;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="22709441-a376-88bd-f7a6-0cc4ee82be94")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,8045729,e=>{"use strict";var t=e.i(847684),i=e.i(7185353),a=e.i(455575),r=e.i(3848416),s=e.i(1717203),l=e.i(7557283),n=e.i(7837522),o=e.i(7780974);e.i(6483798);var c=e.i(8287059),d=e.i(8248823),u=e.i(5338940),g=e.i(8238875),h=e.i(6060673),m=e.i(8366444),p=e.i(3322724),x=e.i(9041876),f=e.i(1688950),j=e.i(3089600),b=e.i(4844919),y=e.i(5255926),v=e.i(1848296),k=e.i(4138437),C=e.i(9722978),S=e.i(57106),N=e.i(7539829),w=e.i(185801);function P(e){return e.loading?(0,t.jsx)(y.Skeleton,{boxHeight:32,vcenter:!0,width:200}):(0,t.jsxs)("span",{children:["Learn more about"," ",(0,t.jsx)(S.Link,{external:!0,href:"/docs/builds/managing-builds#build-machine-types",type:"highlight",children:"Build Machine types"})," ","and"," ",(0,t.jsx)(S.Link,{external:!0,href:"/docs/builds/managing-builds#on-demand-concurrent-builds-pricing",type:"highlight",children:"Pricing"})]})}e.s(["BuildMachineSettings",0,function(){let{project:S}=(0,g.useParams)()??{},{data:R,isLoading:E,mutate:I}=(0,h.useProject)(String(S)),T=(0,r.useRevalidateBuildMachinesCache)(),M=(0,s.default)(),{track:D}=(0,n.useTrackActivity)(),[_,A]=(0,i.useState)();(0,j.default)("source",e=>{A(e)});let{team:L,isLoading:B}=(0,u.useTeam)(),F=L?.billing?.plan==="hobby",z=L?.billing?.plan==="pro",O=L?.billing?.plan==="enterprise",U=L&&(z||O),{data:$}=(0,f.useCopperPrices)(U?L?.slug:void 0,{onDemandConcurrencyMinutes:{model:"matrix"}}),H=(0,c.useOpenUpgradeModal)(),W=(0,p.useIsMobile)(),[q,V]=(0,i.useState)({selected:"standard",defaultSelection:"standard",isSaving:!1,isDirty:!1,savingError:null}),G=(0,i.useCallback)(()=>(0,x.getProjectBuildMachine)(R,L),[R,L]);(0,i.useEffect)(()=>{let e="standard",t="standard";L&&(t=(0,x.getDefaultBuildMachine)(L)),R&&(e=G()),V(i=>({...i,selected:e,defaultSelection:t}))},[R,L,G]);let Q=(0,a.useToasts)();async function Y(){if(L&&void 0!==R&&void 0!==R.accountId&&q.isDirty&&!q.isSaving)try{V(e=>({...e,isSaving:q.isDirty,savingError:null}));let{updateProjectSettingsV9:t}=await e.A(8768757),i={resourceConfig:{}};q.isDirty&&i.resourceConfig&&(i.resourceConfig.buildMachineType="standard"===q.selected?null:q.selected);let a=R.resourceConfig?.buildMachineType,r=await t(String(S),L.id,i),s=r.resourceConfig?.buildMachineType,l=a!==s,n=K()[0];D(o.VercelActivityAction.ProjectSettingsUpdated,{name:"build-machine",projectId:R.id,teamId:L.id,source:_,value:{buildMachineType:s??""}}),l&&Q.success(`Build machine set to ${(0,b.default)(s||n)}.`),await I(),await T(),V(e=>({...e,isSaving:!1,isDirty:!1}))}catch(t){let e=(0,d.errorToString)(t);V(t=>({...t,isSaving:!1,savingError:q.isDirty?e:t.savingError}))}}function K(){return"enhanced"===q.defaultSelection?["enhanced","turbo"]:["standard","enhanced","turbo"]}let Z=E||M.isLoading||B,J=M.isLoading?void 0:M.can(l.Action.Update,l.Resource.BuildMachine),{enabled:X}=(0,m.useOnDemandConcurrentBuilds)(L,J??!1);return(0,t.jsx)(w.ProjectSettingsFieldset,{description:"Choose a larger build machine. Charges apply per minute if it exceeds your team's pre-committed concurrency.",disabled:Z||!X,disabledWall:!F&&void 0,disabledForBilling:!F&&void 0,error:q.savingError,highlightNote:!J,note:(0,t.jsx)(P,{loading:Z}),onSave:Y,saveDisabled:!q.isDirty,saveLoading:q.isSaving,title:"Build Machine",type:"default",children:Z?(0,t.jsx)(y.Skeleton,{height:30,width:128}):(0,t.jsx)("div",{className:"w-full flex flex-col gap-4",id:"enhanced-builds",children:(0,t.jsx)(v.RadioGroup,{onChange:function(e){function t(){V(t=>{var i;return{...t,selected:e,isDirty:(i=e,G()!==i)}})}F?H({teamHint:L?.id,source:_?`build-machine-project.${_}`:"build-machine-project",onConversionSuccess:()=>{t()}}):t()},value:q.selected,children:(0,t.jsx)("div",{className:`flex flex-col ${W?"gap-2":"gap-4"}`,children:K().map(e=>{let i=e===q.selected,a=q.defaultSelection===e;return(0,t.jsx)(y.Skeleton,{show:!1,children:(0,t.jsx)(k.Card,{className:(0,C.clsx)("border p-0 pl-4",{"border-solid border-[var(--ds-blue-700)]":i}),gap:2,padding:4,secondary:i,children:(0,t.jsx)(v.RadioGroup.Item,{className:"items-center",fullWidth:!0,value:e,children:(0,t.jsx)("div",{className:"p-4 pl-2",children:(0,t.jsx)(N.BuildMachineSpecs,{buildMachine:e,isDefault:a,isSelected:i,team:L,prices:$})})})},e)},e)})})})})})}])},1109604,e=>{"use strict";var t=e.i(847684),i=e.i(7185353),a=e.i(455575),r=e.i(1848296),s=e.i(4138437),l=e.i(5255926),n=e.i(3848416),o=e.i(1717203),c=e.i(7557283),d=e.i(7837522),u=e.i(7780974);e.i(6483798);var g=e.i(8287059),h=e.i(8248823),m=e.i(5338940),p=e.i(8238875),x=e.i(6060673),f=e.i(8366444),j=e.i(3322724),b=e.i(9041876),y=e.i(3089600),v=e.i(57106),k=e.i(7812221),C=e.i(185801),S=e.i(9722978);function N(e){return e.loading?(0,t.jsx)(l.Skeleton,{boxHeight:32,vcenter:!0,width:200}):"no-permission"===e.disabledReason?(0,t.jsx)(t.Fragment,{children:"You need additional permissions to manage your project's On-Demand Concurrent Builds."}):"hobby-plan"===e.disabledReason?(0,t.jsxs)("p",{className:"text-copy-14",children:["This feature is available on the"," ",(0,t.jsx)(v.Link,{external:!0,href:"/pricing",tab:!0,type:"highlight",children:"Pro plan"})]}):"enterprise-non-unbundled"===e.disabledReason?(0,t.jsxs)("p",{className:"text-copy-14",children:["To enable On-Demand Concurrent Builds"," ",(0,t.jsx)(v.Link,{external:!0,href:k.CONTACT_SALES_DASHBOARD_HREF,type:"highlight",children:"Contact Sales"})]}):"pro-non-active"===e.disabledReason?(0,t.jsx)("p",{className:"text-copy-14",children:"Upgrade to Pro to enable On-Demand Concurrent Builds."}):(0,t.jsxs)("p",{className:"text-copy-14",children:["Learn more about"," ",(0,t.jsx)(v.Link,{external:!0,href:"/docs/deployments/managing-builds#on-demand-concurrent-builds",type:"highlight",children:"On-Demand Concurrent Builds"})]})}e.s(["ConcurrencySettings",0,function(){let{project:v}=(0,p.useParams)()??{},{data:k,isLoading:w,mutate:P}=(0,x.useProject)(String(v)),R=(0,n.useRevalidateBuildMachinesCache)(),E=(0,o.default)(),{track:I}=(0,d.useTrackActivity)(),[T,M]=(0,i.useState)();(0,y.default)("source",e=>{M(e)});let{team:D,isLoading:_}=(0,m.useTeam)(),A=D?.billing?.plan==="hobby",L=(0,g.useOpenUpgradeModal)(),B=(0,j.useIsMobile)(),[F,z]=(0,i.useState)({selected:"disabled",isSaving:!1,isDirty:!1,savingError:null}),O=(0,i.useCallback)(()=>(0,b.getProjectBuildMachine)(k,D),[k,D]);(0,i.useEffect)(()=>{let e="disabled";if(k){let t=!!k.resourceConfig?.elasticConcurrencyEnabled,i=k.resourceConfig?.buildQueue?.configuration;t&&(e="WAIT_FOR_NAMESPACE_QUEUE"===i?"perBranch":"all")}z(t=>({...t,selected:e}))},[k,D,O]);let U=(0,a.useToasts)();async function $(){if(D&&void 0!==k&&void 0!==k.accountId&&F.isDirty&&!F.isSaving)try{z(e=>({...e,isSaving:F.isDirty,savingError:null}));let{updateProjectSettingsV9:t}=await e.A(8768757),i={resourceConfig:{}};F.isDirty&&i.resourceConfig&&("disabled"===F.selected?i.resourceConfig.elasticConcurrencyEnabled=!1:"perBranch"===F.selected?(i.resourceConfig.elasticConcurrencyEnabled=!0,i.resourceConfig.buildQueue={configuration:"WAIT_FOR_NAMESPACE_QUEUE"}):(i.resourceConfig.elasticConcurrencyEnabled=!0,i.resourceConfig.buildQueue={configuration:"SKIP_NAMESPACE_QUEUE"}));let a={concurrencyEnabled:k.resourceConfig?.elasticConcurrencyEnabled,buildConfiguration:k.resourceConfig?.buildQueue?.configuration},r=await t(String(v),D.id,i),s={concurrencyEnabled:r.resourceConfig?.elasticConcurrencyEnabled,buildConfiguration:r.resourceConfig?.buildQueue?.configuration};(a.concurrencyEnabled!==s.concurrencyEnabled||a.buildConfiguration!==s.buildConfiguration)&&(I(u.VercelActivityAction.ProjectSettingsUpdated,{name:"on-demand-concurrent-builds",projectId:k.id,teamId:D.id,source:T,value:{enabled:s.concurrencyEnabled??!1,buildQueueConfiguration:s.buildConfiguration??null}}),U.success(`Updated On-Demand Concurrent Builds to "${{all:"Run all builds immediately",perBranch:"Run up to one build per branch",disabled:"Disabled on-demand concurrent builds"}[F.selected]}".`)),await P(),await R(),z(e=>({...e,isSaving:!1,isDirty:!1}))}catch(t){let e=(0,h.errorToString)(t);z(t=>({...t,isSaving:!1,savingError:F.isDirty?e:t.savingError}))}}let H=w||E.isLoading||_,W=E.isLoading?void 0:E.can(c.Action.Update,c.Resource.ConcurrentBuilds),{enabled:q,disabledReason:V}=(0,f.useOnDemandConcurrentBuilds)(D,W??!1);return(0,t.jsx)(C.ProjectSettingsFieldset,{description:"Skip the build queue and build deployments immediately. Usage costs apply per build minute.",disabled:H||!q,disabledWall:!A&&void 0,disabledForBilling:!A&&void 0,error:F.savingError,highlightNote:!W,note:(0,t.jsx)(N,{disabledReason:V,loading:H}),onSave:$,saveDisabled:!F.isDirty,saveLoading:F.isSaving,title:"On-Demand Concurrent Builds",type:"default",children:H?(0,t.jsx)(l.Skeleton,{height:30,width:128}):(0,t.jsx)("div",{className:"w-full flex flex-col gap-4",children:(0,t.jsx)(r.RadioGroup,{onChange:e=>(function(e){function t(){z(t=>{var i,a;let r,s;return{...t,selected:e,isDirty:(i=k?.resourceConfig?.elasticConcurrencyEnabled,a=e,r=k?.resourceConfig?.buildQueue?.configuration,s="disabled",i&&(s="WAIT_FOR_NAMESPACE_QUEUE"===r?"perBranch":"all"),s!==a)}})}A?L({teamHint:D?.id,source:T?`on-demand-concurrent-builds-project.${T}`:"on-demand-concurrent-builds-project",onConversionSuccess:()=>{t()}}):t()})(e),value:F.selected,children:(0,t.jsxs)("div",{className:`flex flex-col ${B?"gap-2":"gap-4"}`,children:[(0,t.jsx)(s.Card,{className:(0,S.clsx)("border p-0 pl-4",{"border-solid border-[var(--ds-blue-700)]":"all"===F.selected}),gap:2,padding:4,secondary:"all"===F.selected,children:(0,t.jsx)(r.RadioGroup.Item,{className:"items-center",fullWidth:!0,value:"all",children:(0,t.jsx)("div",{className:"p-4 pl-2",children:(0,t.jsxs)("div",{className:"flex flex-col gap-0",children:[(0,t.jsx)("p",{className:"text-label-14 font-medium",children:"Run all builds immediately"}),(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"Skip the queue for all builds"})]})})})}),(0,t.jsx)(s.Card,{className:(0,S.clsx)("border p-0 pl-4",{"border-solid border-[var(--ds-blue-700)]":"perBranch"===F.selected}),gap:2,padding:4,secondary:"perBranch"===F.selected,children:(0,t.jsx)(r.RadioGroup.Item,{className:"items-center",fullWidth:!0,value:"perBranch",children:(0,t.jsx)("div",{className:"p-4 pl-2",children:(0,t.jsxs)("div",{className:"flex flex-col gap-0",children:[(0,t.jsx)("p",{className:"text-label-14 font-medium",children:"Run up to one build per branch"}),(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"New deployments within a branch are queued"})]})})})}),(0,t.jsx)(s.Card,{className:(0,S.clsx)("border p-0 pl-4",{"border-solid border-[var(--ds-blue-700)]":"disabled"===F.selected}),gap:2,padding:4,secondary:"disabled"===F.selected,children:(0,t.jsx)(r.RadioGroup.Item,{className:"items-center",fullWidth:!0,value:"disabled",children:(0,t.jsx)("div",{className:"p-4 pl-2",children:(0,t.jsxs)("div",{className:"flex flex-col gap-0",children:[(0,t.jsx)("p",{className:"text-label-14 font-medium",children:"Disable on-demand concurrent builds"}),(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"Builds are queued, maximum of one at a time"})]})})})})]})})})})}])},3754632,e=>{"use strict";var t=e.i(847684),i=e.i(8238875),a=e.i(7185353),r=e.i(8248823),s=e.i(5255926),l=e.i(9318197),n=e.i(1906681),o=e.i(455575),c=e.i(57106),d=e.i(4004502),u=e.i(7837522),g=e.i(7780974),h=e.i(5338940),m=e.i(1717203),p=e.i(7557283),x=e.i(8188735),f=e.i(9480212),j=e.i(6060673),b=e.i(185801);e.s(["PrioritizeProductionBuilds",0,function(){let{project:e}=(0,i.useParams)()||{},{data:y,mutate:v}=(0,j.useProject)(String(e)),{team:k,isReady:C}=(0,h.useTeam)(),{can:S,isLoading:N}=(0,m.default)(),{track:w}=(0,u.useTrackActivity)(),P=!!y?.productionDeploymentsFastLane,[R,E,I]=(0,f.default)(P),[T,M]=(0,a.useState)(!1),[D,_]=(0,a.useState)(null),A=N?void 0:S(p.Action.Update,p.Resource.Project),L=(0,o.useToasts)(),B=!y||!e||!C||N,F=!B&&A&&R!==P;async function z(){if(!B){M(!0),_(null);try{await (0,x.updateProjectSettingsV9)(e,k?.id,{productionDeploymentsFastLane:R}),w(g.VercelActivityAction.ProjectSettingsUpdated,{name:"prioritize-production-builds",projectId:y.id,teamId:k?.id??"",value:{enabled:R}}),L.success("Updated Prioritize Production Builds successfully."),I(),await v()}catch(e){_((0,r.errorToString)(e))}finally{M(!1)}}}return(0,t.jsx)(b.ProjectSettingsFieldset,{description:"Builds for Production environment will be prioritized over Pre-Production environments.",disabled:B||!A,error:D,highlightNote:!B&&!A,note:B?(0,t.jsx)(s.Skeleton,{boxHeight:32,vcenter:!0,width:200}):(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:A?(0,t.jsxs)(t.Fragment,{children:["Learn more about"," ",(0,t.jsx)(c.Link,{external:!0,href:"/docs/deployments/concurrent-builds#prioritize-production-builds",type:"highlight",children:"Prioritize Production Builds"})]}):(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"You need additional permissions to manage your project's prioritize production builds setting."})}),onSave:z,saveDisabled:!F,saveLoading:T,title:"Prioritize Production Builds",type:"default",children:B?(0,t.jsx)(s.Skeleton,{height:30,width:128}):(0,t.jsxs)("label",{"data-testid":(0,d.tid)("production-deployments-fastlane","checkbox"),style:{cursor:"pointer"},children:[(0,t.jsx)(n.Toggle,{checked:R,onChange:()=>E(!R),size:"large"}),(0,t.jsx)(l.Spacer,{inline:!0,x:.5}),(0,t.jsx)("span",{className:"text-copy-14",children:R?"Enabled":"Disabled"})]})})}])},7971051,e=>{"use strict";var t=e.i(847684),i=e.i(8238875),a=e.i(7185353),r=e.i(8248823),s=e.i(8522580),l=e.i(5323212),n=e.i(5255926),o=e.i(455575),c=e.i(57106),d=e.i(762945),u=e.i(5338940),g=e.i(1717203),h=e.i(7557283),m=e.i(4450569),p=e.i(6060673),x=e.i(8188735),f=e.i(9480212),j=e.i(185801),b=e.i(2451293),y=e.i(4396019),v=e.i(6625227),k=e.i(5028590),C=e.i(7994132),S=e.i(9722978);function N(e){let{selectedOption:{range:i,discontinueDate:a,link:r,warning:l}}=e;return a?(0,t.jsx)(s.Note,{fill:!0,label:!1,type:"warning",variant:"contrast",children:(0,C.WarningMessage)({selectedOption:{range:i,discontinueDate:a,link:r}})}):l?(0,t.jsx)(s.Note,{fill:!0,label:!1,type:"warning",variant:"contrast",children:l}):void 0}e.s(["default",0,function(){let{project:e}=(0,i.useParams)()||{};if(Array.isArray(e))throw Error("Expected query.project to be string but found array");let{data:s,mutate:w}=(0,p.useProject)(e),{data:P}=(0,y.useProjectProductionDeployment)(s?.id),{data:R}=(0,v.default)(P?.deployment.id),{team:E,isReady:I}=(0,u.useTeam)(),{can:T,isLoading:M}=(0,g.default)(),D=(0,C.getNodeVersions)(),_=s?.nodeVersion||D[0].range,[A,L,B]=(0,f.default)(_),F=D.find(e=>A===e.range)||D[0],[z,O]=(0,a.useState)(!1),[U,$]=(0,a.useState)(null),H=(0,o.useToasts)(),W=!s||!I||M,q=T(h.Action.Update,h.Resource.Project),V=!W&&e&&q&&A!==_,G=(0,a.useMemo)(()=>{if(!R)return!1;let{nodeVersion:e}=R;if(!e||!s)return!1;let{nodeVersion:t}=s;return!!t&&e!==t},[R,s]),Q=(0,a.useMemo)(()=>R?.url?(0,t.jsx)(c.Link,{href:R.inspectorUrl,variant:"highlight",children:R.url}):null,[R]),Y=(0,a.useMemo)(()=>e=>{let{range:t,discontinueDate:i}=e;return t===F.range||!(0,C.isDiscontinued)({discontinueDate:i})},[F]);return(0,t.jsxs)(j.ProjectSettingsFieldset,{description:"The version of Node.js that is used in the Build Step and for Serverless Functions. A new Deployment is required for your changes to take effect.",disabled:W||!q,error:U,highlightNote:!W&&!q,note:W?(0,t.jsx)(n.Skeleton,{boxHeight:32,vcenter:!0,width:200}):q?(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:["Learn more about"," ",(0,t.jsx)(c.Link,{external:!0,href:"/docs/functions/serverless-functions/runtimes/node-js#node.js-version",type:"highlight",children:"Node.js Version"})]}):(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"You need additional permissions to manage your project's node version."}),onSave:async()=>{if(V){O(!0);try{$(null),await (0,x.default)(e,E?.id,{nodeVersion:A}),H.success("Updated Node.js Version successfully."),B(),await w()}catch(e){$((0,r.errorToString)(e))}O(!1)}},saveDisabled:!V,saveLoading:z,title:"Node.js Version",children:[(0,t.jsx)(m.default,{direction:["column","row","row"],gap:.5,children:(0,t.jsx)(m.default,{children:(0,t.jsx)(n.Skeleton,{show:W,children:G?(0,t.jsxs)("div",{className:(0,S.default)("flex flex-col items-stretch justify-start gap-3 flex-initial",b.default.multipleDeploymentSettingStack),children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-1 flex-initial",children:[(0,t.jsx)(d.Warning,{className:`${b.default.warningMessageIcon} geist-hide-on-mobile`}),(0,t.jsx)("p",{className:`text-[14px] leading-[20px] font-medium ${b.default.warningMessageMainText}`,children:"Configuration Settings in the current Production deployment differ from your current Project Settings."})]}),(0,t.jsx)(k.Dropdown,{deploymentLink:Q,title:"Production Overrides",children:(0,t.jsx)(l.Select,{disabled:!0,value:R?.nodeVersion,children:D.filter(Y).map(e=>(0,t.jsx)("option",{value:e.range,children:e.range},e.range))})}),(0,t.jsx)(k.Dropdown,{title:"Project Settings",children:(0,t.jsx)(l.Select,{disabled:W,onChange:e=>L(e.target.value),value:A,children:D.filter(Y).map(e=>(0,t.jsx)("option",{disabled:(0,C.isDiscontinued)(e),value:e.range,children:e.range},e.range))})})]}):(0,t.jsx)(l.Select,{disabled:W,onChange:e=>L(e.target.value),value:A,children:D.filter(Y).map(e=>(0,t.jsx)("option",{disabled:(0,C.isDiscontinued)(e),value:e.range,children:e.range},e.range))})})})}),(0,t.jsx)(m.default,{style:{marginTop:12},children:(0,t.jsx)(N,{selectedOption:F})})]})}])},8577530,e=>{e.v({ujpjic:"root-directory-module__OnK_2q__ujpjic"})},6366455,e=>{"use strict";var t=e.i(847684),i=e.i(9722978),a=e.i(8238875),r=e.i(7185353),s=e.i(5255926),l=e.i(1906681),n=e.i(5468328),o=e.i(455575),c=e.i(57106),d=e.i(5338940),u=e.i(1717203),g=e.i(7557283),h=e.i(8464864),m=e.i(6060673),p=e.i(8188735),x=e.i(9480212),f=e.i(185801),j=e.i(8577530);e.s(["RootDirectory",0,function(){let{project:e}=(0,a.useParams)()||{},{data:b,mutate:y}=(0,m.useProject)(e),{team:v,isReady:k}=(0,d.useTeam)(),{can:C,isLoading:S}=(0,u.default)(),N=b?.rootDirectory||"",w=!!b?.sourceFilesOutsideRootDirectory,[P,R,E]=(0,x.default)(N),[I,T,M]=(0,x.default)(w),D=!!b?.enableAffectedProjectsDeployments,[_,A,L]=(0,x.default)(D),B=P.length>0,F=b?.link?.type==="github",[z,O]=(0,r.useState)(!1),[U,$]=(0,r.useState)(null),H=(0,o.useToasts)(),W=!b||!k||S,q=C(g.Action.Update,g.Resource.Project),V=I!==w,G=P!==N,Q=_!==D,Y=!W&&e&&q&&(V||G||Q);return(0,t.jsx)(f.ProjectSettingsFieldset,{description:"The directory within your project, where your code is located. Leave this field empty if your code is not located in a subdirectory.",disabled:W||!q,error:U,highlightNote:!W&&!q,note:W?(0,t.jsx)(s.Skeleton,{boxHeight:32,vcenter:!0,width:200}):q?(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:["Learn more about"," ",(0,t.jsx)(c.Link,{external:!0,href:"/docs/deployments/configure-a-build#root-directory",type:"highlight",children:"Root Directory"})]}):(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"You need additional permissions to manage your project's root directory."}),onSave:async()=>{if(Y){O(!0);try{$(null),await (0,p.default)(e,v?.id,{rootDirectory:P||null,sourceFilesOutsideRootDirectory:I,enableAffectedProjectsDeployments:_}),H.success("Updated Root Directory successfully."),E(),M(),L(),await y()}catch(e){$(e.message)}O(!1)}},saveDisabled:!Y,saveLoading:z,title:"Root Directory",children:W?(0,t.jsxs)("div",{className:"flex flex-col items-start justify-start gap-4 flex-initial",children:[(0,t.jsx)(s.Skeleton,{height:36,width:300}),(0,t.jsx)(s.Skeleton,{height:20,width:"100%"})]}):(0,t.jsxs)("div",{className:"flex flex-col items-start justify-start gap-4 flex-initial",children:[(0,t.jsx)(h.default,{disabled:z,maxWidth:"100%",onChange:R,placeholder:"",value:P||"",width:"300px"}),(0,t.jsxs)("label",{className:j.default.ujpjic,children:[(0,t.jsxs)("p",{className:"text-copy-14 text-inherit",children:["Include files outside the root directory in the"," ",(0,t.jsx)(c.Link,{external:!0,href:"/docs/deployments/build-step",tab:!0,type:"highlight",children:"Build Step"}),"."]}),(0,t.jsx)(l.Toggle,{"aria-labelledby":"label-for-include-files-outside-root-directory-enabled-toggle",checked:I,direction:"label-first",onChange:()=>T(!I),size:"large",children:(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium normal-case",id:"label-for-include-files-outside-root-directory-enabled-toggle",children:I?"Enabled":"Disabled"})})]}),(0,t.jsx)("hr",{className:"geist-hr-reset w-full"}),(0,t.jsxs)("label",{className:(0,i.clsx)(j.default.ujpjic,{"geist-disabled":!B}),children:[(0,t.jsxs)("p",{className:"text-copy-14 text-inherit",children:[(0,t.jsx)(c.Link,{external:!0,href:"/docs/monorepos#skipping-unaffected-projects",tab:!0,type:"highlight",children:"Skip deployments"})," ","when there are no changes to the root directory or its dependencies."]}),F?(0,t.jsx)(l.Toggle,{"aria-labelledby":"label-for-enable-affected-projects-deployments",checked:_,direction:"label-first",disabled:!B||!F,onChange:()=>A(!_),size:"large",children:(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium normal-case",id:"label-for-enable-affected-projects-deployments",children:_?"Enabled":"Disabled"})}):(0,t.jsx)(n.Tooltip,{text:"Deployment skipping is currently only available for projects connected to GitHub.",children:(0,t.jsx)(l.Toggle,{"aria-labelledby":"label-for-enable-affected-projects-deployments",checked:_,direction:"label-first",disabled:!B||!F,onChange:()=>A(!_),size:"large",children:(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium normal-case",id:"label-for-enable-affected-projects-deployments",children:_?"Enabled":"Disabled"})})})]})]})})}])},5380064,e=>{"use strict";var t=e.i(847684),i=e.i(7185353),a=e.i(1991452),r=e.i(1717203),s=e.i(7557283),l=e.i(6881349),n=e.i(5255926),o=e.i(3671642),c=e.i(5028590),d=e.i(4004502),u=e.i(7710663),g=e.i(4307275),h=e.i(6060673);e.s(["FrameworkSettings",0,function(){let e=(0,a.useRouter)(),{data:m}=(0,u.useFrameworks)(),{project:p}=e.query,{data:x}=(0,h.useProject)(Array.isArray(p)?p[0]:p),[f,j]=(0,i.useState)(null),{can:b,isLoading:y}=(0,r.default)(),v=b(s.Action.Update,s.Resource.Project),k=f??x?.framework??"other",C=(0,i.useMemo)(()=>m?m.find(e=>e.slug===k||!e.slug&&"other"===k):null,[m,k]),S=(0,i.useId)();return(0,t.jsx)(c.BuildDevelopmentSettings,{framework:C,children:(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(n.Skeleton,{height:40,width:"100%",children:(0,t.jsxs)("form",{children:[(0,t.jsx)(o.Label,{id:S,value:"Framework Preset"})," ",(0,t.jsxs)(l.Combobox,{id:S,clearable:!1,disabled:!x||y||!v,onChange:e=>{e!==k&&e&&j(e)},value:k,noRawSelectedValue:!0,children:[(0,t.jsx)(l.Combobox.Input,{"data-testid":(0,d.tid)("project-settings","framework-settings")}),(0,t.jsx)(l.Combobox.List,{children:(0,t.jsx)(g.FrameworkComboboxList,{frameworks:m??null})})]})]})})})})}])},6492790,e=>{"use strict";var t=e.i(847684),i=e.i(1906681),a=e.i(3500331),r=e.i(2504781),s=e.i(5468328),l=e.i(455575),n=e.i(7048904),o=e.i(7722264),c=e.i(6239252),d=e.i(8517043),u=e.i(7137884),g=e.i(1232681),h=e.i(9792418),m=e.i(3895030),p=e.i(7185353),x=e.i(57106),f=e.i(6198010),j=e.i(923772),b=e.i(5756088),y=e.i(5927860),v=e.i(4828269),k=e.i(5644820),C=e.i(1509709),S=e.i(4005781),N=e.i(277234),w=e.i(4244280),P=e.i(6060673),R=e.i(8161149),E=e.i(762945),I=e.i(8172689),T=e.i(1119178),M=e.i(4004502),D=e.i(8238875),_=e.i(1717203),A=e.i(7557283),L=e.i(6891161),B=e.i(199192),F=e.i(883780);function z(e){let{open:i,onConfirm:a,onCancel:r,teamSlug:s,projectSlugOrId:l,billingPlan:n}=e;return(0,t.jsxs)(L.Modal.Modal,{active:i,onClickOutside:r,children:[(0,t.jsxs)(L.Modal.Body,{children:[(0,t.jsx)(L.Modal.Header,{children:(0,t.jsx)(L.Modal.Title,{children:"Enable Rolling Releases"})}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14",children:"We highly recommend enabling Skew Protection when using rolling releases. Skew Protection ensures that every user, whether they get the prior deployment or the release candidate, communicates with the backend code from the matching deployment."}),(0,t.jsxs)("p",{className:"text-copy-14",children:["You can proceed without Skew Protection, but this may lead to version skew issues. You can enable Skew Protection later in deployment settings"," ",(0,t.jsx)(x.Link,{href:`/${s}/${l}/settings/advanced#skew-protection`,target:"_blank",type:"highlight",children:"here"}),"."]}),(0,t.jsxs)("div",{className:"grid grid-cols-[1fr,auto,1fr] items-center gap-1",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-between gap-1 flex-initial p-3 h-full rounded border border-solid border-gray-alpha-400",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"Current"}),(0,t.jsx)("p",{className:"text-copy-14",children:"Disabled"})]}),(0,t.jsx)("div",{className:"flex justify-center items-center rotate-90 md:rotate-0",children:(0,t.jsx)(B.ChevronRightSmall,{color:"gray-900"})}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-between gap-1 flex-initial p-3 h-full rounded border border-solid border-gray-alpha-400",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"Updated"}),(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:n?(0,t.jsxs)("p",{className:"text-copy-14",children:["Max Age: ",(0,F.defaultSkewProtectionMaxAge)(n)]}):(0,t.jsx)("p",{className:"text-copy-14",children:"Enabled"})})]})]}),(0,t.jsxs)("p",{className:"text-copy-14",children:["Learn more about Skew Protection"," ",(0,t.jsx)(x.Link,{href:"/docs/skew-protection",target:"_blank",type:"highlight",children:"Skew Protection"}),"."]})]})]}),(0,t.jsxs)(L.Modal.Actions,{children:[(0,t.jsx)(L.Modal.Action,{onClick:r,type:"secondary",children:"Cancel"}),(0,t.jsx)(L.Modal.Action,{onClick:()=>a(!1),type:"secondary",children:"Enable Without Skew Protection"}),(0,t.jsx)(L.Modal.Action,{onClick:()=>a(!0),children:"Enable Both"})]})]})}var O=e.i(9481787),U=e.i(6630491),$=e.i(901996);function H(e){let{open:i,onConfirm:a,onCancel:r,teamSlug:s,projectSlugOrId:n,rollingRelease:o}=e,[c,d]=(0,p.useTransition)(),u=(0,l.useToasts)(),g=(0,U.useAbortRollingRelease)(),h=(0,$.useCompleteRollingRelease)(),{data:m}=(0,P.useProject)(n),[f,j]=(0,p.useState)("none"),b=(0,O.getDashboardHref)(`/${n}/deployments/rolling-release`,s);return(0,t.jsxs)(L.Modal.Modal,{active:i,onClickOutside:r,children:[(0,t.jsxs)(L.Modal.Body,{children:[(0,t.jsx)(L.Modal.Header,{children:(0,t.jsx)(L.Modal.Title,{children:"Manage active rolling release"})}),(0,t.jsx)("p",{className:"text-copy-16",children:"You have an active rolling release in progress. Disabling rolling releases will prevent new rollouts but won't affect your current active rollout."}),(0,t.jsx)("br",{}),(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:["Check the health of your canary deployment on the"," ",(0,t.jsx)(x.Link,{href:b,prefetch:!0,type:"highlight",className:"inline items-center gap-1",children:"rolling release dashboard"}),"."]})]}),(0,t.jsxs)(L.Modal.Actions,{children:[(0,t.jsx)(L.Modal.Action,{type:"secondary",onClick:()=>{a()},disabled:c,children:"Disable"}),(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)(L.Modal.Action,{type:"tertiary",loading:!!c&&"abort"===f,onClick:()=>{j("abort"),d(async()=>{try{await a(),d(async()=>{try{if(!o||!m?.id)throw Error("Cannot abort rolling release");await g(s,m.id,m.name,o),d(()=>{u.success("Rolling release aborted successfully")})}catch{d(()=>{u.error("Failed to abort rolling release. Please try again."),j("none")})}})}catch{d(()=>{u.error("Failed to disable rolling releases. Please try again."),j("none")})}})},disabled:c,children:"Abort"}),(0,t.jsx)(L.Modal.Action,{type:"secondary",loading:!!c&&"complete"===f,onClick:()=>{j("complete"),d(async()=>{try{await a(),d(async()=>{try{if(!o)throw Error("null rollingRelease");await h(s,n,o),d(()=>{u.success("Rolling release completed successfully")})}catch{d(()=>{u.error("Failed to complete rolling release. Please try again."),j("none")})}})}catch{d(()=>{u.error("Failed to disable rolling releases. Please try again."),j("none")})}})},disabled:c,children:"Complete Rollout"})]})]})]})}var W=e.i(5338940);e.i(3512434);var q=e.i(9835407);let V="manual-approval",G="automatic",Q="final",Y=q.z.number({message:"Percentage must be a number"}).int({message:"Percentage must be an integer"}).min(0,{message:"Percentage must be greater or equal to 0"}).max(100,{message:"Percentage must be less than or equal to 100"}),K=q.z.object({_type:q.z.literal(V),targetPercentage:Y,duration:q.z.null()}),Z=q.z.number({message:"Duration must be a number"}).int({message:"Duration must be an integer"}).positive({message:"Duration must be positive"}).max(1e4,{message:"Duration must be less than or equal to 10,000"}),J=q.z.object({_type:q.z.literal(G),targetPercentage:Y,duration:Z}),X=q.z.object({_type:q.z.literal(Q),targetPercentage:q.z.literal(100)}),ee=q.z.discriminatedUnion("_type",[K,J,X]),et=q.z.array(ee).min(2,{message:"At least 2 stages are required"}).max(10,{message:"Maximum of 10 stages allowed"}).superRefine((e,t)=>{let i=e[e.length-1];100!==i.targetPercentage&&t.addIssue({code:q.z.ZodIssueCode.custom,message:"The final stage must have a percentage of 100.",path:[e.length-1,"targetPercentage"]}),Object.keys(i).some(e=>"targetPercentage"!==e&&"_type"!==e)&&t.addIssue({code:q.z.ZodIssueCode.custom,message:"The final stage can only have the percentage.",path:[e.length-1]});let a=new Set;e.forEach((e,i)=>{a.has(e.targetPercentage)?t.addIssue({code:q.z.ZodIssueCode.custom,message:"Each stage must have a unique percentage.",path:[i,"targetPercentage"]}):a.add(e.targetPercentage)});for(let i=1;i<e.length;i++)e[i].targetPercentage<e[i-1].targetPercentage&&t.addIssue({code:q.z.ZodIssueCode.custom,message:"Each stage must have a higher percentage than the previous stage.",path:[i,"targetPercentage"]})}),ei=q.z.object({enabled:q.z.boolean().describe("Whether rolling releases should be enabled"),stages:et.describe("The stages of a deployment rollout."),advancementType:q.z.enum([V,G]).describe("The type of advancement for the stages."),canaryResponseHeader:q.z.boolean().optional().describe("Whether the request served by a canary deployment should return a header indicating a canary was served."),skewProtection:q.z.boolean().optional().describe("Whether skew protection is enabled.").default(!0)});function ea(e){let{control:i,index:r,advancementType:l}=e;return(0,t.jsx)(v.Controller,{control:i,name:`stages.${r}`,render:e=>{let{field:i,fieldState:r}=e,{value:n}=i;if("final"===n._type)return(0,t.jsx)("div",{});let o=r.error,c=!!(l!==G&&!o?.duration?.message);return(0,t.jsx)("div",{className:"flex flex-col items-center justify-start gap-2 flex-initial",children:(0,t.jsx)(s.Tooltip,{position:"right",disableTriggers:c,text:o?.duration?.message,sticky:!1,desktopOnly:!0,children:(0,t.jsx)(a.Input,{"aria-labelledby":"rolling-release-promotion-time",placeholder:"-",suffix:"min",disabled:l!==G,error:o?.duration?.message,showErrorMessage:!1,className:"w-[64px]",size:"small",onChange:e=>{let t=e.target.value;if(""===t)return i.onChange({...n,duration:null});let a=Number.parseInt(t,10);if(Number.isFinite(a))return i.onChange({...n,_type:G,duration:a})},maxLength:3,minLength:1,value:n.duration?.toString()??"",required:l===G,typeName:"text"})})})}})}var er=e.i(1848296);function es(e){let{control:i}=e,{fields:a,replace:r}=(0,v.useFieldArray)({control:i,name:"stages"});return(0,t.jsx)(v.Controller,{control:i,name:"advancementType",render:e=>{let{field:i}=e;return(0,t.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,t.jsx)("p",{className:"text-label-14",children:"Promote to the next stage:"}),(0,t.jsx)(er.RadioGroup,{onChange:e=>{i.onChange(e),r(a.map(t=>"final"===t._type?t:e===V?{_type:V,targetPercentage:t.targetPercentage,duration:null}:{_type:G,targetPercentage:t.targetPercentage,duration:5}))},value:i.value,children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:[(0,t.jsx)(er.RadioGroup.Item,{className:"items-center",value:V,children:(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:"Manually"})}),(0,t.jsx)(er.RadioGroup.Item,{className:"items-center",value:G,children:(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:"Automatically"})})})]})})]})}})}var el=e.i(3981247);e.i(6483798);var en=e.i(8287059),eo=e.i(7909933),ec=e.i(2547843);function ed(e,t){let{teamIdOrSlug:i,projectSlug:a}=e;return(0,eo.default)(()=>(0,ec.getRollingReleaseBillingEndpoint)(i,a),ec.rollingReleaseBillingFetcher,t)}let eu=e=>{if(!e)return!1;let{availableSlots:t}=e;return"unlimited"===t||t>0};var eg=e.i(8522580),eh=e.i(3405963);function em(e){let{teamSlug:i,projectSlug:a}=e,{data:r}=ed({teamIdOrSlug:i,projectSlug:a});if(!r)return null;let{reason:s,message:l}=r;if("no_available_slots"!==s)return null;{let{enabledProjects:e}=r;if(e.includes(a))return null;let s=RegExp(`(${e.join("|")})`,"g"),n=l.split(s);return(0,t.jsx)(eg.Note,{children:n.map((a,r)=>e.includes(a)?(0,t.jsx)(x.Link,{href:(0,eh.getRollingReleaseSettingsEndpoint)({teamSlug:i,projectSlug:a}),type:"highlight",children:a},`${a}-${r+1}`):a)})}}var ep=e.i(6143247);let ex={enabled:!1,advancementType:V,stages:[{_type:V,targetPercentage:10,duration:null},{_type:Q,targetPercentage:100}],skewProtection:!0,canaryResponseHeader:!1};function ef(e){let R,{teamSlug:E,projectSlugOrId:I}=e,{can:D}=(0,_.default)(void 0,{revalidateOnFocus:!1}),L=D(A.Action.Update,A.Resource.ProjectRollingRelease),{team:B}=(0,W.useTeam)(),F=B?.billing?.plan==="hobby",O=(0,en.useOpenUpgradeModal)(),{data:U,mutate:$}=(0,P.useProject)(I),{data:q}=ed({teamIdOrSlug:E,projectSlug:I}),Y=(0,p.useMemo)(()=>U?.rollingRelease?.stages?{enabled:!F,advancementType:U.rollingRelease.stages.some(e=>e.duration)?G:V,stages:U.rollingRelease.stages.map(e=>{let{targetPercentage:t,duration:i}=e;return 100===t?{_type:Q,targetPercentage:100}:i?{_type:G,targetPercentage:t,duration:i}:{_type:V,targetPercentage:t,duration:null}}),skewProtection:!!U.skewProtectionMaxAge,canaryResponseHeader:U.rollingRelease.canaryResponseHeader}:ex,[U,F]),{control:K,handleSubmit:Z,formState:{isDirty:J,isSubmitting:X,errors:ee},reset:et,getValues:er}=(0,v.useForm)({values:Y,resolver:(0,k.zodResolver)(ei)}),{fields:eo,insert:ec,remove:eg}=(0,v.useFieldArray)({control:K,name:"stages"}),{trigger:eh}=(R=`${(0,w.API_PROJECTS_ROLLING_RELEASE)(I)}/config?slug=${E}`,(0,S.default)(R,async(e,t)=>{let{arg:{enabled:i,stages:a,advancementType:r,canaryResponseHeader:s,skewProtection:l}}=t;return(0,N.fetchAPI)(R,{method:"PATCH",body:JSON.stringify({enabled:i,advancementType:r,stages:a,canaryResponseHeader:s,skewProtection:l}),throwOnHTTPError:!0})})),[ef,ej]=(0,p.useState)(!1),[eb,ey]=(0,p.useState)(!1),ev=(0,p.useRef)(null),{data:ek,isLoading:eC}=(0,el.useRollingRelease)({teamIdOrSlug:E,projectSlug:I}),eS=ek?.rollingRelease?.state==="ACTIVE",eN=!L||X,ew=(0,v.useWatch)({control:K,name:"enabled"}),eP=async e=>{let{enabled:t,advancementType:i,stages:a,skewProtection:r}=e;try{let e=t?a.map(e=>e._type===Q||e._type===V?{targetPercentage:e.targetPercentage}:{targetPercentage:e.targetPercentage,duration:e.duration}):void 0;await eh({enabled:t,advancementType:i,stages:e,skewProtection:r,canaryResponseHeader:U?.rollingRelease?.canaryResponseHeader}),l.toasts.success("Rolling release settings saved successfully."),await $(),t||et({enabled:!1,stages:ex.stages},{keepDirty:!1})}catch(e){(0,o.isError)(e)&&"CustomFetchError"===e.name?l.toasts.error(e.message):l.toasts.error("Failed to save rolling release settings. Please try again."),(0,C.captureException)(e,{attributes:{teamSlug:E,projectSlugOrId:I,envIdOrSlug:y.EnvTarget.Production}})}},eR=async e=>{if(!q)return void l.toasts.error("Unknown rolling release billing status.");let t=Y.enabled,{enabled:i}=e;if(t&&!i&&eS){ev.current=e,ey(!0);return}if(!t&&i){if(!eu(q))return void l.toasts.error(q.message);if(!U?.skewProtectionMaxAge){ev.current=e,ej(!0);return}}return eP(e)},eE=(0,v.useWatch)({control:K,name:"advancementType"}),eI=eE===G;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("form",{onSubmit:(0,T.promiseToCallback)(Z(eR)),id:`${"rolling releases".replaceAll(" ","-")}`,children:(0,t.jsxs)(d.Fieldset,{disabled:eN,"data-testid":(0,M.tid)("project-settings","Rolling Releases"),children:[(0,t.jsxs)(u.FieldsetContent,{disabled:!F&&eN,children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)(h.FieldsetTitle,{children:(0,t.jsx)("a",{href:`#${"rolling releases".replaceAll(" ","-")}`,style:{color:"inherit",textDecoration:"none"},children:(0,t.jsx)(c.SearchContextHighlighter,{children:"Rolling Releases"})})})}),(0,t.jsx)(m.FieldsetSubtitle,{children:"Configure rolling release settings for your production environment. Rolling releases allow you to gradually deploy changes to users by defining a percentage of traffic for each stage."}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial mt-4",children:[(0,t.jsx)(em,{teamSlug:E,projectSlug:I}),(0,t.jsx)(v.Controller,{control:K,name:"enabled",render:e=>{let{field:{onChange:a,value:r,name:s}}=e;return(0,t.jsx)(i.Toggle,{checked:!!r,name:s,className:"flex w-fit justify-end p-0 cursor-pointer disabled:cursor-not-allowed",direction:"switch-first",id:"rolling-release-toggle",disabled:!F&&!ew&&!eu(q),onChange:e=>{function t(){a(e),e&&et({...ex,enabled:!0},{keepDefaultValues:!0,keepDirty:!0,keepTouched:!0,keepIsValid:!0})}F?O({teamHint:B.id,source:"rolling-releases",onConversionSuccess:()=>{t()}}):t()},size:"large",children:(0,t.jsx)("span",{className:(0,ep.cn)("!text-label-14",eN?"text-gray-900":"text-gray-1000"),children:r?"Enabled":"Disabled"})})}}),ew?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h3",{className:"text-heading-16 font-medium",children:"Stages"}),(0,t.jsx)("p",{className:"text-label-14 text-gray-900",children:"Define the percentage of traffic for each stage."})]}),(0,t.jsxs)("div",{className:"flex items-end justify-between mb-4",children:[(0,t.jsx)(es,{control:K}),(0,t.jsx)(s.Tooltip,{disableTriggers:eo.length<10,text:"Maximum of 10 stages allowed",children:(0,t.jsx)(r.Button,{disabled:eo.length>=10||eN,onClick:()=>{let[e,t]=er(["stages","advancementType"]);if(e.length>=10)return void l.toasts.error("Maximum of 10 stages allowed");let i=0;if(e.length>0){let t=Math.max(0,...e.filter(e=>100!==e.targetPercentage).map(e=>e.targetPercentage||0)),a=25;t+25>=100&&(a=Math.max(1,Math.floor(25/Math.ceil(25/(100-t))))),i=Math.min(t+a,99)}t===G?ec(e.length-1,{_type:G,targetPercentage:i,duration:5}):ec(e.length-1,{_type:V,targetPercentage:i,duration:null})},prefix:(0,t.jsx)(f.Plus,{size:16}),size:"small",type:"secondary",typeName:"button",children:"Add Stage"})})]})]}),(0,t.jsx)("div",{className:`grid ${eI?"grid-cols-[auto_1fr_auto_auto_auto]":"grid-cols-[auto_1fr_auto]"} items-center gap-3 overflow-x-auto p-1`,children:eo.flatMap((e,i)=>{let o=i===eo.length-1,c=1===eo.length,d="The final stage must be set to 100%",u=(0,t.jsx)(v.Controller,{control:K,name:`stages.${i}.targetPercentage`,render:e=>{let{field:{onChange:r,value:l},fieldState:{error:n}}=e,c=!o&&!n?.message,u=o?d:n?.message;return(0,t.jsx)(s.Tooltip,{desktopOnly:!0,disableTriggers:c,text:u,children:(0,t.jsx)(a.Input,{"aria-label":`Stage ${i+1}`,disabled:eN||o,id:`stage-${i}`,error:n?.message,showErrorMessage:!1,max:100,min:0,size:"small",className:"w-[64px]",onChange:e=>{let t=e.target.value;if(""===t)return void r(0);let i=Number.parseInt(t,10);Number.isFinite(i)&&i>=0&&i<=100&&r(i)},suffix:"%",value:l.toString()})})}},`${e.id}_percentageInput`),g=(0,t.jsx)(v.Controller,{control:K,name:`stages.${i}.targetPercentage`,render:e=>{let{field:{onChange:i,value:a}}=e;return(0,t.jsx)(s.Tooltip,{disableTriggers:!o,text:d,desktopOnly:!0,children:(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(n.Slider,{disabled:eN||o,fullWidth:!0,max:99,min:0,onValueChange:e=>i(e[0]),step:5,value:[a]})})})}},`${e.id}_slider`),h=(0,t.jsx)(ea,{control:K,advancementType:eE,index:i},`${e.id}_stageDuration`),m=(0,t.jsx)("div",{...o?{}:{className:"h-6 w-px bg-gray-400 "}},`${e.id}_divider`);return[u,g,...eI?[h,m]:[],o?(0,t.jsx)(s.Tooltip,{text:d,desktopOnly:!0,children:(0,t.jsx)(r.Button,{disabled:!0,shape:"square",size:"small",type:"secondary",typeName:"button",children:(0,t.jsx)(b.LockClosed,{size:16})})},`${e.id}_removeButton`):(0,t.jsx)(s.Tooltip,{disableTriggers:!c,text:"At least one stage is required.",children:(0,t.jsx)(r.Button,{disabled:eo.length<=1||eN,onClick:()=>{eo.length<=1?l.toasts.error("At least one stage is required"):eg(i)},shape:"square",size:"small",type:"secondary",typeName:"button",children:(0,t.jsx)(j.Trash,{size:16})})},`${e.id}_removeButton`)]})}),ee.stages?.message?(0,t.jsx)("p",{className:"text-copy-14 text-red-900",children:String(ee.stages.message)}):null]})}):null]})]}),(0,t.jsx)(g.FieldsetFooter,{children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between flex-initial w-full",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:F?(0,t.jsxs)(t.Fragment,{children:["This feature is available on the"," ",(0,t.jsx)(x.Link,{external:!0,href:"/pricing",tab:!0,type:"highlight",children:"Pro plan"})]}):L?(0,t.jsxs)(t.Fragment,{children:["Learn more about"," ",(0,t.jsx)(x.Link,{external:!0,href:"/docs/rolling-releases",target:"_blank",type:"highlight",children:"Rolling Releases"})]}):(0,t.jsx)(t.Fragment,{children:"You need additional permissions to manage rolling releases."})}),(0,t.jsx)(r.Button,{disabled:eN||!J,loading:X||eC,size:"small",typeName:"submit",children:"Save"})]})})]})}),(0,t.jsx)(z,{open:ef,onConfirm:e=>{ej(!1);let t=ev.current;Z(()=>{if(!t)return;let i=eP({...t,skewProtection:e});return ev.current=null,i})()},onCancel:()=>{ej(!1),ev.current=null},teamSlug:E,projectSlugOrId:I,billingPlan:B?.billing?.plan}),(0,t.jsx)(H,{open:eb,onConfirm:()=>(ey(!1),Z(()=>{if(!ev.current)return;let e=eP(ev.current);return ev.current=null,e})()),onCancel:()=>{ey(!1),ev.current=null},teamSlug:E,projectSlugOrId:I,rollingRelease:ek?.rollingRelease})]})}e.s(["RollingReleases",0,function(e){let{variants:i}=e,{project:a,teamSlug:r}=(0,D.useParams)()??{};return i.enableRollingReleases&&"string"==typeof a&&"string"==typeof r?(0,t.jsx)(I.ErrorBoundary,{fallback:(0,t.jsx)(R.EmptyState.Root,{description:"Please try reloading the page.",icon:(0,t.jsx)(R.EmptyState.Icon,{icon:(0,t.jsx)(E.Warning,{size:32})}),title:"Error loading rolling releases configuration"}),children:(0,t.jsx)(ef,{projectSlugOrId:a,teamSlug:r})}):null}],6492790)},5866850,e=>{"use strict";var t=e.i(847684),i=e.i(1282571),a=e.i(6352514),r=e.i(4759942),s=e.i(5838262),l=e.i(3938505),n=e.i(9099168),o=e.i(2064047),c=e.i(8674454),d=e.i(6694387),u=e.i(4991687),g=e.i(8459493),h=e.i(7448864),m=e.i(5255926),p=e.i(1906681),x=e.i(5468328),f=e.i(6317369),j=e.i(5787344),b=e.i(7674801),y=e.i(5018193),v=e.i(8876434),k=e.i(109803),C=e.i(509783),S=e.i(7185353),N=e.i(3306538);let w={preview:(0,t.jsx)(N.Badge,{variant:"purple-subtle",children:"Preview"}),production:(0,t.jsx)(N.Badge,{variant:"blue-subtle",children:"Production"})};function P(e){let{check:i}=e,a=[];for(let e of i.targets)e in w&&a.push(w[e]);return"none"===i.blocks?a.push((0,t.jsx)(N.Badge,{variant:"gray-subtle",children:"Non-blocking"})):a.push((0,t.jsx)(N.Badge,{variant:"red-subtle",children:"Blocking"})),(0,t.jsx)("div",{className:"group flex gap-1",children:a.map((e,i)=>{let r=(a.length-1-i)*36;return(0,t.jsx)("div",{className:"transition-transform duration-300 group-hover:!translate-x-0",style:{transform:`translateX(${r}px)`},children:e},i)})})}var R=e.i(6891161),E=e.i(847180),I=e.i(5338940),T=e.i(455575);function M(e){let{check:i,isOpen:s,onClose:l,onDeleted:n}=e,{team:o}=(0,I.useTeam)(),c=(0,T.useToasts)(),{trigger:d,isMutating:u}=(0,E.useDeleteProjectCheck)({teamId:o?.id,projectId:i.projectId,checkId:i.id}),g=async()=>{try{await d(),r.analytics.track(a.AnalyticsEvent.PROMOTION_REQUIREMENTS_CHECK_DELETED,{teamId:o?.id,projectId:i.projectId}),l(),n()}catch{c.error("Failed to delete check.")}};return(0,t.jsxs)(R.Modal.Modal,{active:s,onClickOutside:()=>{u||l()},children:[(0,t.jsx)(R.Modal.Body,{children:(0,t.jsxs)("div",{className:"flex flex-col items-start justify-start gap-4 flex-initial",children:[(0,t.jsx)(R.Modal.Title,{children:"Delete Check"}),(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:['Are you sure you want to delete "',i.name,'"? This action cannot be undone.']})]})}),(0,t.jsxs)(R.Modal.Actions,{children:[(0,t.jsx)(R.Modal.Action,{disabled:u,onClick:()=>{r.analytics.track(a.AnalyticsEvent.CLICK_EVENT,{click_name:"promotion_requirements_delete_check_modal_cancel_button_click",click_value:"Clicked to cancel delete check modal"}),l()},type:"secondary",children:"Cancel"}),(0,t.jsx)(R.Modal.Action,{loading:u,onClick:g,type:"error",children:"Delete Check"})]})]})}var D=e.i(7743427),_=e.i(1717203),A=e.i(7557283),L=e.i(472117),B=e.i(4597921),F=e.i(6318858);let z=[{label:"All Checks",value:"all_checks"},{label:"Git Providers",value:"git_providers"},{label:"Webhooks",value:"webhooks"},{label:"Integrations",value:"integrations"}];function O(e){return(0,t.jsxs)(u.MenuContainer,{children:[(0,t.jsx)(d.MenuButton,{showChevron:!0,type:"secondary",size:"small",className:e.className,children:z.find(t=>t.value===e.selectedFilter)?.label}),(0,t.jsx)(c.Menu,{width:200,children:z.map(i=>{let{value:a,label:r}=i,s=e.selectedFilter===a;return(0,t.jsxs)(g.MenuItem,{onClick:()=>{e.onFilterChange(a)},children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)("span",{children:r})}),(0,t.jsx)("div",{className:"flex-0",children:s?(0,t.jsx)(F.Check,{}):null})]},a)})})]})}var U=e.i(8525850);e.i(553769);var $=e.i(3758860);function H(){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)(m.Skeleton,{height:32,width:112}),(0,t.jsx)(m.Skeleton,{height:32,width:160,className:"md:ml-auto"})]}),(0,t.jsx)("div",{className:"flex flex-col gap-4",children:["skeleton-1","skeleton-2","skeleton-3"].map(e=>(0,t.jsx)(W,{},e))})]})}function W(){return(0,t.jsx)(o.Entity,{className:"rounded border border-gray-400",left:(0,t.jsx)("div",{className:"flex size-9 items-center justify-center rounded-[50%]",children:(0,t.jsx)(m.Skeleton,{height:24,width:24})}),right:(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)(m.Skeleton,{height:24,width:64,pill:!0}),(0,t.jsx)(m.Skeleton,{height:24,width:48,pill:!0})]}),(0,t.jsx)(m.Skeleton,{height:24,width:24})]}),children:(0,t.jsx)(o.Entity.Content,{title:(0,t.jsx)(m.Skeleton,{height:20,width:128}),description:(0,t.jsx)(m.Skeleton,{height:16,width:96,className:"mt-1"})})})}function q(e){let s,l,n,[m,N]=(0,S.useState)("none"!==e.check.blocks),[w,R]=(0,S.useState)(!1),{team:L}=(0,I.useTeam)(),{can:B}=(0,_.default)({projectIdOrName:e.check.projectId}),{trigger:F,isMutating:z}=(0,E.useUpdateProjectCheckBlockingStatus)({teamId:L?.id,projectId:e.check.projectId,checkId:e.check.id}),O=(0,T.useToasts)(),H=e.check,W=H.source,q="integration"===W.kind&&"integrationId"in W?W.integrationId:void 0,{data:V}=(0,D.useIntegration)(q,{teamId:L?.id});if("webhook"===W.kind)s=(0,t.jsx)("div",{className:"flex size-9 items-center justify-center rounded-[50%] border border-[var(--accents-2)]",children:(0,t.jsx)(C.Webhook,{className:"size-6"})}),l="Webhook";else if("git-provider"===W.kind){let e;switch(W.provider){case"github":l="GitHub",e=b.LogoGithub;break;case"gitlab":l="GitLab",e=y.LogoGitlab;break;case"bitbucket":l="Bitbucket",e=j.LogoBitbucketColor;break;default:l="Git Provider",e=f.GitPullRequest}s=(0,t.jsx)("div",{className:"flex size-9 items-center justify-center rounded-[50%] border border-[var(--accents-2)]",children:(0,t.jsx)(e,{className:"size-6"})})}else V?(s=(0,t.jsx)(i.MarketplaceIntegrationCardIcon,{icon:V.icon,name:V.name}),n=e.resources?.find(e=>e.id===W.resourceId),l=n?.name||V.name):l="Integration";let G=B(A.Action.Delete,A.Resource.DeploymentCheck)?(0,t.jsx)(g.MenuItem,{type:"error",onClick:()=>{R(!0),r.analytics.track(a.AnalyticsEvent.CLICK_EVENT,{click_name:"promotion_requirements_table_view_delete_check_button_click",click_value:`Clicked to delete check "${H.name}"`})},children:"Delete Check"}):(0,t.jsx)(x.Tooltip,{text:"You don't have permission to delete this check. Ask your team admin to delete it or grant you a member role or higher.",maxWidth:"100%",children:(0,t.jsx)(h.MenuItemLocked,{type:"error",children:"Delete Check"})});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Entity,{className:"rounded border border-gray-400",left:s,right:(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)(P,{check:{...e.check,blocks:m?"deployment-alias":"none"}}),(0,t.jsxs)(u.MenuContainer,{children:[(0,t.jsx)(d.MenuButton,{variant:"unstyled",className:"rounded transition duration-300 hover:bg-gray-100",children:(0,t.jsx)(v.MoreHorizontal,{})}),(0,t.jsx)(c.Menu,{className:"min-w-[250px]",children:(0,t.jsxs)("div",{className:"flex flex-col items-start gap-2",children:["git-provider"!==W.kind&&(0,t.jsx)(x.Tooltip,{disableTriggers:B(A.Action.Update,A.Resource.DeploymentCheck),text:"You don't have permission to update this check. Ask your team admin to update it or grant you a member role or higher.",maxWidth:"100%",children:(0,t.jsx)(p.Toggle,{checked:m,disabled:z||!B(A.Action.Update,A.Resource.DeploymentCheck),direction:"switch-first",onChange:async()=>{try{await F({blocking:!m}),N(!m)}catch{O.error("Failed to update check blocking status.")}},size:"large",children:"Blocking"})}),V&&"externalResourceId"in W&&"integrationConfigurationId"in W&&(0,t.jsx)(g.MenuItem,{className:"no-underline",href:(0,$.getIntegrationDeepLink)({externalResourceId:W.externalResourceId,teamIdOrSlug:e.teamSlug,projectId:e.check.projectId,checkId:e.check.id,integrationConfigurationId:W.integrationConfigurationId}),prefetch:!1,isLink:!0,target:"_blank",suffix:(0,t.jsx)(k.External,{}),children:`Open in ${V.name}`}),n&&(0,t.jsxs)(g.MenuItem,{className:"no-underline",href:(0,U.getResourceDetailsPath)(n,e.teamSlug),prefetch:!1,isLink:!0,children:["View ",n.name]}),G]})})]})]}),children:(0,t.jsx)(o.Entity.Content,{title:(0,t.jsx)("p",{className:"text-copy-14 text-sm font-medium",children:H.name}),description:l})}),(0,t.jsx)(M,{check:e.check,isOpen:w,onClose:()=>R(!1),onDeleted:e.onCheckDeleted})]})}e.s(["ChecksList",0,function(e){let[i,a]=(0,S.useState)("all_checks"),r=(0,s.useChecksData)(),o=(0,L.useCiChecksAndPoliciesFlagV2)(),c=(0,L.useChecksPrivateBetaFlag)(),d=(0,B.useServerFlag)("enable-integrations-in-add-check",!1),{data:u,mutate:g,isLoading:h}=(0,E.useProjectChecks)({teamId:e.teamSlug,projectId:e.projectIdOrName,enableCiChecksAndPolicies:o||c}),m=(0,S.useMemo)(()=>u?.checks?u.checks.filter(e=>{switch(i){case"git_providers":return"git-provider"===e.source.kind;case"webhooks":return"webhook"===e.source.kind;case"integrations":return"integration"===e.source.kind;default:return!0}}):null,[u?.checks,i]);return h||e.isLoadingOverride?(0,t.jsx)(H,{}):m&&(0!==m.length||"all_checks"!==i)?(0,t.jsxs)(t.Fragment,{children:[o&&(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)(n.AddChecksButton,{}),c&&!d&&(0,t.jsx)(l.InstallChecksButton,{availableList:r,showLearnMoreLink:!1,showPlusSuffix:!1}),(0,t.jsx)(O,{selectedFilter:i,onFilterChange:a,className:"md:ml-auto"})]}),(0,t.jsx)("div",{className:"flex flex-col gap-4",children:m.toSorted((e,t)=>{let i="none"!==e.blocks,a="none"!==t.blocks;return i!==a?a?1:-1:e.name!==t.name?e.name.localeCompare(t.name):e.id<t.id?-1:1}).map(i=>(0,t.jsx)(q,{check:i,resources:r.resources,teamSlug:e.teamSlug,onCheckDeleted:async()=>{await g()}},i.id))})]}):(0,t.jsx)(s.EmptyChecksCard,{})}],5866850)}]);

//# debugId=22709441-a376-88bd-f7a6-0cc4ee82be94
//# sourceMappingURL=9fc46c44392e6fef.js.map