;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="bdbf0132-be13-38f7-18a1-355f128a6439")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,4422059,e=>{"use strict";var t=e.i(7185353);e.s(["usePrevious",0,function(e){let n=(0,t.useRef)(void 0);return(0,t.useEffect)(()=>{n.current=e}),n.current}])},1627296,e=>{"use strict";var t=e.i(847684),n=e.i(7185353),i=e.i(8735244);e.s(["LoadMore",0,function(e){let{swr:r}=e,s=(0,n.useRef)(null),[l,o]=(0,n.useState)(!1),{loadMore:a,isReachingEnd:c,isLoadingMore:d,initialDataLoaded:u}=r;return((0,n.useEffect)(()=>{u&&!c&&!d&&l&&a()},[u,l,d,c,a]),(0,n.useEffect)(()=>{let e=s.current;if(!e)return;let t=new IntersectionObserver(e=>{o(e[0].isIntersecting)});return t.observe(e),()=>{t.disconnect()}},[o]),!u||c)?null:(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-center flex-initial py-2",style:{position:"relative"},children:[(0,t.jsx)("div",{ref:s,style:{position:"absolute",top:"-150px"}}),d?(0,t.jsx)(i.Spinner,{}):null]})}])},1288475,e=>{"use strict";let t=(0,e.i(9334638).withNewIcon)('<path d="M13 8C13 10.7614 10.7614 13 8 13C5.23858 13 3 10.7614 3 8C3 5.23858 5.23858 3 8 3C10.7614 3 13 5.23858 13 8Z" fill="currentColor"/>');e.s(["Status",0,t])},9186321,e=>{"use strict";var t,n=((t={}).MarketplaceStrictAdmin="marketplace-strict-admin",t.MarketplaceDeploymentActions="marketplace-deployment-actions",t.MarketplaceInstallationOnlyPlan="marketplace-installation-only-plan",t.MarketplaceInstallationDeletePendingAt="marketplace-installation-delete-pending-at",t.MarketplaceIntegrationSupportsResourceClaim="marketplace-integration-supports-resource-claim",t.MarketplaceSsoV2="marketplace-sso-v2",t.MarketplaceMcp="marketplace-mcp",t.AwsIntegration="aws-integration",t);e.s(["LaunchDarklyIntegrationFlags",()=>n])},8020240,e=>{"use strict";var t=e.i(847684),n=e.i(6607601),i=e.i(5744676),r=e.i(1919132);function s(e){return i.LogSourcesWithDescription.find(t=>t.value===e)?.label??e}e.s(["LogDrainConnection",0,function(e){let{connection:i,inlineCode:l,wrap:o}=e,a=(0,r.getLogDrainProtocolSettings)(i);if(!a)return null;let c=`Sampling ${100*a.samplingRate}%`,d=`${a.sources.map(s).join(", ")}, ${c}`;return l||o?(0,t.jsx)("div",{className:"flex flex-row items-stretch justify-end gap-1 flex-initial w-full flex-wrap",children:l?(0,t.jsxs)(t.Fragment,{children:[a.sources.map(e=>(0,t.jsx)("div",{children:(0,t.jsx)(n.InlineCode,{children:s(e)})},e)),(0,t.jsx)("div",{children:(0,t.jsx)(n.InlineCode,{children:c})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900 text-end",children:a.sources.map(s).join(", ")}),",",(0,t.jsx)("p",{className:"text-copy-14 text-gray-900 text-end",children:c})]})}):(0,t.jsx)("p",{className:"text-copy-13-mono text-gray-900 truncate whitespace-nowrap rounded-[var(--geist-radius)] bg-[var(--accents-2)] px-[4px]",title:d,children:d})}])},156530,e=>{"use strict";var t=e.i(7185353);e.s(["useModalState",0,function(e){let[n,i]=(0,t.useState)(!1),r=(0,t.useCallback)(()=>{i(!1)},[]),s=(0,t.useCallback)(()=>{i(!0)},[]),[l,o]=(0,t.useState)(0),a=(0,t.useCallback)(()=>{o(e=>e+1)},[o]);return[s,{active:n,onClickOutside:r,key:`${e}${String(l)}`,onAnimationDone:a}]}])},1919132,e=>{"use strict";function t(e){return e.protocolSettings?.logDrain}e.s(["CONNECT_PROJECT_LABEL",0,"Connect Project","PROJECTS_LABEL",0,"Projects","PROJECT_CONNECTIONS_DESCRIPTION",0,"These are the projects that are connected to this product.","getLogDrainProtocol",0,function(e){return e.protocols.logDrain},"getLogDrainProtocolSettings",0,t,"isLogDrainInConnection",0,function(e){return!!t(e)}])},5744676,e=>{"use strict";var t,n=((t={}).JSON="json",t.NDJSON="ndjson",t);e.s(["DeliveryFormats",()=>n,"LogSourcesWithDescription",0,[{label:"Static",value:"static",description:"Requests to static assets like HTML and CSS files"},{label:"External",value:"external",description:"External rewrites to a different domain"},{label:"Edge",value:"edge",description:"Output from Edge Functions like Middleware"},{label:"Build",value:"build",description:"Output from the Build Step"},{label:"Function",value:"lambda",description:"Output from Vercel Functions like API Routes"},{label:"Firewall",value:"firewall",description:"Requests rejected by the Vercel Firewall"}]])},5098510,7195573,e=>{"use strict";var t=e.i(847684),n=e.i(7185353),i=e.i(2560270),r=e.i(7399351),s=e.i(6048771),l=e.i(1919132),o=e.i(5927860);function a(e){return e===o.EnvTarget.Production?"Production":e===o.EnvTarget.Preview?"Preview":"Development"}e.s(["stringifyTarget",0,a],7195573);var c=e.i(8020240),d=e.i(9722978);function u(e){let{connection:n,index:i}=e,r=3===n.environments.length?"All Environments":n.environments.map(a).join(", ");return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,d.clsx)("flex flex-row items-center justify-between gap-2 flex-initial rounded-md p-2",i%2==1&&"bg-[var(--accents-1)]"),children:[(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)(s.ProjectLogo,{deploymentId:n.latestDeployment,framework:n.framework,project:n,size:20}),(0,t.jsx)("p",{className:"text-copy-14",children:n.name})]}),(0,t.jsx)("div",{color:"gray-900",className:"flex flex-row items-stretch justify-start gap-2 flex-initial",children:(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:r})})]},n.id),(0,l.isLogDrainInConnection)(n)?(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium shrink-0",children:"Log Drain"}),(0,t.jsx)(c.LogDrainConnection,{connection:n,wrap:!0})]},n.id):null]})}e.s(["ProjectConnectionsListInModal",0,function(e){let{connections:s,className:l}=e,[o,a]=(0,n.useState)(!1);if(1===s.length)return(0,t.jsx)(u,{connection:s[0],index:0});let c=o?s:s.slice(0,2);return(0,t.jsxs)("div",{className:(0,d.clsx)("flex flex-col items-stretch justify-start flex-initial p-2 'border-1 relative rounded-md border-gray-alpha-400 bg-[var(--geist-background)] shadow-border",l),children:[s.length>2?(0,t.jsx)("div",{onClick:()=>a(!o),className:"flex flex-col items-center justify-center flex-initial absolute -bottom-3 right-[calc(50%-12px)] size-6 rounded-full border border-solid border-gray-400 bg-background-100",children:o?(0,t.jsx)(r.ChevronUp,{}):(0,t.jsx)(i.ChevronDown,{})}):null,c.map((e,n)=>(0,t.jsx)(u,{connection:e,index:n},e.id))]})}],5098510)},8740003,4404233,e=>{"use strict";var t=e.i(706035);let n=(0,t.createServerReference)("407d4c07ebed1b0143721ba80ba4cd386e4f4e7267",t.callServer,void 0,t.findSourceMapURL,"blockConnectionUntilResourceIsAvailable");e.s(["blockConnectionUntilResourceIsAvailable",0,n],8740003),e.s(["areResourceDeploymentsEnabled",0,function(e){if(!e)return!1;if("protocols"in e)return e.protocols.storage?.status==="enabled";if("product"in e){let t=e.product;if("supportedProtocols"in t)return t.supportedProtocols.includes("storage")}return!1}],4404233)},5393630,e=>{"use strict";var t=e.i(847684),n=e.i(1288475),i=e.i(5255926),r=e.i(3306538),s=e.i(5468328);function l(e){let{label:i,type:r}=e,s="teal-600";return"error"===r?s="red-700":"init"===r?s="gray-500":"warning"===r&&(s="amber-600"),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:[(0,t.jsx)(n.Status,{color:s}),(0,t.jsx)("p",{className:"text-copy-14",children:i})]})}function o(e){let{label:n}=e;return(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:(0,t.jsx)(r.Badge,{variant:"red",children:n})})}e.s(["ResourceStatus",0,function(e){let{resource:n}=e;switch(n?.status){case"suspended":return(0,t.jsx)(o,{label:"Suspended"});case"limits-exceeded-suspended":return(0,t.jsx)(o,{label:"Limits Exceeded"});case"limits-exceeded-suspended-store-count":return(0,t.jsx)(o,{label:"Store Count Limit Reached"});case"available":return(0,t.jsx)(l,{label:"Available",type:"ok"});case"error":return(0,t.jsx)(l,{label:"Error",type:"error"});case"initializing":return(0,t.jsx)(l,{label:"Initializing",type:"init"});case"onboarding":return(0,t.jsx)(s.Tooltip,{text:"Additional onboarding is required to enable all features. Please complete the setup in the partner dashboard.",children:(0,t.jsx)(l,{label:"Onboarding",type:"warning"})});case"uninstalled":return(0,t.jsx)(l,{label:"Uninstalled",type:"error"});default:return(0,t.jsx)(i.Skeleton,{boxHeight:20,height:16,vcenter:!0,width:114})}}])},8824424,e=>{"use strict";var t=e.i(847684),n=e.i(7185353),i=e.i(1360174),r=e.i(3306538),s=e.i(6881349),l=e.i(8522580),o=e.i(5169576),a=e.i(2107254),c=e.i(4004502),d=e.i(6048771),u=e.i(1627296);e.s(["ResourceProjectSelector",0,function(e){let{allowSelectConnectedProjects:x,selectedProject:p,account:m,onProjectSelected:f,resource:g,resourceTitle:j,...h}=e,[v,y]=(0,n.useState)(""),b=(0,n.useMemo)(()=>(0,i.default)(y,500),[]),[,C]=(0,a.useProjectListInfinite)({limit:20,search:v,latestDeployments:0,slug:m},{},!1,!0),N=C.initialDataLoaded,w=e=>!!e&&("connectedProjectIds"in h?h.connectedProjectIds.includes(e.id):h.includedInConnectedProjects(e)),P=w(p),S=(0,n.useCallback)(e=>{let t=g?.projectFilter;if(!t||0===Object.keys(t).length)return!1;if(t.git){let{git:n}=t,i=function(e){if(!e)return null;switch(e.type){case"github":return{provider:"github",id:e.repoOwnerId?String(e.repoOwnerId):e.org,slug:e.org};case"gitlab":return{provider:"gitlab",id:e.projectNamespace,slug:e.projectNamespace};case"bitbucket":return{provider:"bitbucket",id:e.workspaceUuid,slug:e.owner};default:return null}}(e.link);if(!i)return"No Git";if("*"!==n.providers&&!n.providers.includes(i.provider)||n.owners&&!n.owners.includes(i.id)&&!n.owners.includes(i.slug))return"Git Mismatch"}return!1},[g]);return(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsxs)(s.Combobox,{"data-testid":(0,c.tid)("connect-project","select-project-combobox"),filter:e=>e,onChange:e=>{let t=C.projects.find(t=>t.id===e)??null;(!w(t)||x)&&f(t)},onClear:()=>y(""),placeholder:"Search Projects…",prefixIcon:p?.latestDeployments&&p.latestDeployments.length>0?(0,t.jsx)(d.ProjectLogo,{deploymentId:p.latestDeployments[0]?.id??"",framework:p.framework,project:p,size:20}):null,value:p?.name??null,children:[(0,t.jsx)(s.Combobox.Input,{onChange:e=>b(e.target.value)}),(0,t.jsx)(s.Combobox.List,{emptyMessage:N?v?`No project found with the name "${v}".`:"No project under this account.":"Loading…",ListFooterComponent:(0,t.jsx)(u.LoadMore,{swr:C}),children:C.projects.map(e=>{let n=w(e),i=S(e);return(0,t.jsxs)(s.Combobox.Option,{className:"w-full flex-row items-center justify-between gap-2","data-testid":(0,c.tid)("connect-project","select-project",e.id),disabled:n&&!x||!1!==i,value:e.id,children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:[(0,t.jsx)(d.ProjectLogo,{deploymentId:e.latestDeployments?.[e.latestDeployments.length-1]?.id,framework:e.framework,project:e,size:20}),(0,t.jsx)("p",{className:"text-copy-14",children:e.name})]}),n?(0,t.jsx)(r.Badge,{variant:"gray",children:"connected"}):null,i?(0,t.jsx)(r.Badge,{variant:"gray",children:i}):null]},e.id)})})]}),P&&x?(0,t.jsx)(l.Note,{fill:!0,label:!1,type:"secondary",variant:"contrast",children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)(o.Information,{className:"stroke-gray-900",size:20}),(0,t.jsxs)("p",{className:"text-[14px] font-medium leading-[24px] text-gray-1000",children:["This project has already been connected to this ",j]})]}),(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"To connect it again, use a different Environment Variable Name."})]})}):null]})}])},2014455,e=>{"use strict";var t=e.i(847684),n=e.i(3869281),i=e.i(4030453),r=e.i(5927860);e.s(["ResourceEnvironmentSelector",0,function(e){let{environments:s,error:l,onChange:o,resourceTitle:a}=e,c={[r.EnvTarget.Development]:"Development",[r.EnvTarget.Preview]:"Preview",[r.EnvTarget.Production]:"Production"},[d,u]=Object.entries(s).reduce((e,t)=>(e[t[0]in c?0:1].push(t),e),[[],[]]);return(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:"Environments"}),(0,t.jsxs)("div",{className:"text-gray-900 text-[13px] leading-4",children:["Choose which environments of the project to make this"," ",a.toLowerCase()," available to."]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("div",{className:"flex flex-row gap-2",children:d.map(e=>{let[i,r]=e;return(0,t.jsx)(n.Checkbox,{checked:r,onChange:()=>{o({...s,[i]:!r})},children:(0,t.jsx)("span",{className:`font-medium ${!r?"text-gray-900":""}`,children:c[i]})},`environment-${i}`)})}),u.length>0&&(0,t.jsx)("div",{className:"flex flex-row gap-4",children:u.map(e=>{let[i,r]=e;return(0,t.jsx)(n.Checkbox,{checked:r,onChange:()=>{o({...s,[i]:!r})},children:i},`environment-${i}`)})})]}),l?(0,t.jsx)(i.Error,{children:l}):null]})}])},7137779,2483721,e=>{"use strict";var t=e.i(847684),n=e.i(7185353),i=e.i(6891161),r=e.i(455575),s=e.i(4030453),l=e.i(5468328),o=e.i(4004502),a=e.i(57106),c=e.i(5927860),d=e.i(7917902),u=e.i(4422059),x=e.i(134877),p=e.i(7909933),m=e.i(8740003),f=e.i(6060673),g=e.i(8794163),j=e.i(5074599),h=e.i(9584471),v=e.i(3758860),y=e.i(1887803),b=e.i(3183079),C=e.i(648779),N=e.i(39509);e.i(3182268);var w=e.i(7849855),P=e.i(1919132),S=e.i(4404233),k=e.i(5779481),I=e.i(5393630),E=e.i(397510),R=e.i(8824424),T=e.i(3869281),D=e.i(3500331),O=e.i(1906681),M=e.i(9186321),L=e.i(9722978),A=e.i(7743427),B=e.i(2014455);function q(e){let{isLoading:n,store:i,advancedOptions:r,onChangeAdvancedOptions:s,prefixPlaceholder:l,sampleEnvVarName:o,connection:a}=e,c=(0,j.getResourceTitleByResource)(i),d=i?.type==="integration"&&"convex"===i.product.slug;return(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,t.jsx)(B.ResourceEnvironmentSelector,{environments:r.environments,error:r.error?.environments,onChange:e=>s({...r,environments:e,error:{...r.error,environments:void 0}}),resourceTitle:c}),i?.type==="integration"&&(0,S.areResourceDeploymentsEnabled)(i)?(0,t.jsx)($,{advancedOptions:r,onChangeAdvancedOptions:s,store:i,title:c,connection:a}):null,!d&&(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:"Custom Prefix"}),(0,t.jsxs)("div",{className:"text-gray-900 text-[13px] leading-4",children:["This prefix will be applied to the environment variables that are automatically created for the ",c,"."]})]}),(0,t.jsx)("div",{className:"flex flex-col gap-4",children:(0,t.jsx)("div",{className:"flex flex-col gap-3",children:(0,t.jsx)(D.Input,{"aria-label":"Environment Variables Prefix",disabled:n,error:r.error?.envPrefix,onChange:e=>s({...r,envPrefix:e.currentTarget.value,error:{...r.error,envPrefix:void 0}}),placeholder:l,suffix:o,value:r.envPrefix,width:"100%"})})})]})]})}function $(e){let{store:i,advancedOptions:r,onChangeAdvancedOptions:s,connection:l}=e,{data:o}=(0,A.useIntegration)(i.product.integration.id),d=o?.flags?.includes(M.LaunchDarklyIntegrationFlags.MarketplaceDeploymentActions),{product:u}=(0,A.useIntegrationAndProduct)({integrationIdOrSlug:i.product.integration.id,productIdOrSlug:i.product.id,teamIdOrSlug:i.ownerId}),x=u?.actions??[],p=(0,n.useMemo)(()=>[{target:c.EnvTarget.Preview,name:"Preview"},{target:c.EnvTarget.Production,name:"Production"}],[]);if(!d)return null;let m=r.deployments,f=!!l,g=x.length>0&&(l||m?.required);return f||g?(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[f?(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("div",{className:"flex flex-col gap-1",children:(0,t.jsx)("div",{className:"text-sm font-semibold",children:"Resource is Required To Be In An Active State Before Deployment"})}),(0,t.jsx)(O.Toggle,{className:"w-fit",checked:m?.required??!1,direction:"switch-first",onChange:e=>{s({...r,deployments:{...m,required:e,actions:e?m?.actions:{}}})},size:"large",children:(0,t.jsx)("div",{className:"text-[13px] whitespace-normal",children:m?.required?"Required":"Not Required"})})]}):null,g?(0,t.jsx)("div",{className:(0,L.clsx)("flex flex-col gap-6",{"opacity-50":!m?.required}),children:x.map(e=>(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"text-sm font-semibold capitalize",children:e.name}),e.description?(0,t.jsxs)("div",{className:"text-gray-900 text-[13px]",children:[e.description,e.link?(0,t.jsx)(a.Link,{external:!0,href:e.link}):null]}):null]}),(0,t.jsx)("div",{className:"flex flex-row gap-4",children:p.map(n=>(0,t.jsx)(T.Checkbox,{checked:m?.actions?.[e.slug]?.[n.target]??!1,disabled:!m?.required||!r.environments[n.target],onChange:t=>{s({...r,deployments:{...m,actions:{...m?.actions,[e.slug]:{...m?.actions?.[e.slug],[n.target]:t.target.checked}}}})},children:(0,t.jsxs)("span",{className:`font-medium ${!m?.actions?.[e.slug]?.[n.target]?"text-gray-900":""}`,children:[" ",n.name," "]})},n.target))})]},e.slug))}):null]}):null}var F=e.i(808558),V=e.i(5530726);function z(e){let{resource:n}=e;if(!n||"integration"!==n.type)return null;let i=n.product.projectConnectionScopes;if(!i||0===i.length)return null;let r=i.map(e=>(0,V.scopeFormatter)(e)??null).filter(U).reduce((e,t)=>{let{permission:n}=t;return e[n].push(t),e},{Read:[],"Read and Write":[]});return(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14",children:"This integration requires the following permissions"}),(0,t.jsx)("ul",{"data-testid":(0,o.tid)("connect-project","scopes"),className:"flex flex-col items-stretch justify-start gap-4 flex-initial m-0 list-none p-0",children:Object.entries(r).map(e=>{let[n,i]=e;return 0===i.length?null:(0,t.jsxs)("li",{className:"flex flex-row items-center justify-start gap-3 flex-initial",children:[(0,t.jsx)("div",{className:"flex-basis",children:(0,t.jsx)(F.IconDefault,{size:24})}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-1 flex-initial",children:[(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:(0,t.jsx)("p",{className:"text-heading-14 whitespace-nowrap",children:n})}),(0,t.jsx)("ul",{className:"m-0 list-none p-0",children:i.map((e,n)=>{let{resource:r}=e;return(0,t.jsx)("li",{style:{display:"inline"},children:(0,t.jsxs)("span",{className:"text-copy-14 tailwind-preflight",children:[r,n===i.length-1?null:", "]})},r)})})]})]},n)})})]})}function U(e){return null!=e}function _(e){let{resource:t,blockData:n}=e,i=t?.status;return"uninstalled"!==i&&(n&&!n.blockConnection||t&&"integration"!==t.type||"available"===i)}function J(e){let{backOrCancelLabel:d,project:f,store:b,connection:C,title:N,subtitle:w,onBack:R,onClickOutside:T,onConnectionCreated:D,ProjectSelector:O,initialEnvPrefix:M,resourceId:A}=e,{mutateResourceListAndProject:B}=(0,h.useMutateResourceCache)(),{mutate:$}=(0,k.useResourceItem)({resourceId:A,includeGuides:!0}),{createConnection:F,updateConnection:V}=(0,y.useResourceConnection)(),{token:U}=(0,g.useV0Marketplace)()||{},[J,G]=(0,n.useState)(!1),[Z,H]=(0,n.useState)({envPrefix:M??C?.envVarPrefix??void 0,environments:{[c.EnvTarget.Development]:C?.environments.includes(c.EnvTarget.Development)??!0,[c.EnvTarget.Preview]:C?.environments.includes(c.EnvTarget.Preview)??!0,[c.EnvTarget.Production]:C?.environments.includes(c.EnvTarget.Production)??!0},deployments:C?.deployments?{required:C.deployments.required,actions:C.deployments.actions.reduce((e,t)=>{let{slug:n,environments:i}=t;return e[n]=i.reduce((e,t)=>(e[t]=!0,e),{}),e},{})}:!C&&(0,S.areResourceDeploymentsEnabled)(b)?{required:!0,actions:{}}:void 0,protocolSettings:C?.protocolSettings??void 0,error:null}),[K,Q]=(0,n.useState)(!1),[X,Y]=(0,n.useState)(null),ee=(0,u.usePrevious)(f),et=(0,n.useRef)(!1);(0,n.useEffect)(()=>{et.current||f&&(!ee||f.id===ee.id)||(et.current=!0,H(e=>({...e,error:null,environments:{[c.EnvTarget.Development]:!0,[c.EnvTarget.Preview]:!0,[c.EnvTarget.Production]:!0}})))},[ee,f]);let en=(0,n.useCallback)(async()=>{if(f)try{var e,t;let n,i=[c.EnvTarget.Production,c.EnvTarget.Preview,c.EnvTarget.Development].filter(e=>Z.environments[e]),s=Z.deployments?{required:Z.deployments.required??!1,actions:Z.deployments.required?Object.entries(Z.deployments.actions??{}).map(e=>{let[t,n]=e;return{slug:t,environments:Object.entries(n).reduce((e,t)=>{let[n,r]=t;return r&&i.includes(n)&&e.push(n),e},[])}}).filter(e=>{let{environments:t}=e;return t.length>0}):[]}:void 0;if(Q(!0),Y(null),H({...Z,error:null}),0===i.length){H({...Z,error:{environments:"Select at least one Environment for your Environment Variable"}}),Q(!1);return}if(Z.envPrefix&&!/^[a-zA-Z][a-zA-Z0-9_]*$/.test(Z.envPrefix)){H({...Z,error:{envPrefix:"The prefix contains invalid characters. It must start with a letter and be made of letters, digits, and underscores only."}}),Q(!1);return}let l=(e=b,t=Z.protocolSettings,n=(0,P.getLogDrainProtocolSettings)({protocolSettings:t}),e?.type==="integration"&&(0,v.isProtocolSupported)(e.product,"logDrain")&&n&&!n.sources.length?"Select at least one source to enable log draining":null);if(l){H({...Z,error:{protocolSettings:l}}),Q(!1);return}C?await V({resourceId:A,connectionId:C.id,envVarPrefix:Z.envPrefix,envVarEnvironments:i,deployments:s,protocolSettings:Z.protocolSettings}):await F({projectId:f.id,envVarPrefix:Z.envPrefix,envVarEnvironments:i,deployments:s,resourceId:A,protocolSettings:Z.protocolSettings,v0token:U}),r.toasts.success({text:`Connected Project ${f.name} to ${(0,j.getResourceTitleByResource)(b)}`,key:f.id}),await B(f.name,b?.type==="integration"?b.product.supportedProtocols[0]:"storage"),await $(),b?.type==="integration"&&b.product.showSSOLinkOnProjectConnection?G(!0):(D&&await D(),T())}catch(e){if((0,x.isAPIError)(e))e.code===y.ResourceConnectionsErrorCodes.ProjectEnvVarNotUnique?H({...Z,error:{envPrefix:e.message}}):Y(e.message);else throw e}finally{Q(!1)}},[f,Z,b,C,B,$,V,A,F,U,D,T]),{isWaitingForAvailableResource:ei,onSubmit:er,resourceStatus:es,isSubmitDisabled:el,isResourceUninstalled:eo}=function(e){let{initialResource:t,resourceId:i,handleSubmit:r}=e,{data:s}=(0,k.useResourceItem)({resourceId:i,revalidateStatus:!0}),[l,o]=(0,n.useState)(!1),a=s?.store.status,c=(0,n.useRef)(!1),d=s?.store??t,u=d?.type==="integration"?d.product.slug:null,{data:x}=(0,p.default)(u?"marketplace-product-block-connection-until-available":null,()=>(0,m.blockConnectionUntilResourceIsAvailable)(u));(0,n.useEffect)(()=>{!c.current&&l&&_({blockData:x,resource:d})&&(c.current=!0,r())},[r,x,l,d]);let f="uninstalled"===a;return{isWaitingForAvailableResource:!!(l&&"available"!==a&&x?.blockConnection&&!f),onSubmit:()=>{_({blockData:x,resource:d})?r():o(!0)},resourceStatus:a,isSubmitDisabled:!d||!!("integration"===d.type&&!x)||f,isResourceUninstalled:f}}({resourceId:A,handleSubmit:en});return(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),er()},children:[(0,t.jsx)(i.Modal.Body,{children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-6 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)(i.Modal.Title,{center:!0,children:N}),w?(0,t.jsx)(i.Modal.Subtitle,{children:w}):null]}),(0,t.jsx)(i.Modal.Inset,{last:!0,children:W(b)&&J?(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsxs)("p",{className:"text-copy-14",children:["Project ",f?.name," successfully connected to"," ",(0,j.getResourceTitleByResource)(b)]}),(0,t.jsxs)("p",{className:"text-copy-14",children:["Complete the project configuration in the"," ",b.product.integration.name," Dashboard"]})]}):(0,t.jsxs)("div",{className:(0,L.default)("flex flex-col items-stretch justify-start gap-6 flex-initial",ei?"geist-disabled pointer-events-none":void 0),children:[(0,t.jsx)(a.Link,{href:"#",style:{position:"absolute"},children:""}),O,(0,t.jsx)(z,{resource:b}),(0,t.jsx)(q,{advancedOptions:Z,isLoading:K,onChangeAdvancedOptions:H,prefixPlaceholder:(0,v.getEnvPrefixByResource)(b),sampleEnvVarName:(0,v.getSampleEnvVarNameByResource)(b),store:b,connection:C}),X?(0,t.jsx)(s.Error,{children:X}):null]})})]})}),(0,t.jsxs)(i.Modal.Actions,{children:[(0,t.jsx)(i.Modal.Action,{onClick:J?()=>{D&&D(),T()}:R,type:"secondary",children:J?"Later":d}),W(b)&&J?(0,t.jsx)(E.OpenInPartnerDashboardButton,{buttonVariant:"default",componentType:"button",integrationConfigurationId:b.product.integrationConfigurationId,label:`Open in ${b.product.integration.name}`,onClick:()=>{D&&D(),T()},productId:b.product.id,externalResourceId:b.externalResourceId,teamIdOrSlug:b.ownerId,projectId:f?.id,path:"onboarding"}):(0,t.jsx)(l.Tooltip,{text:eo?"This resource is uninstalled and cannot be connected to projects":void 0,children:(0,t.jsx)(i.Modal.Action,{buttonType:"submit","data-testid":(0,o.tid)("connect-project","store-modal-connect-project"),disabled:!f||el,loading:K||ei,type:ei?"secondary":"default",children:ei?(0,t.jsx)(I.ResourceStatus,{resource:es?{status:es}:null}):C?"Update":"Connect"})})]})]})}function W(e){return!!(e?.type==="integration"&&e.product.showSSOLinkOnProjectConnection)}e.s(["ConnectResourceForCurrentProjectStep",0,function(e){let{resource:i}=e,{onClose:r,onBack:s,state:l,onResourceUpdated:o}=(0,b.useResourceModalsContext)(),{type:a}=i,{projectSlug:c}=(0,w.useProjectSlug)(),d=(0,f.useProject)(c),u=(0,n.useCallback)(()=>{o({resource:i,isConnected:!0})},[o,i]);return l.type!==N.ResourceModalsActionTypes.CreateEnvs||"integration"!==a?null:(0,t.jsx)(J,{backOrCancelLabel:l.backOrCancelLabel,onBack:s,onClickOutside:r,onConnectionCreated:u,project:d.data,resourceId:i.id,store:i,subtitle:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-center gap-1.5 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"Connect to"}),(0,t.jsx)(C.ProductIcon,{icon:i.product.iconUrl,size:"small"}),(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-gray-1000",children:i.name})]}),title:`Configure ${d.data?.name??""}`})},"CreateResourceConnectionModal",0,function(e){let{active:r,store:s,onClickOutside:l,onAnimationDone:o,onConnectionCreated:a,resourceId:c,initialProjectSlug:u}=e,{data:x}=(0,f.useProject)(u),[p,m]=(0,n.useState)(null),{team:g,user:h}=(0,d.useAccount)();(0,n.useEffect)(()=>{x&&m(e=>e??x)},[x]);let y=g?g.slug:h?.username;return(0,t.jsx)(i.Modal.Modal,{active:r,allowOverflow:!0,onAnimationDone:o,onClickOutside:l,width:540,children:(0,t.jsx)(J,{ProjectSelector:(0,t.jsx)(R.ResourceProjectSelector,{account:y,allowSelectConnectedProjects:s?.type==="integration"&&(0,v.isProtocolSupported)(s.product,"logDrain"),connectedProjectIds:s?.projectsMetadata.map(e=>e.projectId)??[],onProjectSelected:e=>{m(e)},resource:s??void 0,resourceTitle:(0,j.getResourceTitleByResource)(s),selectedProject:p}),backOrCancelLabel:"Cancel",onBack:l,onClickOutside:l,onConnectionCreated:a,project:p,resourceId:c,store:s,title:P.CONNECT_PROJECT_LABEL})})},"CreateResourceConnectionModalStep",0,J,"UpdateResourceConnectionModal",0,function(e){let{active:n,store:r,connection:s,resourceId:l,onClickOutside:o,onAnimationDone:a,onConnectionCreated:c}=e,d=(0,f.useProject)(s.projectId);return"integration"!==r.type?null:(0,t.jsx)(i.Modal.Modal,{active:n,allowOverflow:!0,onAnimationDone:a,onClickOutside:o,width:540,children:(0,t.jsx)(J,{backOrCancelLabel:"Cancel",connection:s,onBack:o,onClickOutside:o,onConnectionCreated:c,project:d.data,resourceId:l,store:r,subtitle:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-center gap-1.5 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"Connect to"}),(0,t.jsx)(C.ProductIcon,{icon:r.product.iconUrl,size:"small"}),(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-gray-1000",children:r.name})]}),title:`Configure ${d.data?.name??""}`})})}],7137779);var G=e.i(7722264),Z=e.i(3703009),H=e.i(5098510);e.s(["DeleteStoreConnectionModal",0,function(e){let{active:l,onClickOutside:o,connections:a,onAnimationDone:c,resourceId:d,resource:u}=e,{removeConnections:x}=(0,y.useResourceConnection)(),[p,m]=(0,n.useState)(!1),[f,g]=(0,n.useState)(null),j=(0,r.useToasts)(),h=(0,n.useCallback)(async e=>{e.preventDefault(),g(null),m(!0);try{await x({connectionIds:a.map(e=>e.id),resourceId:d}),m(!1),o()}catch(e){m(!1),(0,G.isError)(e)?g(e):j.error(`Unexpected error while removing the ${u?.name||"resource"} connection`)}},[x,a,d,o,j,u]),v=a.some(e=>(0,P.isLogDrainInConnection)(e));return(0,t.jsx)(i.Modal.Modal,{active:l,onAnimationDone:c,onClickOutside:o,children:(0,t.jsxs)("form",{onSubmit:e=>void h(e),children:[(0,t.jsx)(i.Modal.Body,{children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-6 flex-initial",children:[(0,t.jsxs)(i.Modal.Title,{center:!1,children:["Remove"," ",v?"Project Connection & Log Drain":"Project Connection"]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-6 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14",children:"Are you sure you want to remove this project connection?"}),(0,t.jsxs)("p",{className:"text-copy-14",children:["Removing the connection will delete the associated environment variables from the project and future deployments will not be able to access"," ",u?.name?(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"inline-block align-bottom",children:(0,t.jsx)(Z.StoreIconOrAvatar,{icon:"integration"===u.type?u.product.integration.icon:void 0,size:"small",type:u.type})})," ",(0,t.jsx)("span",{className:"align-bottom font-semibold",children:u.name})]}):"this resource","."]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-3 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:"Projects"}),(0,t.jsx)(H.ProjectConnectionsListInModal,{connections:a})]}),f?(0,t.jsx)(s.Error,{children:f.message}):null]})]})}),(0,t.jsxs)(i.Modal.Actions,{children:[(0,t.jsx)(i.Modal.Action,{disabled:p,onClick:o,type:"secondary",children:"Cancel"}),(0,t.jsx)(i.Modal.Action,{buttonType:"submit",disabled:p,loading:p,children:1===a.length?"Remove Connection":`Remove ${a.length} Connections`})]})]})})}],2483721)}]);

//# debugId=bdbf0132-be13-38f7-18a1-355f128a6439
//# sourceMappingURL=1c0d80efe455b281.js.map