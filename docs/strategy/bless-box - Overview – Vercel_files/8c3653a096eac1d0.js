;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="70c1fc30-7d40-616a-dc48-8d50cc731ece")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,9365163,4904548,e=>{"use strict";var t=e.i(847684),i=e.i(7185353),l=e.i(5338940),a=e.i(1717203),s=e.i(7557283),n=e.i(4670733),r=e.i(588428),o=e.i(4396019),c=e.i(762945),d=e.i(7749291),m=e.i(8735244),u=e.i(2504781),p=e.i(6891161),h=e.i(455575),x=e.i(8522580),g=e.i(8761240),y=e.i(5756088),f=e.i(9386557),b=e.i(4004502),j=e.i(8042625),k=e.i(277234),v=e.i(4244280),N=e.i(5140444),C=e.i(5757634),S=e.i(5802506),R=e.i(6641571);e.i(9623499);var A=e.i(5576066),P=e.i(3924999),D=e.i(5229375);e.i(2598434);var w=e.i(9668517);let I="[teamSlug]";var T=e.i(6060673),M=e.i(930810),L=e.i(7952834),$=e.i(1173672),E=e.i(8227242),O=e.i(9745887),B=e.i(3306538),F=e.i(5468328),_=e.i(9719784);function H(e){let{hidden:i,showIcon:l=!0,linkProps:a,defaultRoute:s}=e;return(0,t.jsx)(t.Fragment,{children:i.map(e=>(0,t.jsx)("div",{children:(0,t.jsx)(_.default,{defaultRoute:s,icon:l,title:e,truncate:!0,url:e,...a})},e))})}function W(e){let{hidden:i,linkProps:l}=e;return(0,t.jsx)(F.Tooltip,{text:(0,t.jsx)(H,{hidden:i,linkProps:l}),children:(0,t.jsx)(B.Badge,{size:"sm",variant:"gray-subtle",children:`+${i.length}`})})}let z=function(e){let{className:i,defaultRoute:l,domains:a,firstOnly:s,showIcon:n=!0,style:r,linkProps:o}=e;if(!a)return(0,t.jsx)("span",{className:`text-copy-14 text-gray-900 ${i}`,style:r,children:"-"});let{visible:c,hidden:d}=a.reduce((e,t)=>(0===e.visible.length||!s&&1===e.visible.length&&e.visible[0].length<=20?e.visible.push(t):e.hidden.push(t),e),{visible:[],hidden:[]});return(0,t.jsx)("span",{className:`text-[14px] leading-[20px] font-medium ${i}`,children:(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-initial max-w-full",style:{...r},children:[c.map((e,i)=>{let a=i===c.length-1;return(0,t.jsx)(_.default,{defaultRoute:l,icon:n,style:{marginRight:a?void 0:"var(--geist-gap-half)",minWidth:0},truncate:!0,url:e,...o},e)}),d.length?(0,t.jsx)(W,{hidden:d,linkProps:o}):null]})})};e.s(["default",0,z],4904548);var U=e.i(8651268),Y=e.i(2547843);function q(){return(0,t.jsx)(p.Modal.Header,{children:(0,t.jsx)(p.Modal.Title,{center:!0,children:"Instant Rollback"})})}function G(e){let{setStage:i}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(p.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"24px"},children:"Error: You must select a deployment to roll back."})]}),(0,t.jsx)(p.Modal.Actions,{children:(0,t.jsx)(p.Modal.Action,{fullWidth:!0,onClick:()=>{i("initial")},type:"secondary",children:"Back"})})]})}function V(){return(0,t.jsx)("div",{children:(0,t.jsx)(x.Note,{className:"bg-yellow-50 border-yellow-300 border text-amber-700",fill:!0,label:!1,type:"warning",variant:"contrast",children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",style:{padding:4},children:[(0,t.jsx)(c.Warning,{style:{flexShrink:0}}),(0,t.jsxs)("div",{className:"flex flex-col items-start justify-start flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"Make sure the domains listed above are correct."}),(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"This deployment has custom aliases not included in the project's domain settings."})]})]})})})}function K(e){var a;let s,{hasFloatingAliases:o,onCancel:c,previousDeployment:d,productionAliases:m,productionDeployment:h,project:g,rollbackCandidates:f,setStage:j,selectedDeployment:k,setSelectedDeployment:v,deploymentSwr:N,rollbackReason:C,setRollbackReason:S}=e,R=(a="/[teamSlug]",s=(0,w.useTeamSlug)(),(0,i.useMemo)(()=>a.includes(I)?a.replace(`/${I}`,s?`/${s}`:""):a,[s,a])),[P,D]=(0,i.useState)(!1),{team:T}=(0,l.useTeam)(),L=!T||T.billing?.plan==="hobby",{value:$}=(0,n.useInstantRollbackHobbyRestrictionFlag)(),{value:E}=(0,r.useInstantRollbackHobbyRestrictionTeamFlag)();return f.length&&d&&k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(p.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("p",{className:"text-copy-16",children:["Rolling back"," ",(0,t.jsx)(z,{domains:m,firstOnly:!0,style:{display:"inline-flex",fontWeight:"500"}})]}),o?(0,t.jsx)(V,{}):null,(0,t.jsx)("div",{children:(0,t.jsx)(O.DeploymentCardSmall,{deployment:h,isProductionDeployment:!0,selectedDeployment:k,setSelectedDeployment:v})})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-16",children:"To the following deployment:"}),P?(0,t.jsx)("div",{children:(0,t.jsx)(M.ChooseDeploymentList,{deployments:f,previousDeployment:d,productionDeployment:h,rolledBackDeploymentId:g?.lastAliasRequest?.type==="rollback"?g.lastAliasRequest.fromDeploymentId:void 0,selectedDeployment:k,setSelectedDeployment:v,swr:N})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsx)(O.DeploymentCardSmall,{deployment:k,isForm:P,isPreviousDeployment:k.uid===d.uid,selectedDeployment:k,setSelectedDeployment:v})}),($||E)&&L?(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial mt-6",children:(0,t.jsx)(x.Note,{className:"bg-blue-50 border border-blue-500 text-blue-600",fill:!0,label:!1,size:"small",variant:"contrast",children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial p-2",children:[(0,t.jsx)(y.LockClosed,{style:{transform:"translateX(1px)"}}),(0,t.jsxs)("div",{className:"flex flex-col items-start justify-start flex-initial",children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-inherit",children:"Looking for an earlier deployment?"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(A.Link,{className:"text-current no-underline",external:!0,href:"/"===R?"/dashboard?createTeam=instant-rollback":`${R}?upgradeTeam=instant-rollback`,target:"_blank",children:(0,t.jsx)("span",{className:"text-copy-14 text-inherit",children:"Upgrade to Pro"})}),(0,t.jsxs)("span",{className:"text-copy-14 text-inherit",style:{whiteSpace:"nowrap"},children:[" ","to roll back to an earlier deployment"]})]})]})]})})}):(0,t.jsx)(u.Button,{onClick:()=>{D(!0)},type:"secondary",width:"100%",size:"small",children:"Choose another deployment"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{htmlFor:"rollback-reason",className:"flex flex-col items-stretch justify-start gap-1 flex-initial",children:(0,t.jsx)("span",{className:"text-copy-16",children:"Share a reason for this rollback:"})}),(0,t.jsx)(M.RollbackDescriptionTextarea,{value:C,onChange:S,id:"rollback-reason"})]})]})]}),(0,t.jsxs)(p.Modal.Actions,{children:[(0,t.jsx)(p.Modal.Action,{onClick:c,type:"secondary",children:"Cancel"}),(0,t.jsx)(p.Modal.Action,{"data-testid":(0,b.tid)("deployment","rollback-modal","continue-button"),disabled:C.length>=M.REASON_MAX_CHARACTER_LENGTH,onClick:()=>{j("selected")},children:"Continue"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(p.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsx)("p",{className:"text-copy-14",children:"This project does not have any valid deployments to roll back to."})]}),(0,t.jsx)(p.Modal.Actions,{children:(0,t.jsx)(p.Modal.Action,{onClick:c,type:"secondary",children:"Cancel"})})]})}function X(e){let{selectedDeployment:i,setStage:l,requestRollback:a,project:s,rollbackReason:n,rollbackCandidates:r}=e,{user:o}=(0,N.useUser)();if(!i)return(0,t.jsx)(G,{setStage:l});let c=n.length>=M.REASON_MAX_CHARACTER_LENGTH,m=(0,M.getMostRecentlyPromotedDeployment)(r);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(p.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-16",children:"Rolling back to:"}),(0,t.jsx)(O.DeploymentCardSmall,{deployment:i,isPreviousDeployment:i.uid===m?.uid,selectedDeployment:i,setSelectedDeployment:()=>null})]}),n.trim()&&(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:(0,t.jsx)(M.RollbackDescriptionCard,{rollbackDescription:{description:n.trim(),userId:o?.uid??"",username:o?.username??"",deploymentId:i.uid,projectId:s?.id??"",createdAt:new Date().getTime()},project:s,preview:!0})}),(0,t.jsxs)(R.UL,{className:"mb-0",children:[(0,t.jsx)(R.LI,{children:"Instant Rollback assigns domains to a previous deployment. All Environment Variables from the original build will remain. Cron jobs will be reverted to the state of the previous deployment."}),(0,t.jsxs)(R.LI,{children:[(0,t.jsxs)(A.Link,{className:"inline-flex items-center text-[var(--geist-success)] no-underline",href:`https://${i.url}`,target:"_blank",children:["View the selected deployment ",(0,t.jsx)(d.ExternalSmall,{className:"ml-1"})]})," ","before rolling back—external APIs, databases, and CMS platforms may not behave as expected."]}),(0,t.jsx)(R.LI,{children:"You can update the rollback reason from the project overview."})]}),(s?.autoAssignCustomDomains??!0)||s?.lastAliasRequest?.type==="rollback"?(0,t.jsx)(x.Note,{fill:!0,type:"secondary",children:(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",children:(0,t.jsx)("div",{className:"flex flex-col items-start justify-start flex-initial",children:(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"After rolling back, production deployments will not be automatically promoted until the rollback is removed."})})})}):null]})]}),(0,t.jsxs)(p.Modal.Actions,{children:[(0,t.jsx)(p.Modal.Action,{onClick:()=>{l("initial")},type:"secondary",children:"Back"}),(0,t.jsx)(p.Modal.Action,{"data-testid":(0,b.tid)("deployment","rollback-modal","rollback-button"),disabled:c,onClick:()=>{a(i.uid),l("processing")},children:"Confirm Rollback"})]})]})}function J(e){let{jobStatus:l,rollbackDeploymentId:a,rollbackCandidates:s,selectedDeployment:n,setStage:r,onCancel:o,statusSwr:c,requestRollback:d,rollbackReason:h}=e,{user:x}=(0,N.useUser)();if((0,i.useEffect)(()=>{a===n?.uid&&("failed"===l?r("error"):"succeeded"===l&&r("done"))},[a,l,n,r]),!n)return(0,t.jsx)(G,{setStage:r});let y=(0,M.getMostRecentlyPromotedDeployment)(s);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(p.Modal.Body,{children:[(0,t.jsx)(q,{}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14",children:"Assigning production domains:"}),(0,t.jsx)(O.DeploymentCardSmall,{deployment:n,isPreviousDeployment:n.uid===y?.uid,selectedDeployment:n,setSelectedDeployment:()=>null})]}),""!==h?(0,t.jsxs)("div",{className:"rounded bg-background-200 px-4 py-3 shadow-border",children:[(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:["“",(0,t.jsx)(E.LinkParser,{text:h.trim()}),"”"]}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[(0,t.jsx)("p",{className:"text-copy-14",children:"Rolled back by"}),x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.PrincipalAvatar,{size:20,principalId:x.uid,principal:{type:"user",uid:x.uid,username:x.username}}),(0,t.jsx)("p",{className:"text-copy-14",children:x.username})]}):null]})]}):null,(0,t.jsxs)(R.UL,{className:"mx-4 my-0 list-none pt-2",children:[c.aliases.map(e=>{let i="loading";return"completed"===e.status?i="success":"failed"===e.status&&(i="error"),(0,t.jsx)(R.LI,{children:(0,t.jsxs)("div",{className:"h-6 flex items-center gap-2",children:["loading"===i&&(0,t.jsx)(m.Spinner,{className:"shrink-0",size:16}),"error"===i&&(0,t.jsx)(f.WarningFill,{className:"shrink-0",color:"amber-800",size:16}),"success"===i&&(0,t.jsx)(g.CheckCircleFill,{className:"shrink-0",color:"blue-700",size:16}),(0,t.jsx)("span",{className:"text-copy-14 truncate",children:e.alias})]})},e.alias)}),!c.isReachingEnd&&c.initialDataLoaded?(0,t.jsx)(R.LI,{children:(0,t.jsx)(u.Button,{loading:c.isLoadingMore,onClick:()=>{c.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})}):null]})]})]}),(0,t.jsx)(p.Modal.Actions,{children:(0,t.jsx)(p.Modal.Action,{"data-testid":(0,b.tid)("deployment","rollback-modal","finish-button"),fullWidth:!0,loading:"failed"!==l&&"succeeded"!==l,onClick:()=>{"failed"===l?d(n.uid):"succeeded"===l&&(r("initial"),o())},children:"failed"===l?"Retry":"Done"})})]})}function Q(e){let{active:a,initialSelectedDeployment:s,onCancel:n,productionBranch:r,productionDeployment:o,projectId:c,rollbackCandidates:d,swr:m,rollbackDescription:u}=e,{mutate:x}=(0,C.useSWRConfig)(),[g,y]=(0,i.useState)("initial"),[f,N]=(0,i.useState)(""),{isReady:R,team:A}=(0,l.useTeam)(),w=(0,h.useToasts)(),I=(0,i.useMemo)(()=>{let e=d.filter(e=>e.uid!==o.id);return(0,M.getMostRecentlyPromotedDeployment)(e)},[d,o]),[E,O]=(0,i.useState)(null),B=E??s??I??null,F=(0,i.useCallback)(y,[y]),_=(0,i.useCallback)(O,[O]),[,{aliases:H}]=(0,D.useAliasesInfinite)({rollbackDeploymentId:o.id}),{data:W}=(0,T.useProject)(c),{lastAliasRequest:z,hasFloatingAliases:U}=W||{lastAliasRequest:void 0,hasFloatingAliases:!1},{toDeploymentId:q,jobStatus:G}=z||{toDeploymentId:null,jobStatus:null},[,V]=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,{isReady:s,team:n}=(0,l.useTeam)(),r=(0,P.default)((t,i)=>{if(!s)return null;let l={teamId:n?.id,limit:a};return t?i?.next?`${(0,v.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,j.encode)({...l,until:i.next})}`:null:`${(0,v.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,j.encode)(l)}`},e=>(0,k.fetchAPI)(e,{throwOnHTTPError:!0}),{refreshInterval:t}),o=(0,i.useMemo)(()=>r.data?[].concat(...r.data.filter(Boolean).map(e=>e.aliases.slice(0,a))):[],[r.data,a]),c=!!r.data,d=c&&0===o.length,m=c&&r.data&&r.size>r.data.length,u=c&&r.data&&r.data[r.data.length-1]?.aliases.length<a;return[r,{aliases:o,initialDataLoaded:c,isEmpty:d,loadMore:()=>r.setSize(e=>e+1),isLoadingMore:m,isReachingEnd:u,mutate:r.mutate}]}(c,2e3),Q=(0,i.useMemo)(()=>o,[a]),Z=()=>{y("initial"),O(s||I||null),n()},ee=(0,i.useCallback)(async e=>{if(!R)return;let t=`${(0,v.API_DEPLOYMENT_ROLLBACK)(c,e)}${(0,j.encode)({teamId:A?.id,description:f.trim()})}`;try{await (0,k.fetchAPI)(t,{throwOnHTTPError:!0,method:"POST",body:{}}),A&&(void 0!==W&&(0,L.revalidateProject)(x,W),await x((0,$.getProjectProductionDeploymentKey)({projectIdOrName:c,teamId:A.slug})),x((0,Y.getRollingReleaseEndpoint)(A.slug,c)))}catch(e){w.error({text:"Something went wrong - please try requesting an Instant Rollback again",key:"rollback-deployment"}),(0,S.captureError)(e)}},[R,c,w,f,x,A,W]),et={rollbackDeploymentId:q,hasFloatingAliases:!!U,jobStatus:G,onCancel:Z,previousDeployment:I,productionBranch:r,productionDeployment:Q,productionAliases:H.map(e=>{let{alias:t}=e;return t}),project:W,rollbackCandidates:d,setStage:F,selectedDeployment:B,setSelectedDeployment:_,deploymentSwr:m,statusSwr:V,requestRollback:ee,rollbackWarningText:"New deployments will not be automatically assigned production domains until this rollback is removed.",rollbackReason:f,setRollbackReason:N,rollbackDescription:u};return(0,t.jsxs)(p.Modal.Modal,{active:a,"data-testid":(0,b.tid)("deployment","rollback-modal"),onClickOutside:Z,sticky:!0,width:"500px",children:["initial"===g&&(0,t.jsx)(K,{...et}),"selected"===g&&(0,t.jsx)(X,{...et}),["processing","error","done"].includes(g)&&(0,t.jsx)(J,{...et})]})}var Z=e.i(5771992),ee=e.i(5645345),et=e.i(3981247);e.i(3182268);var ei=e.i(7849855);e.s(["useInstantRollbackModal",0,function(e){let{onClose:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[n,r]=(0,i.useState)(!1),[c,d]=(0,i.useState)(),{teamSlug:m,projectSlug:u}=(0,ei.useProjectAndTeamSlug)(),{data:p}=(0,T.useProject)(c?.name),h=u??c?.name,x=e??p,{data:g}=(0,et.useRollingRelease)({teamIdOrSlug:m,projectSlug:h}),y=g?.rollingRelease?g?.rollingRelease?.canaryDeployment?.id:void 0,{deployment:f,rollbackDescription:b,mutate:j}=(0,o.useProjectProductionDeployment)(x?.name),{can:k}=(0,a.default)({projectIdOrName:x?.name}),v=k(s.Action.Create,s.Resource.DeploymentRollback),N=x?.link?.productionBranch?x.link.productionBranch:void 0,[C,S]=(0,Z.useDeploymentsInfinite)({projectId:x?x.id:"",requireProject:!0,limit:10,rollbackCandidate:!0},{}),{deployments:R,initialDataLoaded:A}=S,P=R.filter(e=>!!e.isRollbackCandidate&&e.uid!==y),D=!!(A&&x&&!P.length),w=(0,i.useCallback)(e=>{d((0,ee.asListDeployment)(e)),r(!0)},[]),I=(0,i.useCallback)(()=>{r(!1),j().finally(()=>null),l?.()},[j,l]);return{rollbackModal:(0,i.useMemo)(()=>v&&n&&f&&x?(0,t.jsx)(Q,{active:n,initialSelectedDeployment:c,onCancel:I,productionBranch:N,productionDeployment:f,projectId:x.id,rollbackCandidates:P,rollbackDescription:b,swr:S}):null,[v,n,c,N,f,P,x,S,I,b]),closeRollbackModal:I,openRollbackModal:w,canRollbackDeployment:v,noRollbackCandidates:D}},"useRollbackTooltip",0,function(e){let{team:t}=(0,l.useTeam)(),a=!t||t.billing?.plan==="hobby",{value:s}=(0,n.useInstantRollbackHobbyRestrictionFlag)(),{value:c}=(0,r.useInstantRollbackHobbyRestrictionTeamFlag)(),d=s||c,m=e?.name,{deployment:u,isLoading:p}=(0,o.useProjectProductionDeployment)(m);return(0,i.useMemo)(()=>{let t=(0,ee.asListDeployment)(e),i=a&&!t?.isRollbackCandidate;return t?p?"Loading…":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be rolled back.":"readySubstate"in t&&"PROMOTED"!==t.readySubstate?"Only Deployments previously aliased to a Production domain can be rolled back.":t.uid===u?.id?"This Deployment is already in Production.":d?t.isRollbackCandidate||"production"===t.target?i?"Hobby customers can only roll back to the previous deployment.":"":"Only Deployments previously aliased to a Production domain can be rolled back.":t.isRollbackCandidate?"":"Only Deployments previously aliased to a Production domain can be rolled back.":""},[e,a,p,u?.id,d])}],9365163)},4443312,e=>{"use strict";var t=e.i(4603164),i=e.i(5338940);e.s(["CHECK_RUNS_REFRESH_INTERVAL",0,3e3,"useProjectCheckRuns",0,function(e){let{deploymentId:l,swrOptions:a,enableCiChecksAndPolicies:s}=e,{team:n}=(0,i.useTeam)();return(0,t.useTypedSWR)("/v2/deployments/{deploymentId}/check-runs",s&&l&&n?.id?{deploymentId:l,teamId:n.id}:null,{refreshInterval:3e3,...a})}])},8529990,e=>{"use strict";let t=encodeURIComponent;function i(e){return"string"==typeof e?e:void 0}e.s(["getGitInfoFromDeployment",0,function(e){if(!e)return null;let{meta:l}=e;if(l?.githubDeployment){let e=`https://github.com/${t(l.githubCommitOrg??"")}/${t(l.githubCommitRepo??"")}/commit/${l.githubCommitSha}`,a=`https://github.com/${t(l.githubCommitOrg??"")}/${t(l.githubCommitRepo??"")}/tree/${t(l.githubCommitRef??"")}`,s=l.githubPrId?`https://github.com/${t(l.githubOrg??"")}/${t(l.githubRepo??"")}/pull/${l.githubPrId}`:void 0;return{type:"github",commitRef:String(l.githubCommitRef),commitSha:String(l.githubCommitSha),commitAuthorName:String(l.githubCommitAuthorName),commitAuthorLogin:i(l.githubCommitAuthorLogin),commitMessage:String(l.githubCommitMessage),repoName:String(l.githubCommitRepo),repoNamespace:String(l.githubCommitOrg),orgNamespace:String(l.githubOrg),commitUrl:e,refUrl:a,viaFork:l.githubOrg!==l.githubCommitOrg,prId:l.githubPrId?Number(l.githubPrId):void 0,prUrl:s,gitDirty:String(l.gitDirty),isPublic:"public"===l.githubRepoVisibility}}if(l?.gitlabDeployment){let e=`https://gitlab.com/${l.gitlabProjectPath}/tree/${t(l.gitlabCommitRef??"")}`,a=`https://gitlab.com/${l.gitlabProjectPath}/commit/${l.gitlabCommitSha}`;return{type:"gitlab",commitRef:String(l.gitlabCommitRef),commitSha:String(l.gitlabCommitSha),commitAuthorName:String(l.gitlabCommitAuthorName),commitAuthorLogin:i(l.gitlabCommitAuthorLogin),commitMessage:String(l.gitlabCommitMessage||l.gitCommitMessage),repoName:String(l.gitlabProjectName),repoNamespace:String(l.gitlabProjectNamespace),orgNamespace:String(l.gitlabProjectNamespace),commitUrl:a,refUrl:e,isPublic:"public"===l.gitlabProjectVisibility}}if(l?.bitbucketDeployment){let e=`https://bitbucket.org/${l.bitbucketRepoOwner}/${l.bitbucketRepoSlug}/branch/${t(l.bitbucketCommitRef??"")}`,a=`https://bitbucket.org/${l.bitbucketRepoOwner}/${l.bitbucketRepoSlug}/commits/${l.bitbucketCommitSha}`;return{type:"bitbucket",commitRef:String(l.bitbucketCommitRef),commitSha:String(l.bitbucketCommitSha),commitAuthorName:i(l.bitbucketCommitAuthorName),commitAuthorLogin:i(l.bitbucketCommitAuthorLogin),commitMessage:String(l.bitbucketCommitMessage),repoName:String(l.bitbucketRepoSlug),repoNamespace:String(l.bitbucketRepoOwner),orgNamespace:String(l.bitbucketRepoOwner),commitUrl:a,refUrl:e,isPublic:"public"===l.bitbucketRepoVisibility}}return null}])},3907048,e=>{"use strict";var t=e.i(847684),i=e.i(4585051),l=e.i(7185353),a=e.i(2982888),s=e.i(8651268);let n=(0,l.memo)(e=>{let{deployment:l,size:n=24,showProviderIcon:r=!1}=e;return l.meta?.deployHookId?(0,t.jsx)(a.DeployHookAvatar,{height:n,width:n}):l.creator?.uid?(0,t.jsx)(s.PrincipalAvatar,{size:n,principalId:l.creator.uid,principal:{type:"user",uid:l.creator.uid,username:l.creator.username},deploymentMeta:l.meta?.originalDeploymentId?void 0:l.meta,showProviderIcon:{github:!1,gitlab:r,bitbucket:r}}):(0,t.jsx)(i.Avatar,{size:n})});n.displayName="CreatorAvatar",e.s(["CreatorAvatar",0,n])},8227242,e=>{"use strict";var t=e.i(847684);e.i(9623499);var i=e.i(5576066);e.s(["LinkParser",0,function(e){let l,{text:a}=e;return(0,t.jsx)("span",{children:(l=/(?<temp1>https?:\/\/[^\s]+)/g,a.split(l).map(e=>l.test(e)?(0,t.jsx)(i.Link,{className:"break-all font-normal",href:e,rel:"noopener noreferrer",target:"_blank",type:"blend",children:e},e):(0,t.jsx)("span",{children:e},e)))})}])},930810,9745887,e=>{"use strict";var t=e.i(847684),i=e.i(2504781),l=e.i(9334091),a=e.i(3306538),s=e.i(57106),n=e.i(3753138),r=e.i(6226725),o=e.i(4345845),c=e.i(8893913),d=e.i(7218483),m=e.i(9722978),u=e.i(9375869),p=e.i(8529990),h=e.i(3907048);function x(e){let{isForm:i,children:l,className:a}=e;return i?(0,t.jsx)("label",{className:a,children:l}):(0,t.jsx)("div",{className:a,children:l})}function g(e){let{deployment:i,isForm:l,isPromote:g,isPreviousDeployment:y,isProductionDeployment:f,isRolledBackDeployment:b,selectedDeployment:j,setSelectedDeployment:k,ariaLabel:v="Rollback Deployment"}=e,N=(0,d.useAgo)(i.createdAt||0),C="number"==typeof i.aliasAssigned?i.aliasAssigned:0,S=C>0,R=(0,d.useAgo)(C),A=(0,u.useDeploymentLink)(i),P=(0,p.getGitInfoFromDeployment)(i),D=f||y||b;y&&b&&(y=!1);let w="Preview";if("target"in i)switch(i.target){case"staging":w="Staging";break;case"production":w="Production";break;default:w="Preview"}else w="Production";let I="uid"in i?i.uid:i.id,T=null;g?P?.commitRef&&(T=(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-0.5 flex-initial",children:[(0,t.jsx)(o.GitBranch,{color:"gray-900"}),(0,t.jsx)("span",{className:"text-copy-14-mono text-gray-900 truncate whitespace-nowrap",style:{marginRight:"4px",maxWidth:120,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0},title:P.commitRef,children:P.commitRef}),(0,t.jsxs)("span",{className:"text-copy-14 text-gray-900 truncate whitespace-nowrap flex items-center gap-1",style:{flexBasis:"50%",flexShrink:0,flexGrow:1,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0,maxWidth:260},children:["Staged"," ",N," by"," ",(0,t.jsx)("span",{children:(0,t.jsx)(h.CreatorAvatar,{deployment:i,showProviderIcon:!0,size:24})}),(0,t.jsx)("span",{children:!i.meta?.originalDeploymentId&&i.creator?.username?i.creator.username:P.commitAuthorLogin})]})]})):T=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"inline-flex flex-row items-center",children:[(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",style:{marginRight:"4px"},children:w}),P?.commitRef?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.GitBranch,{color:"gray-900",size:14}),(0,t.jsx)("span",{className:"text-copy-14-mono max-w-[100px] truncate whitespace-nowrap px-1 text-center text-sm leading-5 text-gray-900",title:P.commitRef,children:P.commitRef}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"by"}),(0,t.jsxs)("div",{className:"ml-1 inline-flex flex-row items-center gap-1",children:[(0,t.jsx)(h.CreatorAvatar,{deployment:i,size:20}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900 truncate max-w-[140px]",children:!i.meta?.originalDeploymentId&&i.creator?.username?`${i.creator.username}`:P.commitAuthorLogin})]})]}):null]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"Deployed "}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:N}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:", "}),S?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"promoted "}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:R})]}):(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"never promoted"})]})]});let M=null;return l||(M=g?(0,t.jsx)(n.ArrowCircleUp,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):f?(0,t.jsx)(r.CrossCircle,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):(0,t.jsx)(c.RotateCounterClockwise,{className:"mr-4 hidden self-center sm:block",color:"gray-1000",style:{flexShrink:0}})),(0,t.jsxs)(x,{className:(0,m.clsx)("flex w-full items-end justify-start px-4 py-3","rounded border border-solid border-[var(--accents-2)]","rounded-b-none","last:rounded-b","[&+&]:rounded-t-none [&+&]:border-t-0",{"bg-[var(--accents-1)] shadow-none":f,"bg-[var(--geist-background)]":!f}),isForm:l,children:[l?(0,t.jsx)("input",{"aria-label":v,checked:j?.uid===I,className:`
            relative m-0 mr-4 size-4 shrink-0 appearance-none
            self-center rounded-[1000px] border
            border-solid border-[var(--geist-foreground)] after:absolute after:inset-[3px]
            after:rounded-[1000px] after:bg-[var(--geist-foreground)]
            after:content-none checked:after:content-['']
          `,name:"rollbackDeployment",onChange:()=>{"uid"in i&&"type"in i&&k&&k(i)},type:"radio",value:I}):M,(0,t.jsxs)("div",{style:{width:D?"initial":"100%",minWidth:0},children:[(0,t.jsx)(s.Link,{className:"flex w-[calc(100%-1ch)] items-center gap-0.5 break-all text-sm font-bold leading-5",href:A,target:"_blank",children:(0,t.jsx)("span",{className:"text-[14px] leading-[20px] font-medium line-clamp-1",title:i.url,children:i.url})}),P?.commitMessage?(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900 line-clamp-1 break-words",title:P.commitMessage,children:[P.commitSha.substring(0,7)," ",P.commitMessage]}):null,T]}),f?(0,t.jsx)(a.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"inverted",children:"Current"}):null,y?(0,t.jsx)(a.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"gray-subtle",children:"Previous"}):null,b?(0,t.jsx)(a.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"red-subtle",children:"Rolled back"}):null]})}e.s(["DeploymentCardSmall",0,g],9745887);var y=e.i(8227242),f=e.i(8651268);e.s(["ChooseDeploymentList",0,function(e){let{deployments:l,previousDeployment:a,rolledBackDeploymentId:s,productionDeployment:n,selectedDeployment:r,setSelectedDeployment:o,swr:c,ariaLabel:d}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:l.map(e=>n.id!==e.uid&&(0,t.jsx)(g,{deployment:e,isForm:!0,isPreviousDeployment:a?.uid===e.uid,isRolledBackDeployment:s===e.uid,selectedDeployment:r,setSelectedDeployment:o,ariaLabel:d},e.uid))}),!c.isReachingEnd&&(0,t.jsx)(i.Button,{loading:c.isLoadingMore,onClick:()=>{c.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})]})},"REASON_MAX_CHARACTER_LENGTH",0,250,"RollbackDescriptionCard",0,function(e){let{rollbackDescription:i,project:l,preview:a}=e,s=(0,d.useAgo)(i.createdAt);return(0,t.jsxs)("div",{className:"px-4 py-3 rounded bg-background-200 shadow-border",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900 break-words",children:i.description.length>0?(0,t.jsxs)(t.Fragment,{children:["“",(0,t.jsx)(y.LinkParser,{text:i.description}),"”"]}):(0,t.jsx)("span",{className:"text-copy-14",children:"No reason provided."})}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[a?null:(0,t.jsx)("p",{className:"text-copy-14",children:"Rolled back by"}),i.username?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.PrincipalAvatar,{size:20,principalId:i.userId,principal:{type:"user",uid:i.userId,username:i.username}}),(0,t.jsx)("p",{className:"text-copy-14",children:i.username}),l?.lastAliasRequest!==void 0&&!a&&(0,t.jsx)("p",{className:"text-copy-14",children:s})]}):null]})]})},"RollbackDescriptionTextarea",0,function(e){let{value:i,onChange:a,id:s}=e;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(l.Textarea,{autoFocus:!0,className:"text-base min-h-24",error:i.length>=250?"Reason cannot be longer than 250 characters.":void 0,id:s,onChange:e=>a(e.target.value),placeholder:"Production is not behaving as expected…",required:!0,value:i,style:{fontSize:14}})})},"getDeploymentId",0,function(e){return"id"in e?e.id:"uid"in e?e.uid:void 0},"getMostRecentlyPromotedDeployment",0,function(e){if(0===e.length)return;let t=e.reduce((e,t)=>e.aliasAssigned&&t.aliasAssigned?e.aliasAssigned>t.aliasAssigned?e:t:t.aliasAssigned?t:e);if(t.aliasAssigned)return t},"isDeleted",0,function(e){return void 0!==e.deleted}],930810)},6619197,5645345,e=>{"use strict";var t=e.i(847684),i=e.i(7185353),l=e.i(8248823),a=e.i(8238875),s=e.i(57106),n=e.i(3869281),r=e.i(4030453),o=e.i(2455417),c=e.i(6891161),d=e.i(8522580),m=e.i(5255926),u=e.i(9318197),p=e.i(455575),h=e.i(8761240),x=e.i(472117),g=e.i(4004502),y=e.i(8042625),f=e.i(277234),b=e.i(4244280),j=e.i(4443312),k=e.i(5140444),v=e.i(5338940),N=e.i(5757634),C=e.i(4450569),S=e.i(4396019),R=e.i(9375869),A=e.i(8518548);function P(e){if(!e)return;if("id"in e==!1)return e;let{aliasAssigned:t,aliasError:i=null,aliasAssignedAt:l,buildingAt:a,created:s=e.createdAt,createdAt:n,creator:r,name:o,ready:c,readyState:d,readySubstate:m,target:u=null,uid:p=e.id,url:h,isRollbackCandidate:x="production"===e.target,prebuilt:g}=e;return{aliasAssigned:t,aliasError:i,aliasAssignedAt:l,buildingAt:a,created:s,createdAt:n,creator:{email:"",githubLogin:"",...r},name:o,ready:c,readyState:d,readySubstate:m,target:u,prebuilt:g,type:"LAMBDAS",uid:p,url:h,isRollbackCandidate:x}}e.s(["asListDeployment",0,P],5645345);var D=e.i(1840726),w=e.i(930810),I=e.i(7952834),T=e.i(1173672),M=e.i(9745887),L=e.i(3008300),$=e.i(3981247),E=e.i(6060673);function O(e){let{title:i}=e;return(0,t.jsx)(c.Modal.Header,{children:(0,t.jsx)(c.Modal.Title,{center:!0,children:i})})}function B(e){let{deploymentId:i}=e,l=(0,x.useChecksPrivateBetaFlag)(),a=(0,x.useCiChecksAndPoliciesFlagV2)(),n=l||a,{data:r,isLoading:o}=(0,j.useProjectCheckRuns)({deploymentId:i,enableCiChecksAndPolicies:n});if(!n)return null;if(o)return(0,t.jsx)(m.Skeleton,{});if(r?.runs.every(e=>"succeeded"===e.conclusion))return null;let c=r?.runs.filter(e=>"succeeded"!==e.conclusion)||[];return(0,t.jsxs)(d.Note,{type:"error",fill:!0,className:"mt-6",children:["By clicking Promote, you acknowledge that you are bypassing promotion requirements:",c.length>0&&(0,t.jsx)("ul",{className:"flex flex-col gap-1 ml-4 list-disc",children:c.slice(0,5).map(e=>(0,t.jsx)("li",{children:e.externalUrl?(0,t.jsx)(s.Link,{href:e.externalUrl,external:!0,children:e.name}):(0,t.jsx)("span",{children:e.name})},e.id||e.name||`${e.conclusion}-${e.status}`))})]})}let F=e=>{let{deployment:t,project:s,useIgnoreBuildStep:n,onCurrentDeploymentPromoted:r}=e,o=(0,p.useToasts)(),c=(0,a.useRouter)(),{team:d}=(0,v.useTeam)(),{user:m}=(0,k.useUser)(),{mutate:u}=(0,N.useSWRConfig)(),[h,x]=(0,i.useState)(!1),[g,j]=(0,i.useState)(void 0),C=(0,D.useShowIgnoreBuildStep)({project:s,deployment:t});return{promote:(0,i.useCallback)(async()=>{if(t&&s){x(!0),j(void 0);try{let e,i=d?.id,l="Promoted Deployment successfully.";if("production"===t.target)await (0,f.fetchAPI)(`${(0,b.API_DEPLOYMENT_PROMOTE)(s.id,t.uid||t.id)}${(0,y.encode)({teamId:i})}`,{method:"POST",body:{},throwOnHTTPError:!0}),e=(0,R.pathFromDeployment)(t,{user:m,team:d});else{let a=await (0,f.fetchAPI)(`${(0,b.API_DEPLOYMENTS)("v13")}${(0,y.encode)({teamId:i,skipIgnoreBuildStep:C&&!n?"1":null})}`,{method:"POST",body:JSON.stringify({deploymentId:t.uid||t.id,meta:{action:"promote"},name:s.name,target:"production"}),throwOnHTTPError:!0});e=(0,R.pathFromDeployment)(a,{user:m,team:d});let r=t.uid||t.id;l="production"===t.target?r===a.id?"Deployment is already the current Production Deployment.":"Promoted Deployment to Production successfully.":"Created Production Deployment successfully."}d&&((0,I.revalidateProject)(u,s),await u((0,T.getProjectProductionDeploymentKey)({projectIdOrName:s.id,teamId:d.slug}))),o.success({text:l,key:"production-deployment"}),e&&(e===location.pathname?r?.():c.push(e))}catch(e){j((0,l.normalizeError)(e))}finally{x(!1)}}},[t,s,c,C,d,o,n,m,u,r]),loading:h,setLoading:x,error:g,setError:j}};e.s(["default",0,function(e,l){let{onDeploymentPromoted:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},[m,p]=(0,i.useState)(!1),[x,y]=(0,i.useState)(null),{team:f}=(0,v.useTeam)(),b=e??x?.name,{data:j}=(0,E.useProject)(b),N=l??j,R=(0,D.useShowIgnoreBuildStep)({project:N,deployment:x}),[P,I]=(0,i.useState)(L.DEFAULT_USE_IGNORE_BUILD_STEP_PROMOTE),T=(0,i.useCallback)(()=>{p(!1)},[]),{error:_,loading:H,promote:W,setError:z,setLoading:U}=F({deployment:x,useIgnoreBuildStep:P,project:N,onCurrentDeploymentPromoted:(0,i.useCallback)(()=>{T(),a?.()},[T,a])}),{user:Y}=(0,k.useUser)(),{data:q}=(0,$.useRollingRelease)({teamIdOrSlug:f?.slug,projectSlug:b}),G=N?.rollingRelease?.stages!==void 0&&N.rollingRelease.stages.length>0,V=q?.rollingRelease?.state==="ACTIVE",K=q?.rollingRelease?.canaryDeployment?.id,X=V&&K===x?.uid,J=G&&!V&&x?.target==="production",Q=G&&V&&x?.target==="production",Z=J&&N.rollingRelease?.stages!==void 0?N.rollingRelease.stages[0]?.targetPercentage:null,{data:ee}=(0,A.useProjectDomains)(b,{limit:11,production:"true",redirects:"false",verified:"true",order:"ASC"}),et=(0,i.useCallback)(e=>{y(e),p(!0)},[]),ei=(0,i.useCallback)(()=>{U(!1),y(null),z(void 0)},[z,U]),{rollbackDescription:el,deploymentIsStale:ea}=(0,S.useProjectProductionDeployment)(N?.name),{andMoreDomains:es,remainingDomains:en}=(0,i.useMemo)(()=>{if(!ee)return{andMoreDomains:!1,remainingDomains:[]};let e=ee.length>2,t=e?ee.slice(2).map(e=>e.name):[];return{andMoreDomains:e,remainingDomains:t}},[ee]),er=(0,i.useMemo)(()=>{if(!N||!x)return(0,t.jsx)(C.default,{center:!0,style:{marginTop:10},children:(0,t.jsx)(o.LoadingDots,{size:4})});let e=!!(ee&&ee.length>0);return(0,t.jsxs)(t.Fragment,{children:["production"===x.target?(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"16px"},children:"Deployment to promote:"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"16px"},children:"A new deployment will be built using your production environment."}),(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"16px"},children:"Deployment to promote to production:"})]}),(0,t.jsx)("div",{children:(0,t.jsx)(M.DeploymentCardSmall,{deployment:x,isPromote:!0,selectedDeployment:null})}),J?(0,t.jsxs)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:["This will start a new rolling release with initial traffic of"," ",Z,"%."]}):null,Q?(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:"This will queue the deployment for promotion after the current rolling release completes."}):null,J||Q||!e?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:"It will be aliased to the following domains:"}),(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial pl-12",children:ee?.slice(0,2).map(e=>{let{name:i}=e;return(0,t.jsx)("p",{className:"text-copy-14",children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-3 flex-initial",children:[(0,t.jsx)(h.CheckCircleFill,{color:"blue-700",size:20}),(0,t.jsx)("span",{children:i.startsWith("*")?i:(0,t.jsx)(s.Link,{"data-testid":(0,g.tid)("deployments","promote-to-production-overlay","preview-link"),external:!0,href:`https://${i}`,variant:"highlight",children:i})})]})},i)})}),es?(0,t.jsxs)("p",{className:"text-copy-14 mt-6 mb-4",children:["...and ",en.length," more"]}):null]}),!J&&!e&&(0,t.jsxs)("p",{className:"text-copy-14",style:{marginBottom:"24px",marginTop:"24px"},children:["Warning: Your Project does not have a Production Domain. We recommend you"," ",(0,t.jsx)(s.Link,{href:`/${f?f.slug:Y?.username}/${encodeURIComponent(N.name)}/settings/domains`,variant:"highlight",children:"add"})," ","one."]}),N.link&&x.gitSource?(0,t.jsx)(B,{deploymentId:x.id}):null,R?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Spacer,{y:1}),(0,t.jsx)(n.Checkbox,{checked:P,fullWidth:!0,onChange:()=>{I(!P)},children:"Use project's Ignore Build Step"})]}):null,X?(0,t.jsx)(d.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",style:{padding:1},children:(0,t.jsx)("div",{className:"flex flex-col items-start justify-start flex-initial",children:(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"This will complete the rolling release for this deployment."})})})}):null,ea?(0,t.jsx)(d.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",style:{padding:1},children:(0,t.jsx)("div",{className:"flex flex-col items-start justify-start flex-initial",children:(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:J?"Completing the Rolling Release will undo the current Instant Rollback":"This action will undo the current Instant Rollback"})})})}):null,el?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:"Rollback Details:"}),(0,t.jsx)(w.RollbackDescriptionCard,{rollbackDescription:el,project:N})]}):null]})},[es,en,ee,N,f,Y,x,P,R,ea,el,Z,J,Q,X]),eo=(0,i.useMemo)(()=>(0,t.jsx)(c.Modal.Action,{"data-testid":(0,g.tid)("deployments","promote-to-production-overlay","confirm-button"),loading:H,onClick:W,children:x&&"target"in x&&"production"===x.target?"Promote":"Promote to Production"}),[W,H,x]);return{modal:(0,i.useMemo)(()=>(0,t.jsxs)(c.Modal.Modal,{active:m,"data-testid":(0,g.tid)("deployments","promote-to-production-overlay"),onAnimationDone:ei,onClickOutside:T,sticky:!0,width:"500px",children:[(0,t.jsxs)(c.Modal.Body,{children:[(0,t.jsx)(O,{title:Q?"Queue for Promotion":x&&"target"in x&&"production"!==x.target?"Promote to Production":"Promote"}),er,_?(0,t.jsx)(r.Error,{error:_}):null]}),(0,t.jsxs)(c.Modal.Actions,{children:[(0,t.jsx)(c.Modal.Action,{"data-testid":(0,g.tid)("deployments","promote-to-production-overlay","cancel-button"),loading:!1,onClick:T,type:"secondary",children:"Cancel"}),eo]})]}),[m,ei,T,er,_,eo,Q,x]),close:T,open:et}},"usePromoteDeployment",0,F,"usePromoteTooltip",0,function(e){let t=e?.name,{deployment:l,isLoading:a}=(0,S.useProjectProductionDeployment)(t);return(0,i.useMemo)(()=>{let t=P(e);return t?a?"Loading…":t.uid===l?.id?"This Deployment is already in Production.":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be promoted.":"prebuilt"in t&&!0===t.prebuilt&&"production"!==t.target?"Prebuilt deployments from non-production environments cannot be promoted.":"":""},[e,a,l?.id])}],6619197)},2645806,e=>{"use strict";var t=e.i(847684),i=e.i(7185353),l=e.i(2111701),a=e.i(6891161),s=e.i(455575),n=e.i(277234),r=e.i(4244280),o=e.i(4470704);let c=i.default.memo(e=>{let{active:c,onClose:d,deployment:m,teamId:u}=e,[p,h]=(0,i.useState)(!1),x=(0,s.useToasts)(),g=(0,i.useCallback)(async()=>{if(!m)return;h(!0);let e=u?"?teamId="+u:"",t=await (0,n.fetchAPI)(`${(0,r.API_DEPLOYMENTS)("v12")}/${m.id}/cancel`+e,{throwOnHTTPError:!1,method:"PATCH"});t.error&&x.error(`Could not cancel the deployment, it's ${m.readyState}`),"CANCELED"===t.readyState&&(x.success("The deployment has been successfully canceled."),(0,l.mutate)((0,o.getUrl)(m.id),{...m,readyState:t.readyState,status:t.readyState,canceledAt:t.canceledAt,host:m.url,isPrivate:!m.public})),h(!1),d()},[m,u,x,d]);return(0,t.jsxs)(a.Modal.Modal,{active:c,onClickOutside:d,width:"500px",children:[(0,t.jsxs)(a.Modal.Body,{children:[(0,t.jsx)(a.Modal.Header,{children:(0,t.jsx)(a.Modal.Title,{children:"Cancel Deployment"})}),(0,t.jsx)("p",{className:"text-copy-16",children:"Canceling this deployment will immediately stop the build, with no way to resume."}),(0,t.jsx)("p",{className:"text-copy-16",style:{margin:0},children:"Are you sure you want to continue?"})]}),(0,t.jsxs)(a.Modal.Actions,{children:[(0,t.jsx)(a.Modal.Action,{loading:!1,onClick:d,type:"secondary",children:"Close"}),(0,t.jsx)(a.Modal.Action,{disabled:p,loading:p,onClick:g,children:"Cancel deployment"})]})]})});e.s(["default",0,c])},5229375,e=>{"use strict";var t=e.i(7185353),i=e.i(7909933),l=e.i(3924999),a=e.i(818351),s=e.i(8042625),n=e.i(277234),r=e.i(4244280),o=e.i(5338940);function c(e,t){let i=(0,s.encode)(e,!1),l=t?`&${t}`:"";return i?`?${i}${l}`:`?${l}`}e.s(["useAliases",0,function(e,t){return(0,i.default)(()=>{if(!e)return null;let{team:t,id:i,teamId:l}=e;return`${(0,r.API_DEPLOYMENTS)("v2")}/${i}/aliases${(0,s.encode)({teamId:l??(t?t.id:null)})}`},e=>(0,n.fetchAPI)(e,{throwOnHTTPError:!0}),t)},"useAliasesInfinite",0,function(e,i){let{limit:a=20,domains:s,rollbackDeploymentId:d}=e,{isReady:m,team:u}=(0,o.useTeam)(),p=(0,l.default)((e,t)=>{if(!m)return null;let i=`${r.API_ALIASES}`,l=s?.map(e=>`domain=${encodeURIComponent(e)}`).join("&")||null;if(!e)return`${i}${c({limit:a+1,teamId:u?.id,rollbackDeploymentId:d},l)}`;let n=t?.aliases&&t.aliases.length>a?t.aliases[a-1].createdAt:null;return n?`${i}${c({limit:a+1,teamId:u?.id,until:n},l)}`:null},e=>(0,n.fetchAPI)(e,{throwOnHTTPError:!0}),i),h=(0,t.useMemo)(()=>p.data?[].concat(...p.data.filter(Boolean).map(e=>e.aliases.slice(0,a))):[],[p.data,a]),x=!!p.data&&!p.error,g=!!(p.data&&0===h.length),y=!!(p.data&&p.size>p.data.length),f=!!(p.data&&p.data[p.data.length-1]?.aliases.length<=a);return[p,{aliases:h,initialDataLoaded:x,isEmpty:g,loadMore:()=>p.setSize(e=>e+1),isLoadingMore:y,isReachingEnd:f}]},"useAliasesV2",0,function(e,t){let{deploymentId:i,teamId:l}=e;return(0,a.useIsomorphicSWR)(i?function(e){let{deploymentId:t,teamId:i}=e;return`${(0,r.API_DEPLOYMENTS)("v2")}/${t}/aliases${(0,s.encode)({teamId:i})}`}({deploymentId:i,teamId:l}):null,t)}],5229375)},7018452,e=>{"use strict";var t=e.i(7185353);e.s(["default",0,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",[i,l]=(0,t.useState)(!1),a=window.location.hash,s=e.startsWith("#")?e:`#${e}`;return(0,t.useEffect)(()=>{let e=()=>{window.location.hash!==s||i||l(!0)};return window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[i,s]),a!==s||i||(l(!0),window.history.replaceState(null,""," ")),a!==s&&i&&(window.location.hash=s),[i,l]}])},9719784,e=>{"use strict";var t=e.i(847684),i=e.i(7185353),l=e.i(57106),a=e.i(822157),s=e.i(7018452),n=e.i(2405448),r=e.i(542164),o=e.i(1681029),c=e.i(4478191);let d=(0,i.memo)(function(e){let{url:d,truncate:m,defaultRoute:u,...p}=e,[h,x]=(0,s.default)("#wildcard"),[g,y]=(0,i.useState)(null),[f,b]=(0,i.useState)(!1),j=(0,i.useCallback)(()=>{y((0,n.default)(d)),x(!0)},[y,x,d]);return d?(0,r.default)(d)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Link,{className:"pt-px leading-[16px] hover:underline",onClick:j,...p,onMouseEnter:()=>b(!0),style:{minWidth:0,maxWidth:m?"100%":void 0},children:m?(0,t.jsx)("span",{className:"geist-ellipsis",children:d}):d}),f||h?(0,t.jsx)(a.default,{active:h,onCancel:()=>{x(!1)},url:g}):null]}):(0,t.jsx)(l.Link,{className:"pt-px leading-[16px] hover:underline",external:!0,href:(0,c.withDefaultRoute)((0,o.domainToUrl)(d),u),...p,style:{minWidth:0,maxWidth:m?"100%":void 0},children:m?(0,t.jsx)("span",{className:"geist-ellipsis",children:d}):d}):null});e.s(["default",0,d])}]);

//# debugId=70c1fc30-7d40-616a-dc48-8d50cc731ece
//# sourceMappingURL=9e2f6bc8ad7a930c.js.map