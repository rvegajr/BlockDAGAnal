;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="af4da04b-dde9-01af-22fa-ef680500889a")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,2747365,e=>{"use strict";let t;function i(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function r(e){return function t(r){return 0==arguments.length||i(r)?t:e.apply(this,arguments)}}function n(e){return function t(n,s){switch(arguments.length){case 0:return t;case 1:return i(n)?t:r(function(t){return e(n,t)});default:return i(n)&&i(s)?t:i(n)?r(function(t){return e(t,s)}):i(s)?r(function(t){return e(n,t)}):e(n,s)}}}function s(e){return function t(s,a,o){switch(arguments.length){case 0:return t;case 1:return i(s)?t:n(function(t,i){return e(s,t,i)});case 2:return i(s)&&i(a)?t:i(s)?n(function(t,i){return e(t,a,i)}):i(a)?n(function(t,i){return e(s,t,i)}):r(function(t){return e(s,a,t)});default:return i(s)&&i(a)&&i(o)?t:i(s)&&i(a)?n(function(t,i){return e(t,i,o)}):i(s)&&i(o)?n(function(t,i){return e(t,a,i)}):i(a)&&i(o)?n(function(t,i){return e(s,t,i)}):i(s)?r(function(t){return e(t,a,o)}):i(a)?r(function(t){return e(s,t,o)}):i(o)?r(function(t){return e(s,a,t)}):e(s,a,o)}}}function a(e,t){return Object.prototype.hasOwnProperty.call(t,e)}var o,l,u,c,d,h=r(function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)});function g(e){return"[object Object]"===Object.prototype.toString.call(e)}let p=Number.isInteger||function(e){return(0|e)===e};var f=function(){function e(){this.map={},this.length=0}return e.prototype.set=function(e,t){var i=this.hash(e),r=this.map[i];r||(this.map[i]=r=[]),r.push([e,t]),this.length+=1},e.prototype.hash=function(e){var t=[];for(var i in e)t.push(Object.prototype.toString.call(e[i]));return t.join()},e.prototype.get=function(e){if(this.length<=180){for(var t in this.map)for(var i=this.map[t],r=0;r<i.length;r+=1){var n=i[r];if(n[0]===e)return n[1]}return}var s=this.hash(e),i=this.map[s];if(i)for(var r=0;r<i.length;r+=1){var n=i[r];if(n[0]===e)return n[1]}},e}(),v=r(function(e){return null!=e&&"function"==typeof e.clone?e.clone():function e(t,i,r){if(r||(r=new f),s=typeof(n=t),null==n||"object"!=s&&"function"!=s)return t;var n,s,a=function(i){var n=r.get(t);if(n)return n;for(var s in r.set(t,i),t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=e(t[s],!0,r));return i};switch(h(t)){case"Object":return a(Object.create(Object.getPrototypeOf(t)));case"Array":return a(Array(t.length));case"Date":return new Date(t.valueOf());case"RegExp":return new RegExp(t.source,t.flags?t.flags:(t.global?"g":"")+(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.sticky?"y":"")+(t.unicode?"u":"")+(t.dotAll?"s":""));case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":return t.slice();default:return t}}(e)}),m=s(function(e,t,i){var r,n={};for(r in i=i||{},t=t||{})a(r,t)&&(n[r]=a(r,i)?e(r,t[r],i[r]):t[r]);for(r in i)a(r,i)&&!a(r,n)&&(n[r]=i[r]);return n}),y=s(function e(t,i,r){return m(function(i,r,n){return g(r)&&g(n)?e(t,r,n):t(i,r,n)},i,r)}),b=s(function(e,t,i){return y(function(t,i,r){return e(i,r)},t,i)}),E=n(function(e,t){for(var i=t,r=0;r<e.length;r+=1){if(null==i)return;var n=e[r];i=p(n)?function(e,t){var i=e<0?t.length+e:e;return t[i]}(n,i):i[n]}return i}),S=n(function(e,t){var i={};for(var r in t)e(t[r],r,t)&&(i[r]=t[r]);return i});let I=e=>"function"==typeof e&&!!(e.constructor&&e.call&&e.apply),k=e=>"string"==typeof e,A=e=>void 0!==e,T=e=>{let t;return null!=(t=e)},w=e=>{switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return e instanceof Error}},C=(e,t)=>E(t.split("."),e),P=e=>null!==e&&"[object Object]"===Object.prototype.toString.call(e),D=(e,t)=>{if(!Array.isArray(e)||!Array.isArray(t))return v(t);let i=v(e);return t.forEach((e,t)=>{let r;i[t]=Array.isArray(e)||null!==(r=e)&&"object"==typeof r&&!Array.isArray(r)?O(i[t],e):e}),i},O=(e,t)=>b(D,e,t),R=e=>P(e)&&Object.keys(e).length>0,x=e=>{let t=S(A,e);return Object.keys(t).forEach(e=>{let i=t[e];P(i)&&(t[e]=x(i))}),t},$=e=>{let t=S(T,e);return Object.keys(t).forEach(e=>{let i=t[e];P(i)&&(t[e]=$(i))}),t},M=e=>{if(R(e))return $(e)},N=(e,t)=>"boolean"==typeof e?e:t,_=e=>(Object.getOwnPropertyNames(e).forEach(function(t){e[t]&&"object"==typeof e[t]&&_(e[t])}),Object.freeze(e)),B=e=>{let t,i=e;if(!k(e)&&null!=(t=e))try{i=JSON.stringify(e)}catch(e){i=null}return i},L=e=>globalThis.btoa(Array.from(new TextEncoder().encode(e),e=>String.fromCodePoint(e)).join("")),U=e=>new TextDecoder().decode(new Uint8Array(globalThis.atob(e).split("").map(e=>e.charCodeAt(0)))),j=(e,t,i,r,n)=>{let s={category:e,name:t,properties:i,options:r,callback:void 0};I(n)&&(s.callback=n),I(r)&&(s.category=e,s.name=t,s.properties=i,s.options=void 0,s.callback=r),I(i)&&(s.category=e,s.name=t,s.properties=void 0,s.options=void 0,s.callback=i),I(t)&&(s.category=e,s.name=void 0,s.properties=void 0,s.options=void 0,s.callback=t),I(e)&&(s.category=void 0,s.name=void 0,s.properties=void 0,s.options=void 0,s.callback=e),P(e)?(s.name=void 0,s.category=void 0,s.properties=e,I(t)?s.options=void 0:s.options=t):P(t)&&(s.name=void 0,s.properties=t,I(i)?s.options=void 0:s.options=i),k(e)&&!k(t)&&(s.category=void 0,s.name=e),A(s.category)||(s.category=void 0),A(s.name)||(s.name=void 0),s.properties=s.properties?v(s.properties):{},A(s.options)?s.options=v(s.options):s.options=void 0;let a=k(s.name)?s.name:s.properties.name,o=k(s.category)?s.category:s.properties.category;return s.properties=O(P(s.properties)?s.properties:{},{...a&&{name:a},...o&&{category:o}}),s},H=(e,t,i,r)=>{let n={name:e,properties:t,options:i,callback:void 0};return I(r)&&(n.callback=r),I(i)&&(n.properties=t,n.options=void 0,n.callback=i),I(t)&&(n.properties=void 0,n.options=void 0,n.callback=t),n.properties=T(n.properties)?v(n.properties):{},A(n.options)?n.options=v(n.options):n.options=void 0,n},F=(e,t,i,r)=>{let n={userId:e,traits:t,options:i,callback:void 0};return I(r)&&(n.callback=r),I(i)&&(n.userId=e,n.traits=t,n.options=void 0,n.callback=i),I(t)&&(n.userId=e,n.traits=void 0,n.options=void 0,n.callback=t),(P(e)||null===e)&&(n.userId=null,n.traits=e,I(t)?n.options=void 0:n.options=t),n.userId=B(n.userId),P(n.traits)?n.traits=v(n.traits):n.traits=void 0,A(n.options)?n.options=v(n.options):n.options=void 0,n},z=(e,t,i,r)=>{let n={to:e,from:t,options:i,callback:void 0};return(I(r)&&(n.callback=r),I(i)&&(n.to=e,n.from=t,n.options=void 0,n.callback=i),I(t))?(n.to=e,n.from=void 0,n.options=void 0,n.callback=t):(P(t)||null===t)&&(n.to=e,n.from=void 0,n.options=t),A(n.to)&&(n.to=B(n.to)),A(n.from)?n.from=B(n.from):n.from=void 0,A(n.options)?n.options=v(n.options):n.options=void 0,n},Q=(e,t,i,r)=>{let n={groupId:e,traits:t,options:i,callback:void 0};return I(r)&&(n.callback=r),I(i)&&(n.groupId=e,n.traits=t,n.options=void 0,n.callback=i),I(t)&&(n.groupId=e,n.traits=void 0,n.options=void 0,n.callback=t),(P(e)||null===e)&&(n.groupId=null,n.traits=e,I(t)?n.options=void 0:n.options=t),n.groupId=B(n.groupId),P(n.traits)?n.traits=v(n.traits):n.traits=void 0,A(n.options)?n.options=v(n.options):n.options=void 0,n},G=((et={}).UNLOADED="Page Unloaded",et),K="CapabilitiesManager",V="ConfigManager",q="EventManager",W="PluginsManager",J="UserSessionManager",X="ErrorHandler",Z="PluginEngine",Y="ReadyAPI",ee="AnalyticsCore";for(var et,ei,er=[],en=0;en<256;en++)er[en]=(en+256).toString(16).substring(1);for(var es,ea=256,eo=[];ea--;)eo[ea]=(ea+256).toString(16).substring(1);let el=()=>{let e;if(null!=(e=globalThis.crypto)&&I(globalThis.crypto.getRandomValues)){(!ei||en+16>4096)&&(ei=crypto.getRandomValues(new Uint8Array(4096)),en=0);for(var t,i=0,r="";i<16;i++)t=ei[en+i],6==i?r+=er[15&t|64]:8==i?r+=er[63&t|128]:r+=er[t],1&i&&i>1&&i<11&&(r+="-");return en+=16,r}var n,s=0,a="";if(!es||ea+16>256){for(es=Array(s=256);s--;)es[s]=256*Math.random()|0;s=ea=0}for(;s<16;s++)n=es[ea+s],6==s?a+=eo[15&n|64]:8==s?a+=eo[63&n|128]:a+=eo[n],1&s&&s>1&&s<11&&(a+="-");return ea++,a},eu=()=>k(globalThis.navigator.userAgent)&&/Trident.*rv:11\./.test(globalThis.navigator.userAgent),ec=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!1,r=!1;function n(){i||(i=!0,e(r),setTimeout(()=>{i=!1},0))}(t||eu())&&globalThis.addEventListener("beforeunload",()=>{r=!1,n()}),globalThis.addEventListener("blur",()=>{r=!0,n()}),globalThis.addEventListener("focus",()=>{i=!1}),document.addEventListener("pagehide",()=>{r="hidden"===document.visibilityState,n()}),document.addEventListener("visibilitychange",()=>{r=!0,"hidden"===document.visibilityState?n():i=!1})},ed=()=>new Date().toISOString(),eh=(e,t,i)=>`Unable to load (${k(i)?i:i.type}) the script with the id "${e}" from URL "${t}"`,eg="[Circular Reference]",ep=(e,t,i,r)=>{try{let n;return JSON.stringify(e,(n=[],function(e,s){if(!i?.includes(e)){let i;if(!(t&&null==(i=s))){if("object"!=typeof s||null===s)return s;for(;n.length>0&&n[n.length-1]!==this;)n.pop();if(n.includes(s))return r?.warn(`JSONStringify:: A circular reference has been detected in the object and the property "${e}" has been dropped from the output.`),eg;return n.push(s),s}}}))}catch(e){return r?.warn("Failed to convert the value to a JSON string.",e),null}},ef=(e,t)=>{let i=Array.isArray(e)?[]:{};for(let r in e)if(Object.hasOwnProperty.call(e,r)){let n=e[r],s=t.call(e,r,n);P(s)||Array.isArray(s)?i[r]=ef(s,t):i[r]=s}return i},ev=(e,t)=>{let i,r=(i=[],function(e,t){if("bigint"==typeof t)return"[BigInt]";for(;i.length>0&&i[i.length-1]!==this;)i.pop();return i.includes(t)?eg:(i.push(t),t)}),n=r.call(e,"",e);return P(e)||Array.isArray(e)?ef(e,r):n},em="[SDK DISPATCHED ERROR]",ey=e=>{let{stack:t,stacktrace:i,"opera#sourceloc":r}=e,n=t??i??r;if(n&&"string"==typeof n)return n},eb=(e,t)=>{if(!w(e))return Error(`${t}: ${ep(e)}`);try{let i=new e.constructor(`${t}: ${e.message}`),r=ey(e);return r&&(i.stack=r),Object.getOwnPropertyNames(e).forEach(t=>{if("message"!==t&&"stack"!==t&&"name"!==t)try{i[t]=e[t]}catch{}}),i}catch{return Error(`${t}: ${ep(e)}`)}},eE=e=>{if(w(e)){let t=ey(e);if(t){let{stack:i,stacktrace:r,"opera#sourceloc":n}=e;switch(t){case i:e.stack=`${i}
${em}`;break;case r:e.stacktrace=`${r}
${em}`;break;default:e["opera#sourceloc"]=`${n}
${em}`}}}globalThis.dispatchEvent(new ErrorEvent("error",{error:e,bubbles:!0,cancelable:!0,composed:!0}))},eS="RudderLabs JavaScript SDK",eI="3.26.0",ek="RudderJS-Initiated",eA="preloadedEventsBuffer",eT="ajs_aid",ew="ajs_event",eC=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"app";globalThis.RudderStackGlobals||(globalThis.RudderStackGlobals={}),globalThis.RudderStackGlobals[e]||(globalThis.RudderStackGlobals[e]={})},eP=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"app";eC(i),globalThis.RudderStackGlobals[i][e]=t},eD=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"app";return eC(t),globalThis.RudderStackGlobals[t][e]},eO=(e,t)=>{let i={};return e.forEach((r,n)=>{n.startsWith(t)&&(i[n.substring(t.length)]=e.get(n))}),i},eR=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=new URLSearchParams(globalThis.location.search);t.get(ew)&&e.unshift(["track",t.get(ew),eO(t,"ajs_prop_")]);let i=t.get("ajs_uid"),r=eO(t,"ajs_trait_");if(i||R(r)){let t=[...i?[i]:[],r];e.unshift(["identify",...t])}t.get(eT)&&e.unshift(["setAnonymousId",t.get(eT)])},ex=(e,t)=>{let i,r=e.shift();if(I(t[r])){switch(r){case"page":i=j(...e);break;case"track":i=H(...e);break;case"identify":i=F(...e);break;case"alias":i=z(...e);break;case"group":i=Q(...e);break;default:t[r](...e)}i&&t[r](i)}},e$=function(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},a=document.createElement("script");return a.type="text/javascript",a.onload=r,a.onerror=n,a.src=e,a.id=t,a.async=i,Object.keys(s).forEach(e=>{a.setAttribute(e,s[e])}),a.setAttribute("data-loader","RS_JS_SDK"),a},eM=function(e,t,i){let r=!(arguments.length>3)||void 0===arguments[3]||arguments[3],n=arguments.length>4?arguments[4]:void 0;return new Promise((s,a)=>{document.getElementById(t)&&a(Error(`A script with the id "${t}" is already loaded. Skipping the loading of this script to prevent conflicts`));try{let o;(e=>{let t=document.getElementsByTagName("head");if(t.length>0)return t[0]?.insertBefore(e,t[0]?.firstChild);let i=document.getElementsByTagName("script");if(i.length>0&&i[0]?.parentNode)return i[0]?.parentNode.insertBefore(e,i[0]);let r=document.createElement("head");r.appendChild(e);let n=document.getElementsByTagName("html")[0];n?.insertBefore(r,n.firstChild)})(e$(e,t,r,()=>{globalThis.clearTimeout(o),s(t)},i=>{globalThis.clearTimeout(o),a(Error(eh(t,e,i)))},n)),o=globalThis.setTimeout(()=>{a(Error(`A timeout of ${i} ms occurred while trying to load the script with id "${t}" from URL "${e}"`))},i)}catch(i){a(eb(i,eh(t,e,"unknown")))}})};class eN{constructor(e,t=1e4){this.logger=e,this.timeout=t}loadJSFile(e){let{url:t,id:i,timeout:r,async:n,callback:s,extraAttributes:a}=e,o=!I(s);eM(t,i,r||this.timeout,n,a).then(e=>{o||s(e)}).catch(e=>{o||s(i,e)})}}var e_=Symbol.for("preact-signals");function eB(){if(eF>1)eF--;else{for(var e,t=!1;void 0!==eH;){var i=eH;for(eH=void 0,ez++;void 0!==i;){var r=i.o;if(i.o=void 0,i.f&=-3,!(8&i.f)&&eq(i))try{i.c()}catch(i){t||(e=i,t=!0)}i=r}}if(ez=0,eF--,t)throw e}}function eL(e){if(eF>0)return e();eF++;try{return e()}finally{eB()}}var eU=void 0;function ej(e){var t=eU;eU=void 0;try{return e()}finally{eU=t}}var eH=void 0,eF=0,ez=0,eQ=0;function eG(e){if(void 0!==eU){var t=e.n;if(void 0===t||t.t!==eU)return t={i:0,S:e,p:eU.s,n:void 0,t:eU,e:void 0,x:void 0,r:t},void 0!==eU.s&&(eU.s.n=t),eU.s=t,e.n=t,32&eU.f&&e.S(t),t;if(-1===t.i)return t.i=0,void 0!==t.n&&(t.n.p=t.p,void 0!==t.p&&(t.p.n=t.n),t.p=eU.s,t.n=void 0,eU.s.n=t,eU.s=t),t}}function eK(e,t){this.v=e,this.i=0,this.n=void 0,this.t=void 0,this.W=null==t?void 0:t.watched,this.Z=null==t?void 0:t.unwatched,this.name=null==t?void 0:t.name}function eV(e,t){return new eK(e,t)}function eq(e){for(var t=e.s;void 0!==t;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function eW(e){for(var t=e.s;void 0!==t;t=t.n){var i=t.S.n;if(void 0!==i&&(t.r=i),t.S.n=t,t.i=-1,void 0===t.n){e.s=t;break}}}function eJ(e){for(var t=e.s,i=void 0;void 0!==t;){var r=t.p;-1===t.i?(t.S.U(t),void 0!==r&&(r.n=t.n),void 0!==t.n&&(t.n.p=r)):i=t,t.S.n=t.r,void 0!==t.r&&(t.r=void 0),t=r}e.s=i}function eX(e,t){eK.call(this,void 0),this.x=e,this.s=void 0,this.g=eQ-1,this.f=4,this.W=null==t?void 0:t.watched,this.Z=null==t?void 0:t.unwatched,this.name=null==t?void 0:t.name}function eZ(e){var t=e.u;if(e.u=void 0,"function"==typeof t){eF++;var i=eU;eU=void 0;try{t()}catch(t){throw e.f&=-2,e.f|=8,eY(e),t}finally{eU=i,eB()}}}function eY(e){for(var t=e.s;void 0!==t;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,eZ(e)}function e0(e){if(eU!==this)throw Error("Out-of-order effect");eJ(this),eU=e,this.f&=-2,8&this.f&&eY(this),eB()}function e1(e,t){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=null==t?void 0:t.name}function e2(e,t){var i=new e1(e,t);try{i.c()}catch(e){throw i.d(),e}var r=i.d.bind(i);return r[Symbol.dispose]=r,r}eK.prototype.brand=e_,eK.prototype.h=function(){return!0},eK.prototype.S=function(e){var t=this,i=this.t;i!==e&&void 0===e.e&&(e.x=i,this.t=e,void 0!==i?i.e=e:ej(function(){var e;null==(e=t.W)||e.call(t)}))},eK.prototype.U=function(e){var t=this;if(void 0!==this.t){var i=e.e,r=e.x;void 0!==i&&(i.x=r,e.e=void 0),void 0!==r&&(r.e=i,e.x=void 0),e===this.t&&(this.t=r,void 0===r&&ej(function(){var e;null==(e=t.Z)||e.call(t)}))}},eK.prototype.subscribe=function(e){var t=this;return e2(function(){var i=t.value,r=eU;eU=void 0;try{e(i)}finally{eU=r}},{name:"sub"})},eK.prototype.valueOf=function(){return this.value},eK.prototype.toString=function(){return this.value+""},eK.prototype.toJSON=function(){return this.value},eK.prototype.peek=function(){var e=eU;eU=void 0;try{return this.value}finally{eU=e}},Object.defineProperty(eK.prototype,"value",{get:function(){var e=eG(this);return void 0!==e&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){if(ez>100)throw Error("Cycle detected");this.v=e,this.i++,eQ++,eF++;try{for(var t=this.t;void 0!==t;t=t.x)t.t.N()}finally{eB()}}}}),eX.prototype=new eK,eX.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if(32==(36&this.f)||(this.f&=-5,this.g===eQ))return!0;if(this.g=eQ,this.f|=1,this.i>0&&!eq(this))return this.f&=-2,!0;var e=eU;try{eW(this),eU=this;var t=this.x();(16&this.f||this.v!==t||0===this.i)&&(this.v=t,this.f&=-17,this.i++)}catch(e){this.v=e,this.f|=16,this.i++}return eU=e,eJ(this),this.f&=-2,!0},eX.prototype.S=function(e){if(void 0===this.t){this.f|=36;for(var t=this.s;void 0!==t;t=t.n)t.S.S(t)}eK.prototype.S.call(this,e)},eX.prototype.U=function(e){if(void 0!==this.t&&(eK.prototype.U.call(this,e),void 0===this.t)){this.f&=-33;for(var t=this.s;void 0!==t;t=t.n)t.S.U(t)}},eX.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;void 0!==e;e=e.x)e.t.N()}},Object.defineProperty(eX.prototype,"value",{get:function(){if(1&this.f)throw Error("Cycle detected");var e=eG(this);if(this.h(),void 0!==e&&(e.i=this.i),16&this.f)throw this.v;return this.v}}),e1.prototype.c=function(){var e=this.S();try{if(8&this.f||void 0===this.x)return;var t=this.x();"function"==typeof t&&(this.u=t)}finally{e()}},e1.prototype.S=function(){if(1&this.f)throw Error("Cycle detected");this.f|=1,this.f&=-9,eZ(this),eW(this),eF++;var e=eU;return eU=this,e0.bind(this,e)},e1.prototype.N=function(){2&this.f||(this.f|=2,this.o=eH,eH=this)},e1.prototype.d=function(){this.f|=8,1&this.f||eY(this)},e1.prototype.dispose=function(){this.d()};class e4{constructor(){this.items=[]}enqueue(e){this.items.push(e)}dequeue(){return 0===this.items.length?null:this.items.shift()}isEmpty(){return 0===this.items.length}size(){return this.items.length}clear(){this.items=[]}}let e5={LOG:0,INFO:1,DEBUG:2,WARN:3,ERROR:4,NONE:5},e6="ERROR",e3=new class{constructor(e="LOG",t="",i=console){this.minLogLevel=e5[e],this.scope=t,this.logProvider=i}log(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];this.outputLog("LOG",t)}info(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];this.outputLog("INFO",t)}debug(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];this.outputLog("DEBUG",t)}warn(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];this.outputLog("WARN",t)}error(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];this.outputLog("ERROR",t)}outputLog(e,t){this.minLogLevel<=e5[e]&&this.logProvider[e.toLowerCase()]?.(...this.formatLogData(t))}setScope(e){this.scope=e||this.scope}setMinLogLevel(e){this.minLogLevel=e5[e],void 0===this.minLogLevel&&(this.minLogLevel=e5.LOG)}formatLogData(e){if(Array.isArray(e)&&e.length>0){let t="%c RS SDK";this.scope&&(t=`${t} - ${this.scope}`);let i=k(e[0])?e[0].trim():"",r=[t=`${t} %c ${i}`,"font-weight: bold; background: black; color: white;","font-weight: normal;"];return k(e[0])||r.push(e[0]),r.push(...e.slice(1)),r}return e}},e8=((o={}).HANDLEDEXCEPTION="handledException",o.UNHANDLEDEXCEPTION="unhandledException",o.UNHANDLEDREJECTION="unhandledPromiseRejection",o),e7=["localStorage","memoryStorage","cookieStorage","sessionStorage","none"],e9="cookieStorage",te="Unable to process/parse source configuration response",tt="Failed to log breadcrumb",ti="Failed to fetch the source config",tr=e=>`${e}:: The provided callback parameter is not a function.`,tn="Failed to set/remove cookies via server. As a fallback, the cookies will be managed client side.",ts={All:!0},ta="js-integrations",to=RegExp("^(https?:\\/\\/)(((([a-zA-Z\\d]([a-zA-Z\\d-]*[a-zA-Z\\d])*)\\.)+[a-zA-Z]{2,}|localhost|((25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9]?)))(\\:\\d+)?(\\/[-a-zA-Z\\d%_.~+]*)*(\\?[;&a-zA-Z\\d%_.~+=-]*)?(\\#[-a-zA-Z\\d_]*)?$"),tl="modern",tu="https://cdn.rudderlabs.com",tc=`${tu}/v3/${tl}/${ta}`,td=`${tu}/v3/${tl}/plugins`,th="https://api.rudderstack.com",tg={iubenda:"IubendaConsentManager",oneTrust:"OneTrustConsentManager",ketch:"KetchConsentManager",custom:"CustomConsentManager"},tp={v3:"StorageEncryption",legacy:"StorageEncryptionLegacy"},tf={xhr:"XhrQueue",beacon:"BeaconQueue"},tv=eV(v({configUrl:th,loadIntegration:!0,sessions:{autoTrack:!0,timeout:18e5,cutOff:{enabled:!1}},sameSiteCookie:"Lax",polyfillIfRequired:!0,integrations:ts,useBeacon:!1,beaconQueueOptions:{},destinationsQueueOptions:{},queueOptions:{},lockIntegrationsVersion:!0,lockPluginsVersion:!0,uaChTrackLevel:"none",plugins:[],useGlobalIntegrationsConfigInEvents:!1,bufferDataPlaneEventsUntilReady:!1,dataPlaneEventsBufferTimeout:1e4,storage:{encryption:{version:"v3"},migrate:!0,cookie:{}},sendAdblockPage:!1,sameDomainCookiesOnly:!1,secureCookie:!1,sendAdblockPageOptions:{},useServerSideCookies:!1})),tm=_({userId:"",userTraits:{},anonymousId:"",groupId:"",groupTraits:{},initialReferrer:"",initialReferringDomain:"",sessionInfo:{},authToken:null}),ty=_({entries:{userId:!0,userTraits:!0,groupId:!0,groupTraits:!0,sessionInfo:!0,authToken:!0,anonymousId:!1,initialReferrer:!1,initialReferringDomain:!1}}),tb={userId:eV(tm.userId),userTraits:eV(tm.userTraits),anonymousId:eV(tm.anonymousId),groupId:eV(tm.groupId),groupTraits:eV(tm.groupTraits),initialReferrer:eV(tm.initialReferrer),initialReferringDomain:eV(tm.initialReferringDomain),sessionInfo:eV(tm.sessionInfo),authToken:eV(tm.authToken)},tE={isOnline:eV(!0),storage:{isLocalStorageAvailable:eV(!1),isCookieStorageAvailable:eV(!1),isSessionStorageAvailable:eV(!1)},isBeaconAvailable:eV(!1),isLegacyDOM:eV(!1),isUaCHAvailable:eV(!1),isCryptoAvailable:eV(!1),isIE11:eV(!1),isAdBlockerDetectionInProgress:eV(!1),isAdBlocked:eV(void 0),cspBlockedURLs:eV([])},tS={isErrorReportingEnabled:eV(!1),isMetricsReportingEnabled:eV(!1),breadcrumbs:eV([])},tI=eV(void 0),tk={activeDataplaneUrl:eV(void 0),integrationsCDNPath:eV(tc),pluginsCDNPath:eV(td),sourceConfigUrl:eV(void 0),status:eV(void 0),initialized:eV(!1),logLevel:eV(e6),loaded:eV(!1),readyCallbacks:eV([]),writeKey:eV(void 0),dataPlaneUrl:eV(void 0),safeAnalyticsInstance:eV(void 0)},tA={enabled:eV(!1),initialized:eV(!1),data:eV({}),activeConsentManagerPluginName:eV(void 0),preConsent:eV({enabled:!1}),postConsent:eV({}),resolutionStrategy:eV("and"),provider:eV(void 0),metadata:eV(void 0)},tT={retries:eV(0),dropped:eV(0),sent:eV(0),queued:eV(0),triggered:eV(0),metricsServiceUrl:eV(void 0)},tw={app:eV({name:eS,namespace:"com.rudderlabs.javascript",version:eI,installType:"npm"}),traits:eV(null),library:eV({name:eS,version:eI,snippetVersion:globalThis.RudderSnippetVersion}),userAgent:eV(null),device:eV(null),network:eV(null),os:eV({name:"",version:""}),locale:eV(null),screen:eV({density:0,width:0,height:0,innerWidth:0,innerHeight:0}),"ua-ch":eV(void 0),timezone:eV(void 0)},tC={configuredDestinations:eV([]),activeDestinations:eV([]),loadOnlyIntegrations:eV({}),failedDestinations:eV([]),loadIntegration:eV(!0),initializedDestinations:eV([]),clientDestinationsReady:eV(!1),integrationsConfig:eV({})},tP={...v({capabilities:tE,consents:tA,context:tw,eventBuffer:{toBeProcessedArray:eV([]),readyCallbacksArray:eV([])},lifecycle:tk,loadOptions:tv,metrics:tT,nativeDestinations:tC,plugins:{ready:eV(!1),loadedPlugins:eV([]),failedPlugins:eV([]),pluginsToLoadFromConfig:eV([]),activePlugins:eV([]),totalPluginsToLoad:eV(0)},reporting:tS,session:tb,source:tI,storage:{encryptionPluginName:eV(void 0),migrate:eV(!1),type:eV(void 0),cookie:eV(void 0),entries:eV({}),trulyAnonymousTracking:eV(!1)},serverCookies:{isEnabledServerSideCookies:eV(!1),dataServiceUrl:eV(void 0)},dataPlaneEvents:{eventsQueuePluginName:eV(void 0),deliveryEnabled:eV(!0)},autoTrack:{enabled:eV(!1),pageLifecycle:{enabled:eV(!1),pageViewId:eV(void 0),pageLoadedTimestamp:eV(void 0)}}})};function tD(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var tO={exports:{}},tR={exports:{}};tR.exports,tO.exports;let tx=tD(function(){var e,t,i,r;if(c)return tO.exports;return c=1,e=function(){return u?tR.exports:(u=1,tR.exports=function(){function e(e){return e.charAt(0).toUpperCase()+e.substring(1)}function t(e){return function(){return this[e]}}var i=["isConstructor","isEval","isNative","isToplevel"],r=["columnNumber","lineNumber"],n=["fileName","functionName","source"],s=i.concat(r,n,["args"],["evalOrigin"]);function a(t){if(t)for(var i=0;i<s.length;i++)void 0!==t[s[i]]&&this["set"+e(s[i])](t[s[i]])}a.prototype={getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof a)this.evalOrigin=e;else if(e instanceof Object)this.evalOrigin=new a(e);else throw TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var e=this.getFileName()||"",t=this.getLineNumber()||"",i=this.getColumnNumber()||"",r=this.getFunctionName()||"";return this.getIsEval()?e?"[eval] ("+e+":"+t+":"+i+")":"[eval]:"+t+":"+i:r?r+" ("+e+":"+t+":"+i+")":e+":"+t+":"+i}},a.fromString=function(e){var t=e.indexOf("("),i=e.lastIndexOf(")"),r=e.substring(0,t),n=e.substring(t+1,i).split(","),s=e.substring(i+1);if(0===s.indexOf("@"))var o=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(s,""),l=o[1],u=o[2],c=o[3];return new a({functionName:r,args:n||void 0,fileName:l,lineNumber:u||void 0,columnNumber:c||void 0})};for(var o=0;o<i.length;o++)a.prototype["get"+e(i[o])]=t(i[o]),a.prototype["set"+e(i[o])]=function(e){return function(t){this[e]=!!t}}(i[o]);for(var l=0;l<r.length;l++)a.prototype["get"+e(r[l])]=t(r[l]),a.prototype["set"+e(r[l])]=function(e){return function(t){if(!(!isNaN(parseFloat(t))&&isFinite(t)))throw TypeError(e+" must be a Number");this[e]=Number(t)}}(r[l]);for(var u=0;u<n.length;u++)a.prototype["get"+e(n[u])]=t(n[u]),a.prototype["set"+e(n[u])]=function(e){return function(t){this[e]=String(t)}}(n[u]);return a}(),tR.exports)}(),t=/(^|@)\S+:\d+/,i=/^\s*at .*(\S+:\d+|\(native\))/m,r=/^(eval@)?(\[native code])?$/,tO.exports={parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(i))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(t){return t.stack.split("\n").filter(function(e){return!!e.match(i)},this).map(function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var i=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),r=i.match(/ (\(.+\)$)/);i=r?i.replace(r[0],""):i;var n=this.extractLocation(r?r[1]:i);return new e({functionName:r&&i||void 0,fileName:["eval","<anonymous>"].indexOf(n[0])>-1?void 0:n[0],lineNumber:n[1],columnNumber:n[2],source:t})},this)},parseFFOrSafari:function(t){return t.stack.split("\n").filter(function(e){return!e.match(r)},this).map(function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===t.indexOf("@")&&-1===t.indexOf(":"))return new e({functionName:t});var i=/((.*".+"[^@]*)?[^@]*)(?:@)/,r=t.match(i),n=r&&r[1]?r[1]:void 0,s=this.extractLocation(t.replace(i,""));return new e({functionName:n,fileName:s[0],lineNumber:s[1],columnNumber:s[2],source:t})},this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(t){for(var i=/Line (\d+).*script (?:in )?(\S+)/i,r=t.message.split("\n"),n=[],s=2,a=r.length;s<a;s+=2){var o=i.exec(r[s]);o&&n.push(new e({fileName:o[2],lineNumber:o[1],source:r[s]}))}return n},parseOpera10:function(t){for(var i=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=t.stacktrace.split("\n"),n=[],s=0,a=r.length;s<a;s+=2){var o=i.exec(r[s]);o&&n.push(new e({functionName:o[3]||void 0,fileName:o[2],lineNumber:o[1],source:r[s]}))}return n},parseOpera11:function(i){return i.stack.split("\n").filter(function(e){return!!e.match(t)&&!e.match(/^Error created at/)},this).map(function(t){var i,r=t.split("@"),n=this.extractLocation(r.pop()),s=r.shift()||"",a=s.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;return s.match(/\(([^)]*)\)/)&&(i=s.replace(/^[^(]+\(([^)]*)\)$/,"$1")),new e({functionName:a,args:void 0===i||"[arguments not available]"===i?void 0:i.split(","),fileName:n[0],lineNumber:n[1],columnNumber:n[2],source:t})},this)}},tO.exports}()),t$="global code",tM=e=>k(e)?e:"";function tN(e,t,i,r){return{errorClass:tM(e),message:`${i}${tM(t)}`,type:"browserjs",stacktrace:r.reduce((e,t)=>{var i;let r,n=((r={file:t.fileName,method:A(i=t.functionName)&&/^global code$/i.test(i)?t$:i,lineNumber:t.lineNumber,columnNumber:t.columnNumber}).lineNumber&&r.lineNumber>-1&&!r.file&&!r.method&&(r.file=t$),r);try{if("{}"===JSON.stringify(n))return e;return e.concat(n)}catch{return e}},[])}}let t_=(e,t)=>{let i;if(w(e)&&k(ey(e)))i=e;else{let r;t.warn((r=ep(e),`${X}:: Ignoring a non-error: ${r}.`)),i=void 0}return i},tB=(e,t)=>{try{return JSON.parse(e||"")}catch(e){t(eb(e,"Failed to parse response data"))}},tL="The request failed",tU=[RegExp(`${tL}.*`),/A script with the id .* is already loaded\./],tj=[/Failed to fetch dynamically imported module: .*/,/Unable to load \(.*\) the script with the id .*/,/A timeout of \d+ ms occurred while trying to load the script with id .*/],tH={headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},method:"GET"},tF=(e,t,i)=>{let r=O(tH,t||{});return i&&(r.headers=O(r.headers,{Authorization:i})),r.url=e,r},tz=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,i=arguments.length>2?arguments[2]:void 0;return new Promise((r,n)=>{let s;if(!0===e.sendRawData)s=e.data;else if(null===(s=ep(e.data,!1,[],i)))return void n({error:Error("Failed to prepare data for the request."),undefined,options:e});let a=new XMLHttpRequest,o=t=>{let i;n({error:Error((i=e.url,`${tL} due to timeout or no connection (${t?t.type:""}) at the client side for URL: ${i}`)),xhr:a,options:e,...t?.type==="timeout"?{timedOut:!0}:{}})};a.ontimeout=o,a.onerror=o,a.onload=()=>{if(a.status>=200&&a.status<400)r({response:a.responseText,xhr:a,options:e});else{let t,i,r,s;n({error:Error((t=a.status,i=a.statusText,r=e.url,s=a.responseText,`${tL} with status ${t} (${i}) for URL: ${r}. Response: ${s.trim()}`)),xhr:a,options:e})}},a.open(e.method,e.url,!0),!0===e.withCredentials&&(a.withCredentials=!0),a.timeout=t,Object.keys(e.headers).forEach(t=>{e.headers[t]&&a.setRequestHeader(t,e.headers[t])});try{a.send(s)}catch(i){let t;n({error:eb(i,(t=e.url,`${tL} for URL: ${t}`)),xhr:a,options:e})}})},tQ=new class{constructor(e){this.logger=e,this.onError=this.onError.bind(this)}init(e){this.errorHandler=e}async getData(e){let{url:t,options:i,timeout:r,isRawResponse:n}=e;try{let e=await tz(tF(t,i,this.basicAuthHeader),r,this.logger);return{data:n?e.response:tB(e.response,this.onError),details:e}}catch(e){return{data:void 0,details:e}}}getAsyncData(e){let{callback:t,url:i,options:r,timeout:n,isRawResponse:s}=e,a=!I(t);tz(tF(i,r,this.basicAuthHeader),n,this.logger).then(e=>{a||t(s?e.response:tB(e.response,this.onError),e)}).catch(e=>{a||t(void 0,e)})}onError(e,t){this.errorHandler?.onError({error:e,context:"HttpClient",groupingHash:t})}setAuthHeader(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t?e:L(`${e}:`);this.basicAuthHeader=`Basic ${i}`}resetAuthHeader(){this.basicAuthHeader=void 0}}(e3),tG=["www.test-host.com","localhost","127.0.0.1","[::1]"],tK=["userId","userTraits","groupId","groupTraits","anonymousId","config","integration","eventBuffer","traits","authToken"],tV=e=>{tP.capabilities.isAdBlockerDetectionInProgress.value=!0;try{let t=new URL(tP.lifecycle.sourceConfigUrl.value),i=`${t.origin}${t.pathname}?view=ad`;e.getAsyncData({url:i,options:{method:"HEAD",headers:{"Content-Type":void 0}},isRawResponse:!0,callback:(e,t)=>{tP.capabilities.isAdBlockerDetectionInProgress.value=!1,tP.capabilities.isAdBlocked.value=t?.error!==void 0||t?.xhr?.responseURL!==i}})}catch(e){throw tP.capabilities.isAdBlockerDetectionInProgress.value=!1,e}},tq=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>window.location.hostname,t=e();return!t||t&&tG.includes(t)?"development":"production"},tW=new class{initialized=!1;constructor(e,t){this.httpClient=e,this.logger=t}init(){this.initialized||(this.attachErrorListeners(),this.initialized=!0)}attachErrorListeners(){globalThis.addEventListener("error",e=>{this.onError({error:e,context:X,errorType:e8.UNHANDLEDEXCEPTION})}),globalThis.addEventListener("unhandledrejection",e=>{this.onError({error:e,context:X,errorType:e8.UNHANDLEDREJECTION})}),document.addEventListener("securitypolicyviolation",e=>{let t=k(e.blockedURI)?e.blockedURI:"";"enforce"===e.disposition&&t.startsWith(tu)&&!tP.capabilities.cspBlockedURLs.value.includes(t)&&(tP.capabilities.cspBlockedURLs.value=[...tP.capabilities.cspBlockedURLs.value,t])})}async onError(e){try{let{error:i,context:r,customMessage:n,groupingHash:s,category:a}=e,o=e.errorType??e8.HANDLEDEXCEPTION,l=((e,t)=>{switch(t){case e8.UNHANDLEDEXCEPTION:{let{error:t}=e;return t||e}case e8.UNHANDLEDREJECTION:return e.reason;case e8.HANDLEDEXCEPTION:default:return e}})(i,o),u=t_(l,this.logger);if(void 0===u)return;let c=n?`${n} - `:"",d=`${r}:: ${c}`,h=((e,t)=>{try{let i=tx.parse(e);return tN(e.name,e.message,t,i)}catch{return tN(e.name,e.message,t,[])}})(u,d),g=ey(u).includes(em);if(!g&&!(e=>{let t=e.stacktrace[0]?.file;if(!t||"string"!=typeof t)return!1;let i=t.substring(t.lastIndexOf("/")+1),r=t.split("/");return r[r.length-2]===ta||["rsa"].some(e=>i.startsWith(e)&&i.endsWith(".js"))})(h)&&o!==e8.HANDLEDEXCEPTION)return;if(tP.reporting.isErrorReportingEnabled.value){var t;let e;if(await (t=this.httpClient,e=h.message,new Promise(i=>{if(tj.some(t=>t.test(e))){let r=/https?:\/\/[^\s"'(),;<>[\]{}]+/.exec(e)?.[0];if(k(r))if(r.startsWith(tu))if(tP.capabilities.cspBlockedURLs.value.includes(r))i(!1);else if(void 0===tP.capabilities.isAdBlocked.value){!1===tP.capabilities.isAdBlockerDetectionInProgress.value&&tV(t);let e=e2(()=>{A(tP.capabilities.isAdBlocked.value)&&(i(!1===tP.capabilities.isAdBlocked.value),e())})}else i(!1===tP.capabilities.isAdBlocked.value);else i(!1);else i(!0)}else i(!tU.some(t=>t.test(e)))}))){let e={severity:"error",unhandled:o!==e8.HANDLEDEXCEPTION,severityReason:{type:o}},t=((e,t,i,r)=>{let n;if("cdn"!==i.context.app.value.installType)return n;if(A(e))if(k(e))n=e;else{let i=t_(e,r);n=A(i)?i.message:t}else n=t;return n})(s,h.message,tP,this.logger),i=((e,t,i,r)=>{let n,{context:s,lifecycle:a,session:o,source:l,reporting:u,autoTrack:c}=i,{app:d,locale:h,userAgent:g,timezone:p,screen:f,library:m}=s;return{payloadVersion:"5",notifier:{name:"RudderStack JavaScript SDK",version:d.value.version,url:"git+https://github.com/rudderlabs/rudder-sdk-js.git"},events:[{exceptions:[v(e)],severity:t.severity,unhandled:t.unhandled,severityReason:t.severityReason,app:{version:d.value.version,releaseStage:tq(),type:d.value.installType},device:{locale:h.value??"NA",userAgent:g.value??"NA",time:new Date},request:{url:globalThis.location.href.split("?")[0],clientIp:"[NOT COLLECTED]"},breadcrumbs:v(u.breadcrumbs.value),context:e.message,groupingHash:r,metaData:{app:{snippetVersion:m.value.snippetVersion},device:{...f.value,timezone:p.value},...(n=ep(i,!1,tK),null!==n?JSON.parse(n):{})},user:{id:`${l.value?.id??a.writeKey.value}..${o.sessionInfo.value.id??"NA"}..${c.pageLifecycle.pageViewId.value??"NA"}`,name:l.value?.name??"NA"}}]}})(h,e,tP,t);this.httpClient.getAsyncData({url:tP.metrics.metricsServiceUrl.value,options:{method:"POST",data:ep({version:"1",message_id:el(),source:{name:"js",sdk_version:tP.context.app.value.version,write_key:tP.lifecycle.writeKey.value,install_type:tP.context.app.value.installType,category:a??"sdk"},errors:i}),sendRawData:!0},isRawResponse:!0})}}(o===e8.HANDLEDEXCEPTION||g)&&this.logger.error(h.message)}catch(e){this.logger.error(`${X}:: Failed to handle the error.`,e)}}leaveBreadcrumb(e){try{tP.reporting.breadcrumbs.value=[...tP.reporting.breadcrumbs.value,{type:"manual",name:e,timestamp:new Date,metaData:{}}]}catch(e){this.onError({error:e,context:X,customMessage:tt,groupingHash:tt})}}}(tQ,e3),tJ=new class{plugins=[];byName={};cache={};config={throws:!0};constructor(e,t={}){this.config={throws:!0,...t},this.logger=e}register(e,t){if(!e.name){let t=`${Z}:: Plugin name is missing.`;if(!this.config.throws)return void this.logger.error(t,e);throw Error(t)}if(this.byName[e.name]){let t,i=(t=e.name,`${Z}:: Plugin "${t}" already exists.`);if(!this.config.throws)return void this.logger.error(i);throw Error(i)}this.cache={},this.plugins=this.plugins.slice();let i=this.plugins.length;this.plugins.forEach((t,r)=>{t.deps?.includes(e.name)&&(i=Math.min(i,r))}),this.plugins.splice(i,0,e),this.byName[e.name]=e,I(e.initialize)&&e.initialize(t)}unregister(e){let t=this.byName[e];if(!t){let t=`${Z}:: Plugin "${e}" not found.`;if(!this.config.throws)return void this.logger.error(t);throw Error(t)}let i=this.plugins.indexOf(t);if(-1===i){let t=`${Z}:: Plugin "${e}" not found in plugins but found in byName. This indicates a bug in the plugin engine. Please report this issue to the development team.`;if(!this.config.throws)return void this.logger.error(t);throw Error(t)}this.cache={},delete this.byName[e],this.plugins=this.plugins.slice(),this.plugins.splice(i,1)}getPlugin(e){return this.byName[e]}getPlugins(e){let t=e??".";return this.cache[t]||(this.cache[t]=this.plugins.filter(e=>{if(e.deps?.some(e=>!this.byName[e])){let t,i=e.deps.filter(e=>!this.byName[e]);return this.logger.error((t=e.name,`${Z}:: Plugin "${t}" could not be loaded because some of its dependencies "${i}" do not exist.`)),!1}return"."===t||!!C(e,t)})),this.cache[t]}processRawPlugins(e){e(this.plugins),this.cache={}}invoke(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];for(var i=arguments.length,r=Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];let s=e;if(!s)throw Error("Failed to invoke plugin because the extension point name is missing.");let a=s.startsWith("!"),o=this.config.throws??s.endsWith("!");if(!(s=s.replace(/(^!|!$)/g,"")))throw Error("Failed to invoke plugin because the extension point name is invalid.");let l=s.split(".");l.pop();let u=l.join(".");return(t?this.getPlugins(s):[this.getPlugins(s)[0]]).map(e=>{let t=C(e,s);if(!I(t)||a)return t;try{return t.apply(C(e,u),r)}catch(r){let t,i;if(o)throw r;this.logger.error((t=s,i=e.name,`${Z}:: Failed to invoke the "${t}" extension point of plugin "${i}".`),r)}return null})}invokeSingle(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return this.invoke(e,!1,...i)[0]}invokeMultiple(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return this.invoke(e,!0,...i)}}(e3,{throws:!0}),tX=e=>"cloud"!==e.config.connectionMode||!0===e.config.useNativeSDKToSend||!0===e.config.useNativeSDK,tZ=e=>"hybrid"===e.config.connectionMode||!0===e.config.useNativeSDKToSend,tY=["BeaconQueue","CustomConsentManager","DeviceModeDestinations","DeviceModeTransformation","ExternalAnonymousId","GoogleLinker","IubendaConsentManager","KetchConsentManager","NativeDestinationQueue","OneTrustConsentManager","StorageEncryption","StorageEncryptionLegacy","StorageMigrator","XhrQueue"],t0=["Bugsnag","ErrorReporting"],t1="cookieStorage",t2="localStorage",t4="sessionStorage",t5="memoryStorage",t6="none",t3=e=>{if(!k(e))return!1;try{return I(globalThis.URL)&&new URL(e),to.test(e)}catch(e){return!1}},t8=e=>429===e||!(e>=400&&e<500),t7=(e,t)=>{try{return encodeURIComponent(e)}catch(e){t?.error("Failed to encode the cookie data.",e);return}},t9=e=>{try{return decodeURIComponent(e)}catch(e){return}},ie=()=>{let e,t,i;return t={},(i=globalThis.document.cookie.split(/\s*;\s*/))[0]&&i.forEach(i=>{let r=(e=i.split("="))[0]?t9(e[0]):void 0;r&&(t[r]=e[1]?t9(e[1]):void 0)}),t},it=function(e,t,i,r){switch(arguments.length){case 4:case 3:case 2:let n={...i||{}},s=`${t7(e,r)}=${t7(t,r)}`;null===t&&(n.maxage=-1),n.maxage&&(n.expires=new Date(+new Date+n.maxage)),n.path&&(s+=`; path=${n.path}`),n.domain&&(s+=`; domain=${n.domain}`),n.expires&&(s+=`; expires=${n.expires.toUTCString()}`),n.samesite&&(s+=`; samesite=${n.samesite}`),n.secure&&(s+="; secure"),globalThis.document.cookie=s;return;case 1:if(e)return ie()[e];return ie();default:return ie()}},ii={userId:"rl_user_id",userTraits:"rl_trait",anonymousId:"rl_anonymous_id",groupId:"rl_group_id",groupTraits:"rl_group_trait",initialReferrer:"rl_page_init_referrer",initialReferringDomain:"rl_page_init_referring_domain",sessionInfo:"rl_session",authToken:"rl_auth_token"},ir="RS_ENC_v3_",is=e=>e?.startsWith(ir)?U(e.substring(ir.length)):e,ia="client-network",io="integrations",il=e=>e instanceof DOMException&&(["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"].includes(e.name)||[22,1014].includes(e.code)),iu=function(){let e,t,i,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t2,n=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0,a=`${K}:: The "${r}" storage type is `,o="unavailable",l=!0;try{switch(r){case t5:return!0;case t1:e=n,t="test_rudder_cookie";break;case t2:e=n??globalThis.localStorage,t="test_rudder_ls";break;case t4:e=n??globalThis.sessionStorage,t="test_rudder_ss";break;default:return!1}if(e&&(e.setItem(t,"true"),e.getItem(t)))return e.removeItem(t),!0;l=!1}catch(e){l=!1,i=e,il(e)&&(o="full")}return l||s?.warn(`${a}${o}.`,i),!1},ic="QueueUtilities",id=(e,t)=>ep(e,!0,void 0,t),ih=(e,t)=>{let i=id(e,t);if(i){let e=i.length;e>32768&&t?.warn(`${ic}:: The size of the event payload (${e} bytes) exceeds the maximum limit of 32768 bytes. Events with large payloads may be dropped in the future. Please review your instrumentation to ensure that event payloads are within the size limit.`)}else t?.warn(`${ic}:: Failed to validate event payload size. Please make sure that the event payload is within the size limit and is a valid JSON object.`)},ig=(e,t)=>{let i=v(e);return i.sentAt=t,i},ip=e=>iu(t2,void 0,e)?t2:iu(t4,void 0,e)?t4:t5,iv={IN_PROGRESS:"inProgress",QUEUE:"queue",RECLAIM_START:"reclaimStart",RECLAIM_END:"reclaimEnd",ACK:"ack",BATCH_QUEUE:"batchQueue"},im=(e,t)=>`${e}:: ${iy(t)}`,iy=e=>`Failed to send events batch data to the browser's beacon queue for URL ${e}.`,ib={maxItems:10,flushQueueInterval:6e5},iE="BeaconQueuePlugin",iS=(e,t,i)=>{try{let r=ep({batch:e,sentAt:t},!0);if(r)return new Blob([r],{type:"text/plain"});i?.error(`${iE}:: Failed to convert events batch object to string.`)}catch(e){i?.error(`${iE}:: Failed to convert events batch object to Blob.`,e)}},iI=((l={})[l.ASAP=1]="ASAP",l[l.RESCHEDULE=2]="RESCHEDULE",l[l.ABANDON=3]="ABANDON",l),ik={setTimeout:(e,t)=>globalThis.setTimeout(e,t),clearTimeout:e=>globalThis.clearTimeout(e),Date:globalThis.Date,clockLateFactor:2};class iA{constructor(){this.tasks={},this.nextId=1,this.clock=ik}now(){return+new this.clock.Date}run(e,t,i){this.nextId===Number.MAX_SAFE_INTEGER&&(this.nextId=1);let r=(this.nextId++).toString();return this.tasks[r]=this.clock.setTimeout(this.handle(r,e,t,i||iI.ASAP),t),r}handle(e,t,i,r){let n=this.now();return()=>{delete this.tasks[e];let s=n+i*(this.clock.clockLateFactor||2),a=this.now();if(r>=iI.RESCHEDULE&&s<a){r===iI.RESCHEDULE&&this.run(t,i,r);return}return t()}}cancel(e){this.tasks[e]&&(this.clock.clearTimeout(this.tasks[e]),delete this.tasks[e])}cancelAll(){Object.values(this.tasks).forEach(this.clock.clearTimeout),this.tasks={}}}let iT=1/0,iw=1/0,iC="Batch",iP="Single",iD=(e,t)=>e.time-t.time,iO="RetryQueue";class iR{constructor(e,t,i,r,n=t2,s,a){this.storeManager=r,this.logger=s,this.name=e,this.id=el(),this.processQueueCb=i,this.batchSizeCalcCb=a,this.maxItems=t.maxItems||iw,this.maxAttempts=t.maxAttempts||iT,this.batch={enabled:!1},this.configureBatchMode(t),this.backoff={minRetryDelay:t.minRetryDelay||1e3,maxRetryDelay:t.maxRetryDelay||3e4,factor:t.backoffFactor||2,jitter:t.backoffJitter||0};let o=Math.max(t.timerScaleFactor??1,1);o=Math.min(o,10),this.timeouts={ackTimer:Math.round(1e3*o),reclaimTimer:Math.round(3e3*o),reclaimTimeout:Math.round(1e4*o),reclaimWait:Math.round(500*o)},this.schedule=new iA,this.processId="0",this.store=this.storeManager.setStore({id:this.id,name:this.name,validKeys:iv,type:n,errorHandler:this.storeManager.errorHandler,logger:this.storeManager.logger}),this.setDefaultQueueEntries(),this.ack=this.ack.bind(this),this.checkReclaim=this.checkReclaim.bind(this),this.processHead=this.processHead.bind(this),this.flushBatch=this.flushBatch.bind(this),this.isPageAccessible=!0,this.flushBatchOnPageLeave(),this.scheduleTimeoutActive=!1}setDefaultQueueEntries(){this.setStorageEntry(iv.IN_PROGRESS,{}),this.setStorageEntry(iv.QUEUE,[]),this.setStorageEntry(iv.BATCH_QUEUE,[])}configureBatchMode(e){if(this.batchingInProgress=!1,!P(e.batch))return;let t=e.batch;this.batch.enabled=!0===t.enabled,this.batch.enabled&&(this.batch.maxSize=Math.min(t.maxSize??524288,524288),this.batch.maxItems=t.maxItems??100,this.batch.flushInterval=t.flushInterval??6e4)}flushBatchOnPageLeave(){this.batch.enabled&&ec(this.flushBatch)}getStorageEntry(e){return this.store.get(e)}setStorageEntry(e,t){null==t?this.store.remove(e):this.store.set(e,t)}stop(){this.schedule.cancelAll(),this.scheduleTimeoutActive=!1}start(){this.scheduleTimeoutActive&&this.stop(),this.scheduleTimeoutActive=!0,this.scheduleFlushBatch(),this.ack(),this.checkReclaim(),this.processHead()}scheduleFlushBatch(){this.batch.enabled&&this.batch?.flushInterval&&(this.flushBatchTaskId&&this.schedule.cancel(this.flushBatchTaskId),this.flushBatchTaskId=this.schedule.run(this.flushBatch,this.batch.flushInterval,iI.ASAP))}flushBatch(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(!this.batchingInProgress){this.isPageAccessible=e,this.batchingInProgress=!0;let t=this.getStorageEntry(iv.BATCH_QUEUE)??[];if(t.length>0){t=t.slice(-t.length);let e=this.genQueueItem(t.map(e=>e.item),iC);this.setStorageEntry(iv.BATCH_QUEUE,[]),this.pushToMainQueue(e)}this.batchingInProgress=!1,this.scheduleFlushBatch()}}shouldRetry(e,t){return t<=this.maxAttempts}getDelay(e){let t=this.backoff.minRetryDelay*this.backoff.factor**e;if(this.backoff.jitter){let e=Math.random(),i=Math.floor(e*this.backoff.jitter*t);5>Math.floor(10*e)?t-=i:t+=i}return Number(Math.min(t,this.backoff.maxRetryDelay).toPrecision(1))}enqueue(e){let t;(t=this.batch.enabled&&e.type===iP?this.handleNewItemForBatch(e):e)&&this.pushToMainQueue(t)}handleNewItemForBatch(e){let t,i=this.getStorageEntry(iv.BATCH_QUEUE)??[];if(this.batchingInProgress)i.push(e);else{this.batchingInProgress=!0,(i=i.slice(-i.length)).push(e);let r=this.getBatchDispatchInfo(i);if(r.criteriaMet||r.criteriaExceeded){let n;if(r.criteriaExceeded?(n=i.slice(0,i.length-1),i=[e]):(n=i,i=[]),n.length>0){let e=n.every(e=>e.reclaimed),i=n.map(e=>e.item);t=e?this.genQueueItem(i,iC,!0):this.genQueueItem(i,iC)}this.scheduleFlushBatch()}this.batchingInProgress=!1}return this.setStorageEntry(iv.BATCH_QUEUE,i),t}pushToMainQueue(e){let t=this.getStorageEntry(iv.QUEUE)??[];(t=this.maxItems>1?t.slice(-(this.maxItems-1)):[]).push(e),t=t.sort(iD),this.setStorageEntry(iv.QUEUE,t),this.scheduleTimeoutActive&&this.processHead()}addItem(e){this.enqueue(this.genQueueItem(e))}genQueueItem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:iP,i=arguments.length>2?arguments[2]:void 0;return{item:e,attemptNumber:0,time:this.schedule.now(),id:el(),type:t,...A(i)?{reclaimed:i}:{}}}requeue(e){let{attemptNumber:t,item:i,type:r,id:n,firstAttemptedAt:s,lastAttemptedAt:a,reclaimed:o,retryReason:l}=e,u=t+1;this.shouldRetry(i,u)&&this.enqueue({item:i,attemptNumber:u,time:this.schedule.now()+this.getDelay(u),id:n??el(),type:r,firstAttemptedAt:s,lastAttemptedAt:a,reclaimed:o,retryReason:l})}getBatchDispatchInfo(e){let t=!1,i=!1,r=this.batch?.maxItems;if(A(r)&&(t=e.length===r,i=e.length>r),t||i)return{criteriaMet:t,criteriaExceeded:i};let n=!1,s=!1,a=this.batch?.maxSize;if(A(a)&&A(this.batchSizeCalcCb)){let t=this.batchSizeCalcCb(e.map(e=>e.item));n=t===a,s=t>a}return{criteriaMet:n,criteriaExceeded:s}}processHead(){this.schedule.cancel(this.processId);let e=this.getStorageEntry(iv.QUEUE)??[],t=this.schedule.now(),i=[],r=(e,t)=>(i,r)=>{let n=this.getStorageEntry(iv.IN_PROGRESS)??{},s=n[t],a=s?.firstAttemptedAt,o=s?.lastAttemptedAt;delete n[t],this.setStorageEntry(iv.IN_PROGRESS,n),i&&this.requeue({...e,firstAttemptedAt:a,lastAttemptedAt:o,retryReason:r?.retryReason??ia})},n=(e,t)=>{i.push({id:t,item:e.item,done:r(e,t),attemptNumber:e.attemptNumber})},s=this.getStorageEntry(iv.IN_PROGRESS)??{},a=Object.keys(s).length;for(;e.length>0&&e[0].time<=t&&a++<this.maxItems;){let t=e.shift();if(t){let e=el();s[e]={item:t.item,attemptNumber:t.attemptNumber,time:this.schedule.now(),type:t.type,firstAttemptedAt:t.firstAttemptedAt,lastAttemptedAt:t.lastAttemptedAt,reclaimed:t.reclaimed},n(t,e)}}if(this.setStorageEntry(iv.QUEUE,e),this.setStorageEntry(iv.IN_PROGRESS,s),i.forEach(e=>{try{let t=this.schedule.now(),i=this.getStorageEntry(iv.IN_PROGRESS)??{},r=i[e.id],n=t,s=t,a=!1,o=ia;r&&(o=r.retryReason??o,n=r.firstAttemptedAt??n,s=r.lastAttemptedAt??s,a=r.reclaimed??a,r.firstAttemptedAt=n,r.lastAttemptedAt=t,i[e.id]=r,this.setStorageEntry(iv.IN_PROGRESS,i));let l=t-n,u=t-s,c=this.shouldRetry(e.item,e.attemptNumber+1);this.processQueueCb(e.item,e.done,{retryAttemptNumber:e.attemptNumber,maxRetryAttempts:this.maxAttempts,willBeRetried:c,timeSinceFirstAttempt:l,timeSinceLastAttempt:u,reclaimed:a,isPageAccessible:this.isPageAccessible,retryReason:o})}catch(r){let t,i="";e.attemptNumber<this.maxAttempts?(i="The item will be requeued.",e.attemptNumber>0&&(i=`${i} Retry attempt ${e.attemptNumber} of ${this.maxAttempts}.`),e.done(r)):(i=`Retries exhausted (${this.maxAttempts}). The item will be dropped.`,e.done()),this.logger?.error((t=i,`${iO}:: An unknown error occurred while processing the queue item. ${t}`),r)}}),e=this.getStorageEntry(iv.QUEUE)??[],this.schedule.cancel(this.processId),e.length>0){let i=e[0].time-t;this.processId=this.schedule.run(this.processHead,i,iI.ASAP)}}ack(){this.setStorageEntry(iv.ACK,this.schedule.now()),null!=this.reclaimStartVal&&(this.reclaimStartVal=null,this.setStorageEntry(iv.RECLAIM_START,null)),null!=this.reclaimEndVal&&(this.reclaimEndVal=null,this.setStorageEntry(iv.RECLAIM_END,null)),this.schedule.run(this.ack,this.timeouts.ackTimer,iI.ASAP)}reclaim(e){let t=this.storeManager.setStore({id:e,name:this.name,validKeys:iv,type:t2,errorHandler:this.storeManager.errorHandler,logger:this.storeManager.logger}),i={queue:this.getStorageEntry(iv.QUEUE)??[]},r={inProgress:t.get(iv.IN_PROGRESS)??{},batchQueue:t.get(iv.BATCH_QUEUE)??[],queue:t.get(iv.QUEUE)??[]},n=[],s=(e,t)=>{let r=e=>{let r=e.id??el();if(n.includes(r));else{let s=Array.isArray(e.item)?iC:iP;i.queue.push({item:e.item,attemptNumber:e.attemptNumber+t,time:this.schedule.now(),id:r,type:e.type??s,firstAttemptedAt:e.firstAttemptedAt,lastAttemptedAt:e.lastAttemptedAt,retryReason:e.retryReason,reclaimed:!0}),n.push(r)}};Array.isArray(e)?e.forEach(r):e&&Object.values(e).forEach(r)};s(r.queue,0),this.batch.enabled?r.batchQueue.forEach(e=>{let t=e.id??el();n.includes(t)||(this.enqueue({...e,id:t,retryReason:e.retryReason,reclaimed:!0,type:e.type??iP,time:this.schedule.now()}),n.push(t))}):s(r.batchQueue,0),s(r.inProgress,1),i.queue.sort(iD),this.setStorageEntry(iv.QUEUE,i.queue),this.clearQueueEntries(t,1),this.processHead()}clearQueueEntries(e,t){this.removeStorageEntry(e,0,t)}removeStorageEntry(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=Object.keys(iv),s=iv[n[t]];globalThis.setTimeout(()=>{try{e.remove(s),t+1<n.length&&this.removeStorageEntry(e,t+1,i)}catch(o){let a="NS_ERROR_STORAGE_BUSY";if((o.name===a||o.code===a||0x80630001===o.code)&&r<2)this.removeStorageEntry(e,t,i+40,r+1);else this.logger?.error(`${iO}:: Failed to remove local storage entry "${s}" (attempt: ${r}.`,o);2===r&&t+1<n.length&&this.removeStorageEntry(e,t+1,i)}},i)}checkReclaim(){let e=e=>()=>{e.get(iv.RECLAIM_END)!==this.id||e.get(iv.RECLAIM_START)===this.id&&this.reclaim(e.id)},t=t=>()=>{t.get(iv.RECLAIM_START)===this.id&&(t.set(iv.RECLAIM_END,this.id),this.schedule.run(e(t),this.timeouts.reclaimWait,iI.ABANDON))},i=e=>{e.set(iv.RECLAIM_START,this.id),e.set(iv.ACK,this.schedule.now()),this.schedule.run(t(e),this.timeouts.reclaimWait,iI.ABANDON)};(e=>{let t=[],i=this.store.getOriginalEngine(),r=[];if(I(i.keys))r=i.keys();else for(let e=0;e<i.length;e++){let t=i.key(e);t&&r.push(t)}return r.forEach(i=>{let r=i?i.split("."):[];r.length>=3&&r[0]===e&&r[1]!==this.id&&r[2]===iv.ACK&&t.push(this.storeManager.setStore({id:r[1],name:e,validKeys:iv,type:t2,errorHandler:this.storeManager.errorHandler,logger:this.storeManager.logger}))}),t})(this.name).forEach(e=>{this.schedule.now()-e.get(iv.ACK)<this.timeouts.reclaimTimeout||i(e)}),this.schedule.run(this.checkReclaim,this.timeouts.reclaimTimer,iI.RESCHEDULE)}clear(){this.schedule.cancelAll(),this.setDefaultQueueEntries()}}let ix="BeaconQueue",i$="CustomConsentManager",iM="DeviceModeDestinationsPlugin",iN=e=>`Failed to initialize integration for destination "${e}".`,i_=e=>`Failed to get integrations data for destination "${e}".`,iB=e=>`Failed to get the ready status from integration for destination "${e}"`,iL=(e,t)=>{let i=e.All??!0;return t.filter(t=>{let r,n,s,a=t.displayName;return i?(s=!0,void 0!==(r=e[a])&&!1==!!r&&(s=!1)):(s=!1,void 0!==(n=e[a])&&!0==!!n&&(s=!0)),s})},iU={HubSpot:"HubSpot","Google Analytics":"GA",Hotjar:"Hotjar","Google Ads":"GoogleAds",VWO:"VWO","Google Tag Manager":"GoogleTagManager",Braze:"Braze",Intercom:"INTERCOM",Keen:"Keen","Kiss Metrics":"Kissmetrics","Customer IO":"CustomerIO",Chartbeat:"Chartbeat","Facebook Pixel":"FacebookPixel",Lotame:"Lotame","Optimizely Web":"Optimizely",Bugsnag:"Bugsnag",Fullstory:"Fullstory",TVSquared:"TVSquared","Google Analytics 4 (GA4)":"GA4","Google Analytics 4 (GA4) V2":"GA4_V2",MoEngage:"MoEngage",Amplitude:"Amplitude",Pendo:"Pendo",Lytics:"Lytics",Appcues:"Appcues",PostHog:"Posthog",Klaviyo:"Klaviyo",CleverTap:"Clevertap","Bing Ads":"BingAds","Pinterest Tag":"PinterestTag","Adobe Analytics":"AdobeAnalytics","Linkedin Insight Tag":"LinkedInInsightTag","Reddit Pixel":"RedditPixel",Drip:"Drip","Heap.io":"Heap",Criteo:"Criteo",Mixpanel:"Mixpanel",Qualtrics:"Qualtrics",ProfitWell:"ProfitWell",Sentry:"Sentry","Quantum Metric":"QuantumMetric","Snap Pixel":"SnapPixel","Post Affiliate Pro":"PostAffiliatePro","Google Optimize":"GoogleOptimize",LaunchDarkly:"LaunchDarkly","Google Analytics 360":"GA360",Adroll:"Adroll","DCM Floodlight":"DCMFloodlight",Matomo:"Matomo",Vero:"Vero",Mouseflow:"Mouseflow",Rockerbox:"Rockerbox",Convertflow:"ConvertFlow",SnapEngage:"SnapEngage",livechat:"LiveChat",Shynet:"Shynet",WOOPRA:"Woopra",rollbar:"RollBar","Quora Pixel":"QuoraPixel",JUNE:"June",Engage:"Engage",Iterable:"Iterable","Yandex.Metrica":"YandexMetrica",Refiner:"Refiner",Qualaroo:"Qualaroo",Podsights:"Podsights",Axeptio:"Axeptio",SatisMeter:"Satismeter","Microsoft Clarity":"MicrosoftClarity",Sendinblue:"Sendinblue",Olark:"Olark","Lemnisk Marketing Automation":"Lemnisk","TikTok Ads":"TiktokAds",ActiveCampaign:"ActiveCampaign",Sprig:"Sprig","Spotify Pixel":"SpotifyPixel",CommandBar:"CommandBar",Ninetailed:"Ninetailed","Gainsight PX":"Gainsight_PX",XPixel:"XPixel",Userpilot:"Userpilot",Comscore:"Comscore"},ij=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Promise((i,r)=>{if(e.integration?.isReady())i(!0);else if(t>=11e3)r(Error("A timeout of 11000 ms occurred"));else{let n=Date.now();new Promise(e=>{globalThis.setTimeout(e,100)}).then(()=>{ij(e,t+(Date.now()-n)).then(i).catch(e=>r(e))})}})},iH=(e,t,i,r,n,s)=>{try{let s,a=v(e),o=a.integration;if(s=o,void 0===s){let n;n={loadIntegration:t.nativeDestinations.loadIntegration.value,logLevel:t.lifecycle.logLevel.value,loadOnlyIntegrations:t.consents.postConsent.value?.integrations??t.nativeDestinations.loadOnlyIntegrations.value,...t.lifecycle.safeAnalyticsInstance.value},a.integration=o=new globalThis[i][r](v(e.config),n,{shouldApplyDeviceModeTransformation:e.shouldApplyDeviceModeTransformation,propagateEventsUntransformedOnError:e.propagateEventsUntransformedOnError,destinationId:e.id})}o.init?.(),ij(a).then(()=>{tZ(a)&&(t.nativeDestinations.integrationsConfig.value=((e,t,i)=>{let r=t;if(I(e.integration?.getDataForIntegrationsObject))try{r={...t,...ev(e.integration.getDataForIntegrationsObject())}}catch(t){i?.onError({error:t,context:iM,customMessage:i_(e.userFriendlyId),groupingHash:i_(e.displayName),category:io})}return r})(a,t.nativeDestinations.integrationsConfig.value,n)),t.nativeDestinations.initializedDestinations.value=[...t.nativeDestinations.initializedDestinations.value,a]}).catch(i=>{t.nativeDestinations.failedDestinations.value=[...t.nativeDestinations.failedDestinations.value,e],n?.onError({error:i,context:iM,customMessage:iB(e.userFriendlyId),groupingHash:iB(e.displayName),category:io})})}catch(i){t.nativeDestinations.failedDestinations.value=[...t.nativeDestinations.failedDestinations.value,e],n?.onError({error:i,context:iM,customMessage:iN(e.userFriendlyId),groupingHash:iN(e.displayName),category:io})}},iF=e=>e.filter(e=>e.enabled),iz=(e,t,i)=>{let r="boolean"==typeof t.enabled&&t.enabled!==e.enabled,n=R(t.config),s="boolean"==typeof t.enabled?t.enabled:e.enabled,a=n&&s;if(!r&&!a&&!i)return e;let o=v(e);return i&&(o.id=`${e.id}_${i}`,o.userFriendlyId=`${e.userFriendlyId}_${i}`),r&&(o.enabled=t.enabled,o.overridden=!0),a&&(o.config=$({...o.config,...t.config}),o.overridden=!0),o},iQ="DeviceModeDestinations",iG={minRetryDelay:500,backoffFactor:2,maxAttempts:3},iK="DeviceModeTransformationPlugin",iV=(e,t,i,r,n)=>`${e}:: Event transformation unsuccessful for destination "${t}" with id "${i}". Reason: ${r}. ${n}.`,iq=(e,t,i,r,n)=>`${e}:: [Destination: ${t} with id "${i}"].Transformation request failed with status: ${r}. Retries exhausted. ${n}.`,iW=(e,t,i)=>{t.includes(e)||(t.push(e),i())},iJ="DeviceModeTransformation",iX={segment:"ajs_anonymous_id"},iZ="ExternalAnonymousId",iY=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return decodeURIComponent(globalThis.atob(e.endsWith("..")?e.substring(0,e.length-2):e).split("").map(e=>{let t=`00${e.charCodeAt(0).toString(16)}`;return`%${t.slice(-2)}`}).join(""))},i0=/^[\w.-]+$/,i1=(e,t,i,r)=>(e=>{let t=(()=>{let e,t=[];for(let i=0;i<256;i++){e=i;for(let t=0;t<8;t++)e=1&e?0xedb88320^e>>>1:e>>>1;t[i]=e}return t})(),i=-1;for(let r=0;r<e.length;r++)i=i>>>8^t[(i^e.charCodeAt(r))&255];return(-1^i)>>>0})([[i,new Date().getTimezoneOffset(),r].join("*"),Math.floor(Date.now()/6e4)-(t||0),e].join("*")).toString(36),i2="GoogleLinker",i4=e=>`${e}:: Failed to read the consent cookie.`,i5="IubendaConsentManagerPlugin",i6=/^_iub_cs-\d+$/,i3=(e,t)=>{let i,r,n=(i=[],r=[],t&&Object.entries(t).forEach(e=>{let t=e[0];e[1]?i.push(t):r.push(t)}),{allowedConsentIds:i,deniedConsentIds:r});e.consents.initialized.value=A(t),e.consents.data.value=n},i8="IubendaConsentManager",i7="KetchConsentManagerPlugin",i9=(e,t)=>{let i,r,n=(i=[],r=[],t&&Object.entries(t).forEach(e=>{let t=e[0];e[1]?i.push(t):r.push(t)}),{allowedConsentIds:i,deniedConsentIds:r});e.consents.initialized.value=A(t),e.consents.data.value=n},re="KetchConsentManager",rt={maxItems:100},ri="NativeDestinationQueuePlugin",rr=(e,t,i)=>`Failed to send "${e}" event ${i?`"${i}" `:""}to integration for destination "${t}".`,rn=(e,t,i,r)=>{let n=e.type.toString();try{t.integration[n]?.({message:e})}catch(r){i?.onError({error:r,context:ri,customMessage:rr(n,t.userFriendlyId,e.event),groupingHash:rr(n,t.displayName,e.event),category:io})}},rs="NativeDestinationQueue",ra="OneTrustConsentManagerPlugin",ro="OneTrustConsentManager",rl="StorageEncryption",ru=("undefined"!=typeof globalThis?globalThis:void 0)?.crypto||e.g?.crypto||("undefined"!=typeof window?window:void 0)?.crypto||("undefined"!=typeof self?self:void 0)?.crypto||("undefined"!=typeof frames?frames:void 0)?.[0]?.crypto;t=ru?e=>{let t=[];for(let i=0;i<e;i+=4)t.push(ru.getRandomValues(new Uint32Array(1))[0]);return new rd(t,e)}:e=>{let t=[],i=e=>{let t=e,i=0x3ade68b1;return()=>{let e=((i=36969*(65535&i)+(i>>16)|0)<<16)+(t=18e3*(65535&t)+(t>>16)|0)|0;return e/=0x100000000,(e+=.5)*(Math.random()>.5?1:-1)}};for(let r=0,n;r<e;r+=4){let e=i(0x100000000*(n||Math.random()));n=0x3ade67b7*e(),t.push(0x100000000*e()|0)}return new rd(t,e)};class rc{static create(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return new this(...t)}mixIn(e){return Object.assign(this,e)}clone(){let e=new this.constructor;return Object.assign(e,this),e}}class rd extends rc{constructor(e=[],t=4*e.length){super();let i=e;if(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),(i instanceof Int8Array||i instanceof Uint8ClampedArray||i instanceof Int16Array||i instanceof Uint16Array||i instanceof Int32Array||i instanceof Uint32Array||i instanceof Float32Array||i instanceof Float64Array)&&(i=new Uint8Array(i.buffer,i.byteOffset,i.byteLength)),i instanceof Uint8Array){const e=i.byteLength,t=[];for(let r=0;r<e;r+=1)t[r>>>2]|=i[r]<<24-r%4*8;this.words=t,this.sigBytes=e}else this.words=e,this.sigBytes=t}static random=t;toString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rh;return e.stringify(this)}concat(e){let t=this.words,i=e.words,r=this.sigBytes,n=e.sigBytes;if(this.clamp(),r%4)for(let e=0;e<n;e+=1){let n=i[e>>>2]>>>24-e%4*8&255;t[r+e>>>2]|=n<<24-(r+e)%4*8}else for(let e=0;e<n;e+=4)t[r+e>>>2]=i[e>>>2];return this.sigBytes+=n,this}clamp(){let{words:e,sigBytes:t}=this;e[t>>>2]&=0xffffffff<<32-t%4*8,e.length=Math.ceil(t/4)}clone(){let e=super.clone.call(this);return e.words=this.words.slice(0),e}}let rh={stringify(e){let{words:t,sigBytes:i}=e,r=[];for(let e=0;e<i;e+=1){let i=t[e>>>2]>>>24-e%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse(e){let t=e.length,i=[];for(let r=0;r<t;r+=2)i[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new rd(i,t/2)}},rg={stringify(e){let{words:t,sigBytes:i}=e,r=[];for(let e=0;e<i;e+=1){let i=t[e>>>2]>>>24-e%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse(e){let t=e.length,i=[];for(let r=0;r<t;r+=1)i[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new rd(i,t)}},rp={stringify(e){try{return decodeURIComponent(escape(rg.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:e=>rg.parse(unescape(encodeURIComponent(e)))};class rf extends rc{constructor(){super(),this._minBufferSize=0}reset(){this._data=new rd,this._nDataBytes=0}_append(e){let t=e;"string"==typeof t&&(t=rp.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(e){let t,{_data:i,blockSize:r}=this,n=i.words,s=i.sigBytes,a=s/(4*r),o=(a=e?Math.ceil(a):Math.max((0|a)-this._minBufferSize,0))*r,l=Math.min(4*o,s);if(o){for(let e=0;e<o;e+=r)this._doProcessBlock(n,e);t=n.splice(0,o),i.sigBytes-=l}return new rd(t,l)}clone(){let e=super.clone.call(this);return e._data=this._data.clone(),e}}class rv extends rf{constructor(e){super(),this.blockSize=16,this.cfg=Object.assign(new rc,e),this.reset()}static _createHelper(e){return(t,i)=>new e(i).finalize(t)}static _createHmacHelper(e){return(t,i)=>new rm(e,i).finalize(t)}reset(){super.reset.call(this),this._doReset()}update(e){return this._append(e),this._process(),this}finalize(e){return e&&this._append(e),this._doFinalize()}}class rm extends rc{constructor(e,t){super();const i=new e;this._hasher=i;let r=t;"string"==typeof r&&(r=rp.parse(r));const n=i.blockSize,s=4*n;r.sigBytes>s&&(r=i.finalize(t)),r.clamp();const a=r.clone();this._oKey=a;const o=r.clone();this._iKey=o;const l=a.words,u=o.words;for(let e=0;e<n;e+=1)l[e]^=0x5c5c5c5c,u[e]^=0x36363636;a.sigBytes=s,o.sigBytes=s,this.reset()}reset(){let e=this._hasher;e.reset(),e.update(this._iKey)}update(e){return this._hasher.update(e),this}finalize(e){let t=this._hasher,i=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(i))}}let ry={stringify(e){let{words:t,sigBytes:i}=e,r=this._map;e.clamp();let n=[];for(let e=0;e<i;e+=3){let s=(t[e>>>2]>>>24-e%4*8&255)<<16|(t[e+1>>>2]>>>24-(e+1)%4*8&255)<<8|t[e+2>>>2]>>>24-(e+2)%4*8&255;for(let t=0;t<4&&e+.75*t<i;t+=1)n.push(r.charAt(s>>>6*(3-t)&63))}let s=r.charAt(64);if(s)for(;n.length%4;)n.push(s);return n.join("")},parse(e){let t=e.length,i=this._map,r=this._reverseMap;if(!r){this._reverseMap=[],r=this._reverseMap;for(let e=0;e<i.length;e+=1)r[i.charCodeAt(e)]=e}let n=i.charAt(64);if(n){let i=e.indexOf(n);-1!==i&&(t=i)}var s=e,a=t,o=r;let l=[],u=0;for(let e=0;e<a;e+=1)if(e%4){let t=o[s.charCodeAt(e-1)]<<e%4*2|o[s.charCodeAt(e)]>>>6-e%4*2;l[u>>>2]|=t<<24-u%4*8,u+=1}return rd.create(l,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},rb=[];for(let e=0;e<64;e+=1)rb[e]=0x100000000*Math.abs(Math.sin(e+1))|0;let rE=(e,t,i,r,n,s,a)=>{let o=e+(t&i|~t&r)+n+a;return(o<<s|o>>>32-s)+t},rS=(e,t,i,r,n,s,a)=>{let o=e+(t&r|i&~r)+n+a;return(o<<s|o>>>32-s)+t},rI=(e,t,i,r,n,s,a)=>{let o=e+(t^i^r)+n+a;return(o<<s|o>>>32-s)+t},rk=(e,t,i,r,n,s,a)=>{let o=e+(i^(t|~r))+n+a;return(o<<s|o>>>32-s)+t};class rA extends rv{_doReset(){this._hash=new rd([0x67452301,0xefcdab89,0x98badcfe,0x10325476])}_doProcessBlock(e,t){for(let i=0;i<16;i+=1){let r=t+i,n=e[r];e[r]=(n<<8|n>>>24)&0xff00ff|(n<<24|n>>>8)&0xff00ff00}let i=this._hash.words,r=e[t+0],n=e[t+1],s=e[t+2],a=e[t+3],o=e[t+4],l=e[t+5],u=e[t+6],c=e[t+7],d=e[t+8],h=e[t+9],g=e[t+10],p=e[t+11],f=e[t+12],v=e[t+13],m=e[t+14],y=e[t+15],b=i[0],E=i[1],S=i[2],I=i[3];b=rE(b,E,S,I,r,7,rb[0]),I=rE(I,b,E,S,n,12,rb[1]),S=rE(S,I,b,E,s,17,rb[2]),E=rE(E,S,I,b,a,22,rb[3]),b=rE(b,E,S,I,o,7,rb[4]),I=rE(I,b,E,S,l,12,rb[5]),S=rE(S,I,b,E,u,17,rb[6]),E=rE(E,S,I,b,c,22,rb[7]),b=rE(b,E,S,I,d,7,rb[8]),I=rE(I,b,E,S,h,12,rb[9]),S=rE(S,I,b,E,g,17,rb[10]),E=rE(E,S,I,b,p,22,rb[11]),b=rE(b,E,S,I,f,7,rb[12]),I=rE(I,b,E,S,v,12,rb[13]),S=rE(S,I,b,E,m,17,rb[14]),E=rE(E,S,I,b,y,22,rb[15]),b=rS(b,E,S,I,n,5,rb[16]),I=rS(I,b,E,S,u,9,rb[17]),S=rS(S,I,b,E,p,14,rb[18]),E=rS(E,S,I,b,r,20,rb[19]),b=rS(b,E,S,I,l,5,rb[20]),I=rS(I,b,E,S,g,9,rb[21]),S=rS(S,I,b,E,y,14,rb[22]),E=rS(E,S,I,b,o,20,rb[23]),b=rS(b,E,S,I,h,5,rb[24]),I=rS(I,b,E,S,m,9,rb[25]),S=rS(S,I,b,E,a,14,rb[26]),E=rS(E,S,I,b,d,20,rb[27]),b=rS(b,E,S,I,v,5,rb[28]),I=rS(I,b,E,S,s,9,rb[29]),S=rS(S,I,b,E,c,14,rb[30]),E=rS(E,S,I,b,f,20,rb[31]),b=rI(b,E,S,I,l,4,rb[32]),I=rI(I,b,E,S,d,11,rb[33]),S=rI(S,I,b,E,p,16,rb[34]),E=rI(E,S,I,b,m,23,rb[35]),b=rI(b,E,S,I,n,4,rb[36]),I=rI(I,b,E,S,o,11,rb[37]),S=rI(S,I,b,E,c,16,rb[38]),E=rI(E,S,I,b,g,23,rb[39]),b=rI(b,E,S,I,v,4,rb[40]),I=rI(I,b,E,S,r,11,rb[41]),S=rI(S,I,b,E,a,16,rb[42]),E=rI(E,S,I,b,u,23,rb[43]),b=rI(b,E,S,I,h,4,rb[44]),I=rI(I,b,E,S,f,11,rb[45]),S=rI(S,I,b,E,y,16,rb[46]),E=rI(E,S,I,b,s,23,rb[47]),b=rk(b,E,S,I,r,6,rb[48]),I=rk(I,b,E,S,c,10,rb[49]),S=rk(S,I,b,E,m,15,rb[50]),E=rk(E,S,I,b,l,21,rb[51]),b=rk(b,E,S,I,f,6,rb[52]),I=rk(I,b,E,S,a,10,rb[53]),S=rk(S,I,b,E,g,15,rb[54]),E=rk(E,S,I,b,n,21,rb[55]),b=rk(b,E,S,I,d,6,rb[56]),I=rk(I,b,E,S,y,10,rb[57]),S=rk(S,I,b,E,u,15,rb[58]),E=rk(E,S,I,b,v,21,rb[59]),b=rk(b,E,S,I,o,6,rb[60]),I=rk(I,b,E,S,p,10,rb[61]),S=rk(S,I,b,E,s,15,rb[62]),E=rk(E,S,I,b,h,21,rb[63]),i[0]=i[0]+b|0,i[1]=i[1]+E|0,i[2]=i[2]+S|0,i[3]=i[3]+I|0}_doFinalize(){let e=this._data,t=e.words,i=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32;let n=Math.floor(i/0x100000000);t[(r+64>>>9<<4)+15]=(n<<8|n>>>24)&0xff00ff|(n<<24|n>>>8)&0xff00ff00,t[(r+64>>>9<<4)+14]=(i<<8|i>>>24)&0xff00ff|(i<<24|i>>>8)&0xff00ff00,e.sigBytes=(t.length+1)*4,this._process();let s=this._hash,a=s.words;for(let e=0;e<4;e+=1){let t=a[e];a[e]=(t<<8|t>>>24)&0xff00ff|(t<<24|t>>>8)&0xff00ff00}return s}clone(){let e=super.clone.call(this);return e._hash=this._hash.clone(),e}}class rT extends rc{constructor(e){super(),this.cfg=Object.assign(new rc,{keySize:4,hasher:rA,iterations:1},e)}compute(e,t){let i,{cfg:r}=this,n=r.hasher.create(),s=rd.create(),a=s.words,{keySize:o,iterations:l}=r;for(;a.length<o;){i&&n.update(i),i=n.update(e).finalize(t),n.reset();for(let e=1;e<l;e+=1)i=n.finalize(i),n.reset();s.concat(i)}return s.sigBytes=4*o,s}}let rw="function"!=typeof Object.assign?function(e){if(null==e)throw TypeError("Cannot convert undefined or null to object");e=Object(e);for(let t=1;t<arguments.length;t++){let i=arguments[t];if(null!=i)for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e}:Object.assign;class rC extends rf{constructor(e,t,i){super(),this.cfg=rw(new rc,i),this._xformMode=e,this._key=t,this.reset()}static createEncryptor(e,t){return this.create(this._ENC_XFORM_MODE,e,t)}static createDecryptor(e,t){return this.create(this._DEC_XFORM_MODE,e,t)}static _createHelper(e){let t=e=>"string"==typeof e?rN:rM;return{encrypt:(i,r,n)=>t(r).encrypt(e,i,r,n),decrypt:(i,r,n)=>t(r).decrypt(e,i,r,n)}}reset(){super.reset.call(this),this._doReset()}process(e){return this._append(e),this._process()}finalize(e){return e&&this._append(e),this._doFinalize()}}rC._ENC_XFORM_MODE=1,rC._DEC_XFORM_MODE=2,rC.keySize=4,rC.ivSize=4;class rP extends rc{constructor(e,t){super(),this._cipher=e,this._iv=t}static createEncryptor(e,t){return this.Encryptor.create(e,t)}static createDecryptor(e,t){return this.Decryptor.create(e,t)}}function rD(e,t,i){let r,n=this._iv;n?(r=n,this._iv=void 0):r=this._prevBlock;for(let n=0;n<i;n+=1)e[t+n]^=r[n]}class rO extends rP{}rO.Encryptor=class extends rO{processBlock(e,t){let i=this._cipher,{blockSize:r}=i;rD.call(this,e,t,r),i.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}},rO.Decryptor=class extends rO{processBlock(e,t){let i=this._cipher,{blockSize:r}=i,n=e.slice(t,t+r);i.decryptBlock(e,t),rD.call(this,e,t,r),this._prevBlock=n}};let rR={pad(e,t){let i=4*t,r=i-e.sigBytes%i,n=r<<24|r<<16|r<<8|r,s=[];for(let e=0;e<r;e+=4)s.push(n);let a=rd.create(s,r);e.concat(a)},unpad(e){let t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};class rx extends rC{constructor(e,t,i){super(e,t,rw({mode:rO,padding:rR},i)),this.blockSize=4}reset(){let e;super.reset.call(this);let{cfg:t}=this,{iv:i,mode:r}=t;this._xformMode===this.constructor._ENC_XFORM_MODE?e=r.createEncryptor:(e=r.createDecryptor,this._minBufferSize=1),this._mode=e.call(r,this,i&&i.words),this._mode.__creator=e}_doProcessBlock(e,t){this._mode.processBlock(e,t)}_doFinalize(){let e,{padding:t}=this.cfg;return this._xformMode===this.constructor._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e}}class r$ extends rc{constructor(e){super(),this.mixIn(e)}toString(e){return(e||this.formatter).stringify(this)}}class rM extends rc{static encrypt(e,t,i,r){let n=rw(new rc,this.cfg,r),s=e.createEncryptor(i,n),a=s.finalize(t),o=s.cfg;return r$.create({ciphertext:a,key:i,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:s.blockSize,formatter:n.format})}static decrypt(e,t,i,r){let n=t,s=rw(new rc,this.cfg,r);return n=this._parse(n,s.format),e.createDecryptor(i,s).finalize(n.ciphertext)}static _parse(e,t){return"string"==typeof e?t.parse(e,this):e}}rM.cfg=rw(new rc,{format:{stringify(e){let{ciphertext:t,salt:i}=e;return(i?rd.create([0x53616c74,0x65645f5f]).concat(i).concat(t):t).toString(ry)},parse(e){let t,i=ry.parse(e),r=i.words;return 0x53616c74===r[0]&&0x65645f5f===r[1]&&(t=rd.create(r.slice(2,4)),r.splice(0,4),i.sigBytes-=16),r$.create({ciphertext:i,salt:t})}}});class rN extends rM{static encrypt(e,t,i,r){let n=rw(new rc,this.cfg,r),s=n.kdf.execute(i,e.keySize,e.ivSize,n.salt,n.hasher);n.iv=s.iv;let a=rM.encrypt.call(this,e,t,s.key,n);return a.mixIn(s),a}static decrypt(e,t,i,r){let n=t,s=rw(new rc,this.cfg,r);n=this._parse(n,s.format);let a=s.kdf.execute(i,e.keySize,e.ivSize,n.salt,s.hasher);return s.iv=a.iv,rM.decrypt.call(this,e,n,a.key,s)}}rN.cfg=rw(rM.cfg,{kdf:{execute(e,t,i,r,n){let s,a=r;a||(a=rd.random(8)),s=n?rT.create({keySize:t+i,hasher:n}).compute(e,a):rT.create({keySize:t+i}).compute(e,a);let o=rd.create(s.words.slice(t),4*i);return s.sigBytes=4*t,r$.create({key:s,iv:o,salt:a})}}});let r_=[],rB=[],rL=[],rU=[],rj=[],rH=[],rF=[],rz=[],rQ=[],rG=[],rK=[];for(let e=0;e<256;e+=1)e<128?rK[e]=e<<1:rK[e]=e<<1^283;let rV=0,rq=0;for(let e=0;e<256;e+=1){let e=rq^rq<<1^rq<<2^rq<<3^rq<<4;e=e>>>8^255&e^99,r_[rV]=e,rB[e]=rV;let t=rK[rV],i=rK[t],r=rK[i],n=257*rK[e]^0x1010100*e;rL[rV]=n<<24|n>>>8,rU[rV]=n<<16|n>>>16,rj[rV]=n<<8|n>>>24,rH[rV]=n,n=0x1010101*r^65537*i^257*t^0x1010100*rV,rF[e]=n<<24|n>>>8,rz[e]=n<<16|n>>>16,rQ[e]=n<<8|n>>>24,rG[e]=n,rV?(rV=t^rK[rK[rK[r^t]]],rq^=rK[rK[rq]]):rV=rq=1}let rW=[0,1,2,4,8,16,32,64,128,27,54];class rJ extends rx{_doReset(){let e;if(this._nRounds&&this._keyPriorReset===this._key)return;this._keyPriorReset=this._key;let t=this._keyPriorReset,i=t.words,r=t.sigBytes/4;this._nRounds=r+6;let n=(this._nRounds+1)*4;this._keySchedule=[];let s=this._keySchedule;for(let t=0;t<n;t+=1)t<r?s[t]=i[t]:(e=s[t-1],t%r?r>6&&t%r==4&&(e=r_[e>>>24]<<24|r_[e>>>16&255]<<16|r_[e>>>8&255]<<8|r_[255&e]):e=(r_[(e=e<<8|e>>>24)>>>24]<<24|r_[e>>>16&255]<<16|r_[e>>>8&255]<<8|r_[255&e])^rW[t/r|0]<<24,s[t]=s[t-r]^e);this._invKeySchedule=[];let a=this._invKeySchedule;for(let t=0;t<n;t+=1){let i=n-t;e=t%4?s[i]:s[i-4],t<4||i<=4?a[t]=e:a[t]=rF[r_[e>>>24]]^rz[r_[e>>>16&255]]^rQ[r_[e>>>8&255]]^rG[r_[255&e]]}}encryptBlock(e,t){this._doCryptBlock(e,t,this._keySchedule,rL,rU,rj,rH,r_)}decryptBlock(e,t){let i=e[t+1];e[t+1]=e[t+3],e[t+3]=i,this._doCryptBlock(e,t,this._invKeySchedule,rF,rz,rQ,rG,rB),i=e[t+1],e[t+1]=e[t+3],e[t+3]=i}_doCryptBlock(e,t,i,r,n,s,a,o){let l=this._nRounds,u=e[t]^i[0],c=e[t+1]^i[1],d=e[t+2]^i[2],h=e[t+3]^i[3],g=4;for(let e=1;e<l;e+=1){let e=r[u>>>24]^n[c>>>16&255]^s[d>>>8&255]^a[255&h]^i[g];g+=1;let t=r[c>>>24]^n[d>>>16&255]^s[h>>>8&255]^a[255&u]^i[g];g+=1;let o=r[d>>>24]^n[h>>>16&255]^s[u>>>8&255]^a[255&c]^i[g];g+=1;let l=r[h>>>24]^n[u>>>16&255]^s[c>>>8&255]^a[255&d]^i[g];g+=1,u=e,c=t,d=o,h=l}let p=(o[u>>>24]<<24|o[c>>>16&255]<<16|o[d>>>8&255]<<8|o[255&h])^i[g];g+=1;let f=(o[c>>>24]<<24|o[d>>>16&255]<<16|o[h>>>8&255]<<8|o[255&u])^i[g];g+=1;let v=(o[d>>>24]<<24|o[h>>>16&255]<<16|o[u>>>8&255]<<8|o[255&c])^i[g];g+=1;let m=(o[h>>>24]<<24|o[u>>>16&255]<<16|o[c>>>8&255]<<8|o[255&d])^i[g];g+=1,e[t]=p,e[t+1]=f,e[t+2]=v,e[t+3]=m}}rJ.keySize=8;let rX=rx._createHelper(rJ),rZ="RudderEncrypt:",rY="Rudder",r0=e=>e.startsWith(rZ)?rX.decrypt(e.substring(rZ.length),rY).toString(rp):e,r1="StorageEncryptionLegacy",r2="StorageMigrator",r4={maxRetryDelay:36e4,minRetryDelay:1e3,backoffFactor:2,maxAttempts:10,maxItems:100},r5=(e,t,i)=>ep({batch:e,sentAt:t},!0,void 0,i),r6=(e,t)=>{let i=new URL(e);return new URL((i.pathname+"/v1/"+t).replace(/\/{2,}/g,"/"),i).href},r3="XhrQueue",r8=()=>({}),r7={...r8(),BeaconQueue:()=>({name:ix,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,ix]},dataplaneEventsQueue:{init(e,t,i,r,n){var s,a;let o,l=e.lifecycle.writeKey.value,u=(s=e.lifecycle.activeDataplaneUrl.value,a=l,o=new URL(s),new URL((o.pathname+"/beacon/v1/"+`batch?writeKey=${a}`).replace(/\/{2,}/g,"/"),o).href),c=O(ib,e.loadOptions.value.beaconQueueOptions??{});return new iR(`rudder_beacon_${l}`,{batch:{enabled:!0,flushInterval:c.flushQueueInterval,maxSize:65536,maxItems:c.maxItems}},(e,t,i)=>{let{isPageAccessible:s}=i;n?.debug(`${iE}:: Sending events to data plane.`);let a=ed(),o=iS(e.map(e=>ig(e.event,a)),a,n);if(!o)return void t(null);try{navigator.sendBeacon(u,o)?t(null):s?(n?.error(`${im(iE,u)} The event(s) will be dropped.`),t(null)):n?.warn(`${im(iE,u)} The event(s) will be retried as the current page is being unloaded.`)}catch(e){r?.onError({error:e,context:iE,customMessage:iy(u)}),t(null)}},i,ip(n),n,e=>{let t=ed();return iS(e.map(e=>e.event),t,n).size})},enqueue(e,t,i,r,n){i.sentAt=ed(),ih(i,n),t.addItem({event:i})}}}),CustomConsentManager:()=>({name:i$,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,i$]},consentManager:{init(e,t){},updateConsentsInfo(e,t,i){},isDestinationConsented(e,t,i,r){if(!e.consents.initialized.value)return!0;let n=e.consents.data.value.allowedConsentIds;try{let{consentManagement:i}=t;if(!i)return!0;let r=i.find(t=>t.provider===e.consents.provider.value);if(!r?.consents)return!0;let s=r.consents.map(e=>e.consent.trim()).filter(e=>e),a=r.resolutionStrategy??e.consents.resolutionStrategy.value,o=e=>n.includes(e);if("or"===a)return s.some(o)||0===s.length;return s.every(o)}catch(e){return i?.onError({error:e,context:"CustomConsentManagerPlugin",customMessage:"Failed to determine the consent status for the destination. Please check the destination configuration and try again."}),!0}}}}),DeviceModeDestinations:()=>({name:iQ,initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,iQ]},nativeDestinations:{addCustomIntegration(e,t,i,r){let n=((e,t,i,r)=>{let n,s=i.nativeDestinations.configuredDestinations.value.find(t=>t.id===e&&!0===t.isCustomIntegration);if(!s)return void r.error(`${iM}:: The destination ID "${e}" does not correspond to a custom device mode destination.`);if(A(s.integration))return void r.error(`${iM}:: A custom integration with destination ID "${e}" was already added.`);if(null==(n=t)||!I(t.isReady)||A(t.init)&&!I(t.init)||A(t.track)&&!I(t.track)||A(t.page)&&!I(t.page)||A(t.identify)&&!I(t.identify)||A(t.group)&&!I(t.group)||A(t.alias)&&!I(t.alias))return void r.error(`${iM}:: The custom integration added for destination ID "${e}" does not match the expected implementation format.`);return s})(e,t,i,r);if(n){let e,s,a,o;e=i.lifecycle.safeAnalyticsInstance.value,(s=v(r)).setScope(n.displayName),a={log:s.log.bind(s),info:s.info.bind(s),debug:s.debug.bind(s),warn:s.warn.bind(s),error:s.error.bind(s),setMinLogLevel:s.setMinLogLevel.bind(s)},o=v(n.config),n.integration={...t.init&&{init:()=>t.init(o,e,a)},...t.track&&{track:i=>t.track(e,a,i)},...t.page&&{page:i=>t.page(e,a,i)},...t.identify&&{identify:i=>t.identify(e,a,i)},...t.group&&{group:i=>t.group(e,a,i)},...t.alias&&{alias:i=>t.alias(e,a,i)},isReady:()=>t.isReady(e,a)},i.nativeDestinations.configuredDestinations.value=[...i.nativeDestinations.configuredDestinations.value]}},setActiveDestinations(e,t,i,r){e.nativeDestinations.loadIntegration.value=e.loadOptions.value.loadIntegration;let n=e.nativeDestinations.configuredDestinations.value.filter(e=>{let t;if(e.isCustomIntegration&&void 0===e.integration){let t;return e.enabled&&r?.warn((t=e.id,`${iM}:: No valid custom integration was added for destination ID "${t}". Ignoring it.`)),!1}if(e.isCustomIntegration||iU[e.displayName])return!0;let n=(t=e.displayName,`Integration for destination "${t}" is not supported.`);return i?.onError({error:Error(n),context:iM,category:io}),!1}),s=e.loadOptions.value.sourceConfigurationOverride?((e,t,i)=>{if(!t?.destinations?.length)return iF(e);let r=e.map(e=>e.id),n={};t.destinations.forEach(e=>{let t=n[e.id]||[];t.push(e),n[e.id]=t});let s=Object.keys(n).filter(e=>!r.includes(e));s.length>0&&i?.warn(`${iM}:: Source configuration override - Unable to identify the destinations with the following IDs: "${s.join(", ")}"`);let a=[];return e.forEach(e=>{let t=n[e.id];if(!t||0===t.length)return void a.push(e);if(t.length>1)t.forEach((t,i)=>{let r=iz(e,t,`${i+1}`);r.cloned=!0,r.originalId=e.id,a.push(r)});else{let i=iz(e,t[0]);a.push(i)}}),iF(a)})(n,e.loadOptions.value.sourceConfigurationOverride,r):iF(n),a=iL(e.consents.postConsent.value?.integrations??e.nativeDestinations.loadOnlyIntegrations.value,s).filter(n=>t.invokeSingle("consentManager.isDestinationConsented",e,n.config,i,r)??!0);e.nativeDestinations.activeDestinations.value=[...e.nativeDestinations.activeDestinations.value,...a]},load(e,t,i,r,n){let s=e.lifecycle.integrationsCDNPath.value;e.nativeDestinations.activeDestinations.value.forEach(r=>{let a=iU[r.displayName],o=`${a}_RS`;if(a&&(!globalThis[o]?.[a]?.prototype||void 0===globalThis[o][a].prototype.constructor)){let l=`${s}/${a}.min.js`;t.loadJSFile({url:l,id:r.userFriendlyId,callback:n??((t,n)=>{if(n){let t,s=(t=r.displayName,`Failed to load integration SDK for destination "${t}"`);i?.onError({error:n,context:iM,customMessage:s,groupingHash:s,category:io}),e.nativeDestinations.failedDestinations.value=[...e.nativeDestinations.failedDestinations.value,r]}else iH(r,e,o,a,i)}),timeout:1e4})}else iH(r,e,o,a,i)})}}}),DeviceModeTransformation:()=>({name:iJ,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,iJ]},transformEvent:{init(e,t,i,r,n,s){let a=e.lifecycle.writeKey.value;return i.setAuthHeader(a),new iR(`rudder_${a}`,iG,(r,a,o)=>{var l,u,c;let d,h=(l=r.event,u=r.destinationIds,c=r.token,{metadata:{"Custom-Authorization":c},batch:[{orderNo:Date.now(),destinationIds:u,event:l}]});i.getAsyncData({url:`${e.lifecycle.activeDataplaneUrl.value}/transform`,options:{method:"POST",data:ep(h,!0,void 0,d),sendRawData:!0},isRawResponse:!0,timeout:1e4,callback:(i,l)=>{let u=t8(l?.xhr?.status??0);if(void 0!==l?.error&&u&&o.retryAttemptNumber!==o.maxRetryAttempts)a(l);else{var c,d,h;let o,u;c=r.destinationIds,d=l?.xhr?.status,h=r.event,o=e.nativeDestinations.initializedDestinations.value.filter(e=>e&&c.includes(e.originalId??e.id)),u=[],o.forEach(r=>{try{let a=[],o=r.originalId??r.id;switch(d){case 200:{let e=JSON.parse(i).transformedBatch.find(e=>e.id===o);e?.payload.forEach(e=>{if("200"===e.status)a.push(e.event);else{let t="Unknown";"410"===e.status&&(t="Transformation is not available");let i="Dropping the event";!0===r.propagateEventsUntransformedOnError?(i="Sending untransformed event",a.push(h),iW(o,u,()=>{s?.warn(iV(iK,r.displayName,o,t,i))})):iW(o,u,()=>{s?.error(iV(iK,r.displayName,o,t,i))})}});break}case 404:iW(o,u,()=>{s?.warn(`${iK}:: Transformation server access is denied. The configuration data seems to be out of sync. Sending untransformed event to the destination.`)}),a.push(h);break;default:!0===r.propagateEventsUntransformedOnError?(iW(o,u,()=>{s?.warn(iq(iK,r.displayName,o,d,"Sending untransformed event"))}),a.push(h)):iW(o,u,()=>{s?.error(iq(iK,r.displayName,o,d,"Dropping the event"))})}a?.forEach(i=>{R(i)&&t.invokeSingle("destinationsEventsQueue.enqueueEventToDestination",e,i,r,n,s)})}catch(i){let e,t;n?.onError({error:i,context:iK,customMessage:(e=r.displayName,t=r.id,`Transformation failed for destination "${e}" with id "${t}"`)})}}),a(null)}}})},r,t5)},enqueue(e,t,i,r){let n=[];r.forEach(e=>{let t=e.originalId??e.id;n.includes(t)||n.push(t)}),t.addItem({event:i,destinationIds:n,token:e.session.authToken.value})}}}),ExternalAnonymousId:()=>({name:iZ,initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,iZ]},storage:{getAnonymousId(e,t){let i;if(t?.autoCapture?.enabled&&t.autoCapture.source){let r=t.autoCapture.source.toLowerCase();if(!Object.keys(iX).includes(r))return i;if("segment"===r){let t,r,n;r=e(t2),r?.isEnabled&&(t=r.getItem(iX.segment)),n=e(t1),!t&&n?.isEnabled&&(t=n.getItem(iX.segment)),i=t}}return i}}}),GoogleLinker:()=>({name:i2,initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,i2]},userSession:{anonymousIdGoogleLinker(e){if(!e)return null;let t=e?(e=>{let t,i,r=(i=(t=e.split("*")).length%2==0,t.length<4||!i||1!==Number(t.shift())?null:{checksum:t.shift()??"",serializedIds:t.join("*")});if(!r)return null;let{checksum:n,serializedIds:s}=r;if(!s||!n||!((e,t)=>{let i=navigator?.userAgent,r=navigator?.language;for(let n=0;n<=1;n+=1)if(i1(e,n,i,r)===t)return!0;return!1})(s,n))return null;if(!s)return{};let a={},o=s.split("*");for(let e=0;e<o.length;e+=2){let t=o[e];i0.test(t)&&(a[t]=iY(o[e+1]))}return a})(e):null;return t?t.rs_amp_id:null}}}),IubendaConsentManager:()=>({name:i8,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,i8]},consentManager:{init(e,t){globalThis.getIubendaUserConsentedPurposes=()=>e.consents.data.value.allowedConsentIds?.slice(),globalThis.getIubendaUserDeniedPurposes=()=>e.consents.data.value.deniedConsentIds?.slice(),globalThis.updateIubendaConsent=t=>{i3(e,t)}},updateConsentsInfo(e,t,i){let r;i3(e,r=void 0===globalThis._iub.cs.consent.purposes?((e,t)=>{let i,r,n=null;try{let i=e?.setStore({id:i5,name:i5,type:t1,errorHandler:e?.errorHandler,logger:e?.logger});n=i?.engine.getItem((e=>{try{let e=document.cookie.split("; ").find(e=>{let[t]=e.split("=");return i6.test((t||"").trim())});if(!e)throw Error("Iubenda Cookie not found with the specified pattern.");let[t]=e.split("=");return t||""}catch(t){return e?.error(i4(i5),t),""}})(t))}catch(e){t?.error(i4(i5),e);return}if(null!=(i=n)){try{r=JSON.parse(decodeURIComponent(n))}catch(e){t?.error(`${i5}:: Failed to parse the consent cookie.`,e);return}if(r)return r.purposes}})(t,i):globalThis._iub.cs.consent.purposes)},isDestinationConsented(e,t,i,r){if(!e.consents.initialized.value)return!0;let n=e.consents.data.value.allowedConsentIds,s=e=>n.includes(e);try{let{consentManagement:i}=t;if(i){let t=i.find(t=>t.provider===e.consents.provider.value);if(!t?.consents)return!0;let r=t.consents.map(e=>e.consent.trim()).filter(e=>e);if((t.resolutionStrategy??e.consents.resolutionStrategy.value)==="or")return r.some(s)||0===r.length;return r.every(s)}return!0}catch(e){return i?.onError({error:e,context:i5,customMessage:"Failed to determine the consent status for the destination. Please check the destination configuration and try again."}),!0}}}}),KetchConsentManager:()=>({name:re,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,re]},consentManager:{init(e,t){globalThis.getKetchUserConsentedPurposes=()=>e.consents.data.value.allowedConsentIds?.slice(),globalThis.getKetchUserDeniedPurposes=()=>e.consents.data.value.deniedConsentIds?.slice(),globalThis.updateKetchConsent=t=>{i9(e,t)}},updateConsentsInfo(e,t,i){let r;i9(e,r=void 0===globalThis.ketchConsent?((e,t)=>{let i,r,n=null;try{let t=e?.setStore({id:i7,name:i7,type:t1,errorHandler:e?.errorHandler,logger:e?.logger});n=t?.engine.getItem("_ketch_consent_v1_")}catch(e){t?.error(`${i7}:: Failed to read the consent cookie.`,e);return}if(null==(i=n))return;try{r=JSON.parse(U(n))}catch(e){t?.error(`${i7}:: Failed to parse the consent cookie.`,e);return}if(!r)return;let s={};return Object.entries(r).forEach(e=>{let t=e[0],i=e[1];s[t]=i?.status==="granted"}),s})(t,i):globalThis.ketchConsent)},isDestinationConsented(e,t,i,r){if(!e.consents.initialized.value)return!0;let n=e.consents.data.value.allowedConsentIds;try{let{ketchConsentPurposes:i,consentManagement:r}=t,s=e=>n.includes(e);if(r){let t=r.find(t=>t.provider===e.consents.provider.value)?.consents;if(!t)return!0;let i=t.map(e=>e.consent.trim()).filter(e=>e);if("or"===e.consents.resolutionStrategy.value)return i.some(s)||0===i.length;return i.every(s)}if(i){let e=i.map(e=>e.purpose.trim()).filter(e=>e);return e.some(s)||0===e.length}return!0}catch(e){return i?.onError({error:e,context:i7,customMessage:"Failed to determine the consent status for the destination. Please check the destination configuration and try again."}),!0}}}}),NativeDestinationQueue:()=>({name:rs,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,rs]},destinationsEventsQueue:{init(e,t,i,r,n,s){let a=O(rt,e.loadOptions.value.destinationsQueueOptions),o=e.lifecycle.writeKey.value;return new iR(`rudder_destinations_events_${o}`,a,(i,a)=>{let o=iL(i.integrations,e.nativeDestinations.initializedDestinations.value),l=[],u=v(i);o.forEach(e=>{try{if(((e,t,i)=>{if("track"!==e)return!1;let{blacklistedEvents:r,whitelistedEvents:n,eventFilteringOption:s}=i.config;switch(s){case"blacklistedEvents":{if(!(t&&"string"==typeof t))return!1;let e=t.trim();if(Array.isArray(r))return r.some(t=>t.eventName.trim()===e);return!1}case"whitelistedEvents":{if(!(t&&"string"==typeof t))return!0;let e=t.trim();if(Array.isArray(n))return!n.some(t=>t.eventName.trim()===e);return!0}default:return!1}})(u.type,u.event,e)){let t,i;return void s?.warn((t=u.event,i=e.userFriendlyId,`${ri}:: The "${t}" track event has been filtered for the "${i}" destination.`))}e.shouldApplyDeviceModeTransformation?l.push(e):rn(u,e,n,s)}catch(e){n?.onError({error:e,context:ri,category:io})}}),l.length>0&&t.invokeSingle("transformEvent.enqueue",e,r,u,l,n,s),a(null)},i,t5)},enqueue(e,t,i,r,n){t.addItem(i)},enqueueEventToDestination(e,t,i,r,n){rn(t,i,r)}}}),OneTrustConsentManager:()=>({name:ro,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,ro]},consentManager:{init(e,t){},updateConsentsInfo(e,t,i){if(!globalThis.OneTrust||!globalThis.OnetrustActiveGroups){i?.error(`${ra}:: Failed to access OneTrust SDK resources. Please ensure that the OneTrust SDK is loaded successfully before RudderStack SDK.`),e.consents.initialized.value=!1;return}let r=globalThis.OneTrust.GetDomainData().Groups,n=globalThis.OnetrustActiveGroups.split(",").filter(e=>e),s=[];r.forEach(e=>{let{CustomGroupId:t}=e;n.includes(t)||s.push(t)}),e.consents.initialized.value=!0,e.consents.data.value={allowedConsentIds:n,deniedConsentIds:s}},isDestinationConsented(e,t,i,r){if(!e.consents.initialized.value)return!0;let n=e.consents.data.value.allowedConsentIds;try{let{oneTrustCookieCategories:i,consentManagement:r}=t,s=e=>n.includes(e);if(r){let t=r.find(t=>t.provider===e.consents.provider.value)?.consents;if(!t)return!0;let i=t.map(e=>e.consent.trim()).filter(e=>e);if("or"===e.consents.resolutionStrategy.value)return i.some(s)||0===i.length;return i.every(s)}if(i)return i.map(e=>e.oneTrustCookieCategory.trim()).filter(e=>e).every(s);return!0}catch(e){return i?.onError({error:e,context:ra,customMessage:"Failed to determine the consent status for the destination. Please check the destination configuration and try again."}),!0}}}}),StorageEncryption:()=>({name:rl,initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,rl]},storage:{encrypt:e=>`${ir}${L(e)}`,decrypt:e=>is(e)}}),StorageEncryptionLegacy:()=>({name:r1,initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,r1]},storage:{encrypt:e=>`${rZ}${rX.encrypt(e,rY).toString()}`,decrypt:e=>r0(e)}}),StorageMigrator:()=>({name:r2,initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,r2]},storage:{migrate(e,t,i,r){try{let i,r=t.getItem(e);if(null==(i=r))return null;let n=r,s=r0(n);for(s=is(s),n=JSON.parse(s);k(n)&&(s=r0(n),(s=is(s))!==n);)n=JSON.parse(s);return n}catch(r){let t=`Failed to retrieve or parse data for "${e}" from storage.`;return i?.onError({error:r,context:"StorageMigratorPlugin",customMessage:t,groupingHash:t}),null}}}}),XhrQueue:()=>({name:r3,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,r3]},dataplaneEventsQueue:{init(e,t,i,r,n){let s=e.lifecycle.writeKey.value;return t.setAuthHeader(s),new iR(`rudder_${s}`,O(r4,e.loadOptions.value.queueOptions),(i,r,s)=>{let{data:a,url:o,headers:l}=((e,t,i,r)=>{let n,s,a,o=ed();if(Array.isArray(e))n=r5(e.map(e=>ig(e.event,o)),o,r),s=e[0]?v(e[0].headers):{},a=r6(t.lifecycle.activeDataplaneUrl.value,"batch");else{let{url:t,event:i,headers:l}=e;n=id(ig(i,o),r),s=v(l),a=t}return s.SentAt=o,i.reclaimed&&(s["Rsa-Recovered"]="true"),i.retryAttemptNumber>0&&(s["Rsa-Retry-Attempt"]=i.retryAttemptNumber.toString(),s["Rsa-Since-Last-Attempt"]=i.timeSinceLastAttempt.toString(),s["Rsa-Since-First-Attempt"]=i.timeSinceFirstAttempt.toString(),s["Rsa-Retry-Reason"]=i.retryReason),{data:n,headers:s,url:a}})(i,e,s,n);t.getAsyncData({url:o,options:{method:"POST",headers:l,data:a,sendRawData:!0},isRawResponse:!0,timeout:3e4,callback:(e,t)=>{if(void 0===t?.error)return void r(null);let i=t8(t?.xhr?.status??0);if(((e,t,i,r)=>{let n;if(!r)return;let s=(n=e?.error?.message??"Unknown",`XhrQueuePlugin:: Failed to deliver event(s). Cause: ${n}.`),a="The event(s) will be dropped.";t?i.willBeRetried?(s=`${s} The event(s) will be retried.`,i.retryAttemptNumber>0&&(s=`${s} Retry attempt ${i.retryAttemptNumber} of ${i.maxRetryAttempts}.`),r.warn(s)):r.error(`${s} Retries exhausted (${i.maxRetryAttempts}). ${a}`):r.error(`${s} ${a}`)})(t,i,s,n),i){let e=ia;t?.timedOut?e="client-timeout":A(t?.xhr?.status)&&(e=`server-${t.xhr.status}`),r(t,{retryReason:e})}else r(null)}})},i,ip(n),n,e=>{let t=ed(),i=e.map(e=>e.event);return r5(i,t,n)?.length})},enqueue(e,t,i,r,n){i.sentAt=ed(),ih(i,n);let s=r6(e.lifecycle.activeDataplaneUrl.value,i.type),a={AnonymousId:L(i.anonymousId)};t.addItem({url:s,headers:a,event:i})}}})};class r9{constructor(e,t,i){this.engine=e,this.errorHandler=t,this.logger=i,this.onError=this.onError.bind(this)}init(){tP.lifecycle.status.value="pluginsLoading",this.setActivePlugins(),this.registerLocalPlugins(),this.registerRemotePlugins(),this.attachEffects()}attachEffects(){e2(()=>{(0===tP.plugins.activePlugins.value.length||tP.plugins.loadedPlugins.value.length+tP.plugins.failedPlugins.value.length===tP.plugins.totalPluginsToLoad.value)&&eL(()=>{tP.plugins.ready.value=!0,tP.lifecycle.status.value="pluginsReady"})})}getPluginsToLoadBasedOnConfig(){let e=tP.plugins.pluginsToLoadFromConfig.value;return e?(e=e.filter(e=>{if(t0.includes(e))return this.logger.warn(`${W}:: ${e} plugin is deprecated. Please exclude it from the load API options.`),!1;return!0}),[{configurationStatus:()=>A(tP.dataPlaneEvents.eventsQueuePluginName.value),configurationStatusStr:"Data plane events delivery is enabled",activePluginName:tP.dataPlaneEvents.eventsQueuePluginName.value,supportedPlugins:Object.values(tf),shouldAddMissingPlugins:!0},{configurationStatus:()=>tP.nativeDestinations.configuredDestinations.value.filter(tX).length>0,configurationStatusStr:"Device mode destinations are connected to the source",supportedPlugins:["DeviceModeDestinations","NativeDestinationQueue"]},{configurationStatus:()=>tP.nativeDestinations.configuredDestinations.value.filter(tX).some(e=>e.shouldApplyDeviceModeTransformation),configurationStatusStr:"Device mode transformations are enabled for at least one destination",supportedPlugins:["DeviceModeTransformation"]},{configurationStatus:()=>A(tP.consents.activeConsentManagerPluginName.value),configurationStatusStr:"Consent management is enabled",activePluginName:tP.consents.activeConsentManagerPluginName.value,supportedPlugins:Object.values(tg)},{configurationStatus:()=>A(tP.storage.encryptionPluginName.value),configurationStatusStr:"Storage encryption is enabled",activePluginName:tP.storage.encryptionPluginName.value,supportedPlugins:Object.values(tp)},{configurationStatus:()=>tP.storage.migrate.value,configurationStatusStr:"Storage migration is enabled",supportedPlugins:["StorageMigrator"]}].forEach(t=>{t.configurationStatus()?(e=e.filter(t.activePluginName?e=>!(e!==t.activePluginName&&t.supportedPlugins.includes(e)):e=>A(e)),this.addMissingPlugins(t,!1,e)):e=e.filter(void 0!==t.basePlugins?e=>!(t.basePlugins.includes(e)||t.supportedPlugins.includes(e)):e=>!t.supportedPlugins.includes(e))}),[...Object.keys(r8()),...e]):[]}addMissingPlugins(e,t,i){let r=e.shouldAddMissingPlugins||t,n=(e.activePluginName?[...e.basePlugins||[],e.activePluginName]:[...e.supportedPlugins]).filter(e=>!i.includes(e));if(n.length>0){var s;let t,a,o;r&&i.push(...n),this.logger.warn((s=e.configurationStatusStr,a=(t=1===n.length)?` '${n[0]}' plugin was`:` ['${n.join("', '")}'] plugins were`,o=`${W}:: ${s}, but${a} not configured to load.`,r?`${o} So, ${t?"the plugin":"those plugins"} will be loaded automatically.`:`${o} Ignore if this was intentional. Otherwise, consider adding ${t?"it":"them"} to the 'plugins' load API option.`))}}setActivePlugins(){let e=this.getPluginsToLoadBasedOnConfig(),t=[...Object.keys(r7),...tY],i=[],r=[];e.forEach(e=>{t.includes(e)?i.push(e):r.push(e)}),r.length>0&&this.logger.warn(`${W}:: Ignoring unknown plugins: ${r.join(", ")}.`),eL(()=>{tP.plugins.totalPluginsToLoad.value=e.length,tP.plugins.activePlugins.value=i,tP.plugins.failedPlugins.value=r})}registerLocalPlugins(){Object.values(r7).forEach(e=>{I(e)&&tP.plugins.activePlugins.value.includes(e().name)&&this.register([e()])})}registerRemotePlugins(){let e=(tP.plugins.activePlugins.value,{});Promise.all(Object.keys(e).map(async t=>{await e[t]().then(e=>this.register([e.default()])).catch(e=>{tP.plugins.failedPlugins.value=[...tP.plugins.failedPlugins.value,t],this.onError(e,`Failed to load plugin "${t}"`,e)})})).catch(e=>{this.onError(e)})}invokeMultiple(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];try{return this.engine.invokeMultiple(e,...i)}catch(t){return this.onError(t,e),[]}}invokeSingle(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];try{return this.engine.invokeSingle(e,...i)}catch(t){return this.onError(t,e),null}}register(e){e.forEach(e=>{try{this.engine.register(e,tP)}catch(t){tP.plugins.failedPlugins.value=[...tP.plugins.failedPlugins.value,e.name],this.onError(t,`Failed to register plugin "${e.name}"`)}})}unregisterLocalPlugins(){Object.values(r7).forEach(e=>{try{this.engine.unregister(e().name)}catch(t){this.onError(t,`Failed to unregister plugin "${e().name}"`)}})}onError(e,t,i){this.errorHandler.onError({error:e,context:W,customMessage:t,groupingHash:i})}}let ne="clientDataInCookie",nt="clientDataInLocalStorage",ni="clientDataInSessionStorage",nr=["userId","userTraits","anonymousId","groupId","groupTraits","initialReferrer","initialReferringDomain","sessionInfo","authToken"],nn={[t1]:ne,[t2]:nt,[t5]:"clientDataInMemory",[t4]:ni},ns=new class{isEnabled=!0;length=0;data={};constructor(e){this.options={enabled:!0},this.logger=e}configure(e){return this.options=O(this.options,e??{}),this.isEnabled=!!this.options.enabled,this.options}setItem(e,t){return this.data[e]=t,this.length=Object.keys(this.data).length,t}getItem(e){return e in this.data?this.data[e]:null}removeItem(e){return e in this.data&&delete this.data[e],this.length=Object.keys(this.data).length,null}clear(){this.data={},this.length=0}key(e){return this.keys()[e]??null}keys(){return Object.keys(this.data)}}(e3);var na={exports:{}};na.exports;let no=tD(function(){return d?na.exports:(d=1,na.exports=function(){function e(e){return e=JSON.stringify(e),!!/^\{[\s\S]*\}$/.test(e)}function t(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}}function i(e){return"[object Function]"===({}).toString.call(e)}var r=function(e){var t="_Is_Incognit";try{e||(e=window.localStorage),e.setItem(t,"yes"),e.removeItem(t)}catch(t){var i={};i._data={},i.setItem=function(e,t){return i._data[e]=String(t)},i.getItem=function(e){return i._data.hasOwnProperty(e)?i._data[e]:void 0},i.removeItem=function(e){return delete i._data[e]},i.clear=function(){return i._data={}},e=i}finally{"yes"===e.getItem(t)&&e.removeItem(t)}return e}();function n(){if(!(this instanceof n))return new n}n.prototype={set:function(t,i){if(t&&!e(t))r.setItem(t,void 0===i||"function"==typeof i?i+"":JSON.stringify(i));else if(e(t))for(var n in t)this.set(n,t[n]);return this},get:function(e){if(void 0===e){var i={};return this.forEach(function(e,t){return i[e]=t}),i}if("?"===e.charAt(0))return this.has(e.substr(1));var n=arguments;if(n.length>1){for(var s={},a=0,o=n.length;a<o;a++){var l=t(r.getItem(n[a]));this.has(n[a])&&(s[n[a]]=l)}return s}return t(r.getItem(e))},clear:function(){return r.clear(),this},remove:function(e){var t=this.get(e);return r.removeItem(e),t},has:function(e){return({}).hasOwnProperty.call(this.get(),e)},keys:function(){var e=[];return this.forEach(function(t){e.push(t)}),e},forEach:function(e){for(var t=0,i=r.length;t<i;t++){var n=r.key(t);e(n,this.get(n))}return this},search:function(e){for(var t=this.keys(),i={},r=0,n=t.length;r<n;r++)t[r].indexOf(e)>-1&&(i[t[r]]=this.get(t[r]));return i},len:function(){return r.length}};var s=null;function a(t,r){var o=arguments,l=null;if(s||(s=n()),0===o.length)return s.get();if(1===o.length){if("string"==typeof t)return s.get(t);if(e(t))return s.set(t)}if(2===o.length&&"string"==typeof t){if(!r)return s.remove(t);if(r&&"string"==typeof r)return s.set(t,r);r&&i(r)&&(l=null,l=r(t,s.get(t)),a.set(t,l))}if(2===o.length&&"[object Array]"===Object.prototype.toString.call(t)&&i(r))for(var u=0,c=t.length;u<c;u++)l=r(t[u],s.get(t[u])),a.set(t[u],l);return a}for(var o in n.prototype)a[o]=n.prototype[o];return a}(),na.exports)}()),nl=new class{isSupportAvailable=!0;isEnabled=!0;length=0;constructor(e){this.options={enabled:!0},this.logger=e}configure(e){return this.options=O(this.options,e??{}),this.isSupportAvailable=iu(t2),this.isEnabled=!!(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){no.set(e,t),this.length=no.len()}getItem(e){let t=no.get(e);return void 0===t?null:t}removeItem(e){no.remove(e),this.length=no.len()}clear(){no.clear(),this.length=0}key(e){return this.keys()[e]??null}keys(){return no.keys()}}(e3),nu=new class{isSupportAvailable=!0;isEnabled=!0;length=0;constructor(e){this.options={enabled:!0},this.logger=e}configure(e){return this.options=O(this.options,e??{}),this.isSupportAvailable=iu(t4),this.isSupportAvailable&&(this.store=globalThis.sessionStorage),this.isEnabled=!!(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){this.store&&(this.store.setItem(e,t),this.length=this.store.length)}getItem(e){if(!this.store)return null;let t=this.store.getItem(e);return void 0===t?null:t}removeItem(e){this.store&&(this.store.removeItem(e),this.length=this.store.length)}clear(){this.store?.clear(),this.length=0}key(e){return this.store?.key(e)??null}keys(){let e=[];if(!this.store)return e;for(let t=0;t<this.store.length;t+=1){let i=this.store.key(t);null!==i&&e.push(i)}return e}}(e3),nc=new class{isSupportAvailable=!0;isEnabled=!0;length=0;constructor(e){this.logger=e}configure(e){let t;return this.options||(this.options={maxage:31536e6,path:"/",domain:(t=`.${(e=>{let t=(e=>{let t,i="function"!=typeof globalThis.URL?((t=document.createElement("a")).href=e,t.hostname):new URL(e).hostname,r=i?.split(".")??[],n=r[r.length-1],s=[];if(4===r.length&&n&&n===parseInt(n,10).toString())return s;if(r.length<=1)return r[0]&&-1!==r[0].indexOf("localhost")?["localhost"]:s;for(let e=r.length-2;e>=0;e-=1)s.push(r.slice(e).join("."));return s})(e);for(let e=0;e<t.length;e+=1){let i=t[e],r="__tld__",n={domain:`${-1!==i.indexOf("localhost")?"":"."}${i}`};try{if(it(r,1,n),it(r))return it(r,null,n),i}catch{try{it(r,null,n)}catch{}}}return""})(globalThis.location.href)}`)&&"."!==t?t:void 0,samesite:"Lax",enabled:!0}),this.options=O(this.options,e??{}),this.options.sameDomainCookiesOnly&&delete this.options.domain,this.isSupportAvailable=iu(t1,this),this.isEnabled=!!(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){return it(e,t,this.options,this.logger),this.length=Object.keys(it()).length,!0}getItem(e){let t=it(e);return void 0===t?null:t}removeItem(e){let t=this.setItem(e,null);return this.length=Object.keys(it()).length,t}clear(){}key(e){return this.keys()[e]??null}keys(){return Object.keys(it())}}(e3),nd=e=>{switch(e){case t2:return nl;case t4:return nu;case t5:return ns;case t1:return nc;default:return ns}},nh=function(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=nc.configure(t),tP.storage.cookie.value={maxage:e.maxage,path:e.path,domain:e.domain,samesite:e.samesite,expires:e.expires,secure:e.secure},nl.configure(i),ns.configure(r),nu.configure(n)};class ng{constructor(e,t,i){this.id=e.id,this.name=e.name,this.isEncrypted=e.isEncrypted??!1,this.validKeys=e.validKeys??{},this.engine=t,this.noKeyValidation=0===Object.keys(this.validKeys).length,this.noCompoundKey=e.noCompoundKey,this.originalEngine=this.engine,this.errorHandler=e.errorHandler,this.logger=e.logger,this.pluginsManager=i}createValidKey(e){let t,{name:i,id:r,validKeys:n,noKeyValidation:s,noCompoundKey:a}=this;return s?a?e:[i,r,e].join("."):(Object.values(n).forEach(n=>{n===e&&(t=a?e:[i,r,e].join("."))}),t)}swapQueueStoreToInMemoryEngine(){let{name:e,id:t,validKeys:i,noCompoundKey:r}=this,n=nd(t5);Object.keys(i).forEach(s=>{let a=this.get(i[s]),o=r?s:[e,t,s].join(".");n.setItem(o,a),this.remove(s)}),this.engine=n}set(e,t){let i=this.createValidKey(e);if(i)try{this.engine.setItem(i,this.encrypt(ep(t,!1,[],this.logger)))}catch(i){if(il(i)){let i;this.logger.warn((i=`Store ${this.id}`,`${i}:: The storage is either full or unavailable, so the data will not be persisted. Switching to in-memory storage.`)),this.swapQueueStoreToInMemoryEngine(),this.set(e,t)}else{let t=`Failed to save the value for "${e}" to storage`;this.onError(i,t,t)}}}get(e){let t,i=this.createValidKey(e);try{if(!i)return null;if(t=this.decrypt(this.engine.getItem(i)),null==t||""===t)return null;return JSON.parse(t)}catch(i){let t=`Failed to retrieve or parse data for "${e}" from storage`;return this.onError(i,t,t),null}}remove(e){let t=this.createValidKey(e);t&&this.engine.removeItem(t)}getOriginalEngine(){return this.originalEngine}decrypt(e){return null==e?null:this.crypto(e,"decrypt")}encrypt(e){return this.crypto(e,"encrypt")}crypto(e,t){if(!this.isEncrypted||!e||"string"!=typeof e||""===e.replace(/^\s+|\s+$/gm,""))return e;let i=`storage.${t}`,r=this.pluginsManager?this.pluginsManager.invokeSingle(i,e):e;return void 0===r?e:r??""}onError(e,t,i){this.errorHandler.onError({error:e,context:`Store ${this.id}`,customMessage:t,groupingHash:i})}}class np{stores={};isInitialized=!1;constructor(e,t,i){this.errorHandler=t,this.logger=i,this.pluginsManager=e}init(){if(this.isInitialized)return;let e=tP.loadOptions.value,t={cookieStorageOptions:{samesite:e.sameSiteCookie,secure:e.secureCookie,domain:e.setCookieDomain,sameDomainCookiesOnly:e.sameDomainCookiesOnly},localStorageOptions:{},inMemoryStorageOptions:{},sessionStorageOptions:{}};nh(x(O(t.cookieStorageOptions??{},tP.storage.cookie?.value??{})),x(t.localStorageOptions),x(t.inMemoryStorageOptions),x(t.sessionStorageOptions)),this.initClientDataStores(),this.isInitialized=!0}initClientDataStores(){this.initializeStorageState(),[t5,t2,t1,t4].forEach(e=>{nd(e)?.isEnabled&&this.setStore({id:nn[e],name:nn[e],isEncrypted:!0,noCompoundKey:!0,type:e,errorHandler:this.errorHandler,logger:this.logger})})}initializeStorageState(){let e=tP.storage.type.value,t=tP.loadOptions.value.storage?.entries,i=tP.consents.postConsent.value.storage;(A(i?.type)||A(i?.entries))&&(e=i?.type,t=i?.entries);let r=!0,n={};nr.forEach(i=>{let s=t?.[i]?.type,a=((e,t)=>{let i;if(e.consents.preConsent.value.enabled)switch(e.consents.preConsent.value.storage?.strategy){case"none":i=t6;break;case"session":"sessionInfo"!==t&&(i=t6);break;case"anonymousId":"anonymousId"!==t&&(i=t6)}return i})(tP,i)??s??e??e9,o=this.getResolvedStorageTypeForEntry(a,i);o!==t6&&(r=!1),n={...n,[i]:{type:o,key:ii[i]}}}),eL(()=>{tP.storage.type.value=e,tP.storage.entries.value=n,tP.storage.trulyAnonymousTracking.value=r})}getResolvedStorageTypeForEntry(e,t){let i,r=e;switch(e){case t2:nd(t2)?.isEnabled||(r=t5);break;case t4:nd(t4)?.isEnabled||(r=t5);break;case t5:case t6:break;default:r=nd(t1)?.isEnabled?t1:nd(t2)?.isEnabled?t2:nd(t4)?.isEnabled?t4:t5}return r!==e&&this.logger.warn((i=r,`StoreManager:: The storage type "${e}" is not available for entry "${t}". The SDK will initialize the entry with "${i}" storage type instead.`)),r}setStore(e){let t=nd(e.type);return this.stores[e.id]=new ng(e,t,this.pluginsManager),this.stores[e.id]}getStore(e){return this.stores[e]}}let nf=e=>{let{host:t,protocol:i}=new URL(e),r=t.split(".");return{topDomain:r.length>2?`${r[r.length-2]}.${r[r.length-1]}`:t,protocol:i}},nv=e=>e?.endsWith("/")?nv(e.substring(0,e.length-1)):e,nm=e=>{try{return new URL(e).host}catch(e){return null}},ny="none",nb="immediate",nE=e=>R(e)||Array.isArray(e),nS=(e,t)=>{let i,r,n=[],s=[],a=!1,o=e?.enabled===!0;R(e)&&o&&({provider:r,consentManagerPluginName:i}=((e,t)=>{let{provider:i}=e,r=i?tg[i]:void 0;if(i&&!r){let e;t.error((e=i,`${V}:: The consent manager "${e}" is not supported. Please choose one of the following supported consent managers: "${Object.keys(tg)}".`)),i=void 0}return{provider:i,consentManagerPluginName:r}})(e,t),nE(e.allowedConsentIds)&&(n=e.allowedConsentIds,a=!0),nE(e.deniedConsentIds)&&(s=e.deniedConsentIds,a=!0));let l={allowedConsentIds:n,deniedConsentIds:s};return o=o&&!!i,{provider:r,consentManagerPluginName:i,initialized:a,enabled:o,consentsData:l}};class nI{constructor(e,t,i){this.errorHandler=t,this.logger=i,this.httpClient=e,this.onError=this.onError.bind(this),this.processConfig=this.processConfig.bind(this)}attachEffects(){e2(()=>{this.logger.setMinLogLevel(tP.lifecycle.logLevel.value)})}init(){let e,{logLevel:t,configUrl:i,lockIntegrationsVersion:r,lockPluginsVersion:n,destSDKBaseURL:s,pluginsSDKBaseURL:a,integrations:o}=tP.loadOptions.value,l=((e,t,i,r,n,s,a)=>{let o;if(s){if(!t3(s))return a.error(`${V}:: The base URL "${s}" for ${e} is not valid.`),null;o=nv(s)}else if(o=i,"cdn"===tP.context.app.value.installType){let e=(()=>{let e=document.querySelector("script[data-rsa-write-key]");if(e&&e.dataset.rsaWriteKey===tP.lifecycle.writeKey.value)return e.src;let t=document.getElementsByTagName("script"),i=/(?:^|\/)rsa(\.min)?\.js$/;for(let e of t){let t=e.getAttribute("src");if(t&&i.test(t))return t}})();e&&(o=e.split("/").slice(0,-1).concat(t).join("/"))}return n&&(o=o.replace(RegExp(`/v3/${tl}/${t}$`),`/${r}/${tl}/${t}`)),o})("integrations",ta,tc,eI,r,s,this.logger);null!==l&&(this.attachEffects(),tP.lifecycle.activeDataplaneUrl.value=nv(tP.lifecycle.dataPlaneUrl.value),(e=>{let t,i,{storage:r}=tP.loadOptions.value,n=r?.type;if(A(n)&&!("string"==typeof(t=n)&&e7.includes(t))){let t;e.warn((t=n,`${V}:: The storage type "${t}" is not supported. Please choose one of the following supported types: "${e7}". The default type "${e9}" will be used instead.`)),n=e9}let s=r?.encryption?.version,a=s&&tp[s];if(void 0===s||void 0!==a)void 0===s&&(s="v3");else{let t;e.warn((t=s,`${V}:: The storage encryption version "${t}" is not supported. Please choose one of the following supported versions: "${Object.keys(tp)}". The default version "v3" will be used instead.`)),s="v3"}let o=r?.migrate,l=o&&"v3"===s;!0===o&&l!==o&&e.warn((i=s,`${V}:: The storage data migration has been disabled because the configured storage encryption version (${i}) is not the latest (v3). To enable storage data migration, please update the storage encryption version to the latest version.`));let{sscEnabled:u,finalDataServiceUrl:c,cookieOptions:d}=(e=>{let t,{useServerSideCookies:i,dataServiceEndpoint:r,storage:n,setCookieDomain:s,sameDomainCookiesOnly:a}=tP.loadOptions.value,o=n?.cookie,l=!1;if(i){var u;let n,c;l=i;let d=o.domain??s,h=A(d)&&!(e=>{let{topDomain:t}=nf(window.location.href);return t===e})(d.replace(/^\.+/,""))||a,g=(u=r??"rsaRequest",n=h?window.location.origin:(e=>{let{topDomain:t,protocol:i}=nf(e);return`${i}//${t}`})(window.location.href),c=u.startsWith("/")?u.substring(1):u,`${n}/${c}`);if(t3(g)){t=nv(g);let i=nm(window.location.href),r=nm(g);(i!==r&&(o={...o,samesite:"None",secure:!0}),!a&&h&&r!==d.replace(/^\.+/,""))&&(l=!1,e.warn(`${V}:: The provided cookie domain (${d}) does not match the current webpage's domain (${r}). Hence, the cookies will be set client-side.`))}else l=!1}return{sscEnabled:l,cookieOptions:o,finalDataServiceUrl:t}})(e);eL(()=>{tP.storage.type.value=n,tP.storage.cookie.value=d,tP.serverCookies.isEnabledServerSideCookies.value=u,tP.serverCookies.dataServiceUrl.value=c,tP.storage.encryptionPluginName.value=tp[s],tP.storage.migrate.value=l})})(this.logger),(e=>{let{provider:t,consentManagerPluginName:i,initialized:r,enabled:n,consentsData:s}=nS(tP.loadOptions.value.consentManagement,e),a=tP.loadOptions.value.preConsent,o=a?.storage?.strategy??ny;if(A(o)&&!["none","session","anonymousId"].includes(o)){let t;o=ny,e.warn((t=a?.storage?.strategy,`${V}:: The pre-consent storage strategy "${t}" is not supported. Please choose one of the following supported strategies: "none, session, anonymousId". The default strategy "${ny}" will be used instead.`))}let l=a?.events?.delivery??nb;if(A(l)&&!["immediate","buffer"].includes(l)){let t;l=nb,e.warn((t=a?.events?.delivery,`${V}:: The pre-consent events delivery type "${t}" is not supported. Please choose one of the following supported types: "immediate, buffer". The default type "${nb}" will be used instead.`))}eL(()=>{tP.consents.activeConsentManagerPluginName.value=i,tP.consents.initialized.value=r,tP.consents.enabled.value=n,tP.consents.data.value=s,tP.consents.provider.value=t,tP.consents.preConsent.value={enabled:tP.loadOptions.value.preConsent?.enabled===!0&&!1===r&&!0===n,storage:{strategy:o},events:{delivery:l}}})})(this.logger),(e=>{if(tP.dataPlaneEvents.deliveryEnabled.value){let t="XhrQueue",i=t;if(tP.loadOptions.value.useBeacon)if(tP.capabilities.isBeaconAvailable.value)i="BeaconQueue";else i=t,e.warn(`${V}:: The Beacon API is not supported by your browser. The events will be sent using XHR instead.`);eL(()=>{tP.dataPlaneEvents.eventsQueuePluginName.value=i})}})(this.logger),eL(()=>{tP.lifecycle.integrationsCDNPath.value=l,tP.lifecycle.pluginsCDNPath.value=e,t&&(tP.lifecycle.logLevel.value=t),tP.lifecycle.sourceConfigUrl.value=((e,t,i,r,n)=>{let s=new URLSearchParams({p:"npm",v:eI,build:tl,writeKey:t,lockIntegrationsVersion:i.toString(),lockPluginsVersion:r.toString()}),a=th,o=s,l="/sourceConfig/",u="";if(t3(e)){let t=new URL(e);nv(t.pathname).endsWith("/sourceConfig")||(t.pathname=`${nv(t.pathname)}/sourceConfig/`),t.pathname=t.pathname.replace(/\/{2,}/g,"/"),s.forEach((e,i)=>{null===t.searchParams.get(i)&&t.searchParams.set(i,e)}),a=t.origin,l=t.pathname,o=t.searchParams,u=t.hash}else n.warn(`${V}:: The provided source config URL "${e}" is invalid. Using the default source config URL instead.`);return`${a}${l}?${o}${u}`})(i,tP.lifecycle.writeKey.value,r,n,this.logger),tP.metrics.metricsServiceUrl.value=`${tP.lifecycle.activeDataplaneUrl.value}/rsaMetrics`,tP.nativeDestinations.loadOnlyIntegrations.value=o}),this.getConfig())}onError(e,t,i){this.errorHandler.onError({error:e,context:V,customMessage:t,groupingHash:i})}processConfig(e,t){var i;let r,n,s,a,o;if(!A(e))return void(A(t)?this.onError(t.error,ti):this.onError(Error(ti)));try{r=k(e)?JSON.parse(e):e}catch(e){this.onError(e,te);return}if(!(P(n=r)&&P(n.source)&&null!=(o=n.source.id)&&P(n.source.config)&&Array.isArray(n.source.destinations)))return void this.onError(Error(te));if(!1===r.source.enabled)return void this.logger.error("The source is disabled. Please enable the source in the dashboard to send events.");i=r,tP.reporting.isErrorReportingEnabled.value=(s=i.source.config,s?.statsCollection?.errors?.enabled===!0&&!window.chrome?.runtime?.id),tP.reporting.isMetricsReportingEnabled.value=(a=i.source.config,a?.statsCollection?.metrics?.enabled===!0);let l=r.source.destinations.length>0?r.source.destinations.map(e=>{let t,i;return{id:e.id,displayName:e.destinationDefinition.displayName,enabled:e.enabled,config:e.config,shouldApplyDeviceModeTransformation:e.shouldApplyDeviceModeTransformation??!1,propagateEventsUntransformedOnError:e.propagateEventsUntransformedOnError??!1,userFriendlyId:(t=e.destinationDefinition.displayName,i=e.id,`${t.replaceAll(" ","-")}___${i}`),isCustomIntegration:"Custom Device Mode"===e.destinationDefinition.displayName}}):[];eL(()=>{var e;let t,i;tP.source.value={config:r.source.config,name:r.source.name,id:r.source.id,workspaceId:r.source.workspaceId},tP.nativeDestinations.configuredDestinations.value=l,tP.plugins.pluginsToLoadFromConfig.value=tP.loadOptions.value.plugins??[],e=r,i=tP.consents.resolutionStrategy.value,P(e.consentManagementMetadata)&&(tP.consents.provider.value&&(i=e.consentManagementMetadata.providers.find(e=>e.provider===tP.consents.provider.value)?.resolutionStrategy??tP.consents.resolutionStrategy.value),t=e.consentManagementMetadata),"custom"===tP.consents.provider.value&&(i=void 0),eL(()=>{tP.consents.metadata.value=v(t),tP.consents.resolutionStrategy.value=i}),tP.lifecycle.status.value="configured"})}getConfig(){let e=tP.loadOptions.value.getSourceConfig;if(e){if(!I(e))return void this.logger.error(`${V}:: The "getSourceConfig" load API option must be a function that returns valid source configuration data.`);let t=e();t instanceof Promise?t.then(e=>this.processConfig(e)).catch(e=>{this.onError(e,"SourceConfig")}):this.processConfig(t)}else this.httpClient.getAsyncData({url:tP.lifecycle.sourceConfigUrl.value,options:{headers:{"Content-Type":void 0}},callback:this.processConfig})}}let nk=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>document;return e()?.referrer||"$direct"},nA=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>document,t=e().getElementsByTagName("link"),i="";for(let e=0;t[e];e+=1){let r=t[e];if("canonical"===r.getAttribute("rel")&&!i){i=r.getAttribute("href")??"";break}}return i},nT=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>globalThis.navigator,t=e();if(void 0===t)return null;let{userAgent:i}=t,{brave:r}=t;if(r&&Object.getPrototypeOf(r).isBrave){let e=i.match(/(chrome)\/([\w.]+)/i);e&&(i=`${i} Brave/${e[2]}`)}return i},nw=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>globalThis.navigator,t=e();return void 0===t?null:t.language??t.browserLanguage},nC=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>globalThis.location,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>document,i=e(),r=nA(t),n=i.pathname,{href:s}=i,a=s,{search:o}=i;if(r)try{let e=new URL(r);a=""===e.search?r+o:r,n=e.pathname}catch(e){}let l=(e=>{let t=e;try{let i=new URL(e);t=i.origin+i.pathname+i.search}catch(e){}return t})(a),{title:u}=t(),c=nk(t);return{path:n,referrer:c,referring_domain:nm(c)??"",search:o,title:u,url:l,tab_url:s}},nP=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";"none"===t&&e(void 0),"default"===t&&e(navigator.userAgentData),"full"===t&&navigator.userAgentData?.getHighEntropyValues(["architecture","bitness","brands","mobile","model","platform","platformVersion","uaFullVersion","fullVersionList","wow64"]).then(t=>{e(t)}).catch(()=>{e()})},nD={URL:()=>!I(globalThis.URL)||!I(globalThis.URLSearchParams),Promise:()=>!I(globalThis.Promise),"Number.isNaN":()=>!I(globalThis.Number.isNaN),"Number.isInteger":()=>!I(globalThis.Number.isInteger),"Array.from":()=>!I(globalThis.Array.from),"Array.prototype.find":()=>!I(globalThis.Array.prototype.find),"Array.prototype.includes":()=>!I(globalThis.Array.prototype.includes),"String.prototype.endsWith":()=>!I(globalThis.String.prototype.endsWith),"String.prototype.startsWith":()=>!I(globalThis.String.prototype.startsWith),"String.prototype.includes":()=>!I(globalThis.String.prototype.includes),"String.prototype.replaceAll":()=>!I(globalThis.String.prototype.replaceAll),"String.fromCodePoint":()=>!I(globalThis.String.fromCodePoint),"Object.entries":()=>!I(globalThis.Object.entries),"Object.values":()=>!I(globalThis.Object.values),"Object.assign":()=>!I(globalThis.Object.assign),"Object.fromEntries":()=>!I(globalThis.Object.fromEntries),"Element.prototype.dataset":()=>{let e;return(e=globalThis.document.createElement("div")).setAttribute("data-a-b","c"),!e.dataset||"c"!==e.dataset.aB},TextEncoder:()=>!I(globalThis.TextEncoder)||!I(globalThis.TextDecoder),requestAnimationFrame:()=>!I(globalThis.requestAnimationFrame)||!I(globalThis.cancelAnimationFrame),CustomEvent:()=>!I(globalThis.CustomEvent),"navigator.sendBeacon":()=>!I(globalThis.navigator.sendBeacon),ArrayBuffer:()=>!I(globalThis.Uint8Array),Set:()=>!I(globalThis.Set),atob:()=>!I(globalThis.atob)},nO=`https://polyfill-fastly.io/v3/polyfill.min.js?version=3.111.0&features=${Object.keys(nD).join("%2C")}`,nR="rudderstackPolyfill",nx=()=>{let e;return null!=(e=globalThis.navigator.userAgentData)},n$=()=>({width:globalThis.screen.width,height:globalThis.screen.height,density:globalThis.devicePixelRatio,innerWidth:globalThis.innerWidth,innerHeight:globalThis.innerHeight});class nM{constructor(e,t,i){this.httpClient=e,this.errorHandler=t,this.logger=i,this.externalSrcLoader=new eN(this.logger),this.onError=this.onError.bind(this),this.onReady=this.onReady.bind(this)}init(){this.prepareBrowserCapabilities(),this.attachWindowListeners()}detectBrowserCapabilities(){eL(()=>{let e,t,i;tP.capabilities.storage.isCookieStorageAvailable.value=iu(t1,nd(t1),this.logger),tP.capabilities.storage.isLocalStorageAvailable.value=iu(t2,void 0,this.logger),tP.capabilities.storage.isSessionStorageAvailable.value=iu(t4,void 0,this.logger),tP.capabilities.isBeaconAvailable.value=null!=(t=globalThis.navigator.sendBeacon)&&I(globalThis.navigator.sendBeacon),tP.capabilities.isUaCHAvailable.value=nx(),tP.capabilities.isCryptoAvailable.value=null!=(i=globalThis.crypto)&&I(globalThis.crypto.getRandomValues),tP.capabilities.isIE11.value=eu(),tP.capabilities.isOnline.value=globalThis.navigator.onLine,tP.context.userAgent.value=nT(),tP.context.locale.value=nw(),tP.context.screen.value=n$(),tP.context.timezone.value=(e=/([A-Z]+[+-]\d+)/.exec(new Date().toString()),e?.[1]?e[1]:"NA"),nx()&&nP(e=>{tP.context["ua-ch"].value=e},tP.loadOptions.value.uaChTrackLevel)}),e2(()=>{!0===tP.loadOptions.value.sendAdblockPage&&void 0!==tP.lifecycle.sourceConfigUrl.value&&tV(this.httpClient)})}prepareBrowserCapabilities(){tP.capabilities.isLegacyDOM.value=(()=>{let e=Object.keys(nD),t=!1;for(let i=0;i<e.length;i++){let r=nD[e[i]];if(I(r)&&r()){t=!0;break}}return t})();let e=tP.loadOptions.value.polyfillURL,t=nO;if(T(e))if(t3(e))t=e;else this.logger.warn(`${K}:: The provided polyfill URL "${e}" is invalid. The default polyfill URL will be used instead.`);if(tP.loadOptions.value.polyfillIfRequired&&tP.capabilities.isLegacyDOM.value&&t3(t)){let e=t!==tP.loadOptions.value.polyfillURL;if(e){let e=`RS_polyfillCallback_${tP.lifecycle.writeKey.value}`,i=()=>{this.onReady(),delete globalThis[e]};globalThis[e]=i,t=`${t}&callback=${e}`}this.externalSrcLoader.loadJSFile({url:t,id:nR,async:!0,timeout:1e4,callback:i=>{if(i)e||this.onReady();else{let e;this.onError(Error((e=t,`Failed to load the polyfill script with ID "${nR}" from URL ${e}.`)))}}})}else this.onReady()}attachWindowListeners(){globalThis.addEventListener("offline",()=>{tP.capabilities.isOnline.value=!1}),globalThis.addEventListener("online",()=>{tP.capabilities.isOnline.value=!0}),globalThis.addEventListener("resize",function(e,t){let i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250;return function(){for(var n=arguments.length,s=Array(n),a=0;a<n;a++)s[a]=arguments[a];globalThis.clearTimeout(i),i=globalThis.setTimeout(()=>{e.apply(t,s)},r)}}(()=>{tP.context.screen.value=n$()},this))}onReady(){this.detectBrowserCapabilities(),tP.lifecycle.status.value="browserCapabilitiesReady"}onError(e,t){this.errorHandler.onError({error:e,context:K,groupingHash:t})}}let nN=["integrations","anonymousId","originalTimestamp"],n_=["library","consentManagement","userAgent","ua-ch","screen"],nB=["id","anonymous_id","user_id","sent_at","timestamp","received_at","original_timestamp","event","event_text","channel","context_ip","context_request_ip","context_passed_ip","group_id","previous_id"],nL=e=>"number"==typeof e&&!Number.isNaN(e),nU=e=>nL(e)&&e>=0&&Number.isInteger(e),nj=e=>{let{cutOff:t}=e,i=Date.now();return!!(t?.enabled&&t.expiresAt&&i>t.expiresAt)},nH=e=>!!(!e.expiresAt||Date.now()>e.expiresAt)||nj(e),nF=e=>e===t1||e===t2||e===t4||e===t5,nz=(e,t,i)=>{P(e)&&Object.keys(e).forEach(e=>{(nB.includes(e)||nB.includes(e.toLowerCase()))&&i.warn(`${q}:: The "${e}" property defined under "${t}" is a reserved keyword. Please choose a different property name to avoid conflicts with reserved keywords (${nB}).`)})},nQ=(e,t,i,r)=>{var n;let s,a,o={channel:"web",context:{traits:v(tP.session.userTraits.value),sessionId:tP.session.sessionInfo.value.id||void 0,sessionStart:tP.session.sessionInfo.value.sessionStart||void 0,...tP.consents.enabled.value&&{consentManagement:{deniedConsentIds:v(tP.consents.data.value.deniedConsentIds),allowedConsentIds:v(tP.consents.data.value.allowedConsentIds),provider:tP.consents.provider.value,resolutionStrategy:tP.consents.resolutionStrategy.value}},"ua-ch":tP.context["ua-ch"].value,app:tP.context.app.value,library:tP.context.library.value,userAgent:tP.context.userAgent.value,os:tP.context.os.value,locale:tP.context.locale.value,screen:tP.context.screen.value,campaign:(e=>{let t={};try{let i=new URL(e),r="utm_";i.searchParams.forEach((e,i)=>{if(i.startsWith(r)){let n=i.substring(r.length);"campaign"===n&&(n="name"),t[n]=e}})}catch(e){}return t})(globalThis.location.href),page:(s=nC(),a={},Object.keys(s).forEach(e=>{a[e]=i?.[e]||s[e]}),a.initial_referrer=i?.initial_referrer||tP.session.initialReferrer.value,a.initial_referring_domain=i?.initial_referring_domain||tP.session.initialReferringDomain.value,a),timezone:tP.context.timezone.value,...tP.autoTrack.enabled.value&&{autoTrack:{...tP.autoTrack.pageLifecycle.enabled.value&&{page:{pageViewId:tP.autoTrack.pageLifecycle.pageViewId.value}}}}},originalTimestamp:ed(),messageId:el(),userId:e.userId||tP.session.userId.value};nF(tP.storage.entries.value.anonymousId?.type)?o.anonymousId=tP.session.anonymousId.value:o.anonymousId=el(),tP.storage.trulyAnonymousTracking.value&&(o.context.trulyAnonymousTracking=!0),"identify"===e.type&&(o.context.traits=tP.storage.entries.value.userTraits?.type!==t6?v(tP.session.userTraits.value):e.context.traits),"group"===e.type&&((e.groupId||tP.session.groupId.value)&&(o.groupId=e.groupId||tP.session.groupId.value),(e.traits||tP.session.groupTraits.value)&&(o.traits=tP.storage.entries.value.groupTraits?.type!==t6?v(tP.session.groupTraits.value):e.traits));let l=O(e,o);return void 0===l.event&&(l.event=null),void 0===l.properties&&(l.properties=null),((e,t,i)=>{if(P(t)){var r;let n;t.anonymousId&&k(t.anonymousId)&&(e.anonymousId=t.anonymousId),R(t.integrations)&&(e.integrations=t.integrations),t.originalTimestamp&&k(t.originalTimestamp)&&(e.originalTimestamp=t.originalTimestamp),r=e.context,n=r,Object.keys(t).forEach(e=>{if(!nN.includes(e)&&!n_.includes(e))if("context"!==e)n=O(n,{[e]:t[e]});else if(void 0!==t[e]&&P(t[e])){let i={};Object.keys(t[e]).forEach(r=>{n_.includes(r)||(i[r]=t[e][r])}),n=O(n,{...i})}else i.warn(`${q}:: Please make sure that the "context" property in the event API's "options" argument is a valid object literal with key-value pairs.`)}),e.context=n}})(l,t,r),((e,t)=>{let{properties:i,traits:r,context:n}=e,{traits:s}=n;nz(i,"properties",t),nz(r,"traits",t),nz(s,"context.traits",t)})(l,r),n=l.integrations,l.integrations=v(tP.loadOptions.value.useGlobalIntegrationsConfigInEvents?tP.consents.postConsent.value.integrations??tP.nativeDestinations.loadOnlyIntegrations.value:n||ts),l};class nG{constructor(e){this.logger=e}generatePageEvent(e,t,i,r){var n,s;let a,o,l=i??{};return nQ({properties:(n=l,s=r,a=s?.page||{},Object.keys(o=nC()).forEach(e=>{void 0===n[e]&&(n[e]=a[e]||o[e])}),void 0===n.initial_referrer&&(n.initial_referrer=a.initial_referrer||tP.session.initialReferrer.value),void 0===n.initial_referring_domain&&(n.initial_referring_domain=a.initial_referring_domain||tP.session.initialReferringDomain.value),l=n),name:t,category:e,type:"page"},r,l,this.logger)}generateTrackEvent(e,t,i){return nQ({properties:t,event:e,type:"track"},i,void 0,this.logger)}generateIdentifyEvent(e,t,i){return nQ({userId:e,type:"identify",context:{traits:t}},i,void 0,this.logger)}generateAliasEvent(e,t,i){let r=nQ({previousId:t,type:"alias"},i,void 0,this.logger);return r.userId=e??r.userId,r}generateGroupEvent(e,t,i){let r={type:"group"};return e&&(r.groupId=e),t&&(r.traits=t),nQ(r,i,void 0,this.logger)}create(e){let t;switch(e.type){case"page":t=this.generatePageEvent(e.category,e.name,e.properties,e.options);break;case"track":t=this.generateTrackEvent(e.name,e.properties,e.options);break;case"identify":t=this.generateIdentifyEvent(e.userId,e.traits,e.options);break;case"alias":t=this.generateAliasEvent(e.to,e.from,e.options);break;default:t=this.generateGroupEvent(e.groupId,e.traits,e.options)}return t}}class nK{constructor(e,t,i,r){this.eventRepository=e,this.userSessionManager=t,this.errorHandler=i,this.logger=r,this.eventFactory=new nG(this.logger)}init(){this.eventRepository.init()}resume(){this.eventRepository.resume()}addEvent(e){this.userSessionManager.refreshSession();let t=this.eventFactory.create(e);this.eventRepository.enqueue(t,e.callback)}}class nV{constructor(e,t,i,r,n){this.storeManager=t,this.pluginsManager=e,this.logger=n,this.errorHandler=r,this.httpClient=i,this.onError=this.onError.bind(this),this.serverSideCookieDebounceFuncs={},this.serverSideCookiesRequestInProgress={}}init(){this.syncStorageDataToState(),this.registerEffects()}syncStorageDataToState(){let e;this.migrateStorageIfNeeded(),this.migrateDataFromPreviousStorage(),this.setUserId(this.getUserId()),this.setUserTraits(this.getUserTraits()),this.setGroupId(this.getGroupId()),this.setGroupTraits(this.getGroupTraits());let{externalAnonymousIdCookieName:t,anonymousIdOptions:i}=tP.loadOptions.value;T(t)&&"string"==typeof t&&(e=this.getExternalAnonymousIdByCookieName(t)),this.setAnonymousId(e??this.getAnonymousId(i)),this.setAuthToken(this.getAuthToken()),this.setInitialReferrerInfo(),this.configureSessionTracking()}configureSessionTracking(){let e;if(this.isPersistenceEnabledForStorageEntry("sessionInfo")){let t=this.getConfiguredSessionTrackingInfo(),i=this.getSessionInfo()??tm.sessionInfo;(e={autoTrack:t.autoTrack&&!0!==i.manualTrack,timeout:t.timeout,manualTrack:i.manualTrack,expiresAt:i.expiresAt,id:i.id,sessionStart:i.sessionStart}).autoTrack||!0===e.manualTrack?t.cutOff?.enabled===!0&&(e.cutOff={enabled:!0,duration:t.cutOff.duration,expiresAt:i.cutOff?.expiresAt}):e=tm.sessionInfo}else e=tm.sessionInfo;tP.session.sessionInfo.value=e,tP.session.sessionInfo.value.autoTrack&&this.startOrRenewAutoTracking(tP.session.sessionInfo.value)}setInitialReferrerInfo(){let e=this.getInitialReferrer(),t=this.getInitialReferringDomain();if(e&&t)this.setInitialReferrer(e),this.setInitialReferringDomain(t);else{let t=e||nk();this.setInitialReferrer(t),this.setInitialReferringDomain(nm(t)??"")}}isPersistenceEnabledForStorageEntry(e){return nF(tP.storage.entries.value[e]?.type)}migrateDataFromPreviousStorage(){let e=tP.storage.entries.value,t=[t1,t2,t4];Object.keys(e).forEach(i=>{let r=e[i]?.type,n=this.storeManager?.getStore(nn[r]);n&&t.forEach(e=>{let t=this.storeManager?.getStore(nn[e]);if(t&&e!==r){let e=t.get(ii[i]);T(e)&&""!==e&&n.set(ii[i],e),t.remove(ii[i])}})})}migrateStorageIfNeeded(e,t){if(!tP.storage.migrate.value)return;let i=e??[];0===i.length&&[ne,nt,ni].forEach(e=>{let t=this.storeManager?.getStore(e);t&&i.push(t)}),(t??Object.keys(ii)).forEach(e=>{let t=ii[e];i.forEach(e=>{let i=this.pluginsManager?.invokeSingle("storage.migrate",t,e.engine,this.errorHandler,this.logger);null==i||e.set(t,i)})})}getConfiguredSessionTrackingInfo(){let e,t,i=!1!==tP.loadOptions.value.sessions.autoTrack;if(!i)return{autoTrack:i};let r=tP.loadOptions.value.sessions?.timeout;if(nU(r))t=r;else this.logger.warn(`${J}:: The session timeout value "${r}" is not a number. The default timeout of 1800000 ms will be used instead.`),t=18e5;0===t&&(this.logger.warn(`${J}:: The session timeout value is 0, which disables the automatic session tracking feature. If you want to enable session tracking, please provide a positive integer value for the timeout.`),i=!1);t>0&&t<1e4&&this.logger.warn((e=t,`${J}:: The session timeout value ${e} ms is less than the recommended minimum of 10000 ms. Please consider increasing the timeout value to ensure optimal performance and reliability.`));let n=this.getCutOffInfo(t);return{timeout:t,autoTrack:i,cutOff:n}}getCutOffInfo(e){let t,i=tP.loadOptions.value.sessions.cutOff,r=!1;if(!0===i.enabled)if(t=i.duration,r=!0,nU(t)){if(t<e){let i;this.logger.warn((i=t,`${J}:: The session cut off duration value "${i}" ms is less than the session timeout value "${e}" ms. The cut off functionality will be disabled.`)),r=!1}}else{let e;this.logger.warn((e=t,`${J}:: The session cut off duration value "${e}" is not a number. The default cut off duration of 43200000 ms will be used instead.`)),t=432e5}return{enabled:r,duration:t}}onError(e,t,i){this.errorHandler.onError({error:e,context:J,customMessage:t,groupingHash:i})}getEncryptedCookieData(e,t){let i=[];return e.forEach(e=>{let r=t?.encrypt(ep(e.value,!1,[],this.logger));T(r)&&i.push({name:e.name,value:r})}),i}makeRequestToSetCookie(e,t){this.httpClient?.getAsyncData({url:tP.serverCookies.dataServiceUrl.value,options:{method:"POST",data:ep({reqType:"setCookies",workspaceId:tP.source.value?.workspaceId,data:{options:{maxAge:tP.storage.cookie.value?.maxage,path:tP.storage.cookie.value?.path,domain:tP.storage.cookie.value?.domain,sameSite:tP.storage.cookie.value?.samesite,secure:tP.storage.cookie.value?.secure,expires:tP.storage.cookie.value?.expires},cookies:e}}),sendRawData:!0,withCredentials:!0},isRawResponse:!0,callback:t})}setServerSideCookies(e,t,i){let r=Object.keys(e),n=()=>r.map(t=>({name:e[t].name,value:tP.session[t].value})),s={};r.forEach(t=>{s[e[t].name]=i?.get(e[t].name)});let a=()=>{r.forEach(e=>{this.serverSideCookiesRequestInProgress[e]=!1})},o=()=>{n().forEach(e=>{t&&t(e.name,e.value)})};try{let l={};r.forEach(t=>{l[e[t].name]=tP.session[t].value});let u=this.getEncryptedCookieData(n(),i);u.length>0?this.makeRequestToSetCookie(u,(e,r)=>{if(a(),r?.xhr?.status===200)n().forEach(e=>{let r=s[e.name],n=i?.get(e.name);if(ep(l[e.name],!1,[])!==ep(n,!1,[])){let i;null===r&&null===n&&this.logger.error((i=e.name,`The server failed to set the ${i} cookie. As a fallback, the cookies will be set client side.`)),t&&t(e.name,e.value)}});else{let e;this.logger.error((e=r?.xhr?.status,`The server responded with status ${e} while setting the cookies. As a fallback, the cookies will be set client side.`)),o()}}):(o(),a())}catch(e){this.onError(e,tn,tn),o(),a()}}syncValueToStorage(e){let t=tP.storage.entries.value,i=t[e]?.type;if(nF(i)){let r=this.storeManager.getStore(nn[i]),n=t[e]?.key,s=tP.session[e].value;s&&(k(s)||R(s))?tP.serverCookies.isEnabledServerSideCookies.value&&i===t1?(this.serverSideCookiesRequestInProgress[e]=!0,this.serverSideCookieDebounceFuncs[e]&&globalThis.clearTimeout(this.serverSideCookieDebounceFuncs[e]),this.serverSideCookieDebounceFuncs[e]=globalThis.setTimeout(()=>{this.setServerSideCookies({[e]:{name:n}},(e,t)=>{r?.set(e,t)},r)},10)):r?.set(n,s):r?.remove(n)}}registerEffects(){nr.forEach(e=>{e2(()=>{this.syncValueToStorage(e)})})}setAnonymousId(e,t){let i=e;k(e)&&i||(i=void 0),this.isPersistenceEnabledForStorageEntry("anonymousId")?(!i&&t&&(i=this.pluginsManager?.invokeSingle("userSession.anonymousIdGoogleLinker",t)),i=i||el()):i=tm.anonymousId,tP.session.anonymousId.value=i}getAnonymousId(e){if(nF(tP.storage.entries.value.anonymousId?.type)){let t=tP.session.anonymousId.value;t&&t!==tm.anonymousId||(t=this.getEntryValue("anonymousId")),!t&&e&&(t=this.pluginsManager?.invokeSingle("storage.getAnonymousId",nd,e)),tP.session.anonymousId.value=t||el()}return tP.session.anonymousId.value}getEntryValue(e){let t=tP.storage.entries.value,i=t[e]?.type;if(nF(i)){let r=this.storeManager?.getStore(nn[i]);this.migrateStorageIfNeeded([r],[e]);let n=t[e]?.key;return r?.get(n)??null}return null}getExternalAnonymousIdByCookieName(e){let t=nd(t1);return t?.isEnabled?t.getItem(e)??null:null}getUserSessionValue(e){return this.serverSideCookiesRequestInProgress[e]?tP.session[e].value:this.getEntryValue(e)}getUserId(){return this.getUserSessionValue("userId")}getUserTraits(){return this.getUserSessionValue("userTraits")}getGroupId(){return this.getUserSessionValue("groupId")}getGroupTraits(){return this.getUserSessionValue("groupTraits")}getInitialReferrer(){return this.getUserSessionValue("initialReferrer")}getInitialReferringDomain(){return this.getUserSessionValue("initialReferringDomain")}getSessionInfo(){return this.getUserSessionValue("sessionInfo")}getAuthToken(){return this.getUserSessionValue("authToken")}getSessionId(){let e=this.getSessionInfo()??tm.sessionInfo;return e.autoTrack&&!nH(e)||e.manualTrack?e.id??null:null}refreshSession(){let e=this.getSessionInfo()??tm.sessionInfo;(e.autoTrack||e.manualTrack)&&(e.autoTrack&&(this.startOrRenewAutoTracking(e),e=tP.session.sessionInfo.value),void 0===e.sessionStart?e={...e,sessionStart:!0}:e.sessionStart&&(e={...e,sessionStart:!1})),tP.session.sessionInfo.value=e,"readyExecuted"!==tP.lifecycle.status.value&&this.syncValueToStorage("sessionInfo")}resetAndStartNewSession(){let e=tP.session,{manualTrack:t,autoTrack:i,timeout:r,cutOff:n}=e.sessionInfo.value;if(i){let t={...tm.sessionInfo,timeout:r};n&&(t.cutOff={enabled:n.enabled,duration:n.duration}),e.sessionInfo.value=t,this.startOrRenewAutoTracking(e.sessionInfo.value)}else t&&this.startManualTrackingInternal()}reset(e){let{session:t}=tP,i=(e=>{if("boolean"==typeof e){let{entries:t,...i}=ty;return{...i,entries:{...t,anonymousId:e}}}return P(e)&&P(e.entries)?O(ty,e):{...ty}})(e);eL(()=>{Object.keys(tm).forEach(e=>{if(!0===i.entries[e])switch(e){case"anonymousId":this.setAnonymousId();break;case"sessionInfo":this.resetAndStartNewSession();break;default:t[e].value=tm[e]}})})}setUserId(e){tP.session.userId.value=this.isPersistenceEnabledForStorageEntry("userId")&&e?e:tm.userId}setUserTraits(e){tP.session.userTraits.value=this.isPersistenceEnabledForStorageEntry("userTraits")&&P(e)?O(tP.session.userTraits.value??tm.userTraits,e):tm.userTraits}setGroupId(e){tP.session.groupId.value=this.isPersistenceEnabledForStorageEntry("groupId")&&e?e:tm.groupId}setGroupTraits(e){tP.session.groupTraits.value=this.isPersistenceEnabledForStorageEntry("groupTraits")&&P(e)?O(tP.session.groupTraits.value??tm.groupTraits,e):tm.groupTraits}setInitialReferrer(e){tP.session.initialReferrer.value=this.isPersistenceEnabledForStorageEntry("initialReferrer")&&e?e:tm.initialReferrer}setInitialReferringDomain(e){tP.session.initialReferringDomain.value=this.isPersistenceEnabledForStorageEntry("initialReferringDomain")&&e?e:tm.initialReferringDomain}startOrRenewAutoTracking(e){let t=e;if(nH(e))t=(e=>{let{timeout:t,cutOff:i}=e,r=Date.now();return{id:r,expiresAt:r+t,timeout:t,autoTrack:!0,...i&&{cutOff:i}}})(e);else{let i=Date.now(),r=e.timeout;t.expiresAt=i+r}if(nj(t)&&(t.cutOff.expiresAt=void 0),t.cutOff){let e=(e=>{if(e?.enabled)return e.expiresAt??(nU(e.duration)?Date.now()+e.duration:void 0)})(t.cutOff);t.cutOff.expiresAt=e}tP.session.sessionInfo.value=t}start(e){tP.session.sessionInfo.value={id:((e,t)=>{if(!e||!nU(e)||!(e.toString().length>=10))return t.warn(`${J}:: The provided session ID (${e}) is either invalid, not a positive integer, or not at least "10" digits long. A new session ID will be auto-generated instead.`),!1;return!0})(e,this.logger)?e:Date.now(),sessionStart:void 0,manualTrack:!0}}startManualTrackingInternal(){this.start(Date.now())}end(){tP.session.sessionInfo.value=tm.sessionInfo}setAuthToken(e){tP.session.authToken.value=this.isPersistenceEnabledForStorageEntry("authToken")&&e?e:tm.authToken}}let nq=["BeaconQueue","CustomConsentManager","DeviceModeDestinations","DeviceModeTransformation","ExternalAnonymousId","GoogleLinker","IubendaConsentManager","KetchConsentManager","NativeDestinationQueue","OneTrustConsentManager","StorageEncryption","StorageEncryptionLegacy","StorageMigrator","XhrQueue"],nW="dataplaneEventsQueue",nJ="destinationsEventsQueue",nX=(e,t,i,r)=>{if(A(e))if(I(e))try{e(...t)}catch(e){r.error(`${i}:: The callback threw an exception`,e)}else r.error(tr(i))};class nZ{constructor(e,t,i,r,n){this.pluginsManager=e,this.errorHandler=r,this.httpClient=i,this.logger=n,this.storeManager=t}init(){let e;this.dataplaneEventsQueue=this.pluginsManager.invokeSingle(`${nW}.init`,tP,this.httpClient,this.storeManager,this.errorHandler,this.logger),this.dmtEventsQueue=this.pluginsManager.invokeSingle("transformEvent.init",tP,this.pluginsManager,this.httpClient,this.storeManager,this.errorHandler,this.logger),this.destinationsEventsQueue=this.pluginsManager.invokeSingle(`${nJ}.init`,tP,this.pluginsManager,this.storeManager,this.dmtEventsQueue,this.errorHandler,this.logger),e2(()=>{!0===tP.nativeDestinations.clientDestinationsReady.value&&(this.destinationsEventsQueue?.start(),this.dmtEventsQueue?.start())});let t=tP.consents.preConsent.value.enabled&&tP.consents.preConsent.value.events?.delivery==="buffer";e2(()=>{let i=!0===tP.loadOptions.value.bufferDataPlaneEventsUntilReady&&!1===tP.nativeDestinations.clientDestinationsReady.value;!1!==tP.nativeDestinations.activeDestinations.value.some(e=>tZ(e))&&!1!==i||t||this.dataplaneEventsQueue?.scheduleTimeoutActive===!0||(globalThis.clearTimeout(e),this.dataplaneEventsQueue?.start())}),!0===tP.loadOptions.value.bufferDataPlaneEventsUntilReady&&(e=globalThis.setTimeout(()=>{this.dataplaneEventsQueue?.scheduleTimeoutActive!==!0&&this.dataplaneEventsQueue?.start()},tP.loadOptions.value.dataPlaneEventsBufferTimeout))}resume(){this.dataplaneEventsQueue?.scheduleTimeoutActive!==!0&&(tP.consents.postConsent.value.discardPreConsentEvents&&(this.dataplaneEventsQueue?.clear(),this.destinationsEventsQueue?.clear()),this.dataplaneEventsQueue?.start())}enqueue(e,t){let i,r,n,s,a=(i=v(e),r=tP.nativeDestinations.integrationsConfig.value,n=e.integrations,s=Object.keys(n).filter(e=>!0!==n[e]||!r[e]).reduce((e,t)=>{let i=v(e);return i[t]=n[t],i},{}),i.integrations=O(r,s),i);this.pluginsManager.invokeSingle(`${nW}.enqueue`,tP,this.dataplaneEventsQueue,a,this.errorHandler,this.logger);let o=v(e);this.pluginsManager.invokeSingle(`${nJ}.enqueue`,tP,this.destinationsEventsQueue,o,this.errorHandler,this.logger),nX(t,[a],`${e.type.charAt(0).toUpperCase()}${e.type.slice(1)}API`,this.logger)}}let nY=e=>{let t=new CustomEvent(e,{detail:{analyticsInstance:globalThis.rudderanalytics},bubbles:!0,cancelable:!0,composed:!0});globalThis.document.dispatchEvent(t)};class n0{constructor(){this.preloadBuffer=new e4,this.initialized=!1,this.errorHandler=tW,this.logger=e3,this.externalSrcLoader=new eN(this.logger),this.httpClient=tQ,this.httpClient.init(this.errorHandler),this.capabilitiesManager=new nM(this.httpClient,this.errorHandler,this.logger)}load(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!tP.lifecycle.status.value){if(!(k(e)&&e.trim().length>0))return void this.logger.error(`${ee}:: The write key "${e}" is invalid. It must be a non-empty string. Please check that the write key is correct and try again.`);if(!t3(t))return void this.logger.error(`${ee}:: The data plane URL "${t}" is invalid. It must be a valid URL string. Please check that the data plane URL is correct and try again.`);eL(()=>{var r;let n;tP.lifecycle.writeKey.value=v(e),tP.lifecycle.dataPlaneUrl.value=v(t),tP.loadOptions.value=(r=tP.loadOptions.value,k((n=v(i)).setCookieDomain)||(n.setCookieDomain=void 0),["Strict","Lax","None"].includes(n.sameSiteCookie)||(n.sameSiteCookie=void 0),n.secureCookie=N(n.secureCookie,r.secureCookie),n.sameDomainCookiesOnly=N(n.sameDomainCookiesOnly,r.sameDomainCookiesOnly),["none","default","full"].includes(n.uaChTrackLevel)||(n.uaChTrackLevel=void 0),n.integrations=M(n.integrations),Array.isArray(n.plugins)||(n.plugins=nq),n.useGlobalIntegrationsConfigInEvents=N(n.useGlobalIntegrationsConfigInEvents,r.useGlobalIntegrationsConfigInEvents),n.bufferDataPlaneEventsUntilReady=N(n.bufferDataPlaneEventsUntilReady,r.bufferDataPlaneEventsUntilReady),n.sendAdblockPage=N(n.sendAdblockPage,r.sendAdblockPage),n.useServerSideCookies=N(n.useServerSideCookies,r.useServerSideCookies),k(n.dataServiceEndpoint)||(n.dataServiceEndpoint=void 0),n.sendAdblockPageOptions=M(n.sendAdblockPageOptions),n.loadIntegration=N(n.loadIntegration,r.loadIntegration),R(n.storage)?(n.storage.migrate=N(n.storage.migrate,r.storage?.migrate),n.storage.cookie=M(n.storage.cookie),n.storage.encryption=M(n.storage.encryption),n.storage=$(n.storage)):n.storage=void 0,n.destinationsQueueOptions=M(n.destinationsQueueOptions),n.queueOptions=M(n.queueOptions),n.lockIntegrationsVersion=N(n.lockIntegrationsVersion,r.lockIntegrationsVersion),n.lockPluginsVersion=N(n.lockPluginsVersion,r.lockPluginsVersion),nL(n.dataPlaneEventsBufferTimeout)||(n.dataPlaneEventsBufferTimeout=void 0),n.beaconQueueOptions=M(n.beaconQueueOptions),n.preConsent=M(n.preConsent),n.sourceConfigurationOverride=M(n.sourceConfigurationOverride),O(r,$(n))),tP.lifecycle.status.value="mounted"}),this.logger.setMinLogLevel(tP.loadOptions.value.logLevel??e6),eP("state",tP,e),this.startLifecycle()}}startLifecycle(){e2(()=>{try{switch(tP.lifecycle.status.value){case"mounted":this.onMounted();break;case"browserCapabilitiesReady":this.onBrowserCapabilitiesReady();break;case"configured":this.onConfigured();break;case"pluginsLoading":case"destinationsLoading":break;case"pluginsReady":this.onPluginsReady();break;case"initialized":this.onInitialized();break;case"loaded":this.onLoaded();break;case"destinationsReady":this.onDestinationsReady();break;case"ready":this.onReady()}}catch(t){let e="Failed to load the SDK";this.errorHandler.onError({error:t,context:ee,customMessage:e,groupingHash:e})}})}onBrowserCapabilitiesReady(){let e;eR(e=eD(eA)||[]),e.length>0&&(this.enqueuePreloadBufferEvents(e),eP(eA,[])),this.prepareInternalServices(),this.loadConfig()}onLoaded(){this.processBufferedEvents(),!0===tP.consents.preConsent.value.enabled?tP.lifecycle.status.value="ready":this.loadDestinations()}onMounted(){this.capabilitiesManager.init()}enqueuePreloadBufferEvents(e){Array.isArray(e)&&e.forEach(e=>this.preloadBuffer.enqueue(v(e)))}processDataInPreloadBuffer(){for(;this.preloadBuffer.size()>0;){let e=this.preloadBuffer.dequeue();e&&ex([...e],this)}}prepareInternalServices(){this.pluginsManager=new r9(tJ,this.errorHandler,this.logger),this.storeManager=new np(this.pluginsManager,this.errorHandler,this.logger),this.configManager=new nI(this.httpClient,this.errorHandler,this.logger),this.userSessionManager=new nV(this.pluginsManager,this.storeManager,this.httpClient,this.errorHandler,this.logger),this.eventRepository=new nZ(this.pluginsManager,this.storeManager,this.httpClient,this.errorHandler,this.logger),this.eventManager=new nK(this.eventRepository,this.userSessionManager,this.errorHandler,this.logger)}loadConfig(){tP.lifecycle.writeKey.value&&this.httpClient.setAuthHeader(tP.lifecycle.writeKey.value),this.configManager?.init()}onPluginsReady(){this.storeManager?.init(),this.userSessionManager?.init(),tP.consents.enabled.value&&!tP.consents.initialized.value&&(this.pluginsManager?.invokeSingle("consentManager.init",tP,this.logger),!1===tP.consents.preConsent.value.enabled&&this.pluginsManager?.invokeSingle("consentManager.updateConsentsInfo",tP,this.storeManager,this.logger)),this.eventManager?.init(),tP.lifecycle.status.value="initialized"}onConfigured(){this.pluginsManager?.init()}onInitialized(){this.processDataInPreloadBuffer(),eL(()=>{tP.lifecycle.loaded.value=!0,tP.lifecycle.status.value="loaded"}),this.initialized=!0,nX(tP.loadOptions.value.onLoaded,[globalThis.rudderanalytics],"LoadAPI",this.logger),nY("RSA_Initialised")}onReady(){tP.lifecycle.status.value="readyExecuted",tP.eventBuffer.readyCallbacksArray.value.forEach(e=>{nX(e,[],Y,this.logger)}),nY("RSA_Ready")}processBufferedEvents(){let e=tP.eventBuffer.toBeProcessedArray.value;for(;e.length>0;){let t=e.shift();if(tP.eventBuffer.toBeProcessedArray.value=e,t){let e=t[0];I(this[e])&&this[e](...t.slice(1),!0)}e=tP.eventBuffer.toBeProcessedArray.value}}loadDestinations(){if("destinationsLoading"===tP.lifecycle.status.value||"destinationsReady"===tP.lifecycle.status.value)return;this.pluginsManager?.invokeSingle("nativeDestinations.setActiveDestinations",tP,this.pluginsManager,this.errorHandler,this.logger);let e=tP.nativeDestinations.activeDestinations.value.length;if(0===e){tP.lifecycle.status.value="destinationsReady";return}tP.lifecycle.status.value="destinationsLoading",this.pluginsManager?.invokeSingle("nativeDestinations.load",tP,this.externalSrcLoader,this.errorHandler,this.logger),e2(()=>{(0===e||tP.nativeDestinations.initializedDestinations.value.length+tP.nativeDestinations.failedDestinations.value.length===e)&&eL(()=>{tP.lifecycle.status.value="destinationsReady",tP.nativeDestinations.clientDestinationsReady.value=!0})})}onDestinationsReady(){"ready"!==tP.lifecycle.status.value&&(tP.lifecycle.status.value="ready")}ready(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t="ready";if(!tP.lifecycle.loaded.value){tP.eventBuffer.toBeProcessedArray.value=[...tP.eventBuffer.toBeProcessedArray.value,[t,e]];return}(this.errorHandler.leaveBreadcrumb(`New ${t} invocation`),I(e))?"readyExecuted"===tP.lifecycle.status.value?nX(e,[],Y,this.logger):tP.eventBuffer.readyCallbacksArray.value=[...tP.eventBuffer.readyCallbacksArray.value,e]:this.logger.error(tr(Y))}page(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t="page";if(!tP.lifecycle.loaded.value){tP.eventBuffer.toBeProcessedArray.value=[...tP.eventBuffer.toBeProcessedArray.value,[t,e]];return}this.errorHandler.leaveBreadcrumb(`New ${t} event`),tP.metrics.triggered.value+=1,this.eventManager?.addEvent({type:"page",category:e.category,name:e.name,properties:e.properties,options:e.options,callback:e.callback}),!0===tP.capabilities.isAdBlocked.value&&e.category!==ek&&this.page(j(ek,"ad-block page request",{path:"/ad-blocked"},tP.loadOptions.value.sendAdblockPageOptions))}track(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t="track";if(!tP.lifecycle.loaded.value){tP.eventBuffer.toBeProcessedArray.value=[...tP.eventBuffer.toBeProcessedArray.value,[t,e]];return}this.errorHandler.leaveBreadcrumb(`New ${t} event - ${e.name}`),tP.metrics.triggered.value+=1,this.eventManager?.addEvent({type:t,name:e.name||void 0,properties:e.properties,options:e.options,callback:e.callback})}identify(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t="identify";if(!tP.lifecycle.loaded.value){tP.eventBuffer.toBeProcessedArray.value=[...tP.eventBuffer.toBeProcessedArray.value,[t,e]];return}this.errorHandler.leaveBreadcrumb(`New ${t} event`),tP.metrics.triggered.value+=1,e.userId&&tP.session.userId.value&&e.userId!==tP.session.userId.value&&this.reset(),null!==e.userId&&this.userSessionManager?.setUserId(e.userId),this.userSessionManager?.setUserTraits(e.traits),this.eventManager?.addEvent({type:t,userId:e.userId,traits:e.traits,options:e.options,callback:e.callback})}alias(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t="alias";if(!tP.lifecycle.loaded.value){tP.eventBuffer.toBeProcessedArray.value=[...tP.eventBuffer.toBeProcessedArray.value,[t,e]];return}this.errorHandler.leaveBreadcrumb(`New ${t} event`),tP.metrics.triggered.value+=1;let i=e.from??(this.getUserId()||this.userSessionManager?.getAnonymousId());this.eventManager?.addEvent({type:t,to:e.to,from:i,options:e.options,callback:e.callback})}group(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t="group";if(!tP.lifecycle.loaded.value){tP.eventBuffer.toBeProcessedArray.value=[...tP.eventBuffer.toBeProcessedArray.value,[t,e]];return}this.errorHandler.leaveBreadcrumb(`New ${t} event`),tP.metrics.triggered.value+=1,null!==e.groupId&&this.userSessionManager?.setGroupId(e.groupId),this.userSessionManager?.setGroupTraits(e.traits),this.eventManager?.addEvent({type:t,groupId:e.groupId,traits:e.traits,options:e.options,callback:e.callback})}reset(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t="reset";if(!tP.lifecycle.loaded.value){tP.eventBuffer.toBeProcessedArray.value=[...tP.eventBuffer.toBeProcessedArray.value,[t,e]];return}this.errorHandler.leaveBreadcrumb(`New ${t} invocation`),this.userSessionManager?.reset(e)}getAnonymousId(e){return this.userSessionManager?.getAnonymousId(e)}setAnonymousId(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let i="setAnonymousId";if(!tP.lifecycle.loaded.value){tP.eventBuffer.toBeProcessedArray.value=[...tP.eventBuffer.toBeProcessedArray.value,[i,e,t]];return}this.errorHandler.leaveBreadcrumb(`New ${i} invocation`),this.userSessionManager?.setAnonymousId(e,t)}getUserId(){return tP.session.userId.value}getUserTraits(){return tP.session.userTraits.value}getGroupId(){return tP.session.groupId.value}getGroupTraits(){return tP.session.groupTraits.value}startSession(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let t="startSession";if(!tP.lifecycle.loaded.value){tP.eventBuffer.toBeProcessedArray.value=[...tP.eventBuffer.toBeProcessedArray.value,[t,e]];return}this.errorHandler.leaveBreadcrumb(`New ${t} invocation`),this.userSessionManager?.start(e)}endSession(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let e="endSession";if(!tP.lifecycle.loaded.value){tP.eventBuffer.toBeProcessedArray.value=[...tP.eventBuffer.toBeProcessedArray.value,[e]];return}this.errorHandler.leaveBreadcrumb(`New ${e} invocation`),this.userSessionManager?.end()}getSessionId(){return this.userSessionManager?.getSessionId()??null}consent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!tP.lifecycle.loaded.value){tP.eventBuffer.toBeProcessedArray.value=[...tP.eventBuffer.toBeProcessedArray.value,["consent",e]];return}this.errorHandler.leaveBreadcrumb("New consent invocation"),eL(()=>{tP.consents.preConsent.value={...tP.consents.preConsent.value,enabled:!1},tP.consents.postConsent.value=(e=>{let t={sendPageEvent:!1,trackConsent:!1,discardPreConsentEvents:!1};if(P(e)){let i=v(e);t.storage=i.storage,R(i.integrations)&&(t.integrations=i.integrations),t.discardPreConsentEvents=!0===i.discardPreConsentEvents,t.sendPageEvent=!0===i.sendPageEvent,t.trackConsent=!0===i.trackConsent,R(i.consentManagement)&&(t.consentManagement=O(i.consentManagement,{enabled:tP.consents.enabled.value}))}return t})(e);let{initialized:t,consentsData:i}=nS(tP.consents.postConsent.value.consentManagement,this.logger);tP.consents.initialized.value=t,tP.consents.data.value=i}),tP.consents.enabled.value&&!tP.consents.initialized.value&&this.pluginsManager?.invokeSingle("consentManager.updateConsentsInfo",tP,this.storeManager,this.logger),this.storeManager?.initializeStorageState(),this.userSessionManager?.syncStorageDataToState(),this.eventManager?.resume(),this.loadDestinations(),this.sendTrackingEvents(t)}sendTrackingEvents(e){if(tP.consents.postConsent.value.trackConsent){let t=H("Consent Management Interaction");e?tP.eventBuffer.toBeProcessedArray.value=[...tP.eventBuffer.toBeProcessedArray.value,["track",t]]:this.track(t)}if(tP.consents.postConsent.value.sendPageEvent){let t=j();e?tP.eventBuffer.toBeProcessedArray.value=[...tP.eventBuffer.toBeProcessedArray.value,["page",t]]:this.page(t)}}setAuthToken(e){this.userSessionManager?.setAuthToken(e)}addCustomIntegration(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r="addCustomIntegration";if(i)this.errorHandler.leaveBreadcrumb(`New ${r} invocation`),this.pluginsManager?.invokeSingle("nativeDestinations.addCustomIntegration",e,t,tP,this.logger);else{if(tP.lifecycle.loaded.value)return void this.logger.error(`${ee}:: Cannot add custom integration for destination ID "${e}" after the SDK is loaded.`);tP.eventBuffer.toBeProcessedArray.value=[...tP.eventBuffer.toBeProcessedArray.value,[r,e,t]]}}}class n1{static globalSingleton=null;analyticsInstances={};defaultAnalyticsKey="";logger=e3;constructor(){try{if(n1.globalSingleton)return n1.globalSingleton;n1.initializeGlobalResources(),this.setDefaultInstanceKey=this.setDefaultInstanceKey.bind(this),this.getAnalyticsInstance=this.getAnalyticsInstance.bind(this),this.load=this.load.bind(this),this.ready=this.ready.bind(this),this.triggerBufferedLoadEvent=this.triggerBufferedLoadEvent.bind(this),this.page=this.page.bind(this),this.track=this.track.bind(this),this.identify=this.identify.bind(this),this.alias=this.alias.bind(this),this.group=this.group.bind(this),this.reset=this.reset.bind(this),this.getAnonymousId=this.getAnonymousId.bind(this),this.setAnonymousId=this.setAnonymousId.bind(this),this.getUserId=this.getUserId.bind(this),this.getUserTraits=this.getUserTraits.bind(this),this.getGroupId=this.getGroupId.bind(this),this.getGroupTraits=this.getGroupTraits.bind(this),this.startSession=this.startSession.bind(this),this.endSession=this.endSession.bind(this),this.getSessionId=this.getSessionId.bind(this),this.setAuthToken=this.setAuthToken.bind(this),this.consent=this.consent.bind(this),this.addCustomIntegration=this.addCustomIntegration.bind(this),this.createSafeAnalyticsInstance(),n1.globalSingleton=this,tP.autoTrack.pageLifecycle.pageViewId.value=el(),tP.autoTrack.pageLifecycle.pageLoadedTimestamp.value=Date.now(),this.triggerBufferedLoadEvent(),globalThis.rudderanalytics=this}catch(e){eE(e)}}createSafeAnalyticsInstance(){tP.lifecycle.safeAnalyticsInstance.value={page:this.page.bind(this),track:this.track.bind(this),identify:this.identify.bind(this),alias:this.alias.bind(this),group:this.group.bind(this),getAnonymousId:this.getAnonymousId.bind(this),getUserId:this.getUserId.bind(this),getUserTraits:this.getUserTraits.bind(this),getGroupId:this.getGroupId.bind(this),getGroupTraits:this.getGroupTraits.bind(this),getSessionId:this.getSessionId.bind(this)}}static initializeGlobalResources(){tW.init(),nc.configure(),nl.configure(),nu.configure(),ns.configure()}setDefaultInstanceKey(e){k(e)&&e&&(this.defaultAnalyticsKey=e)}getAnalyticsInstance(e){try{let t=e;return k(t)&&t||(t=this.defaultAnalyticsKey),this.analyticsInstances[t]||(this.analyticsInstances[t]=new n0),this.analyticsInstances[t]}catch(e){eE(e);return}}load(e,t,i){try{let r,n;if(this.analyticsInstances[e])return;this.setDefaultInstanceKey(e),this.trackPageLifecycleEvents(i);let s=eD(eA);r=s.filter(e=>"consent"===e[0]),n=s.filter(e=>"consent"!==e[0]),s.splice(0,s.length,...r,...n),eP(eA,v(s)),this.getAnalyticsInstance(e)?.load(e,t,ev(i))}catch(e){eE(e)}}trackPageLifecycleEvents(e){let{autoTrack:t,useBeacon:i}=e??{},{enabled:r=!1,options:n={},pageLifecycle:s}=t??{},{events:a=[G.UNLOADED],enabled:o=r,options:l=n}=s??{};tP.autoTrack.pageLifecycle.enabled.value=o,tP.autoTrack.enabled.value=r||o,o&&this.setupPageUnloadTracking(a,i,l)}setupPageUnloadTracking(e,t,i){(0===e.length||e.includes(G.UNLOADED))&&(!0===t?ec(e=>{if(!1===e&&tP.lifecycle.loaded.value){let e=Date.now(),t=e-tP.autoTrack.pageLifecycle.pageLoadedTimestamp.value;this.track(G.UNLOADED,{timeOnPage:t},{...i,originalTimestamp:new Date(e).toISOString()})}},!0):this.logger.warn('RudderStackAnalytics:: Page Unloaded event can only be tracked when the Beacon transport is active. Please enable "useBeacon" load API option.'))}triggerBufferedLoadEvent(){let e=Array.isArray(globalThis.rudderanalytics)?globalThis.rudderanalytics:[],t=(e=>{let t=[],i=0;for(;i<e.length;){if(e[i]&&"load"===e[i][0]){t=v(e[i]),e.splice(i,1);break}i+=1}return t})(e);eP(eA,v([...e])),t.length>0&&(t.shift(),this.load.apply(null,t))}ready(e){try{this.getAnalyticsInstance()?.ready(ev(e))}catch(e){eE(e)}}page(e,t,i,r,n){try{this.getAnalyticsInstance()?.page(j(ev(e),ev(t),ev(i),ev(r),ev(n)))}catch(e){eE(e)}}track(e,t,i,r){try{this.getAnalyticsInstance()?.track(H(ev(e),ev(t),ev(i),ev(r)))}catch(e){eE(e)}}identify(e,t,i,r){try{this.getAnalyticsInstance()?.identify(F(ev(e),ev(t),ev(i),ev(r)))}catch(e){eE(e)}}alias(e,t,i,r){try{this.getAnalyticsInstance()?.alias(z(ev(e),ev(t),ev(i),ev(r)))}catch(e){eE(e)}}group(e,t,i,r){try{this.getAnalyticsInstance()?.group(Q(ev(e),ev(t),ev(i),ev(r)))}catch(e){eE(e)}}reset(e){try{this.getAnalyticsInstance()?.reset(ev(e))}catch(e){eE(e)}}getAnonymousId(e){try{return this.getAnalyticsInstance()?.getAnonymousId(ev(e))}catch(e){eE(e);return}}setAnonymousId(e,t){try{this.getAnalyticsInstance()?.setAnonymousId(ev(e),ev(t))}catch(e){eE(e)}}getUserId(){try{return this.getAnalyticsInstance()?.getUserId()}catch(e){eE(e);return}}getUserTraits(){try{return this.getAnalyticsInstance()?.getUserTraits()}catch(e){eE(e);return}}getGroupId(){try{return this.getAnalyticsInstance()?.getGroupId()}catch(e){eE(e);return}}getGroupTraits(){try{return this.getAnalyticsInstance()?.getGroupTraits()}catch(e){eE(e);return}}startSession(e){try{this.getAnalyticsInstance()?.startSession(ev(e))}catch(e){eE(e)}}endSession(){try{this.getAnalyticsInstance()?.endSession()}catch(e){eE(e)}}getSessionId(){try{return this.getAnalyticsInstance()?.getSessionId()}catch(e){eE(e);return}}setAuthToken(e){try{this.getAnalyticsInstance()?.setAuthToken(ev(e))}catch(e){eE(e)}}consent(e){try{this.getAnalyticsInstance()?.consent(ev(e))}catch(e){eE(e)}}addCustomIntegration(e,t){try{this.getAnalyticsInstance()?.addCustomIntegration(ev(e),ev(t))}catch(e){eE(e)}}}e.s(["RudderAnalytics",0,n1])}]);

//# debugId=af4da04b-dde9-01af-22fa-ef680500889a
//# sourceMappingURL=3391f5c67e3ce2a4.js.map