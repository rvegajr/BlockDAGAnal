;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="1fccbfe5-00d3-e336-b21a-c65f48835172")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,2128692,e=>{"use strict";var t=e.i(4998750),r=e.i(4244280),i=e.i(9668517),n=e.i(5338940),l=e.i(9979783),a=e.i(6352514),s=e.i(4759942),o=e.i(7185353),u=e.i(5757634),c=e.i(4005781),d=e.i(8673480),m=e.i(2749380);e.s(["useNotebookOperations",0,function(e){let{mutate:p}=(0,u.useSWRConfig)(),g=(0,i.useTeamSlug)()??"",{team:f}=(0,n.useTeam)(),b=f?.id,h=f?.billing?.plan??"hobby",x=(0,d.buildSWRKey)(r.API_NOTEBOOK,{id:e?.id,teamSlug:g}),y=(0,d.buildSWRKey)(r.API_NOTEBOOKS,{teamSlug:g}),{trigger:v,isMutating:j}=(0,c.default)(x,async(i,n)=>{let{arg:a}=n,s=a.id??e?.id;if(!s)throw Error("Notebook ID is required to save a notebook");return(0,t.parseNotebook)(await (0,l.typedFetchData)(r.API_NOTEBOOK,"put",{id:s,slug:g},{title:a.title,variables:(0,t.serializeVariables)(a.variables)},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:w,isMutating:N}=(0,c.default)(x,async(t,i)=>{let{arg:n}=i,a=n?.id??e?.id;if(!a)throw Error("Notebook ID is required to delete a notebook");return(0,l.typedFetchData)(r.API_NOTEBOOK,"delete",{id:a,slug:g},{throwOnHTTPError:!0})},{revalidate:!1}),{trigger:E,isMutating:k}=(0,c.default)(x,async(i,n)=>{let{arg:a}=n,s=a?.id??e?.id;if(!s)throw Error("Notebook ID is required to share a notebook");return(0,t.parseNotebook)(await (0,l.typedFetchData)(r.API_NOTEBOOK_SHARE,"put",{id:s,slug:g},{},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:S,isMutating:R}=(0,c.default)(x,async(i,n)=>{let{arg:a}=n,s=a.notebookId??e?.id;if(!s)throw Error("Notebook ID is required to save a notebook widget");let{id:o,query:u,...c}=a.widget;return(0,t.parseNotebook)(await (0,l.typedFetchData)(r.API_NOTEBOOK_WIDGET,"put",{id:s,slug:g,widgetId:o},{query:(0,m.serializeQuery)(u),...c},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:M,isMutating:C}=(0,c.default)(x,async(i,n)=>{let{arg:a}=n,s=a.notebookId??e?.id;if(!s)throw Error("Notebook ID is required to remove a notebook widget");return(0,t.parseNotebook)(await (0,l.typedFetchData)(r.API_NOTEBOOK_WIDGET,"delete",{id:s,slug:g,widgetId:a.id},{throwOnHTTPError:!0}))},{revalidate:!1}),O=(0,o.useCallback)(async e=>(await Promise.all([p((0,d.buildSWRKey)(r.API_NOTEBOOK,{id:e.id,teamSlug:g}),e),p((0,d.buildSWRKey)(r.API_NOTEBOOKS,{teamSlug:g}),(0,d.updateCachedList)(e))]),e),[g,p]);return{saveNotebook:async e=>{let t=await O(await v(e,{optimisticData:(0,d.updateCachedNotebook)(e),rollbackOnError:!0}));return s.analytics.track(a.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:h,operation:"title_edited",source:"notebook-details-page"}),t},deleteNotebook:async t=>{await w(t),s.analytics.track(a.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_DELETED,{teamId:b,plan:h,source:"notebook-details-page"});let r=t?.id??e?.id;return await p(y,(0,d.updateCachedList)({id:r},!1)),null},shareNotebook:async e=>{let t=O(await E(e));return s.analytics.track(a.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:h,operation:"notebook_shared",source:"notebook-details-page"}),t},saveWidget:async(e,t)=>{let r=await O(await S(e,{optimisticData:(0,d.updateCachedNotebook)({},e.widget),rollbackOnError:!0}));return s.analytics.track(a.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:h,operation:"new"===e.widget.id?"widget_added":"widget_edited",source:t??"notebook-details-page"}),r},removeWidget:async e=>{let t=await O(await M(e,{optimisticData:(0,d.updateCachedNotebook)({},null,e.id),rollbackOnError:!0}));return s.analytics.track(a.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:h,operation:"widget_removed",source:"notebook-details-page"}),t},isSaving:j||N||k||R||C}}])},3886311,e=>{"use strict";var t=e.i(7185353),r=e.i(9179929),i=e.i(6029070),n=e.i(2923544),l=e.i(1283928),a=e.i(5115727),s=e.i(4950960),o=e.i(8690335),u=e.i(9935315),c=e.i(2655172),d=e.i(5778089);function m(e){return e.replace(/[^a-zA-Z0-9\s]/g,"").trim().split(/\s+/).map((e,t)=>0===t?e.toLowerCase():e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join("")}function p(e,t){let r=e[t];return null==r||""===r?d.emptyStringReplacement:String(r)}var g=e.i(5338940),f=e.i(4759942),b=e.i(6092370),h=e.i(6352514);let x={metric:"",aggregation:"sum",by:[],time:"1h",filter:""};e.s(["useExportSonarData",0,function(e){let{query:d,title:y,filteredProjects:v}=e,j=d??x,{team:w}=(0,g.useTeam)(),N=(0,a.useDefaultQueryTitle)(j),E=y??N,k=(0,t.useMemo)(()=>{if(!d)return;let{filter:e,...t}=(0,o.toSonarQuery)(d);return{...t,filter:v?.length?(0,b.andFilterStrings)(e||void 0,`projectId in (${v.map(e=>`'${e}'`).join(",")})`):e}},[d,v]),{data:S}=(0,u.useSonarQuery)(k),R=(0,t.useMemo)(()=>({meta:{timeseries:{by:j.by,lowGranularity:!0}}}),[j.by]),M=(0,r.useTableData)(S,R),{accessibleDimensions:C}=(0,i.useAccessibleDimensions)(j),{event:O,measure:T}=(0,t.useMemo)(()=>(0,o.splitEventAndMeasure)(j),[j]),I=l.AllMeasures[T],A=(0,n.labelForMeasure)(O,T),D=(0,t.useMemo)(()=>{let e=I?.unit??"count";return(0,o.getFormatter)(j.aggregation,e)},[I?.unit,j.aggregation]),B=s.aggregationMappings[j.aggregation].label,F=`${A} ${B}`,P=(0,t.useMemo)(()=>j.by.map(e=>o.labelColumnByColumn.get(e)??e),[j.by]),q=(0,t.useMemo)(()=>j.by.map(e=>{let t=C.find(t=>t.id===e);return t?.label??e}),[C,j.by]),_=j.by.length>0,L=!!M?.length,$=!!S?.data?.length;return{handleExport:(0,t.useCallback)(e=>{var t,r;let i,n,l,a,s;if(!S||!d)return;if(_){if(!M||0===M.length)return;"csv"===e?(i=function(e){let{rows:t,dimensionAccessors:r,dimensionLabels:i,valueHeader:n,measureFormatter:l}=e,a=[...i,n,`${n} (formatted)`],s=t.map(e=>{let t=r.map(t=>p(e,t)),i=e.value??null,n=null===i?"":l(i??0);return[...t,null===i?"":String(i),n]});return(0,c.csvFormatRows)([a,...s])}({rows:M,dimensionAccessors:P,dimensionLabels:q,valueHeader:F,measureFormatter:D}),n="text/csv",l="csv"):(i=function(e){let{rows:t,dimensionAccessors:r,dimensionLabels:i,valueHeader:n,measureFormatter:l}=e;return JSON.stringify(t.map(e=>{let t={};r.forEach((r,n)=>{t[m(i[n])]=p(e,r)});let a=e.value??null;return t[m(n)]=a,t[`${m(n)}Formatted`]=null===a?null:l(a??0),t}),null,2)}({rows:M,dimensionAccessors:P,dimensionLabels:q,valueHeader:F,measureFormatter:D}),n="application/json",l="json")}else{if(!S.data||0===S.data.length)return;if("csv"===e){let e,t,r;e=S.data||[],t=["timestamp",E,...d.by],r=e.map(e=>{let t=[e.timestamp.toISOString(),e.value?.toString()??""];for(let r of d.by){let i=e[r];t.push(i?.toString()??"")}return t}),i=(0,c.csvFormatRows)([t,...r]),n="text/csv",l="csv"}else i=JSON.stringify((S.data||[]).map(e=>{let{timestamp:t,value:r,...i}=e;return{timestamp:t.toISOString(),value:r??null,...i}}),null,2),n="application/json",l="json"}let o=function(e){let{title:t,results:r,extension:i}=e,n=r.data||[];if(0===n.length)return`${t}.${i}`;let l=[t,"-",new Date(Math.min(...n.map(e=>e.timestamp.getTime()))).toISOString().slice(0,10),"to",new Date(Math.max(...n.map(e=>e.timestamp.getTime()))).toISOString().slice(0,10)].filter(Boolean);return`${l.join(" ")}.${i}`}({title:E,results:S,extension:l});t=i,r=n,a=`data:${r},${encodeURIComponent(t)}`,(s=document.createElement("a")).setAttribute("href",a),s.setAttribute("download",o),document.body.appendChild(s),s.click(),document.body.removeChild(s),f.analytics.track(h.AnalyticsEvent.QUERY_BUILDER_EXPORTED,{teamId:w?.id,plan:w?.billing?.plan??"hobby",format:e,hasGroupBy:_})},[S,d,_,M,P,q,F,D,E,w?.id,w?.billing?.plan]),disabled:!d||(_?!L:!$)}}],3886311)},2863467,e=>{"use strict";var t=e.i(847684),r=e.i(4998750),i=e.i(2749380),n=e.i(9505054),l=e.i(8119470),a=e.i(1794286),s=e.i(7432042);e.s(["DateRangeSelect",0,function(e){let{value:o,onChange:u,disabled:c,trackEvents:d,variables:m}=e,{start:p,end:g}=(0,i.fromTimeToRange)(o),f=(0,l.subDays)(new Date,90),b=(0,i.getTimeRangePresets)(!0,m?.time?{[r.TIME_VARIABLE]:{start:new Date,end:new Date,text:`Notebook (${(0,i.printTime)(m.time)})`}}:void 0),h=Object.keys(b).findIndex(e=>e===o);return(0,t.jsx)(a.Calendar,{allowClear:!1,compact:!0,minValue:f,disabled:c,onChange:(e,t)=>{let r=new Date(e.start),i=new Date(e.end),l=t||(0,s.default)(i.getTime()-r.getTime());d&&(0,n.track)("Query Builder Changed Date Range Period",{period:l}),t?u(t):u({from:r,to:i})},popoverAlignment:"center",presetIndex:h,presets:b,size:"small",value:{start:p,end:g},width:"210px"},"date-range-select-query-builder")}])},1135066,e=>{"use strict";var t=e.i(847684),r=e.i(4597921),i=e.i(6092370),n=e.i(5467025),l=e.i(1482596),a=e.i(8815885),s=e.i(854682),o=e.i(4998750),u=e.i(2504781),c=e.i(3500331),d=e.i(5255926),m=e.i(8923565),p=e.i(5468328),g=e.i(1663964),f=e.i(244424),b=e.i(1918911),h=e.i(7749365),x=e.i(9096446),y=e.i(5169576),v=e.i(218692),j=e.i(4047087),w=e.i(3675495),N=e.i(2006677),E=e.i(6143247),k=e.i(7185353),S=e.i(2713400),R=e.i(2863467),M=e.i(1821888),C=e.i(9689002),O=e.i(7087273),T=e.i(2942788),I=e.i(3228096),A=e.i(4333930),D=e.i(4796642),B=e.i(787358),F=e.i(8004707),P=e.i(1898517),q=e.i(1379708),_=e.i(6401841),L=e.i(4141852),$=e.i(762945),z=e.i(7807066),U=e.i(2712781),Q=e.i(2923544),K=e.i(1813317);function G(e){let[r,i]=function(){let[e,t]=(0,k.useState)({x:0,y:0});return(0,k.useEffect)(()=>{let e=e=>{t({x:e.clientX,y:e.clientY})};return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}},[]),[e.x,e.y]}(),[n,l]=(0,k.useState)({button:null,container:null,metrics:null,firstMetric:null});(0,k.useEffect)(()=>{let t=()=>{if(!e.containerRef.current||!e.metricsRef.current)return void l({button:null,container:null,metrics:null,firstMetric:null});let t=e.metricsRef.current.querySelectorAll("button");0===t.length?l({button:null,container:null,metrics:null,firstMetric:null}):l({button:e.buttonRef.current?.getBoundingClientRect()||null,container:e.containerRef.current.getBoundingClientRect(),metrics:e.metricsRef.current.getBoundingClientRect(),firstMetric:t[0].getBoundingClientRect()})};t();let r=new ResizeObserver(t);return e.buttonRef.current&&r.observe(e.buttonRef.current),e.containerRef.current&&r.observe(e.containerRef.current),e.metricsRef.current&&r.observe(e.metricsRef.current),()=>r.disconnect()},[e.buttonRef,e.containerRef,e.metricsRef]);let[a,s]=(0,k.useState)({x:r,y:i});(0,k.useEffect)(()=>{let e=setTimeout(()=>{s({x:r,y:i})},16);return()=>clearTimeout(e)},[r,i]);let o=(0,k.useMemo)(()=>{if(!n.container||!n.metrics||!n.firstMetric)return null;let e=Math.min(n.metrics.bottom,n.container.bottom),t=a.x-n.container.left,r=n.button?n.button.right-n.container.left:260,i=Math.min(1,Math.max(0,(t-.5*r)/(.5*r))),l=a.y-n.container.top,s=Math.max(260,r),o=Math.max(n.button?n.button.left-n.container.left:0,Math.min(t-(8+18*i),s-10)),u=s-o,c=l;if(n.button){let e=n.button.top-n.container.top,t=n.button.bottom-n.container.top;if(l>=e-10&&l<=t+10){let t=Math.max(0,Math.min(n.button.height,l-e));c=e+t}}let d=n.firstMetric.top-n.container.top,m=e-n.container.top,p=Math.max(50,c),g=Math.min(p,Math.max(50,d)),f=m-g;if(f<=0||u<=0||!Number.isFinite(g)||!Number.isFinite(c)||!Number.isFinite(o))return null;let b=Math.max(0,Math.min(100,(p-g)/f*100));return{position:"absolute",left:`${o}px`,top:`${g}px`,width:`${u}px`,height:`${f}px`,clipPath:`polygon(0 ${b}%, 100% 0, 100% 100%, 0 ${b}%)`,pointerEvents:"auto",zIndex:1,cursor:"pointer"}},[a.x,a.y,n]);return o?(0,t.jsx)("div",{className:"group-hover:block hidden",style:o,onMouseEnter:e.onMouseEnter,onWheel:t=>{e.eventsScrollerRef.current&&(e.eventsScrollerRef.current.scrollTop+=t.deltaY)},onClick:e=>{let t=document.elementsFromPoint(e.clientX,e.clientY).find(t=>t!==e.currentTarget&&("BUTTON"===t.tagName||t.closest("button")));if(t){let e="BUTTON"===t.tagName?t:t.closest("button");e&&e.click()}}}):null}let W={incomingRequest:I.Globe,serverlessFunctionInvocation:A.FunctionSquare,edgeFunctionInvocation:D.FunctionEdge,middlewareInvocation:B.FunctionMiddleware,edgeMiddlewareInvocation:B.FunctionMiddleware,outgoingRequest:F.ArrowGlobe,imageTransformation:P.Image,imageTransformationFailure:P.Image,isrOperation:q.Isr,blockedConnection:_.Stop,firewallAction:L.FirewallFlame,botIdCheck:$.Warning,aiGatewayRequest:U.Sparkles};function V(e){return W[e]||T.Database}let Y=["count","durationMs","functionDurationMs","functionWallTimeMs","functionCpuTimeMs","functionDurationGbhr","ttfbMs","coldStartDurationMs","initDurationMs","fotInBytes","fotOutBytes","fotTotalBytes","isrReadBytes","isrWriteBytes","isrReadUnits","isrWriteUnits","vdcReadUnits","invokedMemoryMb","maxMemoryUsedMb","billedMemoryMb"];function H(e){return(0,K.getAggregableMeasures)(e).map(t=>({id:t,label:(0,Q.labelForMeasure)(e,t)})).toSorted((e,t)=>{let r=Y.indexOf(e.id),i=Y.indexOf(t.id);return -1!==r&&-1!==i?r-i:-1!==r?-1:-1!==i?1:e.label.localeCompare(t.label)})}function J(e){let{disabled:r,selectedEventId:i,selectedMetricId:n,events:l,onSelect:a}=e,[s,o]=(0,k.useState)(!1),[c,d]=(0,k.useState)(""),[m,p]=(0,k.useState)(null),[g,f]=(0,k.useState)(null),[h,x]=(0,k.useState)(!1),[y,v]=(0,k.useState)(!1),[j,w]=(0,k.useState)("events"),[N,S]=(0,k.useState)(null),R=(0,k.useRef)(null),I=(0,k.useRef)(null),A=(0,k.useRef)(null),D=(0,k.useRef)(null),B=(0,k.useRef)(new Map),F=(0,k.useRef)(null),P=(0,k.useMemo)(()=>l.find(e=>e.id===i),[l,i]),q=(0,k.useMemo)(()=>{if(!c.trim())return{events:l,metrics:[],firstMatchingEventId:null};let e=c.toLowerCase(),t=new Set,r=null;return l.forEach(i=>{i.label.toLowerCase().includes(e)&&(t.add(i.id),r||(r=i.id))}),l.forEach(i=>{(0,K.getAggregableMeasures)(i.id).map(e=>({id:e,label:(0,Q.labelForMeasure)(i.id,e)})).some(t=>t.label.toLowerCase().includes(e)||t.id.toLowerCase().includes(e))&&(t.add(i.id),r||(r=i.id))}),{events:l.filter(e=>t.has(e.id)),firstMatchingEventId:r}},[l,c]),_=y&&"metrics"===j&&N?N:m||(c.trim()&&q.firstMatchingEventId?q.firstMatchingEventId:i)||q.events[0]?.id,L=(0,k.useMemo)(()=>l.find(e=>e.id===_),[l,_]),$=(0,k.useMemo)(()=>_?H(_):[],[_]),U=(0,k.useMemo)(()=>{if(!c.trim())return $;let e=c.toLowerCase(),t=$.filter(t=>t.label.toLowerCase().includes(e)||t.id.toLowerCase().includes(e));return 0===t.length&&_?$:t},[$,c,_]),W=(0,k.useMemo)(()=>{let e={};return q.events.forEach(t=>{let r=t.group||"Other";e[r]||(e[r]=[]),e[r].push(t)}),Object.entries(e).sort((e,t)=>{let[r]=e,[i]=t;return"Deprecated"===r&&"Deprecated"!==i?1:"Deprecated"!==r&&"Deprecated"===i?-1:0})},[q.events]),Y=(0,k.useMemo)(()=>{let e=W.flatMap(e=>{let[,t]=e;return t});return m&&!e.some(e=>e.id===m),e},[W,m]),J=(0,k.useCallback)((e,t)=>{a(e,t),o(!1),d("")},[a]),X=(0,k.useCallback)(e=>{if(y)S(e),w("metrics");else{let t=H(e)[0];t&&J(e,t.id)}},[y,J]),Z=(0,k.useCallback)(e=>{let t=y&&N?N:_;t&&J(t,e)},[y,N,_,J]),ee=(0,k.useCallback)(e=>{if("ArrowDown"===e.key)if(e.preventDefault(),x(!0),m||g){if(m&&!g){let e=Y.findIndex(e=>e.id===m);if(-1===e){let e=Y[0];e&&p(e.id)}else{let t=Y[e+1];t&&p(t.id)}}else if(g){let e=U.findIndex(e=>e.id===g),t=U[e+1];t&&f(t.id)}}else{let e=Y[0];e&&p(e.id)}else if("ArrowUp"===e.key){if(e.preventDefault(),x(!0),m&&!g){let e=Y.findIndex(e=>e.id===m);if(-1===e){let e=Y[Y.length-1];e&&p(e.id)}else e>0&&p(Y[e-1].id)}else if(g){let e=U.findIndex(e=>e.id===g);e>0?f(U[e-1].id):f(null)}}else if("ArrowRight"===e.key)e.preventDefault(),x(!0),m&&U.length>0&&f(U[0].id);else if("ArrowLeft"===e.key)e.preventDefault(),x(!0),g&&f(null);else if("Enter"===e.key){if(m&&g)J(m,g);else if(m)if(c.trim()&&U.length>0)J(m,U[0].id);else{let e=l.find(e=>e.id===m);e&&X(e.id)}}else"Escape"===e.key&&o(!1)},[Y,U,m,g,J,l,X,c]);(0,k.useEffect)(()=>{s&&(p(null),f(null),i&&I.current&&setTimeout(()=>{let e=I.current?.querySelector(`[data-event-id="${i}"]`);e?.scrollIntoView({block:"nearest",behavior:"auto"})},50))},[s,i]),(0,k.useEffect)(()=>{!m||Y.some(e=>e.id===m)||c.trim()&&m===q.firstMatchingEventId||p(null)},[m,Y,c,q.firstMatchingEventId]),(0,k.useEffect)(()=>{c.trim()&&q.firstMatchingEventId&&!h?(p(q.firstMatchingEventId),l.some(e=>e.id===q.firstMatchingEventId&&e.label.toLowerCase().includes(c.toLowerCase()))||U.length):c.trim()||i||p(null)},[c,q.firstMatchingEventId,U.length,i,l,h]),(0,k.useEffect)(()=>{if(h&&m&&I.current){let e=I.current.querySelector(`[data-event-id="${m}"]`);e&&e.scrollIntoView({block:"center",behavior:"smooth"})}},[m,h]),(0,k.useEffect)(()=>{let e=()=>{v(window.innerWidth<640)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,k.useEffect)(()=>{s||(w("events"),S(null))},[s]);let et=(0,k.useMemo)(()=>(function(e,t){if(!t||!e)return null;let r=(0,K.getAggregableMeasures)(e).find(e=>e===t);return r?{id:r,label:(0,Q.labelForMeasure)(e,r)}:null})(i,n),[i,n]),er=P&&et?(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsxs)("span",{children:[P.label," "]}),(0,t.jsx)("span",{className:"text-gray-900 inline-block ml-1",children:et.label})]}):"Select Metric";return(0,t.jsxs)(M.Root,{modal:!0,onOpenChange:o,open:s,children:[(0,t.jsx)(M.Anchor,{className:"flex",children:(0,t.jsx)(M.Trigger,{asChild:!0,children:(0,t.jsx)(u.Button,{"aria-label":"Select event and metric",className:(0,E.cn)("!px-2 !py-4",r&&"!bg-white"),disabled:r,prefix:P?k.default.createElement(V(P.id),{color:"gray-900"}):(0,t.jsx)(T.Database,{color:"gray-900"}),size:"small",suffix:(0,t.jsx)(b.ChevronUpDown,{color:"gray-800"}),type:"secondary",typeName:"button",children:er})})}),(0,t.jsx)(M.Portal,{children:(0,t.jsx)(M.Content,{align:"start",className:"tailwind-preflight",sideOffset:8,children:(0,t.jsxs)("div",{ref:D,className:(0,E.cn)("flex rounded-lg border-gray-alpha-400 bg-background-100 shadow-menu overflow-hidden font-sans relative isolate group",y?"w-[320px]":"w-[520px]"),children:[m&&!y&&(0,t.jsx)(G,{buttonRef:m&&B.current.get(m)?{current:B.current.get(m)||null}:{current:null},containerRef:D,metricsRef:A,eventsScrollerRef:F,onMouseEnter:()=>{p(m)}}),(0,t.jsxs)("div",{className:"flex flex-1 flex-col",children:[y&&"metrics"===j&&(0,t.jsx)("div",{className:"flex items-center border-b px-2 py-3",children:(0,t.jsxs)("button",{onClick:()=>w("events"),className:"flex items-center gap-1 bg-transparent text-sm text-gray-800 hover:text-gray-900",type:"button",children:[(0,t.jsx)(z.ChevronRight,{className:"size-3 rotate-180"}),"Back to Events"]})}),!(y&&"metrics"===j)&&(0,t.jsxs)("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[(0,t.jsx)("input",{className:"w-full border-none bg-transparent text-sm outline-none",onChange:e=>d(e.target.value),placeholder:"Find metric…",ref:R,value:c,onKeyDown:ee}),(0,t.jsx)(C.Kbd,{small:!0,style:{paddingRight:"0.5rem"},children:"Esc"})]}),(0,t.jsx)("div",{className:(0,E.cn)("flex h-[340px]",y&&"flex-col"),children:c.trim()&&0===q.events.length?(0,t.jsx)("div",{className:"flex flex-1 items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center text-sm text-gray-800",children:[(0,t.jsx)("div",{className:"mb-2",children:"No events or metrics found"}),(0,t.jsx)("div",{className:"text-xs text-gray-600",children:"Try adjusting your search terms"})]})}):(0,t.jsxs)(t.Fragment,{children:[(!y||"events"===j)&&(0,t.jsx)("div",{className:(0,E.cn)(y?"flex-1":"w-[260px] border-r"),children:(0,t.jsx)(O.Scroller,{className:"h-[340px]",overflow:"y",setContainerRef:e=>{F.current=e},children:(0,t.jsx)("div",{className:"px-2 py-2",ref:I,children:W.map(e=>{let[r,n]=e;return(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)("p",{className:"text-copy-14 mb-1 px-2 text-xs text-gray-800",children:r}),n.map(e=>{let r=V(e.id),n=function(e){let{eventId:t,selectedEventId:r,activeEventId:i,activeMetricId:n,displayEventId:l}=e,a=t===r,s=t===l;return{isSelected:a,isActive:t===i,isDisplayed:s,showSelectedBg:a&&!i,isIndirectlyActive:s&&n}}({eventId:e.id,selectedEventId:i,activeEventId:m,activeMetricId:g,displayEventId:_});return(0,t.jsxs)("button",{ref:t=>{t?B.current.set(e.id,t):B.current.delete(e.id)},"data-event-id":e.id,className:(0,E.cn)("flex w-full items-center gap-2 rounded px-2 py-1.5 text-sm font-sans cursor-pointer","bg-white focus:bg-gray-100 focus:outline-none",!h&&"hover:bg-gray-100",(n.showSelectedBg||n.isIndirectlyActive)&&"bg-gray-100",n.isActive&&!g&&"bg-gray-100"),onMouseEnter:()=>{h||p(e.id)},onMouseMove:()=>x(!1),onFocus:()=>p(e.id),onClick:()=>X(e.id),type:"button",children:[(0,t.jsx)(r,{className:"size-4",color:"gray-900"}),(0,t.jsx)("span",{className:"flex-1 text-left",children:e.label}),(0,t.jsx)(z.ChevronRight,{className:(0,E.cn)("size-3 text-gray-800 ",n.isDisplayed?"opacity-100":"opacity-0")})]},e.id)})]},r)})})})}),(!y||"metrics"===j)&&(0,t.jsx)("div",{className:(0,E.cn)("flex-1"),ref:A,children:(0,t.jsx)(O.Scroller,{className:"h-[340px]",overflow:"y",children:(0,t.jsxs)("div",{className:"px-2 py-2",children:[L&&(0,t.jsxs)("p",{className:"text-copy-14 mb-1 px-2 text-xs text-gray-800",children:["Metrics for ",L.label]}),U.length>0?U.map((e,r)=>{let l=function(e){let{metricId:t,metricIndex:r,selectedMetricId:i,activeEventId:n,activeMetricId:l,displayEventId:a,selectedEventId:s,isMobile:o,mobileStep:u}=e,c=t===i&&a===s;return{isSelected:c,isActive:(!o||"metrics"!==u)&&t===l,isFirstAndActive:(!o||"metrics"!==u)&&0===r&&n&&!l&&!c,showSelectedBg:c&&!l}}({metricId:e.id,metricIndex:r,selectedMetricId:n,activeEventId:m,activeMetricId:g,displayEventId:_,selectedEventId:i,isMobile:y,mobileStep:j});return(0,t.jsx)("button",{className:(0,E.cn)("flex w-full items-center rounded px-2 py-1.5 text-sm font-sans cursor-pointer","bg-white focus:bg-gray-100 focus:outline-none",!h&&"hover:bg-gray-100",(l.isFirstAndActive||l.showSelectedBg)&&"bg-gray-100",l.isActive&&"bg-gray-100"),onMouseEnter:()=>{h||y&&"metrics"===j||f(e.id)},onMouseLeave:()=>{h||y&&"metrics"===j||f(null)},onMouseMove:()=>x(!1),onClick:()=>Z(e.id),type:"button",children:(0,t.jsx)("span",{className:"flex-1 text-left",children:e.label})},e.id)}):(0,t.jsx)("div",{className:"px-2 py-4 text-center text-sm text-gray-800",children:c?"No metrics match your search":"No metrics available"})]})})})]})})]})]})})})]})}var X=e.i(8284460),Z=e.i(455575),ee=e.i(8735244),et=e.i(2924363),er=e.i(4244280),ei=e.i(7867910),en=e.i(1438473),el=e.i(5338940),ea=e.i(6352514),es=e.i(4759942);function eo(e){let{onGeneratedQuery:r,query:i,disabled:n,className:l}=e,a=(0,Z.useToasts)(),{team:s}=(0,el.useTeam)(),o=(0,k.useRef)(null),[d,m]=(0,k.useState)(!1),[p,g]=(0,k.useState)(""),{isGenerating:f,generate:b,error:h}=(e=>{let{onSuccess:t,query:r}=e,[i,n]=(0,k.useState)(!1),[l,a]=(0,k.useState)(null),{team:s}=(0,el.useTeam)(),o=(0,Z.useToasts)();return{isGenerating:i,generate:(0,k.useCallback)(async e=>{if(!e.trim())return;n(!0);let i=new URLSearchParams({previousQuery:JSON.stringify(r),prompt:e}).toString();try{let e=await fetch(`${er.API_OBSERVABILITY_QUERY_GENERATION}?${i}`),r=await e.json(),n=r.rollups.value,l=(0,K.getGroupableDimensions)(r.event),s=r.groupBy?.filter(e=>l.includes(e))??[];a(null),t({metric:`${r.event}.${n.measure}`,by:s,filter:r.filter??"",aggregation:n.aggregation,time:r.range??{from:new Date(r.startTime),to:new Date(r.endTime)}})}catch{let e="Error generating query";o.error(e),a(e)}finally{n(!1),es.analytics.track(ea.AnalyticsEvent.QUERY_BUILDER_GENERATED_QUERY,{prompt:e,plan:s?.billing?.plan??"hobby"})}},[t,r,s,o]),error:l}})({query:i,onSuccess:e=>{r(e),o.current={query:JSON.stringify(e),prompt:p},g("")}}),x=(0,k.useRef)(null),[y,v]=(0,k.useState)(!1),j=y&&!f&&!h,w=async e=>{e.preventDefault(),p.trim()&&(v(!0),await b(p))},N="query-builder-input";return(0,ei.useHotkey)(()=>{m(!0),setTimeout(()=>x.current?.focus(),0)},"/"),(0,t.jsx)(X.Root,{className:(0,E.cn)("border-t border-gray-400 px-4 bg-background-100",l),collapsible:!0,value:d?"query-assistant":"",type:"single",children:(0,t.jsxs)(X.Item,{value:"query-assistant",children:[(0,t.jsxs)(X.Trigger,{className:"group flex items-center w-full bg-transparent text-label-14 text-gray-800 font-medium p-0 py-3 gap-3 cursor-pointer",onClick:()=>{m(!d),d||setTimeout(()=>x.current?.focus(),0)},children:[(0,t.jsx)(z.ChevronRight,{className:"transition-transform group-[[data-state=open]]:rotate-90"}),(0,t.jsx)("span",{className:"mr-auto",children:"Query Assistant"}),(0,t.jsx)(C.Kbd,{className:(0,E.cn)("transition-opacity",0!==p.trim().length&&"hidden"),small:!0,children:"/"})]}),(0,t.jsx)(X.Content,{className:"pb-4",children:(0,t.jsxs)("form",{onSubmit:w,children:[(0,t.jsx)("label",{className:"sr-only",htmlFor:N,children:"Prompt"}),(0,t.jsx)(c.Input,{className:"h-12 rounded-lg",id:N,innerWrapperClassName:(0,E.cn)("bg-background-100 shadow h-12 font-sans text-[14px] relative z-10 border-gray-200 focus:border-gray-600 rounded-lg overflow-hidden m-1","h-10 shadow-border rounded-md",{"bg-gray-100":f}),name:N,disabled:f||n,onChange:e=>{g(e.target.value),v(!1)},placeholder:"Show me requests by host…",prefix:(0,t.jsx)(U.Sparkles,{size:14}),prefixStyling:!1,ref:x,suffix:(0,t.jsxs)("div",{className:"flex h-full gap-2 !pr-1",children:[j?(0,t.jsx)(u.Button,{"aria-label":"Not what I expected",className:"!px-0",size:"small",type:"secondary",onClickCapture:e=>{e.preventDefault()},onClick:()=>{v(!1),es.analytics.track(ea.AnalyticsEvent.QUERY_BUILDER_FEEDBACK,{feedback:"badly-generated-query",plan:s?.billing?.plan??"hobby",prompt:o.current?.prompt??"",generatedQuery:o.current?.query??""}),a.success("Thank you for the feedback!")},children:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 px-0.5 md:px-0",children:[(0,t.jsx)("span",{className:"hidden px-1.5 md:block",children:"Not what I expected"}),(0,t.jsx)(et.ThumbDown,{})]})}):null,f&&(0,t.jsx)("div",{className:"flex items-center justify-center px-2",children:(0,t.jsx)(ee.Spinner,{size:14})}),(0,t.jsx)(u.Button,{"aria-label":"Build It",className:"!px-0 disabled:hidden",disabled:0===p.trim().length||f,size:"small",typeName:"submit",children:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 px-0.5 md:px-0",children:[(0,t.jsx)("span",{className:"hidden px-1.5 md:block",children:"Generate Query"}),(0,t.jsx)(en.ArrowRight,{})]})})]}),suffixContainer:!1,suffixStyling:!1,typeName:"text",value:p})]})})]})})}var eu=e.i(962099),ec=e.i(6029070),ed=e.i(2749380),em=e.i(5627633),ep=e.i(268049);function eg(e){return{granularity:e,id:(0,ep.milliseconds)(e).toString(),label:(0,em.formatDuration)(e),type:"string"}}var ef=e.i(6190059),eb=e.i(1283928),eh=e.i(1717203),ex=e.i(9486194),ey=e.i(8690335),ev=e.i(9372366),ej=e.i(1111237),ew=e.i(6198010);let eN="!ring-1 ring-gray-400 outline-offset-2 outline-[var(--ds-focus-color)] outline-2 overflow-visible focus:outline";function eE(e){let{addButtonLabel:r,className:i,dimensions:n,values:l,onChange:s,isLoading:o,disabled:c,id:d}=e,[m,p]=(0,k.useReducer)(eS,{values:l,dimensions:n},ek);(0,k.useEffect)(()=>{p({type:"updateProps",dimensions:n,values:l})},[n,l]);let g=m.values.length>0;return(0,t.jsxs)("fieldset",{id:d,className:(0,E.cn)("flex flex-row flex-wrap items-center gap-2",i),children:[m.values.map((e,r)=>(0,t.jsxs)("span",{className:"flex flex-row",children:[(0,t.jsx)(a.SingleFilterPopoverBox,{className:(0,E.cn)("!p-1",eN,!c&&"!rounded-l"),disabled:c,label:"dimension",onChange:e=>p({type:"change",value:e,index:r,onChange:s}),onOpenChange:e=>p({type:"toggle",open:e,index:r}),open:m.open[r],options:m.remaining,rounded:c,value:e}),c?null:(0,t.jsx)(u.Button,{"aria-label":`Remove ${e.label}`,className:(0,E.cn)("!px-0.5 !text-gray-900 hover:!text-gray-1000",eN),onClick:()=>p({type:"remove",index:r,onChange:s}),size:"small",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},svgOnly:!0,type:"secondary",typeName:"button",children:(0,t.jsx)(x.CrossSmall,{size:"small"})})]},e.id)),(0,t.jsx)(a.SingleFilterPopoverBox,{className:"border !p-1",isLoading:o,label:"dimension",onChange:e=>p({type:"add",value:e,onChange:s}),onOpenChange:e=>p({type:"toggle",open:e}),open:m.openAdd,options:m.remaining,rounded:!0,children:(0,t.jsx)(u.Button,{"aria-label":"Add dimension",className:"!text-gray-900 data-[state='open']:!bg-gray-100 hover:!text-gray-1000",disabled:c,size:"small",type:"tertiary",...g?{shape:"square",svgOnly:!0,children:(0,t.jsx)(ew.Plus,{})}:{children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(ew.Plus,{}),r]})}})})]})}function ek(e){let{values:t,dimensions:r}=e;return{open:Array.from(t,()=>!1),openAdd:!1,values:t,remaining:eR(r,t),allDimensions:r}}function eS(e,t){switch(t.type){case"toggle":if(void 0===t.index)return{...e,openAdd:t.open};return t.index<0||t.index>=e.values.length?{...e}:{...e,open:[...e.open.slice(0,t.index),t.open,...e.open.slice(t.index+1)]};case"updateProps":{let{dimensions:r}=t,i=t.values.filter(e=>{let{id:t}=e;return r.some(e=>e.id===t)});return{...e,remaining:eR(r,i),values:i,allDimensions:r}}case"add":return{...e,...eM(e.allDimensions,[...e.values,t.value],t.onChange)};case"change":{let{index:r,value:i,onChange:n}=t;if(r<0||r>=e.values.length)return e;return{...e,...eM(e.allDimensions,[...e.values.slice(0,r),i,...e.values.slice(r+1)],n)}}case"remove":{let{index:r,onChange:i}=t;return{...e,...eM(e.allDimensions,[...e.values.slice(0,r),...e.values.slice(r+1)],i)}}default:return e}}function eR(e,t){return e.filter(e=>{let{id:r}=e;return!t.some(e=>e.id===r)})}function eM(e,t,r){return setTimeout(()=>r?.(t),0),{open:Array.from(t,()=>!1),openAdd:!1,values:t,remaining:eR(e,t)}}var eC=e.i(8522580),eO=e.i(6982071);e.i(6728635);var eT=e.i(2630141),eI=e.i(5348482);function eA(){let{team:e}=(0,el.useTeam)(),r=(0,eT.useOpenEnableModal)(),[,i]=(0,eI.useQueryBuilderQueryState)(),n=e?.billing?.plan==="hobby"?"Upgrade to Pro":"Get Observability Plus";return(0,t.jsx)(eC.Note,{action:(0,t.jsx)(u.Button,{size:"small",onClick:()=>{es.analytics.track(ea.AnalyticsEvent.OBSERVE_FEATURE_SEPARATION,{plan:e?.billing?.plan??"hobby",page:"query-builder",type:"modal_opened"}),r({from:"observability",via:"query-builder",upgradeUseCase:"query-builder"}),i({builder:!1})},children:n}),variant:"contrast",fill:!0,icon:(0,t.jsx)(eO.LockClosedSmall,{}),type:"secondary",className:"!rounded-md !pr-1.5",size:"small",children:(0,t.jsxs)("p",{children:["Read-only mode."," ",(0,t.jsx)("span",{className:"font-medium",children:"Unlock custom queries"})," by upgrading to"," ",e?.billing?.plan==="hobby"?"Pro and Observability Plus":"Observability Plus","."]})})}function eD(e){let{query:r,setQuery:i,embedded:n}=e,{hasObservabilityPlusAccess:l,ready:a}=(0,s.useHasObservabilityPlus)(),o=(0,k.useMemo)(()=>(0,ey.toSonarQuery)(r),[r]);return!a||l?(0,t.jsx)(eo,{className:n?"bg-background-200 border-0 rounded-md":"rounded-b-md",onGeneratedQuery:i,query:o}):(0,t.jsx)("div",{className:n?"pl-2":"p-4 pt-0",children:(0,t.jsx)(eA,{})})}let eB="flex flex-col md:flex-row gap-3 align-center";function eF(e){let{disabled:i,embedded:n,query:s,setQuery:o,variables:u,className:c,hideProjectFilter:m=!1}=e,g=(0,r.useServerFlag)("query-builder-pick-operator-upon-creation",!1),[f,h]=(0,k.useState)(!1),{isReady:x,accessibleDimensions:v,by:j}=(0,ec.useAccessibleDimensions)(s),{accessibleEvents:w}=(()=>{let{can:e}=(0,eh.default)(),{team:t}=(0,el.useTeam)();return t?{isReady:!0,accessibleEvents:ex.queryBuilderEvents.filter(r=>(0,K.canAccessEvent)({event:r,team:t,can:e})).map(e=>({id:e,label:"label"in eb.AllEvents[e]?eb.AllEvents[e].label:e,type:"string",group:(e=>{switch(e){case"serverlessFunctionInvocation":case"middlewareInvocation":case"outgoingRequest":return"Compute";case"incomingRequest":case"imageTransformation":case"isrOperation":return"Edge Network";case"blockedConnection":case"firewallAction":case"botIdCheck":return"Security";case"aiGatewayRequest":return"AI";case"edgeFunctionInvocation":return"Deprecated";default:return"Other"}})(e)})).toSorted((e,t)=>"Deprecated"===e.group&&"Deprecated"!==t.group?1:"Deprecated"!==e.group&&"Deprecated"===t.group?-1:0)}:{isReady:!1,accessibleEvents:[]}})(),{event:N,measure:M}=(0,ey.splitEventAndMeasure)(s),{accessibleAggregations:C,aggregation:O}=(0,eu.useAccessibleAggregations)(s),T=(0,ev.useValuesResolver)(s);((e,t)=>{let{event:r}=(0,ey.splitEventAndMeasure)(e),i=(0,k.useCallback)((e,t)=>{let r=(0,K.getGroupableDimensions)(e);return t.filter(e=>r.includes(e))},[]);(0,k.useEffect)(()=>{if(e.by.length>0){let n=i(r,e.by);n.length!==e.by.length&&t({by:n})}},[e.by,t,r,i])})(s,o);let I=(0,k.useMemo)(()=>v.toSorted((e,t)=>e.label.localeCompare(t.label)),[v]),A=(0,k.useMemo)(()=>({dimensions:I.filter(e=>{let{id:t}=e;return!m||"projectId"!==t}),operators:S.operators,resolveValues:T,defaultSingleOperator:S.defaultSingleOperator,defaultMultiOperator:S.defaultMultiOperator,defaultArrayOperator:S.defaultArrayOperator}),[I,T,m]),D=(0,k.useMemo)(()=>(0,ey.parseFilters)(s.filter),[s.filter]),B=0===D.length&&s.filter,F=(0,k.useCallback)(e=>o({filter:(0,ey.serializeFilters)(e)}),[o]),P=(0,k.useCallback)(e=>{let t=s.view;0===e.length&&t?.type==="table"?t={type:"big-number"}:e.length>0&&t?.type==="big-number"&&(t={type:"table"}),o({by:e.map(e=>{let{id:t}=e;return t}),view:t})},[o,s.view]);return(0,t.jsxs)("div",{className:(0,E.cn)("flex flex-col bg-background-100 mb-3",!n&&"shadow-border rounded-md",c),children:[(0,t.jsxs)("div",{className:(0,E.cn)("flex flex-col flex-1 gap-3",n?"p-2 pt-0 pb-4":"p-4 pb-3"),children:[(0,t.jsxs)("div",{className:eB,children:[(0,t.jsx)(eq,{htmlFor:"event-metric",className:eP,children:"Metric"}),(0,t.jsxs)("div",{className:"flex flex-col flex-wrap md:flex-row gap-2 flex-1 [&>:nth-child(2)]:mr-auto",children:[(0,t.jsx)(J,{disabled:i,selectedEventId:N,selectedMetricId:M,events:w,onSelect:(e,t)=>{o({metric:`${e}.${t}`,aggregation:function(e){let t=eb.AllMeasures[e];if(!t)return"sum";let{unit:r,aggregations:i}=t;switch(r){case"count":case"bytes":return i.includes("sum")?"sum":i[0];case"milliseconds":case"seconds":case"megabytes":case"gigabyte_hour":case"ratio":case"percent":return i.includes("avg")?"avg":i[0];default:return i[0]}}(t)})}}),(0,t.jsx)(a.SingleFilterPopoverBox,{id:"aggregation",className:"!px-2 !py-4",disabled:i,label:"aggregation",onChange:e=>{o({aggregation:e.id}),h(!1)},onOpenChange:h,open:f,options:C,rounded:!0,suffix:(0,t.jsx)(b.ChevronUpDown,{color:"gray-800"}),value:O}),(0,t.jsx)(R.DateRangeSelect,{disabled:i,value:s.time,onChange:e=>o({time:e}),trackEvents:!0,variables:u})]})]}),(0,t.jsxs)("div",{className:eB,children:[(0,t.jsx)(eq,{htmlFor:"by",className:eP,children:"Group By"}),(0,t.jsx)("div",{className:"flex-1",children:x?(0,t.jsx)(eE,{addButtonLabel:"Add",id:"by",dimensions:I,disabled:i,isLoading:!x,onChange:P,values:j}):(0,t.jsx)(d.Skeleton,{height:32,width:100})})]}),B?(0,t.jsx)(e_,{setQuery:o,query:s}):(0,t.jsxs)("div",{className:eB,children:[(0,t.jsxs)(eq,{htmlFor:"filter",className:eP,children:["Filter",m?(0,t.jsx)(p.Tooltip,{text:(0,t.jsx)("p",{className:"text-copy-14",children:"This query is already filtered for your current project."}),children:(0,t.jsx)(y.Information,{color:"gray-900",className:"-mt-2"})}):null]}),(0,t.jsx)("div",{className:"flex-1",children:x?(0,t.jsx)(l.FilterBar,{config:A,disabled:i,filters:D,onChange:F,operatorUponCreation:g}):(0,t.jsx)(d.Skeleton,{height:32,width:200})})]})]}),(0,t.jsx)(eD,{embedded:n,query:s,setQuery:o})]})}let eP="md:w-16 md:shrink-0 md:pt-1.5 inline-flex gap-1";function eq(e){let{children:r,className:i,htmlFor:n,...l}=e;return(0,t.jsx)("label",{className:(0,E.cn)("text-sm font-medium text-gray-800",i),htmlFor:n,...l,children:r})}function e_(e){let{setQuery:r,query:i}=e;return(0,t.jsxs)("div",{className:"flex w-full flex-row items-center gap-2 py-2 col-span-2",children:[(0,t.jsx)(p.Tooltip,{text:"Invalid or unsupported filter saved",children:(0,t.jsx)(N.Question,{size:16})}),(0,t.jsxs)("div",{className:"flex w-full flex-row items-center",children:[(0,t.jsx)(p.Tooltip,{className:"w-full",text:i.filter,children:(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(c.Input,{"aria-label":"Invalid or unsupported filter saved",className:"w-full overflow-visible outline-2 outline-offset-2 outline-[var(--ds-focus-color)] !ring-1 ring-gray-400 focus:outline",disabled:!0,style:{borderTopRightRadius:0,borderBottomRightRadius:0},value:i.filter})})}),(0,t.jsx)(u.Button,{"aria-label":"Clear filter",className:"overflow-visible !border-l-0 outline-2 outline-offset-2 outline-[var(--ds-focus-color)] !ring-1 ring-gray-400 focus:outline",onClick:()=>r({filter:""}),size:"medium",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},svgOnly:!0,type:"secondary",children:(0,t.jsx)(x.CrossSmall,{size:20})})]})]})}function eL(e){let r,i,n,l,{className:s,query:o,setQuery:u,disabled:c}=e,[d,m]=(0,k.useState)(!1),{accessibleGranularities:p,granularity:g}=(r=(0,k.useMemo)(()=>{let{start:e,end:t}=(0,ed.fromTimeToRange)(o.time);return Math.round(t.getTime()-e.getTime())},[o.time]),i=(0,k.useMemo)(()=>(0,ed.getGranularityFromDuration)(r),[r]),n=(0,k.useMemo)(()=>{let e=[],t=(0,ep.milliseconds)(i);for(let i of ed.preferredGranularities){let n=(0,ep.milliseconds)(i);n>=t&&n<=r&&e.push(eg(i))}return e},[i,r]),l=(0,k.useMemo)(()=>n.find(e=>{let{id:t}=e;return t===(0,ep.milliseconds)(o.granularity??{}).toString()})??eg(i),[i,n,o.granularity]),{accessibleGranularities:n,granularity:l});return(0,t.jsxs)("div",{className:(0,E.cn)("flex flex-wrap gap-2 items-center justify-end",s),children:[(0,t.jsx)(a.SingleFilterPopoverBox,{id:"granularity",disabled:c,label:"granularity",onChange:e=>{let{granularity:t}=e;u({granularity:t}),m(!1)},onOpenChange:m,open:d,options:p,prefix:(0,t.jsx)(h.Clock,{color:"gray-900"}),rounded:!0,suffix:(0,t.jsx)(b.ChevronUpDown,{color:"gray-800"}),value:g}),(0,t.jsx)(ez,{query:o,onChange:e=>u({view:e})})]})}let e$=[{type:"line",icon:(0,t.jsx)(v.LineChart,{})},{type:"area",icon:(0,t.jsx)(f.BarChart,{})},{type:"table",icon:(0,t.jsx)(j.MenuAlt,{}),isDisabled:e=>(e?.by.length??0)===0?"Add a Group By clause to view results in a Table.":null},{type:"big-number",icon:(0,t.jsx)(w.Percentage,{}),isDisabled:e=>(e?.by.length??0)>=1?"Remove your Group By clause to view results as a number.":null}];function ez(e){let{query:r,onChange:i}=e,n=e$.filter(e=>{let{isDisabled:t}=e;return!t?.(r)});return(0,t.jsx)(m.Switch,{name:"view",size:"small",children:n.map(e=>{let{type:n,icon:l}=e;return(0,t.jsx)(m.Switch.Control,{checked:(r?.view?.type??"line")===n,icon:l,value:n,onChange:()=>i({type:n})},n)})})}e.s(["QueryBuilder",0,function(e){let{query:r,setQuery:l,Actions:a,Title:c,variables:d,children:m,filteredProjects:p,embedded:f=!0}=e,[b,h]=(0,k.useState)(!1),{hasObservabilityPlusAccess:x}=(0,s.useHasObservabilityPlus)(),y=(0,k.useMemo)(()=>{let{filter:e,...t}=(0,o.replaceVariables)(r,d);return{...t,filter:p?.length?(0,i.andFilterStrings)(e||void 0,`projectId in (${p.map(e=>`'${e}'`).join(",")})`):e}},[r,d,p]),{isReady:v}=(0,ef.useAccessibleMetrics)(),j=!v||!x,w=!!p?.length,N=(0,k.useRef)(null),S=(0,k.useCallback)(()=>{N.current&&h(N.current.scrollTop>40)},[]),R=(0,k.useCallback)(()=>{N.current&&N.current.scrollTo({top:0,behavior:"smooth"})},[]);return(0,t.jsx)(n.ObservabilityChartContextProvider,{children:f?(0,t.jsxs)("div",{ref:N,className:"relative flex flex-1 flex-col overflow-y-auto m-4",onScroll:S,children:[(0,t.jsxs)("div",{className:"sticky left-0 top-0 z-10 pb-3 flex items-center justify-between gap-3 bg-background-100",children:[(0,t.jsx)("div",{className:"flex flex-1 items-center justify-start gap-2",children:c}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(u.Button,{"aria-label":"Scroll to top",onClick:R,type:"tertiary",svgOnly:!0,"aria-hidden":!b,shape:"square",className:(0,E.cn)("transition-all duration-200",b?"opacity-100 translate-y-0":"opacity-0 translate-y-2 pointer-events-none"),tabIndex:b?0:-1,children:(0,t.jsx)(g.ArrowUp,{size:16})}),a]})]}),(0,t.jsx)(eF,{className:"sticky inset-x-0 pt-px",disabled:j,embedded:f,query:r,setQuery:l,variables:d,hideProjectFilter:w}),(0,t.jsx)(eL,{className:"p-px sticky inset-x-0",disabled:j,query:r,setQuery:l}),(0,t.jsx)(ej.ResultsChart,{query:y,readOnly:j,scrollerRef:f?N:void 0,setQuery:l,showTable:r.by.length>0,sticky:f,variant:"minimal"}),m]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eF,{disabled:j,embedded:f,query:r,setQuery:l,variables:d,hideProjectFilter:w}),(0,t.jsxs)("div",{className:"p-4 flex flex-col gap-3 border-1 rounded-md shadow-border bg-background-100",children:[(0,t.jsx)(eL,{disabled:j,query:r,setQuery:l}),(0,t.jsx)(ej.ResultsChart,{query:y,readOnly:j,scrollerRef:f?N:void 0,setQuery:l,showTable:r.by.length>0,sticky:f,variant:"minimal"}),m]})]})})}],1135066)}]);

//# debugId=1fccbfe5-00d3-e336-b21a-c65f48835172
//# sourceMappingURL=e43d8916ca16f57f.js.map