;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="0563a067-d7a2-01da-ae10-0b80b7e7a48d")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,5598924,5442212,e=>{"use strict";var t=e.i(847684),i=e.i(9338892),r=e.i(7185353),l=e.i(5255926),n=e.i(6881349),a=e.i(6352514),o=e.i(4759942),s=e.i(1991452),c=e.i(8238875),d=e.i(9031150),u=e.i(935882);let m=()=>{let e=(0,c.useSearchParams)();return{isReady:(0,s.useRouter)().isReady,filterBranch:e?.get("filterBranch")||void 0}};e.s(["useProjectFilteredBranch",0,function(){let{project:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=m(),[i,l]=(0,r.useState)(t.filterBranch||null);(0,r.useEffect)(()=>{l(t.filterBranch||null)},[t.isReady,t.filterBranch]);let n=(0,s.useRouter)(),a=(0,r.useCallback)(e=>{(0,d.awaitPaint)().then(()=>{l(e),function(e,t){let{teamSlug:i,project:r,slug:l,...n}=e.query;t?n.filterBranch=t:delete n.filterBranch,e.replace({pathname:window.location.pathname,query:n},void 0,{shallow:!0,scroll:!1})}(n,e)})},[n]),o=i?{ref:i}:void 0,c=(0,r.useCallback)(()=>{i&&(l(null),a(null))},[i,a]),p=!e||!t.isReady,h=null!==i,[g,x]=(0,r.useState)(h);return(0,u.default)(()=>{x(h)},[x,p,h]),{showBranchFilterBar:g,filteredBranch:i,setFilteredBranch:a,clearBranch:c,gitSource:o}},"useRouterFilteredBranch",0,m],5442212);var p=e.i(1947138),h=e.i(7401972);let g=(0,r.memo)(e=>{let{loading:l,skeleton:s,onSelect:c,project:d,value:g,includeProductionBranch:f,placeholder:y,skeletonStyle:b,comboboxSize:j,clearable:v}=e,[S,k]=(0,r.useState)(!1),[N,C]=(0,r.useState)(!1),[R,P,{currentValue:w,setValueImmediate:A}]=(0,p.useDebounceState)(g||"",300);(0,r.useEffect)(()=>{g&&A(g)},[A,g]);let[,{branches:D,isValidating:I,fetchedQuery:T}]=(0,h.useProjectDeployedBranches)({project:d,includeProductionBranch:f,query:R},{revalidateOnFocus:!1,revalidateIfStale:!1,revalidateOnReconnect:!1}),O=(T||"")!==R,E=!!N&&!!S&&!!w&&O,{filterBranch:B}=m();(0,r.useEffect)(()=>{B&&A(B)},[A,B]),(0,r.useEffect)(()=>{A(g||"")},[A,g]),(0,r.useEffect)(()=>{S||D&&!I&&k(!0)},[S,D,I]);let[M,$]=(0,r.useState)([]);(0,r.useEffect)(()=>{I||void 0===D||(0!==L.current.query.indexOf(w)&&(L.current={values:[],query:w}),$(D||[]))},[JSON.stringify(D),T]);let L=(0,r.useRef)({values:[],query:""}),F=I||w.length>=R.length&&w.length>=1?L.current.values:[],_=[...new Set([...F,...E?M:D||[]])],q=(0,r.useRef)(null);return((0,u.default)(()=>{w&&q.current?.setValue(w)},[w]),(0,u.default)(()=>{g||q.current?.clear()},[g]),s&&!S)?(0,t.jsx)(x,{skeletonStyle:b}):(0,t.jsxs)(n.Combobox,{clearable:v,filter:function(e,t){let r=""===t?e:(0,i.matchSorter)(e,t,{keys:["value","label"]}),l=[];for(let e of F)r.find(t=>t.value===e)&&l.push(e);let n=[...new Set([...l,...r.map(e=>e.value)])],a=n.map(e=>{let t=r.find(t=>t.value===e);if(!t)throw Error("impossible state");return t});return L.current={values:n,query:w},a},loading:E||l,onChange:e=>{e===B?setTimeout(()=>{c?.(null),q.current?.clear(),A("")}):(o.analytics.track(a.AnalyticsEvent.DEPLOYMENT_OVERVIEW_FILTERS_BRANCH,{value:e}),A(e||""),c?.(e))},onChangeOpen:e=>{C(e)},placeholder:y||"All Branches…",ref:q,size:j,children:[(0,t.jsx)(n.Combobox.Input,{loading:E||l,onChange:e=>{""===e.target.value?A(""):P(e.target.value)}}),(0,t.jsx)(n.Combobox.List,{children:_.map((e,i)=>(0,t.jsx)(n.Combobox.Option,{value:e,children:e},w?e:`${e}${i}`))})]})});function x(e){let{skeletonStyle:i}=e;return(0,t.jsx)(l.Skeleton,{style:i||{height:40},width:"100%"})}e.s(["BranchSearchCombobox",0,function(e){let{skeletonStyle:i}=e;return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)(x,{skeletonStyle:i}),children:(0,t.jsx)(g,{...e})})}],5598924)},4443312,e=>{"use strict";var t=e.i(4603164),i=e.i(5338940);e.s(["CHECK_RUNS_REFRESH_INTERVAL",0,3e3,"useProjectCheckRuns",0,function(e){let{deploymentId:r,swrOptions:l,enableCiChecksAndPolicies:n}=e,{team:a}=(0,i.useTeam)();return(0,t.useTypedSWR)("/v2/deployments/{deploymentId}/check-runs",n&&r&&a?.id?{deploymentId:r,teamId:a.id}:null,{refreshInterval:3e3,...l})}])},8529990,e=>{"use strict";let t=encodeURIComponent;function i(e){return"string"==typeof e?e:void 0}e.s(["getGitInfoFromDeployment",0,function(e){if(!e)return null;let{meta:r}=e;if(r?.githubDeployment){let e=`https://github.com/${t(r.githubCommitOrg??"")}/${t(r.githubCommitRepo??"")}/commit/${r.githubCommitSha}`,l=`https://github.com/${t(r.githubCommitOrg??"")}/${t(r.githubCommitRepo??"")}/tree/${t(r.githubCommitRef??"")}`,n=r.githubPrId?`https://github.com/${t(r.githubOrg??"")}/${t(r.githubRepo??"")}/pull/${r.githubPrId}`:void 0;return{type:"github",commitRef:String(r.githubCommitRef),commitSha:String(r.githubCommitSha),commitAuthorName:String(r.githubCommitAuthorName),commitAuthorLogin:i(r.githubCommitAuthorLogin),commitMessage:String(r.githubCommitMessage),repoName:String(r.githubCommitRepo),repoNamespace:String(r.githubCommitOrg),orgNamespace:String(r.githubOrg),commitUrl:e,refUrl:l,viaFork:r.githubOrg!==r.githubCommitOrg,prId:r.githubPrId?Number(r.githubPrId):void 0,prUrl:n,gitDirty:String(r.gitDirty),isPublic:"public"===r.githubRepoVisibility}}if(r?.gitlabDeployment){let e=`https://gitlab.com/${r.gitlabProjectPath}/tree/${t(r.gitlabCommitRef??"")}`,l=`https://gitlab.com/${r.gitlabProjectPath}/commit/${r.gitlabCommitSha}`;return{type:"gitlab",commitRef:String(r.gitlabCommitRef),commitSha:String(r.gitlabCommitSha),commitAuthorName:String(r.gitlabCommitAuthorName),commitAuthorLogin:i(r.gitlabCommitAuthorLogin),commitMessage:String(r.gitlabCommitMessage||r.gitCommitMessage),repoName:String(r.gitlabProjectName),repoNamespace:String(r.gitlabProjectNamespace),orgNamespace:String(r.gitlabProjectNamespace),commitUrl:l,refUrl:e,isPublic:"public"===r.gitlabProjectVisibility}}if(r?.bitbucketDeployment){let e=`https://bitbucket.org/${r.bitbucketRepoOwner}/${r.bitbucketRepoSlug}/branch/${t(r.bitbucketCommitRef??"")}`,l=`https://bitbucket.org/${r.bitbucketRepoOwner}/${r.bitbucketRepoSlug}/commits/${r.bitbucketCommitSha}`;return{type:"bitbucket",commitRef:String(r.bitbucketCommitRef),commitSha:String(r.bitbucketCommitSha),commitAuthorName:i(r.bitbucketCommitAuthorName),commitAuthorLogin:i(r.bitbucketCommitAuthorLogin),commitMessage:String(r.bitbucketCommitMessage),repoName:String(r.bitbucketRepoSlug),repoNamespace:String(r.bitbucketRepoOwner),orgNamespace:String(r.bitbucketRepoOwner),commitUrl:l,refUrl:e,isPublic:"public"===r.bitbucketRepoVisibility}}return null}])},3907048,e=>{"use strict";var t=e.i(847684),i=e.i(4585051),r=e.i(7185353),l=e.i(2982888),n=e.i(8651268);let a=(0,r.memo)(e=>{let{deployment:r,size:a=24,showProviderIcon:o=!1}=e;return r.meta?.deployHookId?(0,t.jsx)(l.DeployHookAvatar,{height:a,width:a}):r.creator?.uid?(0,t.jsx)(n.PrincipalAvatar,{size:a,principalId:r.creator.uid,principal:{type:"user",uid:r.creator.uid,username:r.creator.username},deploymentMeta:r.meta?.originalDeploymentId?void 0:r.meta,showProviderIcon:{github:!1,gitlab:o,bitbucket:o}}):(0,t.jsx)(i.Avatar,{size:a})});a.displayName="CreatorAvatar",e.s(["CreatorAvatar",0,a])},8227242,e=>{"use strict";var t=e.i(847684);e.i(9623499);var i=e.i(5576066);e.s(["LinkParser",0,function(e){let r,{text:l}=e;return(0,t.jsx)("span",{children:(r=/(?<temp1>https?:\/\/[^\s]+)/g,l.split(r).map(e=>r.test(e)?(0,t.jsx)(i.Link,{className:"break-all font-normal",href:e,rel:"noopener noreferrer",target:"_blank",type:"blend",children:e},e):(0,t.jsx)("span",{children:e},e)))})}])},930810,9745887,e=>{"use strict";var t=e.i(847684),i=e.i(2504781),r=e.i(9334091),l=e.i(3306538),n=e.i(57106),a=e.i(3753138),o=e.i(6226725),s=e.i(4345845),c=e.i(8893913),d=e.i(7218483),u=e.i(9722978),m=e.i(9375869),p=e.i(8529990),h=e.i(3907048);function g(e){let{isForm:i,children:r,className:l}=e;return i?(0,t.jsx)("label",{className:l,children:r}):(0,t.jsx)("div",{className:l,children:r})}function x(e){let{deployment:i,isForm:r,isPromote:x,isPreviousDeployment:f,isProductionDeployment:y,isRolledBackDeployment:b,selectedDeployment:j,setSelectedDeployment:v,ariaLabel:S="Rollback Deployment"}=e,k=(0,d.useAgo)(i.createdAt||0),N="number"==typeof i.aliasAssigned?i.aliasAssigned:0,C=N>0,R=(0,d.useAgo)(N),P=(0,m.useDeploymentLink)(i),w=(0,p.getGitInfoFromDeployment)(i),A=y||f||b;f&&b&&(f=!1);let D="Preview";if("target"in i)switch(i.target){case"staging":D="Staging";break;case"production":D="Production";break;default:D="Preview"}else D="Production";let I="uid"in i?i.uid:i.id,T=null;x?w?.commitRef&&(T=(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-0.5 flex-initial",children:[(0,t.jsx)(s.GitBranch,{color:"gray-900"}),(0,t.jsx)("span",{className:"text-copy-14-mono text-gray-900 truncate whitespace-nowrap",style:{marginRight:"4px",maxWidth:120,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0},title:w.commitRef,children:w.commitRef}),(0,t.jsxs)("span",{className:"text-copy-14 text-gray-900 truncate whitespace-nowrap flex items-center gap-1",style:{flexBasis:"50%",flexShrink:0,flexGrow:1,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0,maxWidth:260},children:["Staged"," ",k," by"," ",(0,t.jsx)("span",{children:(0,t.jsx)(h.CreatorAvatar,{deployment:i,showProviderIcon:!0,size:24})}),(0,t.jsx)("span",{children:!i.meta?.originalDeploymentId&&i.creator?.username?i.creator.username:w.commitAuthorLogin})]})]})):T=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"inline-flex flex-row items-center",children:[(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",style:{marginRight:"4px"},children:D}),w?.commitRef?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.GitBranch,{color:"gray-900",size:14}),(0,t.jsx)("span",{className:"text-copy-14-mono max-w-[100px] truncate whitespace-nowrap px-1 text-center text-sm leading-5 text-gray-900",title:w.commitRef,children:w.commitRef}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"by"}),(0,t.jsxs)("div",{className:"ml-1 inline-flex flex-row items-center gap-1",children:[(0,t.jsx)(h.CreatorAvatar,{deployment:i,size:20}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900 truncate max-w-[140px]",children:!i.meta?.originalDeploymentId&&i.creator?.username?`${i.creator.username}`:w.commitAuthorLogin})]})]}):null]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"Deployed "}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:k}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:", "}),C?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"promoted "}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:R})]}):(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"never promoted"})]})]});let O=null;return r||(O=x?(0,t.jsx)(a.ArrowCircleUp,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):y?(0,t.jsx)(o.CrossCircle,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):(0,t.jsx)(c.RotateCounterClockwise,{className:"mr-4 hidden self-center sm:block",color:"gray-1000",style:{flexShrink:0}})),(0,t.jsxs)(g,{className:(0,u.clsx)("flex w-full items-end justify-start px-4 py-3","rounded border border-solid border-[var(--accents-2)]","rounded-b-none","last:rounded-b","[&+&]:rounded-t-none [&+&]:border-t-0",{"bg-[var(--accents-1)] shadow-none":y,"bg-[var(--geist-background)]":!y}),isForm:r,children:[r?(0,t.jsx)("input",{"aria-label":S,checked:j?.uid===I,className:`
            relative m-0 mr-4 size-4 shrink-0 appearance-none
            self-center rounded-[1000px] border
            border-solid border-[var(--geist-foreground)] after:absolute after:inset-[3px]
            after:rounded-[1000px] after:bg-[var(--geist-foreground)]
            after:content-none checked:after:content-['']
          `,name:"rollbackDeployment",onChange:()=>{"uid"in i&&"type"in i&&v&&v(i)},type:"radio",value:I}):O,(0,t.jsxs)("div",{style:{width:A?"initial":"100%",minWidth:0},children:[(0,t.jsx)(n.Link,{className:"flex w-[calc(100%-1ch)] items-center gap-0.5 break-all text-sm font-bold leading-5",href:P,target:"_blank",children:(0,t.jsx)("span",{className:"text-[14px] leading-[20px] font-medium line-clamp-1",title:i.url,children:i.url})}),w?.commitMessage?(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900 line-clamp-1 break-words",title:w.commitMessage,children:[w.commitSha.substring(0,7)," ",w.commitMessage]}):null,T]}),y?(0,t.jsx)(l.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"inverted",children:"Current"}):null,f?(0,t.jsx)(l.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"gray-subtle",children:"Previous"}):null,b?(0,t.jsx)(l.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"red-subtle",children:"Rolled back"}):null]})}e.s(["DeploymentCardSmall",0,x],9745887);var f=e.i(8227242),y=e.i(8651268);e.s(["ChooseDeploymentList",0,function(e){let{deployments:r,previousDeployment:l,rolledBackDeploymentId:n,productionDeployment:a,selectedDeployment:o,setSelectedDeployment:s,swr:c,ariaLabel:d}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:r.map(e=>a.id!==e.uid&&(0,t.jsx)(x,{deployment:e,isForm:!0,isPreviousDeployment:l?.uid===e.uid,isRolledBackDeployment:n===e.uid,selectedDeployment:o,setSelectedDeployment:s,ariaLabel:d},e.uid))}),!c.isReachingEnd&&(0,t.jsx)(i.Button,{loading:c.isLoadingMore,onClick:()=>{c.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})]})},"REASON_MAX_CHARACTER_LENGTH",0,250,"RollbackDescriptionCard",0,function(e){let{rollbackDescription:i,project:r,preview:l}=e,n=(0,d.useAgo)(i.createdAt);return(0,t.jsxs)("div",{className:"px-4 py-3 rounded bg-background-200 shadow-border",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900 break-words",children:i.description.length>0?(0,t.jsxs)(t.Fragment,{children:["“",(0,t.jsx)(f.LinkParser,{text:i.description}),"”"]}):(0,t.jsx)("span",{className:"text-copy-14",children:"No reason provided."})}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[l?null:(0,t.jsx)("p",{className:"text-copy-14",children:"Rolled back by"}),i.username?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.PrincipalAvatar,{size:20,principalId:i.userId,principal:{type:"user",uid:i.userId,username:i.username}}),(0,t.jsx)("p",{className:"text-copy-14",children:i.username}),r?.lastAliasRequest!==void 0&&!l&&(0,t.jsx)("p",{className:"text-copy-14",children:n})]}):null]})]})},"RollbackDescriptionTextarea",0,function(e){let{value:i,onChange:l,id:n}=e;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(r.Textarea,{autoFocus:!0,className:"text-base min-h-24",error:i.length>=250?"Reason cannot be longer than 250 characters.":void 0,id:n,onChange:e=>l(e.target.value),placeholder:"Production is not behaving as expected…",required:!0,value:i,style:{fontSize:14}})})},"getDeploymentId",0,function(e){return"id"in e?e.id:"uid"in e?e.uid:void 0},"getMostRecentlyPromotedDeployment",0,function(e){if(0===e.length)return;let t=e.reduce((e,t)=>e.aliasAssigned&&t.aliasAssigned?e.aliasAssigned>t.aliasAssigned?e:t:t.aliasAssigned?t:e);if(t.aliasAssigned)return t},"isDeleted",0,function(e){return void 0!==e.deleted}],930810)},6619197,5645345,e=>{"use strict";var t=e.i(847684),i=e.i(7185353),r=e.i(8248823),l=e.i(8238875),n=e.i(57106),a=e.i(3869281),o=e.i(4030453),s=e.i(2455417),c=e.i(6891161),d=e.i(8522580),u=e.i(5255926),m=e.i(9318197),p=e.i(455575),h=e.i(8761240),g=e.i(472117),x=e.i(4004502),f=e.i(8042625),y=e.i(277234),b=e.i(4244280),j=e.i(4443312),v=e.i(5140444),S=e.i(5338940),k=e.i(5757634),N=e.i(4450569),C=e.i(4396019),R=e.i(9375869),P=e.i(8518548);function w(e){if(!e)return;if("id"in e==!1)return e;let{aliasAssigned:t,aliasError:i=null,aliasAssignedAt:r,buildingAt:l,created:n=e.createdAt,createdAt:a,creator:o,name:s,ready:c,readyState:d,readySubstate:u,target:m=null,uid:p=e.id,url:h,isRollbackCandidate:g="production"===e.target,prebuilt:x}=e;return{aliasAssigned:t,aliasError:i,aliasAssignedAt:r,buildingAt:l,created:n,createdAt:a,creator:{email:"",githubLogin:"",...o},name:s,ready:c,readyState:d,readySubstate:u,target:m,prebuilt:x,type:"LAMBDAS",uid:p,url:h,isRollbackCandidate:g}}e.s(["asListDeployment",0,w],5645345);var A=e.i(1840726),D=e.i(930810),I=e.i(7952834),T=e.i(1173672),O=e.i(9745887),E=e.i(3008300),B=e.i(3981247),M=e.i(6060673);function $(e){let{title:i}=e;return(0,t.jsx)(c.Modal.Header,{children:(0,t.jsx)(c.Modal.Title,{center:!0,children:i})})}function L(e){let{deploymentId:i}=e,r=(0,g.useChecksPrivateBetaFlag)(),l=(0,g.useCiChecksAndPoliciesFlagV2)(),a=r||l,{data:o,isLoading:s}=(0,j.useProjectCheckRuns)({deploymentId:i,enableCiChecksAndPolicies:a});if(!a)return null;if(s)return(0,t.jsx)(u.Skeleton,{});if(o?.runs.every(e=>"succeeded"===e.conclusion))return null;let c=o?.runs.filter(e=>"succeeded"!==e.conclusion)||[];return(0,t.jsxs)(d.Note,{type:"error",fill:!0,className:"mt-6",children:["By clicking Promote, you acknowledge that you are bypassing promotion requirements:",c.length>0&&(0,t.jsx)("ul",{className:"flex flex-col gap-1 ml-4 list-disc",children:c.slice(0,5).map(e=>(0,t.jsx)("li",{children:e.externalUrl?(0,t.jsx)(n.Link,{href:e.externalUrl,external:!0,children:e.name}):(0,t.jsx)("span",{children:e.name})},e.id||e.name||`${e.conclusion}-${e.status}`))})]})}let F=e=>{let{deployment:t,project:n,useIgnoreBuildStep:a,onCurrentDeploymentPromoted:o}=e,s=(0,p.useToasts)(),c=(0,l.useRouter)(),{team:d}=(0,S.useTeam)(),{user:u}=(0,v.useUser)(),{mutate:m}=(0,k.useSWRConfig)(),[h,g]=(0,i.useState)(!1),[x,j]=(0,i.useState)(void 0),N=(0,A.useShowIgnoreBuildStep)({project:n,deployment:t});return{promote:(0,i.useCallback)(async()=>{if(t&&n){g(!0),j(void 0);try{let e,i=d?.id,r="Promoted Deployment successfully.";if("production"===t.target)await (0,y.fetchAPI)(`${(0,b.API_DEPLOYMENT_PROMOTE)(n.id,t.uid||t.id)}${(0,f.encode)({teamId:i})}`,{method:"POST",body:{},throwOnHTTPError:!0}),e=(0,R.pathFromDeployment)(t,{user:u,team:d});else{let l=await (0,y.fetchAPI)(`${(0,b.API_DEPLOYMENTS)("v13")}${(0,f.encode)({teamId:i,skipIgnoreBuildStep:N&&!a?"1":null})}`,{method:"POST",body:JSON.stringify({deploymentId:t.uid||t.id,meta:{action:"promote"},name:n.name,target:"production"}),throwOnHTTPError:!0});e=(0,R.pathFromDeployment)(l,{user:u,team:d});let o=t.uid||t.id;r="production"===t.target?o===l.id?"Deployment is already the current Production Deployment.":"Promoted Deployment to Production successfully.":"Created Production Deployment successfully."}d&&((0,I.revalidateProject)(m,n),await m((0,T.getProjectProductionDeploymentKey)({projectIdOrName:n.id,teamId:d.slug}))),s.success({text:r,key:"production-deployment"}),e&&(e===location.pathname?o?.():c.push(e))}catch(e){j((0,r.normalizeError)(e))}finally{g(!1)}}},[t,n,c,N,d,s,a,u,m,o]),loading:h,setLoading:g,error:x,setError:j}};e.s(["default",0,function(e,r){let{onDeploymentPromoted:l}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},[u,p]=(0,i.useState)(!1),[g,f]=(0,i.useState)(null),{team:y}=(0,S.useTeam)(),b=e??g?.name,{data:j}=(0,M.useProject)(b),k=r??j,R=(0,A.useShowIgnoreBuildStep)({project:k,deployment:g}),[w,I]=(0,i.useState)(E.DEFAULT_USE_IGNORE_BUILD_STEP_PROMOTE),T=(0,i.useCallback)(()=>{p(!1)},[]),{error:_,loading:q,promote:V,setError:z,setLoading:U}=F({deployment:g,useIgnoreBuildStep:w,project:k,onCurrentDeploymentPromoted:(0,i.useCallback)(()=>{T(),l?.()},[T,l])}),{user:W}=(0,v.useUser)(),{data:H}=(0,B.useRollingRelease)({teamIdOrSlug:y?.slug,projectSlug:b}),G=k?.rollingRelease?.stages!==void 0&&k.rollingRelease.stages.length>0,Y=H?.rollingRelease?.state==="ACTIVE",J=H?.rollingRelease?.canaryDeployment?.id,K=Y&&J===g?.uid,X=G&&!Y&&g?.target==="production",Q=G&&Y&&g?.target==="production",Z=X&&k.rollingRelease?.stages!==void 0?k.rollingRelease.stages[0]?.targetPercentage:null,{data:ee}=(0,P.useProjectDomains)(b,{limit:11,production:"true",redirects:"false",verified:"true",order:"ASC"}),et=(0,i.useCallback)(e=>{f(e),p(!0)},[]),ei=(0,i.useCallback)(()=>{U(!1),f(null),z(void 0)},[z,U]),{rollbackDescription:er,deploymentIsStale:el}=(0,C.useProjectProductionDeployment)(k?.name),{andMoreDomains:en,remainingDomains:ea}=(0,i.useMemo)(()=>{if(!ee)return{andMoreDomains:!1,remainingDomains:[]};let e=ee.length>2,t=e?ee.slice(2).map(e=>e.name):[];return{andMoreDomains:e,remainingDomains:t}},[ee]),eo=(0,i.useMemo)(()=>{if(!k||!g)return(0,t.jsx)(N.default,{center:!0,style:{marginTop:10},children:(0,t.jsx)(s.LoadingDots,{size:4})});let e=!!(ee&&ee.length>0);return(0,t.jsxs)(t.Fragment,{children:["production"===g.target?(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"16px"},children:"Deployment to promote:"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"16px"},children:"A new deployment will be built using your production environment."}),(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"16px"},children:"Deployment to promote to production:"})]}),(0,t.jsx)("div",{children:(0,t.jsx)(O.DeploymentCardSmall,{deployment:g,isPromote:!0,selectedDeployment:null})}),X?(0,t.jsxs)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:["This will start a new rolling release with initial traffic of"," ",Z,"%."]}):null,Q?(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:"This will queue the deployment for promotion after the current rolling release completes."}):null,X||Q||!e?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:"It will be aliased to the following domains:"}),(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial pl-12",children:ee?.slice(0,2).map(e=>{let{name:i}=e;return(0,t.jsx)("p",{className:"text-copy-14",children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-3 flex-initial",children:[(0,t.jsx)(h.CheckCircleFill,{color:"blue-700",size:20}),(0,t.jsx)("span",{children:i.startsWith("*")?i:(0,t.jsx)(n.Link,{"data-testid":(0,x.tid)("deployments","promote-to-production-overlay","preview-link"),external:!0,href:`https://${i}`,variant:"highlight",children:i})})]})},i)})}),en?(0,t.jsxs)("p",{className:"text-copy-14 mt-6 mb-4",children:["...and ",ea.length," more"]}):null]}),!X&&!e&&(0,t.jsxs)("p",{className:"text-copy-14",style:{marginBottom:"24px",marginTop:"24px"},children:["Warning: Your Project does not have a Production Domain. We recommend you"," ",(0,t.jsx)(n.Link,{href:`/${y?y.slug:W?.username}/${encodeURIComponent(k.name)}/settings/domains`,variant:"highlight",children:"add"})," ","one."]}),k.link&&g.gitSource?(0,t.jsx)(L,{deploymentId:g.id}):null,R?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Spacer,{y:1}),(0,t.jsx)(a.Checkbox,{checked:w,fullWidth:!0,onChange:()=>{I(!w)},children:"Use project's Ignore Build Step"})]}):null,K?(0,t.jsx)(d.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",style:{padding:1},children:(0,t.jsx)("div",{className:"flex flex-col items-start justify-start flex-initial",children:(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"This will complete the rolling release for this deployment."})})})}):null,el?(0,t.jsx)(d.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",style:{padding:1},children:(0,t.jsx)("div",{className:"flex flex-col items-start justify-start flex-initial",children:(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:X?"Completing the Rolling Release will undo the current Instant Rollback":"This action will undo the current Instant Rollback"})})})}):null,er?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:"Rollback Details:"}),(0,t.jsx)(D.RollbackDescriptionCard,{rollbackDescription:er,project:k})]}):null]})},[en,ea,ee,k,y,W,g,w,R,el,er,Z,X,Q,K]),es=(0,i.useMemo)(()=>(0,t.jsx)(c.Modal.Action,{"data-testid":(0,x.tid)("deployments","promote-to-production-overlay","confirm-button"),loading:q,onClick:V,children:g&&"target"in g&&"production"===g.target?"Promote":"Promote to Production"}),[V,q,g]);return{modal:(0,i.useMemo)(()=>(0,t.jsxs)(c.Modal.Modal,{active:u,"data-testid":(0,x.tid)("deployments","promote-to-production-overlay"),onAnimationDone:ei,onClickOutside:T,sticky:!0,width:"500px",children:[(0,t.jsxs)(c.Modal.Body,{children:[(0,t.jsx)($,{title:Q?"Queue for Promotion":g&&"target"in g&&"production"!==g.target?"Promote to Production":"Promote"}),eo,_?(0,t.jsx)(o.Error,{error:_}):null]}),(0,t.jsxs)(c.Modal.Actions,{children:[(0,t.jsx)(c.Modal.Action,{"data-testid":(0,x.tid)("deployments","promote-to-production-overlay","cancel-button"),loading:!1,onClick:T,type:"secondary",children:"Cancel"}),es]})]}),[u,ei,T,eo,_,es,Q,g]),close:T,open:et}},"usePromoteDeployment",0,F,"usePromoteTooltip",0,function(e){let t=e?.name,{deployment:r,isLoading:l}=(0,C.useProjectProductionDeployment)(t);return(0,i.useMemo)(()=>{let t=w(e);return t?l?"Loading…":t.uid===r?.id?"This Deployment is already in Production.":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be promoted.":"prebuilt"in t&&!0===t.prebuilt&&"production"!==t.target?"Prebuilt deployments from non-production environments cannot be promoted.":"":""},[e,l,r?.id])}],6619197)},1947138,e=>{"use strict";var t=e.i(7185353);e.s(["useDebounceState",0,function(e,i){let[r,l]=(0,t.useState)(e),[n,a]=function(e,i){let[r,l]=(0,t.useState)(e);return(0,t.useEffect)(()=>{let t=setTimeout(()=>{l(e)},i);return()=>clearTimeout(t)},[e,l,i]),[r,l]}(r,i);return[n,l,{currentValue:r,setValueImmediate:(0,t.useCallback)(e=>{l(e),a(e)},[l,a])}]}])},935882,e=>{"use strict";let t=e.i(7185353).useLayoutEffect;e.s(["default",0,t])},7401972,e=>{"use strict";var t=e.i(7185353),i=e.i(3924999),r=e.i(8042625),l=e.i(277234),n=e.i(4244280),a=e.i(5338940),o=e.i(935882);e.s(["useProjectDeployedBranches",0,function(e){let s,{project:c,includeProductionBranch:d,query:u,limit:m,active:p,includeDeploymentInfo:h,readyStateFilter:g}=e,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{isReady:f,team:y}=(0,a.useTeam)(),[b,j]=(0,t.useState)(""),v={search:u&&+(s=u)==+s?`"${u}"`:u,active:p?"1":null,teamId:y?.id,includeDeployments:h?"1":null,limit:m,state:g},S=(0,i.default)((e,t)=>{if(!c)return null;if(!e)return f?`${(0,n.API_PROJECTS_VERSION)("v5")}/${c.id}/branches/${(0,r.encode)(v)}`:null;let i=t&&m&&t.branches.length>=m?t.until:null;return i&&f?`${(0,n.API_PROJECTS_VERSION)("v5")}/${c.id}/branches/${(0,r.encode)({...v,until:i})}`:null},e=>(0,l.fetchAPI)(e,{throwOnHTTPError:!0}).then(e=>({...e,query:u})),x),k=c?.link?.productionBranch,N=(0,t.useMemo)(()=>{let e;if(!S.data)return;if(h){let t,i=[];for(let r of S.data)for(let l of(e=r.query,r.branches))k&&l.branch===k?t=l:i.push(l);return{query:e,result:(d&&t?[t,...i]:i).filter(e=>!!e.deployment).sort((e,t)=>t.deployment.createdAt-e.deployment.createdAt)}}let t=new Set;for(let i of S.data)for(let r of(e=i.query,i.branches))t.add(r.branch);return{query:e,result:(k&&t.has(k)&&t.delete(k),d&&k?[k,...t]:[...t])}},[S.data,d,k,h]);(0,o.default)(()=>{N?.query&&j(N.query)},[N?.query,j]);let C=!!S.data,R=C&&N?.result.length===0,P=C&&S.data&&S.size>S.data.length,w=!m||C&&S.data&&S.data[S.data.length-1]?.branches.length<m;return[S,{branches:N?.result,fetchedQuery:b,initialDataLoaded:C,isValidating:S.isValidating,isEmpty:R,loadMore:()=>S.setSize(e=>e+1),isLoadingMore:P,isReachingEnd:w,mutate:S.mutate}]}])}]);

//# debugId=0563a067-d7a2-01da-ae10-0b80b7e7a48d
//# sourceMappingURL=4b06df6bb71f83a1.js.map