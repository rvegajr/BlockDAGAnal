;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="922b2c74-3323-faf9-1623-ece229fd85fa")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6619197,5645345,e=>{"use strict";var t=e.i(847684),i=e.i(7185353),r=e.i(8248823),n=e.i(8238875),a=e.i(57106),o=e.i(3869281),l=e.i(4030453),s=e.i(2455417),c=e.i(6891161),d=e.i(8522580),m=e.i(5255926),u=e.i(9318197),p=e.i(455575),g=e.i(8761240),h=e.i(472117),x=e.i(4004502),y=e.i(8042625),b=e.i(277234),f=e.i(4244280),j=e.i(4443312),v=e.i(5140444),k=e.i(5338940),N=e.i(5757634),P=e.i(4450569),A=e.i(4396019),C=e.i(9375869),S=e.i(8518548);function R(e){if(!e)return;if("id"in e==!1)return e;let{aliasAssigned:t,aliasError:i=null,aliasAssignedAt:r,buildingAt:n,created:a=e.createdAt,createdAt:o,creator:l,name:s,ready:c,readyState:d,readySubstate:m,target:u=null,uid:p=e.id,url:g,isRollbackCandidate:h="production"===e.target,prebuilt:x}=e;return{aliasAssigned:t,aliasError:i,aliasAssignedAt:r,buildingAt:n,created:a,createdAt:o,creator:{email:"",githubLogin:"",...l},name:s,ready:c,readyState:d,readySubstate:m,target:u,prebuilt:x,type:"LAMBDAS",uid:p,url:g,isRollbackCandidate:h}}e.s(["asListDeployment",0,R],5645345);var w=e.i(1840726),I=e.i(930810),D=e.i(7952834),M=e.i(1173672),T=e.i(9745887),L=e.i(3008300),$=e.i(3981247),O=e.i(6060673);function E(e){let{title:i}=e;return(0,t.jsx)(c.Modal.Header,{children:(0,t.jsx)(c.Modal.Title,{center:!0,children:i})})}function B(e){let{deploymentId:i}=e,r=(0,h.useChecksPrivateBetaFlag)(),n=(0,h.useCiChecksAndPoliciesFlagV2)(),o=r||n,{data:l,isLoading:s}=(0,j.useProjectCheckRuns)({deploymentId:i,enableCiChecksAndPolicies:o});if(!o)return null;if(s)return(0,t.jsx)(m.Skeleton,{});if(l?.runs.every(e=>"succeeded"===e.conclusion))return null;let c=l?.runs.filter(e=>"succeeded"!==e.conclusion)||[];return(0,t.jsxs)(d.Note,{type:"error",fill:!0,className:"mt-6",children:["By clicking Promote, you acknowledge that you are bypassing promotion requirements:",c.length>0&&(0,t.jsx)("ul",{className:"flex flex-col gap-1 ml-4 list-disc",children:c.slice(0,5).map(e=>(0,t.jsx)("li",{children:e.externalUrl?(0,t.jsx)(a.Link,{href:e.externalUrl,external:!0,children:e.name}):(0,t.jsx)("span",{children:e.name})},e.id||e.name||`${e.conclusion}-${e.status}`))})]})}let z=e=>{let{deployment:t,project:a,useIgnoreBuildStep:o,onCurrentDeploymentPromoted:l}=e,s=(0,p.useToasts)(),c=(0,n.useRouter)(),{team:d}=(0,k.useTeam)(),{user:m}=(0,v.useUser)(),{mutate:u}=(0,N.useSWRConfig)(),[g,h]=(0,i.useState)(!1),[x,j]=(0,i.useState)(void 0),P=(0,w.useShowIgnoreBuildStep)({project:a,deployment:t});return{promote:(0,i.useCallback)(async()=>{if(t&&a){h(!0),j(void 0);try{let e,i=d?.id,r="Promoted Deployment successfully.";if("production"===t.target)await (0,b.fetchAPI)(`${(0,f.API_DEPLOYMENT_PROMOTE)(a.id,t.uid||t.id)}${(0,y.encode)({teamId:i})}`,{method:"POST",body:{},throwOnHTTPError:!0}),e=(0,C.pathFromDeployment)(t,{user:m,team:d});else{let n=await (0,b.fetchAPI)(`${(0,f.API_DEPLOYMENTS)("v13")}${(0,y.encode)({teamId:i,skipIgnoreBuildStep:P&&!o?"1":null})}`,{method:"POST",body:JSON.stringify({deploymentId:t.uid||t.id,meta:{action:"promote"},name:a.name,target:"production"}),throwOnHTTPError:!0});e=(0,C.pathFromDeployment)(n,{user:m,team:d});let l=t.uid||t.id;r="production"===t.target?l===n.id?"Deployment is already the current Production Deployment.":"Promoted Deployment to Production successfully.":"Created Production Deployment successfully."}d&&((0,D.revalidateProject)(u,a),await u((0,M.getProjectProductionDeploymentKey)({projectIdOrName:a.id,teamId:d.slug}))),s.success({text:r,key:"production-deployment"}),e&&(e===location.pathname?l?.():c.push(e))}catch(e){j((0,r.normalizeError)(e))}finally{h(!1)}}},[t,a,c,P,d,s,o,m,u,l]),loading:g,setLoading:h,error:x,setError:j}};e.s(["default",0,function(e,r){let{onDeploymentPromoted:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},[m,p]=(0,i.useState)(!1),[h,y]=(0,i.useState)(null),{team:b}=(0,k.useTeam)(),f=e??h?.name,{data:j}=(0,O.useProject)(f),N=r??j,C=(0,w.useShowIgnoreBuildStep)({project:N,deployment:h}),[R,D]=(0,i.useState)(L.DEFAULT_USE_IGNORE_BUILD_STEP_PROMOTE),M=(0,i.useCallback)(()=>{p(!1)},[]),{error:F,loading:_,promote:W,setError:U,setLoading:H}=z({deployment:h,useIgnoreBuildStep:R,project:N,onCurrentDeploymentPromoted:(0,i.useCallback)(()=>{M(),n?.()},[M,n])}),{user:Y}=(0,v.useUser)(),{data:G}=(0,$.useRollingRelease)({teamIdOrSlug:b?.slug,projectSlug:f}),V=N?.rollingRelease?.stages!==void 0&&N.rollingRelease.stages.length>0,q=G?.rollingRelease?.state==="ACTIVE",K=G?.rollingRelease?.canaryDeployment?.id,X=q&&K===h?.uid,J=V&&!q&&h?.target==="production",Q=V&&q&&h?.target==="production",Z=J&&N.rollingRelease?.stages!==void 0?N.rollingRelease.stages[0]?.targetPercentage:null,{data:ee}=(0,S.useProjectDomains)(f,{limit:11,production:"true",redirects:"false",verified:"true",order:"ASC"}),et=(0,i.useCallback)(e=>{y(e),p(!0)},[]),ei=(0,i.useCallback)(()=>{H(!1),y(null),U(void 0)},[U,H]),{rollbackDescription:er,deploymentIsStale:en}=(0,A.useProjectProductionDeployment)(N?.name),{andMoreDomains:ea,remainingDomains:eo}=(0,i.useMemo)(()=>{if(!ee)return{andMoreDomains:!1,remainingDomains:[]};let e=ee.length>2,t=e?ee.slice(2).map(e=>e.name):[];return{andMoreDomains:e,remainingDomains:t}},[ee]),el=(0,i.useMemo)(()=>{if(!N||!h)return(0,t.jsx)(P.default,{center:!0,style:{marginTop:10},children:(0,t.jsx)(s.LoadingDots,{size:4})});let e=!!(ee&&ee.length>0);return(0,t.jsxs)(t.Fragment,{children:["production"===h.target?(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"16px"},children:"Deployment to promote:"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"16px"},children:"A new deployment will be built using your production environment."}),(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"16px"},children:"Deployment to promote to production:"})]}),(0,t.jsx)("div",{children:(0,t.jsx)(T.DeploymentCardSmall,{deployment:h,isPromote:!0,selectedDeployment:null})}),J?(0,t.jsxs)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:["This will start a new rolling release with initial traffic of"," ",Z,"%."]}):null,Q?(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:"This will queue the deployment for promotion after the current rolling release completes."}):null,J||Q||!e?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:"It will be aliased to the following domains:"}),(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial pl-12",children:ee?.slice(0,2).map(e=>{let{name:i}=e;return(0,t.jsx)("p",{className:"text-copy-14",children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-3 flex-initial",children:[(0,t.jsx)(g.CheckCircleFill,{color:"blue-700",size:20}),(0,t.jsx)("span",{children:i.startsWith("*")?i:(0,t.jsx)(a.Link,{"data-testid":(0,x.tid)("deployments","promote-to-production-overlay","preview-link"),external:!0,href:`https://${i}`,variant:"highlight",children:i})})]})},i)})}),ea?(0,t.jsxs)("p",{className:"text-copy-14 mt-6 mb-4",children:["...and ",eo.length," more"]}):null]}),!J&&!e&&(0,t.jsxs)("p",{className:"text-copy-14",style:{marginBottom:"24px",marginTop:"24px"},children:["Warning: Your Project does not have a Production Domain. We recommend you"," ",(0,t.jsx)(a.Link,{href:`/${b?b.slug:Y?.username}/${encodeURIComponent(N.name)}/settings/domains`,variant:"highlight",children:"add"})," ","one."]}),N.link&&h.gitSource?(0,t.jsx)(B,{deploymentId:h.id}):null,C?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Spacer,{y:1}),(0,t.jsx)(o.Checkbox,{checked:R,fullWidth:!0,onChange:()=>{D(!R)},children:"Use project's Ignore Build Step"})]}):null,X?(0,t.jsx)(d.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",style:{padding:1},children:(0,t.jsx)("div",{className:"flex flex-col items-start justify-start flex-initial",children:(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"This will complete the rolling release for this deployment."})})})}):null,en?(0,t.jsx)(d.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",style:{padding:1},children:(0,t.jsx)("div",{className:"flex flex-col items-start justify-start flex-initial",children:(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:J?"Completing the Rolling Release will undo the current Instant Rollback":"This action will undo the current Instant Rollback"})})})}):null,er?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:16,marginTop:24},children:"Rollback Details:"}),(0,t.jsx)(I.RollbackDescriptionCard,{rollbackDescription:er,project:N})]}):null]})},[ea,eo,ee,N,b,Y,h,R,C,en,er,Z,J,Q,X]),es=(0,i.useMemo)(()=>(0,t.jsx)(c.Modal.Action,{"data-testid":(0,x.tid)("deployments","promote-to-production-overlay","confirm-button"),loading:_,onClick:W,children:h&&"target"in h&&"production"===h.target?"Promote":"Promote to Production"}),[W,_,h]);return{modal:(0,i.useMemo)(()=>(0,t.jsxs)(c.Modal.Modal,{active:m,"data-testid":(0,x.tid)("deployments","promote-to-production-overlay"),onAnimationDone:ei,onClickOutside:M,sticky:!0,width:"500px",children:[(0,t.jsxs)(c.Modal.Body,{children:[(0,t.jsx)(E,{title:Q?"Queue for Promotion":h&&"target"in h&&"production"!==h.target?"Promote to Production":"Promote"}),el,F?(0,t.jsx)(l.Error,{error:F}):null]}),(0,t.jsxs)(c.Modal.Actions,{children:[(0,t.jsx)(c.Modal.Action,{"data-testid":(0,x.tid)("deployments","promote-to-production-overlay","cancel-button"),loading:!1,onClick:M,type:"secondary",children:"Cancel"}),es]})]}),[m,ei,M,el,F,es,Q,h]),close:M,open:et}},"usePromoteDeployment",0,z,"usePromoteTooltip",0,function(e){let t=e?.name,{deployment:r,isLoading:n}=(0,A.useProjectProductionDeployment)(t);return(0,i.useMemo)(()=>{let t=R(e);return t?n?"Loading…":t.uid===r?.id?"This Deployment is already in Production.":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be promoted.":"prebuilt"in t&&!0===t.prebuilt&&"production"!==t.target?"Prebuilt deployments from non-production environments cannot be promoted.":"":""},[e,n,r?.id])}],6619197)},3981247,e=>{"use strict";var t=e.i(7909933),i=e.i(2547843);function r(e,r){let{teamIdOrSlug:n,projectSlug:a}=e,o=!n||!a,l=(0,t.default)(()=>o?null:(0,i.getRollingReleaseEndpoint)(n,a),i.rollingReleaseFetcher,r);return{...l,skipped:o,isLoading:!o&&l.isLoading}}e.s(["useRollingRelease",0,r,"useSuspenseRollingRelease",0,function(e){let{teamIdOrSlug:t,projectSlug:i}=e;return r({teamIdOrSlug:t,projectSlug:i},{suspense:!0,revalidateOnMount:!1})}])},3930829,e=>{"use strict";var t=e.i(7185353),i=e.i(3924999),r=e.i(2919890),n=e.i(7316497),a=e.i(5260505),o=e.i(8765922),l=e.i(1194788);e.s(["useIsomorphicSWRInfinite",0,function(e,s,c){let{isServer:d,config:m,fetcher:u,fallbackSource:p}=(0,r.useIsomorphicSwrContext)(!0),g=(0,t.useMemo)(()=>"function"==typeof s?(e,t)=>s(e,t):(e,t)=>t(e),[s]),h=(0,t.useMemo)(()=>e=>{if(d)throw Error("useSWR: swrFetcher is not available on server");return g(e,u)},[d,g,u]),x="object"==typeof s?s:c,{ssr:y,...b}=x??{},f=(0,n.mergeConfig)(m,x),j=e(0,null),v=p(j??null,g,f,!1),{data:k,isLoading:N,error:P}=(0,a.useAsyncValue)(d,v),A=(0,i.default)((t,i)=>{let r=e(t,i);return N&&!d?null:r},h,{...b,suspense:!1,fallback:{[(0,i.unstable_serialize)(e)]:k?[k]:void 0},revalidateOnMount:!d&&(b.revalidateOnMount??(!k&&!N))}),{mutate:C,data:S,isLoading:R}=A,w=(0,t.useMemo)(()=>(0,o.withThrottle)(j,()=>{(0,l.debug)(`Client fallback data fetch for ${j}`),C()},2e3),[j,C]);return(0,t.useEffect)(()=>{!P||R||S||w()},[P,w,S,R]),{...A,isLoading:A.isLoading&&void 0===A.data||N||d}}])},5771992,e=>{"use strict";var t=e.i(7185353),i=e.i(7909933),r=e.i(8042625),n=e.i(277234),a=e.i(4244280),o=e.i(5338940),l=e.i(1360174),s=e.i(5140444),c=e.i(8238875),d=e.i(3930829),m=e.i(588428),u=e.i(4670733),p=e.i(2259673),g=e.i(7783521);e.s(["default",0,function(e){let{limit:t,projectId:l,project:s,from:c,target:d,users:m=[],...u}=e,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"v6",{isReady:h,team:x}=(0,o.useTeam)(),y=m.length>0?m.map(e=>e.uid).join(","):null,b=!!l||!!s?.id;return(0,i.default)(h&&b&&t>0?`${(0,a.API_DEPLOYMENTS)(g)}${(0,r.encode)({projectId:l||s?.id,limit:t,from:c||null,teamId:x?.id,target:d,users:y,...u})}`:null,e=>(0,n.fetchAPI)(e,{throwOnHTTPError:!0}),p)},"useDeploymentsInfinite",0,function(e){var i;let n,{limit:h,project:x,projectId:y,requireProject:b,users:f,target:j,readyStateFilter:v,meta:k,rollbackCandidate:N,since:P,until:A,subscribeToUpdates:C,branch:S,sha:R,ignoreProjectSlug:w,projectIds:I}=e,{refreshInterval:D,...M}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"v6",{isReady:L,team:$}=(0,o.useTeam)(),{user:O}=(0,s.useUser)(),[E,B]=(0,t.useState)(()=>D),z=f&&f.length>0?f.map(e=>e.uid).join(","):null,F=x?.id||y,{value:_}=(0,u.useInstantRollbackHobbyRestrictionFlag)(),{value:W}=(0,m.useInstantRollbackHobbyRestrictionTeamFlag)(),{teamSlug:U,project:H}=(0,c.useParams)()??{},Y={projectId:F,limit:h,teamId:$?.id,target:j||null,users:z,state:v,meta:k,rollbackCandidate:N,since:P,until:A,branch:S,sha:R,projectIds:I},G=b||(_||W)&&void 0!==N&&(!$||$.billing?.plan==="hobby"),V=(0,d.useIsomorphicSWRInfinite)((e,t)=>{if(U&&H&&!w){if(!e)return`${(0,a.API_DEPLOYMENTS)(T)}${(0,r.encode)({...Y,teamId:U,projectId:H})}`;let i=t&&t.deployments.length>=h?t.deployments[t.deployments.length-1].created-1:null;return i?`${(0,a.API_DEPLOYMENTS)(T)}${(0,r.encode)({...Y,teamId:U,projectId:H,from:i})}`:null}if(G&&!F)return null;if(!e)return L?`${(0,a.API_DEPLOYMENTS)(T)}${(0,r.encode)(Y)}`:null;let i=t&&t.deployments.length>=h?t.deployments[t.deployments.length-1].created-1:null;return i&&L?`${(0,a.API_DEPLOYMENTS)(T)}${(0,r.encode)({...Y,from:i})}`:null},{...M,refreshInterval:E,ssr:{timeout:1e3}}),{mutate:q}=V,K=(0,t.useMemo)(()=>(0,l.default)(()=>{q()},100),[q]),{isListening:X}=(n=(i=C?x:void 0)?`${i.accountId}-${i.id}`:void 0,(0,p.usePusherEvent)("deployments",n,"deployment-created",K));X||D===E?X&&3e4!==E&&B(3e4):B(D);let J=(0,t.useMemo)(()=>V.data?V.data.flatMap(e=>e.deployments):[],[V.data]),Q=$?$.id:O?.uid,Z=(0,t.useMemo)(()=>C&&Q?J.map(e=>({id:e.uid,readyState:e.readyState,aliasAssigned:!!e.aliasAssigned,ownerId:Q})):[],[J,C,Q]);(0,g.useDeploymentsStatusPing)(Z,K);let ee=!!V.data,et=ee&&0===J.length,ei=ee&&V.data&&V.size>V.data.length,er=ee&&V.data&&V.data[V.data.length-1]?.deployments.length<h;return[V,{deployments:J,initialDataLoaded:ee,isEmpty:et,loadMore:()=>V.setSize(e=>e+1),isLoadingMore:ei,isReachingEnd:er,mutate:V.mutate}]}],5771992)},415061,e=>{"use strict";var t=e.i(847684);e.s(["default",0,function(e){let{width:i=24,height:r=24,style:n}=e;return(0,t.jsxs)("svg",{fill:"none",height:r,style:{border:"1px solid var(--accents-2)",borderRadius:"100%",boxSizing:"border-box",...n},viewBox:"0 0 24 24",width:i,children:[(0,t.jsx)("path",{clipRule:"evenodd",d:"M12 24c6.627 0 12-5.373 12-12S18.627 0 12 0 0 5.373 0 12s5.373 12 12 12z",fill:"#000",fillRule:"evenodd"}),(0,t.jsx)("path",{clipRule:"evenodd",d:"M12.24 6.24L18 16.378H6.48L12.24 6.24z",fill:"#fff",fillRule:"evenodd"})]})}])},8651268,e=>{"use strict";var t=e.i(847684),i=e.i(415061),r=e.i(4585051),n=e.i(76079),a=e.i(3025777),o=e.i(3896588),l=e.i(6683690);let s={12:-6},c={12:-5};function d(e){let t,{principalId:i,principal:r,viaIds:n,via:a,viewerId:o,includeVia:l}=e;if(r)switch(r.type){case"app":case"integration":t=r.name;break;case"system":t="System";break;default:if(r.uid===o){t="You";break}t=r.username}if(i&&i===o&&(t="You"),t&&l){let e=m({viaIds:n,via:a,viewerId:o});e&&(t+=`via ${e}`)}return t}function m(e){let{viaIds:t,via:i,viewerId:r}=e;if(t&&t.length>0)return d({principalId:t[0],principal:i?.[0],viewerId:r})}e.s(["PrincipalAvatar",0,function e(d){var m,u,p,g,h,x,y;let b,f,j,v,k,{title:N,principalId:P,principal:A,viaIds:C,via:S,size:R=32,style:w,entities:I,deploymentMeta:D,viewerId:M,iconBackground:T,...L}=d,$=!1,O=L.iconSize??(0==(b=(m=R/2.2)%2)?m:m+2-b);I?.forEach(e=>{"system"===e.type?$=!0:"github_login"===e.type?f=e:"gitlab_login"===e.type?j=e:"bitbucket_login"===e.type&&(v=e)}),D&&(D.githubCommitAuthorLogin?f={login:D.githubCommitAuthorLogin}:D.gitlabCommitAuthorLogin?j={login:D.gitlabCommitAuthorLogin,avatar:D.gitlabCommitAuthorAvatar}:D.bitbucketCommitAuthorName&&(v={login:D.bitbucketCommitAuthorName,avatar:D.bitbucketCommitAuthorAvatar}));let E="object"==typeof L.showProviderIcon?L.showProviderIcon:{github:L.showProviderIcon,gitlab:L.showProviderIcon,bitbucket:L.showProviderIcon};if(u=P,p=A,p?.type==="app"||u.startsWith("cl_")||(g=P,h=A,h?.type==="integration"||g.startsWith("oac_"))){let e=A&&"name"in A?A.name:void 0;return(0,t.jsx)(r.Avatar,{hash:A?.avatar,size:R,style:w,title:N??(e?`${e} Avatar`:void 0),uid:P})}if($||(x=P,y=A,y?.type==="system"||"system"===x))return(0,t.jsx)(i.default,{height:R,style:{marginTop:"2px",...w??{}},width:R});let B=N;P===M?(k="You",B??="Your Avatar"):A&&"username"in A&&(k=A.username,B??=`${k} Avatar`);let z=function(e,t){let i=e?.[0],r=t?.[0];if(!i){if(!r)return;switch(r.type){case"app":i=r.clientId;break;case"integration":i=r.id;break;case"system":i="system";break;default:i=r.uid}}return[i,r]}(C,S);return z?(0,t.jsx)(n.AvatarWithIcon,{hash:A?.avatar,size:R,style:w,title:B,uid:P,iconBackground:T,left:c[O],icon:(0,t.jsx)(e,{principalId:z[0],principal:z[1],size:O+4})}):f?.login?(0,t.jsx)(a.GitHubAvatar,{iconBackground:T,size:R,iconSize:O,left:s[O],bottom:s[O],style:w,title:N??`github/${f.login}`,username:f.login,showIcon:E.github}):j?.login?(0,t.jsx)(o.GitLabAvatar,{hash:j.avatar?void 0:A?.avatar,iconBackground:T,size:R,iconSize:O,style:w,title:N,url:j.avatar,showIcon:E.gitlab}):v?.login?(0,t.jsx)(l.BitbucketAvatar,{hash:v.avatar?void 0:A?.avatar,iconBackground:T,size:R,iconSize:O,style:w,title:N,url:v.avatar,showIcon:E.bitbucket}):(0,t.jsx)(r.Avatar,{hash:A?.avatar,size:R,style:w,title:B,uid:P})},"getPrincipalName",0,d,"getViaName",0,m])},2982888,e=>{"use strict";var t=e.i(847684),i=e.i(4585051),r=e.i(415061),n=e.i(8651268);function a(e){let{deployment:r,showIcon:a,iconBackground:o,size:l}=e;return r?(0,t.jsx)(n.PrincipalAvatar,{size:l,principalId:r.creator.uid,principal:{type:"user",uid:r.creator.uid,username:r.creator.username},deploymentMeta:r.meta?.originalDeploymentId?void 0:r.meta,showProviderIcon:a,iconBackground:o}):(0,t.jsx)(i.Avatar,{placeholder:!0,size:l})}e.s(["DeployHookAvatar",0,function(e){let{height:i,width:n}=e;return(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)(r.default,{height:i,width:n})})},"DeploymentCreatorAvatar",0,function(e){let{deployment:i,size:r=24,showIcon:n=!0,iconBackground:o=!0}=e;return(0,t.jsx)("span",{style:{display:"inline-block"},children:(0,t.jsx)(a,{deployment:i,iconBackground:o,showIcon:n,size:r})})},"getDeploymentCreatorUsername",0,function(e){let{deployment:t}=e;if(!t)return null;if(!t.meta?.originalDeploymentId){if(t.meta?.githubDeployment&&"string"==typeof t.meta.githubCommitAuthorLogin)return t.meta.githubCommitAuthorLogin;if(t.meta?.gitlabDeployment&&"string"==typeof t.meta.gitlabCommitAuthorLogin)return t.meta.gitlabCommitAuthorLogin;if(t.meta?.bitbucketDeployment){if("string"==typeof t.meta.bitbucketCommitAuthorLogin)return t.meta.bitbucketCommitAuthorLogin;if("string"==typeof t.meta.bitbucketCommitAuthorName)return t.meta.bitbucketCommitAuthorName}}return t.creator?.username||null}])},4443312,e=>{"use strict";var t=e.i(4603164),i=e.i(5338940);e.s(["CHECK_RUNS_REFRESH_INTERVAL",0,3e3,"useProjectCheckRuns",0,function(e){let{deploymentId:r,swrOptions:n,enableCiChecksAndPolicies:a}=e,{team:o}=(0,i.useTeam)();return(0,t.useTypedSWR)("/v2/deployments/{deploymentId}/check-runs",a&&r&&o?.id?{deploymentId:r,teamId:o.id}:null,{refreshInterval:3e3,...n})}])},8529990,e=>{"use strict";let t=encodeURIComponent;function i(e){return"string"==typeof e?e:void 0}e.s(["getGitInfoFromDeployment",0,function(e){if(!e)return null;let{meta:r}=e;if(r?.githubDeployment){let e=`https://github.com/${t(r.githubCommitOrg??"")}/${t(r.githubCommitRepo??"")}/commit/${r.githubCommitSha}`,n=`https://github.com/${t(r.githubCommitOrg??"")}/${t(r.githubCommitRepo??"")}/tree/${t(r.githubCommitRef??"")}`,a=r.githubPrId?`https://github.com/${t(r.githubOrg??"")}/${t(r.githubRepo??"")}/pull/${r.githubPrId}`:void 0;return{type:"github",commitRef:String(r.githubCommitRef),commitSha:String(r.githubCommitSha),commitAuthorName:String(r.githubCommitAuthorName),commitAuthorLogin:i(r.githubCommitAuthorLogin),commitMessage:String(r.githubCommitMessage),repoName:String(r.githubCommitRepo),repoNamespace:String(r.githubCommitOrg),orgNamespace:String(r.githubOrg),commitUrl:e,refUrl:n,viaFork:r.githubOrg!==r.githubCommitOrg,prId:r.githubPrId?Number(r.githubPrId):void 0,prUrl:a,gitDirty:String(r.gitDirty),isPublic:"public"===r.githubRepoVisibility}}if(r?.gitlabDeployment){let e=`https://gitlab.com/${r.gitlabProjectPath}/tree/${t(r.gitlabCommitRef??"")}`,n=`https://gitlab.com/${r.gitlabProjectPath}/commit/${r.gitlabCommitSha}`;return{type:"gitlab",commitRef:String(r.gitlabCommitRef),commitSha:String(r.gitlabCommitSha),commitAuthorName:String(r.gitlabCommitAuthorName),commitAuthorLogin:i(r.gitlabCommitAuthorLogin),commitMessage:String(r.gitlabCommitMessage||r.gitCommitMessage),repoName:String(r.gitlabProjectName),repoNamespace:String(r.gitlabProjectNamespace),orgNamespace:String(r.gitlabProjectNamespace),commitUrl:n,refUrl:e,isPublic:"public"===r.gitlabProjectVisibility}}if(r?.bitbucketDeployment){let e=`https://bitbucket.org/${r.bitbucketRepoOwner}/${r.bitbucketRepoSlug}/branch/${t(r.bitbucketCommitRef??"")}`,n=`https://bitbucket.org/${r.bitbucketRepoOwner}/${r.bitbucketRepoSlug}/commits/${r.bitbucketCommitSha}`;return{type:"bitbucket",commitRef:String(r.bitbucketCommitRef),commitSha:String(r.bitbucketCommitSha),commitAuthorName:i(r.bitbucketCommitAuthorName),commitAuthorLogin:i(r.bitbucketCommitAuthorLogin),commitMessage:String(r.bitbucketCommitMessage),repoName:String(r.bitbucketRepoSlug),repoNamespace:String(r.bitbucketRepoOwner),orgNamespace:String(r.bitbucketRepoOwner),commitUrl:n,refUrl:e,isPublic:"public"===r.bitbucketRepoVisibility}}return null}])},3907048,e=>{"use strict";var t=e.i(847684),i=e.i(4585051),r=e.i(7185353),n=e.i(2982888),a=e.i(8651268);let o=(0,r.memo)(e=>{let{deployment:r,size:o=24,showProviderIcon:l=!1}=e;return r.meta?.deployHookId?(0,t.jsx)(n.DeployHookAvatar,{height:o,width:o}):r.creator?.uid?(0,t.jsx)(a.PrincipalAvatar,{size:o,principalId:r.creator.uid,principal:{type:"user",uid:r.creator.uid,username:r.creator.username},deploymentMeta:r.meta?.originalDeploymentId?void 0:r.meta,showProviderIcon:{github:!1,gitlab:l,bitbucket:l}}):(0,t.jsx)(i.Avatar,{size:o})});o.displayName="CreatorAvatar",e.s(["CreatorAvatar",0,o])},8227242,e=>{"use strict";var t=e.i(847684);e.i(9623499);var i=e.i(5576066);e.s(["LinkParser",0,function(e){let r,{text:n}=e;return(0,t.jsx)("span",{children:(r=/(?<temp1>https?:\/\/[^\s]+)/g,n.split(r).map(e=>r.test(e)?(0,t.jsx)(i.Link,{className:"break-all font-normal",href:e,rel:"noopener noreferrer",target:"_blank",type:"blend",children:e},e):(0,t.jsx)("span",{children:e},e)))})}])},930810,9745887,e=>{"use strict";var t=e.i(847684),i=e.i(2504781),r=e.i(9334091),n=e.i(3306538),a=e.i(57106),o=e.i(3753138),l=e.i(6226725),s=e.i(4345845),c=e.i(8893913),d=e.i(7218483),m=e.i(9722978),u=e.i(9375869),p=e.i(8529990),g=e.i(3907048);function h(e){let{isForm:i,children:r,className:n}=e;return i?(0,t.jsx)("label",{className:n,children:r}):(0,t.jsx)("div",{className:n,children:r})}function x(e){let{deployment:i,isForm:r,isPromote:x,isPreviousDeployment:y,isProductionDeployment:b,isRolledBackDeployment:f,selectedDeployment:j,setSelectedDeployment:v,ariaLabel:k="Rollback Deployment"}=e,N=(0,d.useAgo)(i.createdAt||0),P="number"==typeof i.aliasAssigned?i.aliasAssigned:0,A=P>0,C=(0,d.useAgo)(P),S=(0,u.useDeploymentLink)(i),R=(0,p.getGitInfoFromDeployment)(i),w=b||y||f;y&&f&&(y=!1);let I="Preview";if("target"in i)switch(i.target){case"staging":I="Staging";break;case"production":I="Production";break;default:I="Preview"}else I="Production";let D="uid"in i?i.uid:i.id,M=null;x?R?.commitRef&&(M=(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-0.5 flex-initial",children:[(0,t.jsx)(s.GitBranch,{color:"gray-900"}),(0,t.jsx)("span",{className:"text-copy-14-mono text-gray-900 truncate whitespace-nowrap",style:{marginRight:"4px",maxWidth:120,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0},title:R.commitRef,children:R.commitRef}),(0,t.jsxs)("span",{className:"text-copy-14 text-gray-900 truncate whitespace-nowrap flex items-center gap-1",style:{flexBasis:"50%",flexShrink:0,flexGrow:1,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0,maxWidth:260},children:["Staged"," ",N," by"," ",(0,t.jsx)("span",{children:(0,t.jsx)(g.CreatorAvatar,{deployment:i,showProviderIcon:!0,size:24})}),(0,t.jsx)("span",{children:!i.meta?.originalDeploymentId&&i.creator?.username?i.creator.username:R.commitAuthorLogin})]})]})):M=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"inline-flex flex-row items-center",children:[(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",style:{marginRight:"4px"},children:I}),R?.commitRef?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.GitBranch,{color:"gray-900",size:14}),(0,t.jsx)("span",{className:"text-copy-14-mono max-w-[100px] truncate whitespace-nowrap px-1 text-center text-sm leading-5 text-gray-900",title:R.commitRef,children:R.commitRef}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"by"}),(0,t.jsxs)("div",{className:"ml-1 inline-flex flex-row items-center gap-1",children:[(0,t.jsx)(g.CreatorAvatar,{deployment:i,size:20}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900 truncate max-w-[140px]",children:!i.meta?.originalDeploymentId&&i.creator?.username?`${i.creator.username}`:R.commitAuthorLogin})]})]}):null]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"Deployed "}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:N}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:", "}),A?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"promoted "}),(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:C})]}):(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:"never promoted"})]})]});let T=null;return r||(T=x?(0,t.jsx)(o.ArrowCircleUp,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):b?(0,t.jsx)(l.CrossCircle,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):(0,t.jsx)(c.RotateCounterClockwise,{className:"mr-4 hidden self-center sm:block",color:"gray-1000",style:{flexShrink:0}})),(0,t.jsxs)(h,{className:(0,m.clsx)("flex w-full items-end justify-start px-4 py-3","rounded border border-solid border-[var(--accents-2)]","rounded-b-none","last:rounded-b","[&+&]:rounded-t-none [&+&]:border-t-0",{"bg-[var(--accents-1)] shadow-none":b,"bg-[var(--geist-background)]":!b}),isForm:r,children:[r?(0,t.jsx)("input",{"aria-label":k,checked:j?.uid===D,className:`
            relative m-0 mr-4 size-4 shrink-0 appearance-none
            self-center rounded-[1000px] border
            border-solid border-[var(--geist-foreground)] after:absolute after:inset-[3px]
            after:rounded-[1000px] after:bg-[var(--geist-foreground)]
            after:content-none checked:after:content-['']
          `,name:"rollbackDeployment",onChange:()=>{"uid"in i&&"type"in i&&v&&v(i)},type:"radio",value:D}):T,(0,t.jsxs)("div",{style:{width:w?"initial":"100%",minWidth:0},children:[(0,t.jsx)(a.Link,{className:"flex w-[calc(100%-1ch)] items-center gap-0.5 break-all text-sm font-bold leading-5",href:S,target:"_blank",children:(0,t.jsx)("span",{className:"text-[14px] leading-[20px] font-medium line-clamp-1",title:i.url,children:i.url})}),R?.commitMessage?(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900 line-clamp-1 break-words",title:R.commitMessage,children:[R.commitSha.substring(0,7)," ",R.commitMessage]}):null,M]}),b?(0,t.jsx)(n.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"inverted",children:"Current"}):null,y?(0,t.jsx)(n.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"gray-subtle",children:"Previous"}):null,f?(0,t.jsx)(n.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"red-subtle",children:"Rolled back"}):null]})}e.s(["DeploymentCardSmall",0,x],9745887);var y=e.i(8227242),b=e.i(8651268);e.s(["ChooseDeploymentList",0,function(e){let{deployments:r,previousDeployment:n,rolledBackDeploymentId:a,productionDeployment:o,selectedDeployment:l,setSelectedDeployment:s,swr:c,ariaLabel:d}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:r.map(e=>o.id!==e.uid&&(0,t.jsx)(x,{deployment:e,isForm:!0,isPreviousDeployment:n?.uid===e.uid,isRolledBackDeployment:a===e.uid,selectedDeployment:l,setSelectedDeployment:s,ariaLabel:d},e.uid))}),!c.isReachingEnd&&(0,t.jsx)(i.Button,{loading:c.isLoadingMore,onClick:()=>{c.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})]})},"REASON_MAX_CHARACTER_LENGTH",0,250,"RollbackDescriptionCard",0,function(e){let{rollbackDescription:i,project:r,preview:n}=e,a=(0,d.useAgo)(i.createdAt);return(0,t.jsxs)("div",{className:"px-4 py-3 rounded bg-background-200 shadow-border",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-900 break-words",children:i.description.length>0?(0,t.jsxs)(t.Fragment,{children:["“",(0,t.jsx)(y.LinkParser,{text:i.description}),"”"]}):(0,t.jsx)("span",{className:"text-copy-14",children:"No reason provided."})}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[n?null:(0,t.jsx)("p",{className:"text-copy-14",children:"Rolled back by"}),i.username?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.PrincipalAvatar,{size:20,principalId:i.userId,principal:{type:"user",uid:i.userId,username:i.username}}),(0,t.jsx)("p",{className:"text-copy-14",children:i.username}),r?.lastAliasRequest!==void 0&&!n&&(0,t.jsx)("p",{className:"text-copy-14",children:a})]}):null]})]})},"RollbackDescriptionTextarea",0,function(e){let{value:i,onChange:n,id:a}=e;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(r.Textarea,{autoFocus:!0,className:"text-base min-h-24",error:i.length>=250?"Reason cannot be longer than 250 characters.":void 0,id:a,onChange:e=>n(e.target.value),placeholder:"Production is not behaving as expected…",required:!0,value:i,style:{fontSize:14}})})},"getDeploymentId",0,function(e){return"id"in e?e.id:"uid"in e?e.uid:void 0},"getMostRecentlyPromotedDeployment",0,function(e){if(0===e.length)return;let t=e.reduce((e,t)=>e.aliasAssigned&&t.aliasAssigned?e.aliasAssigned>t.aliasAssigned?e:t:t.aliasAssigned?t:e);if(t.aliasAssigned)return t},"isDeleted",0,function(e){return void 0!==e.deleted}],930810)}]);

//# debugId=922b2c74-3323-faf9-1623-ece229fd85fa
//# sourceMappingURL=38be371c2303f66e.js.map