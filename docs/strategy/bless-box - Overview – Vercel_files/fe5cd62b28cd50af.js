;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="24853ec0-7281-2a0d-d182-094ba51ff31b")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,8256306,e=>{"use strict";let t=(0,e.i(9334638).withNewIcon)('<path fill-rule="evenodd" clip-rule="evenodd" d="M5.5 2.5V1.75H4V2.5V13.5V14.25H5.5V13.5V2.5ZM12 2.5V1.75H10.5V2.5V13.5V14.25H12V13.5V2.5Z" fill="currentColor"/>');e.s(["Pause",0,t])},3800789,3180667,e=>{"use strict";var t=e.i(847684),r=e.i(7185353),i=e.i(5757634),s=e.i(3500331),a=e.i(6891161),n=e.i(8522580),l=e.i(277234),o=e.i(134877),d=e.i(2504781),c=e.i(8735244);e.i(6887680);var u=e.i(6463786),x=e.i(5779481),m=e.i(6311495),h=e.i(6060673),p=e.i(6625227),j=e.i(2720056),g=e.i(57106),f=e.i(5129431);function y(e){let{resource:t,rotatedAtJitter:i}=e,{data:s}=(0,x.useResourceItem)({resourceId:t?.id??null,skipMetadata:!0,refreshInterval:5e3}),{secretRotationRequestedAt:a,secretRotationCompletedAt:n}=s?.store??{},l=n&&n>=(i??0)&&n>=(a??0)||!1,{data:o,isLoading:d}=(0,u.useResourceConnectedProjects)(l?t:null,{revalidateOnFocus:!0,refreshInterval:5e3}),c=(0,r.useMemo)(()=>o?.connections&&n?o.connections.filter(e=>!!e.productionDeployment&&e.productionDeployment.createdAt<n):[],[o?.connections,n]);return d?{isLoading:!0}:{isLoading:!1,isComplete:l&&0===c.length,isRotationDone:l,needRedeploy:c}}function b(e){let{resource:r,rotatedAtJitter:i}=e,s=(0,m.useTeamSlug)(),{isLoading:a,isRotationDone:n,needRedeploy:l}=y({resource:r,rotatedAtJitter:i});return!n||a?(0,t.jsxs)("div",{className:"mt-2 text-yellow-900 flex items-center gap-2",children:[(0,t.jsx)(c.Spinner,{size:16})," Rotating secrets, please wait..."]}):0===l.length?null:(0,t.jsxs)("div",{className:"mt-2 text-yellow-900",children:[(0,t.jsx)("strong",{children:"Be advised:"})," the following projects should be redeployed to use the new secrets:",(0,t.jsx)("ul",{children:l.map(e=>(0,t.jsx)("li",{className:"p-2",children:(0,t.jsx)(v,{teamSlug:s,projectId:e.project.id,deploymentId:e.productionDeployment?.id||""})},e.id))})]})}function v(e){let{teamSlug:r,projectId:i,deploymentId:s}=e,{data:a}=(0,h.useProject)(i),{data:n}=(0,p.default)(s),{modal:l,open:o}=(0,f.default)(a);return a&&n?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(j.ProjectAvatar,{teamId:r||void 0,project:{id:a.id,name:a.name},size:16}),(0,t.jsx)(g.Link,{type:"underline",href:`/${r}/${a.name}/deployments`,children:a.name}),(0,t.jsx)(d.Button,{size:"small",type:"secondary",onClick:()=>{o(n)},children:"Redeploy"}),l]}):null}function T(e){let{resource:r,children:i,actions:s,error:l}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.Modal.Body,{children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)(a.Modal.Title,{children:"Rotate Secrets"}),(0,t.jsxs)(a.Modal.Subtitle,{children:["Rotate secrets for ",r.name]}),(0,t.jsxs)(a.Modal.Inset,{last:!0,children:[l?(0,t.jsx)(n.Note,{type:"error",className:"mb-2",children:l}):null,i]})]})}),(0,t.jsx)(a.Modal.Actions,{children:s})]})}function C(e){let{resource:i,executing:l,onConfirm:o,onCancel:d,error:c}=e,u=i.capabilities?.secretRotation?i.capabilities.secretRotation.maxDelayHours:0,[x,m]=(0,r.useState)(Math.min(1,u)),[h,p]=(0,r.useState)(""),[j,g]=(0,r.useState)(""),f=j===i.name&&!!h.trim()&&x>=0&&x<=u;return(0,t.jsx)("form",{onSubmit:e=>{e.preventDefault(),o({delayOldSecretsExpirationHours:x,reason:h})},children:(0,t.jsx)(T,{error:c,resource:i,actions:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.Modal.Action,{disabled:l,onClick:d,type:"secondary",children:"Cancel"}),(0,t.jsx)(a.Modal.Action,{buttonType:"submit",disabled:!f||l,loading:l,type:"error",children:"Rotate Secrets"})]}),children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[0===u?(0,t.jsx)(n.Note,{type:"warning",children:"The old secrets will expire immediately upon rotation. Running projects may be unable to connect to this resource until they are redeployed to pick up the new values."}):(0,t.jsxs)("label",{htmlFor:"delayOldSecretsExpirationHours",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-1000",children:"Delay expiration of old secrets"}),(0,t.jsx)(s.Input,{id:"delayOldSecretsExpirationHours","aria-label":"Delay Old Secrets Expiration Hours",disabled:l,typeName:"number",suffix:"hours",value:String(x),min:0,max:u,onChange:e=>m(e.target.valueAsNumber)})]}),0===x?(0,t.jsx)(n.Note,{type:"warning",className:"mt-2",children:"The old secrets will expire immediately upon rotation. Running projects may be unable to connect to this resource until they are redeployed to pick up the new values."}):null]}),(0,t.jsx)("label",{htmlFor:"rotateReason",children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-1000",children:"Rotation reason"}),(0,t.jsx)(s.Input,{id:"rotateReason","aria-label":"Rotation Reason",disabled:l,typeName:"text",value:h,onChange:e=>p(e.target.value)})]})}),(0,t.jsx)("label",{htmlFor:"resourceNameConfirmation",children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("p",{className:"text-copy-14 text-gray-1000",children:["To confirm, type “",(0,t.jsx)("b",{style:{overflowWrap:"anywhere"},className:"font-semibold",children:i.name}),"”"]}),(0,t.jsx)(s.Input,{id:"resourceNameConfirmation","aria-label":"Resource Name",disabled:l,error:j&&j!==i.name?(0,t.jsxs)("span",{children:["The value does not match “",i.name,"”."]}):null,value:j,onChange:e=>g(e.target.value)})]})})]})})})}function N(e){let{resource:r,rotationResult:i,onDone:s}=e,n=i?.sync===!0;return(0,t.jsx)(T,{resource:r,actions:(0,t.jsx)(a.Modal.Action,{onClick:s,children:"Done"}),children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-6 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-1000",children:n?(0,t.jsxs)(t.Fragment,{children:["Secrets rotated successfully for ",r.name]}):(0,t.jsxs)(t.Fragment,{children:["Secrets rotation has been scheduled for ",r.name]})}),(0,t.jsx)("p",{className:"text-copy-14 text-gray-1000",children:n?(0,t.jsx)(t.Fragment,{children:"Please redeploy affected projects."}):(0,t.jsx)(t.Fragment,{children:"Once rotation is complete, please redeploy affected projects."})})]})})}function w(e){let{resource:r,rotationResult:i,onDone:s}=e,n=i?.sync===!0,{isComplete:l}=y({resource:r,rotatedAtJitter:i.rotatedAtJitter});return(0,t.jsx)(T,{resource:r,actions:(0,t.jsx)(a.Modal.Action,{onClick:s,type:l?"default":"secondary",children:l?"Done":"Later"}),children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-6 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-gray-1000",children:n?(0,t.jsxs)(t.Fragment,{children:["Secrets rotated successfully for ",r.name]}):(0,t.jsxs)(t.Fragment,{children:["Secrets rotation has been scheduled for ",r.name]})}),(0,t.jsx)(b,{resource:r,rotatedAtJitter:i.rotatedAtJitter})]})})}e.s(["RotateSecretsProjects",0,b,"useRotateSecretsProjectsState",0,y],3180667),e.s(["RotateResourceSecretsModal",0,function(e){let{active:s,resource:n,onCancel:d,onDone:c,trackRotation:u}=e,{mutate:x}=(0,i.useSWRConfig)(),[m,h]=(0,r.useState)("rotate"),[p,j]=(0,r.useTransition)(),[g,f]=(0,r.useState)(null),[y,b]=(0,r.useState)(null);return(0,t.jsxs)(a.Modal.Modal,{active:s,onClickOutside:d,width:500,children:["rotate"===m?(0,t.jsx)(C,{resource:n,executing:p,onConfirm:e=>{j(async()=>{try{let t=await (0,l.default)(`/v1/integrations/installations/${n.product.integrationConfigurationId}/resources/${n.id}/secrets/rotate?teamId=${n.ownerId}`,{method:"POST",throwOnHTTPError:!0,body:JSON.stringify({delayOldSecretsExpirationHours:e.delayOldSecretsExpirationHours,reason:e.reason})});x(e=>"string"==typeof e&&e.includes(`/stores/${n.id}`)),b({sync:!0===t.sync,rotatedAtJitter:Date.now()-5e3}),h(u?"track":"done")}catch(e){(0,o.isAPIError)(e)&&"conflict"===e.code?f(e.message):f(`Unable to rotate secrets for ${n.name}. Try again later.`)}})},onCancel:d,error:g}):null,"done"===m&&y?(0,t.jsx)(N,{resource:n,rotationResult:y,onDone:c}):null,"track"===m&&y?(0,t.jsx)(w,{resource:n,rotationResult:y,onDone:c}):null]})}],3800789)},5463680,6769352,e=>{"use strict";e.i(6356390),e.i(15312);var t=e.i(7897830);e.i(39509);var r=e.i(847684),i=e.i(2504781),s=e.i(5468328);e.i(3182268);var a=e.i(7849855);e.i(6887680);var n=e.i(6810699),l=e.i(1414602),o=e.i(5074599);function d(){return(0,r.jsx)("div",{style:{height:40}})}e.s(["CreateResourceButton",0,function(e){let{onSuccess:c,protocolType:u,label:x,hideIfHasNoStores:m=!0,buttonType:h="default"}=e,{projectSlug:p}=(0,a.useProjectAndTeamSlug)(),{data:j}=(0,n.useResourceList)({projectSlug:p,protocolType:u}),{openBrowseProducts:g}=(0,t.useResourceModals)({onSuccess:c}),{permissions:f,isLoading:y}=(0,l.useResourcePermissions)();if(y)return(0,r.jsx)(d,{});let b=!!(j&&j.stores.length>0);return m&&!b?(0,r.jsx)(d,{}):(0,r.jsx)(s.Tooltip,{disableTriggers:f.create,text:(0,o.missingPermissionLabel)("create",u),children:(0,r.jsx)(i.Button,{disabled:!f.create,onClick:()=>g("browse-new"),type:h,typeName:"button",children:x??(0,o.createResourceButtonLabel)(u)})})}],6769352),e.i(3800789),e.s([],5463680)},9522552,e=>{"use strict";let t=(0,e.i(9334638).withNewIcon)('<path fill-rule="evenodd" clip-rule="evenodd" d="M10.5 4C10.5 4.82843 11.1716 5.5 12 5.5C12.8284 5.5 13.5 4.82843 13.5 4C13.5 3.17157 12.8284 2.5 12 2.5C11.1716 2.5 10.5 3.17157 10.5 4ZM9.41536 5.52397C9.15145 5.07734 9 4.55636 9 4C9 2.34315 10.3431 1 12 1C13.6569 1 15 2.34315 15 4C15 5.65685 13.6569 7 12 7C11.4436 7 10.9227 6.84855 10.476 6.58464L6.58464 10.476C6.84855 10.9227 7 11.4436 7 12C7 13.6569 5.65685 15 4 15C2.34315 15 1 13.6569 1 12C1 10.3431 2.34315 9 4 9C4.55636 9 5.07734 9.15145 5.52398 9.41537L9.41536 5.52397ZM2.5 12C2.5 12.8284 3.17157 13.5 4 13.5C4.82843 13.5 5.5 12.8284 5.5 12C5.5 11.1716 4.82843 10.5 4 10.5C3.17157 10.5 2.5 11.1716 2.5 12Z" fill="currentColor"/>');e.s(["Connection",0,t])},3349273,e=>{"use strict";var t=e.i(4005781),r=e.i(2111701),i=e.i(9979783),s=e.i(5338940),a=e.i(319451);e.s(["useDeleteDrain",0,function(e,n){let{team:l}=(0,s.useTeam)(),o=(0,a.getDrainsKey)({teamIdOrSlug:e,projectIdOrSlug:n,includeMetadata:!0}),{trigger:d,isMutating:c,error:u}=(0,t.default)(o,async(e,t)=>{let{arg:s}=t;if(!l?.id)throw Error("Team ID is required");(0,r.mutate)(o,e=>e?{...e,drains:e.drains.filter(e=>e.id!==s.id)}:void 0,!1);try{let e={id:s.id,teamId:l.id},t=await (0,i.typedFetch)("/v1/drains/{id}","delete",e,{throwOnHTTPError:!0});if((0,r.mutate)(o),204!==t.status)throw console.error("Failed to delete drain:",t.body),Error("Failed to delete drain");return t.body}catch(e){throw console.error("Failed to delete drain:",e),(0,r.mutate)(o),e}},{throwOnError:!0});return{deleteDrain:d,isDeleting:c,error:u}}])},8039973,e=>{"use strict";var t=e.i(847684),r=e.i(7185353),i=e.i(3169345),s=e.i(5255926),a=e.i(455575),n=e.i(3349273),l=e.i(8404074),o=e.i(8674454),d=e.i(6694387),c=e.i(4991687),u=e.i(5468328),x=e.i(4585051);e.i(8703064);var m=e.i(648779),h=e.i(8876434),p=e.i(248550),j=e.i(5761705),g=e.i(8256306),f=e.i(762945),y=e.i(2640326),b=e.i(4524395),v=e.i(4535059),T=e.i(1000921),C=e.i(6143247),N=e.i(6048771),w=e.i(9668517),D=e.i(6060673);function R(e){let{project:r}=e;return r?(0,t.jsx)("div",{className:"size-5 rounded-full bg-white border border-gray-200 flex items-center justify-center overflow-hidden",children:(0,t.jsx)(N.ProjectLogo,{project:r,framework:r.framework,deploymentId:r.latestDeployments?.[0]?.id,size:20})}):(0,t.jsx)(s.Skeleton,{width:20,height:20,className:"rounded-full"})}function I(e){let{count:r}=e;return(0,t.jsx)("div",{className:"size-5 rounded-full bg-gray-100 border border-gray-200 flex items-center justify-center",children:(0,t.jsxs)("span",{className:"text-[8px] font-medium text-gray-900",children:["+",r]})})}function S(e){let{project:r}=e,i=(0,w.useTeamSlug)();return(0,t.jsx)("a",{href:`/${i}/${r.name}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm font-medium text-inherit no-underline",children:r.name})}function M(e){let{projectIds:r}=e,{data:i}=(0,D.useProjects)(r,{latestDeployments:1});return i&&0!==i.length?(0,t.jsx)("div",{className:"flex flex-col gap-1.5 text-left",children:i.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(R,{project:e}),(0,t.jsx)("span",{children:e.name})]},e.id))}):(0,t.jsx)("span",{children:"Loading projects…"})}function k(){return(0,t.jsx)("p",{className:"text-copy-14 text-sm font-medium",children:"All projects"})}function P(e){let{projectAccess:r,disabled:i}=e,{data:a,isLoading:n}=(0,D.useProjects)(r.projectIds,{latestDeployments:1}),l=r.projectIds.length,o=l>=4,d=o?2:Math.min(l,3),c=r.projectIds.slice(0,d),x=c.map(e=>a?.find(t=>t.id===e)),m=a?.find(e=>e.id===r.projectIds[0]),h=1===l&&m?(0,t.jsx)(S,{project:m}):1===l&&n?(0,t.jsx)(s.Skeleton,{width:100,height:20}):`${l} Projects`;return(0,t.jsx)(u.Tooltip,{text:(0,t.jsx)(M,{projectIds:r.projectIds}),children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:(0,C.cn)("flex items-center",i&&"opacity-50"),children:[x.map((e,r)=>(0,t.jsx)("div",{className:"relative",style:{marginLeft:0===r?0:"-8px"},children:(0,t.jsx)(R,{project:e})},c[r])),o&&(0,t.jsx)("div",{className:"relative",style:{marginLeft:"-8px",zIndex:0},children:(0,t.jsx)(I,{count:l-d})})]}),(0,t.jsx)("span",{className:"text-sm font-medium",children:h})]})})}function A(e){let{projectAccess:r,disabled:i}=e;return"all"===r.access?(0,t.jsx)(k,{}):(0,t.jsx)(P,{projectAccess:r,disabled:i})}var L=e.i(1733572);e.i(553769);var F=e.i(1919132),z=e.i(7594446);e.i(6887680);var E=e.i(1414602),H=e.i(1717203),O=e.i(7557283);function $(){let{can:e,isLoading:t}=(0,H.default)(),r=(0,z.useIntegrationPermissions)(),{permissions:i}=(0,E.useResourcePermissions)(),s={list:e(O.Action.List,O.Resource.Drain),read:e(O.Action.Read,O.Resource.Drain),create:e(O.Action.Create,O.Resource.Drain),update:e(O.Action.Update,O.Resource.Drain),remove:e(O.Action.Delete,O.Resource.Drain),isLoading:t};return{checkDrainPermissions:(e,a)=>{if("integration"===e.source.kind&&!a)return{isLoading:t,remove:s.remove&&r.canUpdateIntegrationConfiguration,update:s.update&&r.canUpdateIntegrationConfiguration,read:s.read&&r.canReadProjects};let n=a?s.remove&&i.remove:s.remove;return{isLoading:t,remove:n,update:a?s.update&&i.update:s.update,read:a?s.read&&i.read:s.read}},permissions:s}}var U=e.i(2704354),B=e.i(3758860),V=e.i(8459493);function J(e){let{disabled:r,onClick:i,href:s,children:a,tooltipText:n,className:l,isLink:o=!!(s&&!r),external:d}=e;return(0,t.jsx)(u.Tooltip,{disableTriggers:!r,position:"bottom",text:n,className:"w-full flex",children:(0,t.jsx)(V.MenuItem,{isLink:o,disabled:r,href:s&&!r?s:void 0,onClick:i&&!r?i:void 0,innerMenuItemClassName:l,external:d,children:a})})}var Y=e.i(5779481),Z=e.i(7743427),_=e.i(5338940),W=e.i(4011256);function q(e){let{drain:r,teamSlug:i,permissions:s,location:a}=e,{installationId:n,externalResourceId:l,resource:o,integration:d,isIntegrationDrain:c}=function(e){let t,r,i,s,{team:a}=(0,_.useTeam)(),n=!1;"integration"===e.source.kind&&(n=!0,t=e.source.resourceId,r=e.source.integrationConfigurationId,i=e.source.externalResourceId,s=e.source.integrationId);let{data:l}=(0,Y.useResourceItem)({resourceId:t||null}),o=l?.store,{integration:d}=(0,Z.useIntegration)(s,{teamId:a?.id});return{resourceId:t,installationId:r,externalResourceId:i,integrationId:s,resource:o,integration:d||void 0,isIntegrationDrain:n}}(r);return c?(0,t.jsxs)(t.Fragment,{children:["resource-dashboard"!==a&&(o||d)&&(0,t.jsx)(J,{external:!0,href:o&&d?(0,W.getResourceDashboardLink)(o,{teamSlug:i}):d&&n?(0,W.getIntegrationInstallationLink)(i,d.slug,n):void 0,disabled:s.isLoading||!s.update,tooltipText:"You do not have permission to manage this resource",children:(0,t.jsx)(u.Tooltip,{className:"block truncate",text:o?.name||d?.name,children:o?.name||d?.name})}),d&&n&&l&&(0,t.jsx)(J,{disabled:!1,external:!0,href:(0,B.getIntegrationDeepLink)({integrationConfigurationId:n,externalResourceId:l,teamIdOrSlug:i}),children:(0,t.jsx)(u.Tooltip,{className:"block truncate",text:`Manage in ${d.name}`,children:`Manage in ${d.name}`})})]}):null}function K(e){var r;let{drain:s,onDelete:a,onEdit:n,onStatusUpdate:l,resource:x,teamSlug:m,location:p}=e,{checkDrainPermissions:j}=$(),g="integration"===s.source.kind&&!x,f=x?.projectsMetadata.find(e=>(0,F.getLogDrainProtocolSettings)(e)?.logDrainId===s.id),y=j(s,x),b="disabled-by-admin"===s.disabledReason||"account-plan-downgrade"===s.disabledReason;return(0,t.jsxs)(i.Table.Row,{className:(0,C.cn)("h-16","hover:!bg-background-100","disabled"===s.status?"text-gray-700":"text-gray-900"),children:[(0,t.jsx)(i.Table.Cell,{className:"py-1 pl-2 pr-0",children:(0,t.jsx)("div",{className:(0,C.cn)("flex items-center justify-center","disabled"===s.status&&"opacity-50"),children:(0,t.jsx)(X,{drain:s,resource:x})})}),(0,t.jsx)(i.Table.Cell,{className:(0,C.cn)("py-1 truncate font-medium text-sm pr-4","disabled"===s.status?"text-gray-700":"text-gray-1000"),children:s.name}),(0,t.jsx)(i.Table.Cell,{className:"py-1",children:(0,t.jsxs)("div",{className:"flex items-center gap-1 text-sm font-medium",children:[(0,t.jsx)(Q,{drain:s}),(0,L.getDrainTypeLabel)((0,L.getDrainType)(s))]})}),(0,t.jsx)(i.Table.Cell,{className:"py-1",children:(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsx)(A,{projectAccess:s.projectAccess,disabled:"disabled"===s.status})})}),(0,t.jsx)(i.Table.Cell,{className:"py-1",children:(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)(u.Tooltip,{text:"enabled"===(r=s.status)?"Running - Drain is active and forwarding data":"disabled"===r?"Paused - Drain is paused and not forwarding data":"Error - Drain is experiencing an error rate above 80%",children:(0,t.jsx)(G,{status:s.status})})})}),(0,t.jsx)(i.Table.Cell,{className:"py-1",children:(0,t.jsxs)(c.MenuContainer,{children:[(0,t.jsx)(d.MenuButton,{"aria-label":"More options",type:"tertiary",shape:"square",size:"small",className:"flex items-center justify-center",children:(0,t.jsx)(h.MoreHorizontal,{})}),(0,t.jsxs)(o.Menu,{width:160,children:[g?(0,t.jsx)(J,{external:!0,disabled:y.isLoading||!y.update,href:"integration"===s.source.kind?(0,U.getConfigureUrl)({website:s.integrationWebsite??"",configurationUri:s.integrationConfigurationUri},s.source.integrationConfigurationId):void 0,tooltipText:"You need additional permissions to edit this integration.",children:"Edit"}):(0,t.jsx)(t.Fragment,{children:b?null:(0,t.jsx)(J,{tooltipText:"You do not have permission to update this drain",disabled:y.isLoading||!y.update,onClick:()=>n(s,{resource:x,connection:f}),children:"Edit"})}),b?null:(0,t.jsx)(J,{tooltipText:"You do not have permission to update this drain",disabled:y.isLoading||!y.update,onClick:()=>l(s,f&&x?{resource:x,connection:f}:void 0),children:"disabled"===s.status?"Resume":"Pause"}),(0,t.jsx)(q,{drain:s,teamSlug:m,permissions:y,location:p}),g?null:(0,t.jsx)(J,{tooltipText:"You do not have permission to delete this drain",disabled:y.isLoading||!y.remove,className:y.remove?"text-red-900":"text-red-500",onClick:()=>a(s,f&&x?{resource:x,connection:f}:void 0),children:"Delete"})]})]})})]},s.id)}function G(e){let{status:r}=e;return"enabled"===r?(0,t.jsx)(j.CheckCircle,{color:"blue-700",size:16}):"disabled"===r?(0,t.jsx)(g.Pause,{color:"gray-700",size:16}):(0,t.jsx)(f.Warning,{color:"red-700",size:16})}function Q(e){let{drain:r}=e;switch((0,L.getDrainType)(r)){case"traces":return(0,t.jsx)(v.Traces,{size:14});case"logs":default:return(0,t.jsx)(p.Logs,{size:14});case"analytics":return(0,t.jsx)(y.Analytics,{size:14});case"speed_insights":return(0,t.jsx)(b.StopwatchFast,{size:14})}}function X(e){let{drain:r,resource:i}=e;return r.integrationIcon?(0,t.jsx)(x.Avatar,{hash:r.integrationIcon,size:28}):r.source?.kind==="integration"&&i?.product?.iconUrl?(0,t.jsx)("div",{className:"size-[28px] flex items-center justify-center",children:(0,t.jsx)(m.ProductIcon,{icon:i.product.iconUrl,size:"medium"})}):(0,t.jsx)("div",{className:"size-[28px] bg-gray-alpha-100 flex items-center justify-center rounded-full border border-gray-alpha-200",children:(0,t.jsx)(T.ArrowCircleRight,{size:16})})}var ee=e.i(8544664),et=e.i(8248823),er=e.i(6891161),ei=e.i(4030453),es=e.i(8522580);function ea(e){let{drain:r,action:s,onConfirm:a,isLoading:n,error:l,onClose:o,resource:d,connection:c}=e,{title:u,subtitle:x,note:m,buttonText:h,buttonType:p}=en[s],j=!!m,g="";"delete"===s&&r?.status==="disabled"&&(j=!1),"delete"===s&&d&&c&&(g="This will remove environment variable(s) associated with this Drain. Make sure your code is not relying on them anymore.");let f=(e=>{if(e.delivery&&"endpoint"in e.delivery)return"otlphttp"===e.delivery.type?e.delivery.endpoint.traces:e.delivery.endpoint;throw Error("Invalid drain delivery")})(r);return(0,t.jsxs)(er.Modal.Modal,{active:!!s,onClickOutside:o,children:[(0,t.jsx)(er.Modal.Body,{children:(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-6 flex-initial",children:[(0,t.jsx)(er.Modal.Title,{children:u}),(0,t.jsx)(er.Modal.Subtitle,{children:x}),(0,t.jsx)(i.Table,{children:(0,t.jsxs)(i.Table.Body,{striped:!0,className:"text-gray-1000",children:[(0,t.jsxs)(i.Table.Row,{children:[(0,t.jsx)(i.Table.Cell,{className:"font-medium",children:"Drain Name"}),(0,t.jsx)(i.Table.Cell,{children:r?.name?r.name:(0,t.jsx)("span",{className:"italic",children:"No name"})})]}),f?(0,t.jsxs)(i.Table.Row,{children:[(0,t.jsx)(i.Table.Cell,{className:"font-medium",children:"Drain Endpoint"}),(0,t.jsx)(i.Table.Cell,{children:f})]}):null]})}),j?(0,t.jsx)(es.Note,{fill:!0,type:"warning",children:m}):null,g?(0,t.jsx)(es.Note,{fill:!0,type:"warning",children:g}):null,l?(0,t.jsx)(ei.Error,{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",error:(0,et.normalizeError)(l)}):null]})}),(0,t.jsxs)(er.Modal.Actions,{children:[(0,t.jsx)(er.Modal.Action,{onClick:o,type:"secondary",children:"Cancel"}),(0,t.jsx)(er.Modal.Action,{type:p,loading:n,onClick:a,children:h})]})]})}let en={delete:{title:"Delete Drain",subtitle:"The following drain will be permanently deleted. Are you sure you want to continue?",note:"This drain is currently active. Make sure you don't need the drained data anymore before deleting it.",buttonText:"Delete",buttonType:"error"},disable:{title:"Pause Drain",subtitle:"The following drain will be paused, and any data that is generated will be lost. Are you sure you want to continue?",buttonText:"Pause",buttonType:"warning"},enable:{title:"Resume Drain",subtitle:"The following drain will be resumed and will start receiving new data. Are you sure you want to continue?",buttonText:"Resume",buttonType:"default"}};var el=e.i(6810699);function eo(e,t){t&&t.forEach(t=>{(0,B.isProtocolSupported)(t.product,"logDrain")&&e.set(t.id,t)})}var ed=e.i(4110479),ec=e.i(3199886);e.i(5192575);var eu=e.i(1887803),ex=e.i(3850869),em=e.i(2006191);e.i(5463680);var eh=e.i(15312);function ep(e){let{teamSlug:s,projectIdOrSlug:o,drains:d,isLoading:c,onDrainsMutate:u,location:x}=e,{data:m}=(0,em.useTeam)(s),{permissions:h}=$(),{openDrain:p,isOpen:j,drain:g,closeModal:f}=(0,ed.useDrainModalContext)(),{data:y}=function(){let{data:e}=(0,el.useResourceList)({protocolType:"observability"}),{data:t}=(0,el.useResourceList)({protocolType:"logDrain"}),r=new Map;eo(r,e?.stores),eo(r,t?.stores);let i=!e||!t;return{data:i?void 0:Array.from(r.values()),isLoading:i}}(),{data:b}=(0,el.useResourceList)({protocolType:"traceDrain"}),v=(0,r.useMemo)(()=>{let e=[...y||[]];return b?.stores&&e.push(...b.stores),e},[y,b]),T=(0,r.useMemo)(()=>{let e=new Map;if(!v)return e;for(let t of v)if(e.set(t.id,t),t.projectsMetadata)for(let r of t.projectsMetadata){let i=(0,F.getLogDrainProtocolSettings)(r)?.logDrainId;i&&e.set(i,t)}return e},[v]),[C,N]=(0,r.useState)(null),[w,D]=(0,r.useState)(null),[R,I]=(0,r.useState)(void 0),S=(0,a.useToasts)(),M=(0,ee.usePlaceholderCount)(`drains:${s}${o?`-${o}`:""}`,d?.length),{deleteDrain:k,isDeleting:P}=(0,n.useDeleteDrain)(s,o),{updateDrain:A,isUpdating:L}=(0,l.useUpdateDrain)(s,o),z=()=>{N(null),D(null),I(void 0)},{removeConnections:E,isRemovingConnections:H}=(0,eu.useResourceConnection)(),O=(e,t)=>{p(e,t?.resource)},U=async()=>{if(C&&w)try{"delete"===C&&(w.resource&&w.connection?await E({resourceId:w.resource.id,connectionIds:[w.connection.id]}):await k({id:w.drain.id})),("disable"===C||"enable"===C)&&await A({id:w.drain.id,status:"disable"===C?"disabled":"enabled"}),z(),S.success({text:ef[C].success,key:`${C}-drain`}),await u?.()}catch(e){I(e),S.error({text:ef[C].error,key:`${C}-drain`})}},B=async(e,t)=>{N("delete"),D({drain:e,resource:t?.resource,connection:t?.connection})},V=async(e,t)=>{N("disabled"===e.status?"enable":"disable"),D({drain:e,resource:t?.resource,connection:t?.connection})};return h.isLoading||h.read?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"overflow-x-auto rounded-md border border-gray-alpha-400 bg-background-100",children:(0,t.jsxs)(i.Table,{className:"table-fixed w-full [&_tr:hover]:rounded-none [&_tr:hover_td]:rounded-none",children:[(0,t.jsxs)(i.Table.Colgroup,{children:[(0,t.jsx)(i.Table.Col,{className:"w-8"}),(0,t.jsx)(i.Table.Col,{className:"w-52"}),(0,t.jsx)(i.Table.Col,{className:"w-36"}),(0,t.jsx)(i.Table.Col,{className:"w-28 lg:w-60"}),(0,t.jsx)(i.Table.Col,{className:"w-8"}),(0,t.jsx)(i.Table.Col,{className:"w-12"})]}),(0,t.jsx)(i.Table.Header,{removeSpacing:!0,children:(0,t.jsxs)(i.Table.Row,{className:"border-b border-gray-alpha-400 bg-gray-50 h-12",children:[(0,t.jsx)(i.Table.Head,{}),(0,t.jsx)(i.Table.Head,{className:"font-medium text-gray-700",children:"Name"}),(0,t.jsx)(i.Table.Head,{className:"font-medium text-gray-700",children:"Type"}),(0,t.jsx)(i.Table.Head,{className:"font-medium text-gray-700",children:"Connected Projects"}),(0,t.jsx)(i.Table.Head,{}),(0,t.jsx)(i.Table.Head,{})]})}),(0,t.jsx)(i.Table.Body,{interactive:!0,bordered:!0,children:c?(0,t.jsx)(ej,{count:M}):d?.sort((e,t)=>t.createdAt-e.createdAt).map(e=>(0,t.jsx)(K,{drain:e,teamSlug:s,resource:function(e,t){if(t.source?.kind==="integration"){let r=t.source;if(r.resourceId)return e.get(r.resourceId)}}(T,e),onEdit:O,onDelete:B,onStatusUpdate:V,location:x},e.id))})]})}),w?.drain&&C?(0,t.jsx)(ea,{action:C,drain:w.drain,onConfirm:U,isLoading:P||L||H,error:R,onClose:z,resource:w.resource,connection:w.connection}):null,(0,t.jsx)(ec.DrainModal,{drain:g,active:j,onClose:f,teamSlug:s,projectIdOrSlug:o,onDrainUpdated:async()=>{await u?.()}})]}):(0,t.jsx)(ex.AdditionalPermissionsRequired,{resource:"drains",team:m,className:"min-h-56 rounded-md border border-gray-alpha-400 bg-background-100"})}function ej(e){let{count:r}=e;return(0,t.jsx)(t.Fragment,{children:Array.from({length:r||3},(e,r)=>(0,t.jsx)(eg,{},`loading-${r}`))})}function eg(){return(0,t.jsxs)(i.Table.Row,{className:"h-16",children:[(0,t.jsx)(i.Table.Cell,{className:"pl-4",children:(0,t.jsx)(s.Skeleton,{width:16,height:16})}),(0,t.jsx)(i.Table.Cell,{children:(0,t.jsx)(s.Skeleton,{width:"60%",height:16})}),(0,t.jsx)(i.Table.Cell,{children:(0,t.jsx)(s.Skeleton,{width:"50%",height:16})}),(0,t.jsx)(i.Table.Cell,{children:(0,t.jsx)(s.Skeleton,{width:80,height:16})}),(0,t.jsx)(i.Table.Cell,{children:(0,t.jsx)(s.Skeleton,{width:16,height:16})}),(0,t.jsx)(i.Table.Cell,{children:(0,t.jsx)(s.Skeleton,{width:16,height:16})})]})}let ef={delete:{success:"Drain removed successfully.",error:"Failed to remove drain. Please contact support if this persists."},disable:{success:"Drain paused successfully.",error:"Failed to pause drain. Please contact support if this persists."},enable:{success:"Drain resumed successfully.",error:"Failed to resume drain. Please contact support if this persists."}};e.s(["DrainsList",0,function(e){return(0,t.jsx)(ed.DrainModalProvider,{children:(0,t.jsx)(eh.ResourceModalsProvider,{protocolType:"logDrain",children:(0,t.jsx)(ep,{...e})})})}],8039973)}]);

//# debugId=24853ec0-7281-2a0d-d182-094ba51ff31b
//# sourceMappingURL=51a7e77f88bc37f9.js.map