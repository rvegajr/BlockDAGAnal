;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="713db41c-36f5-230e-4d6d-0075a48ae233")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,8366444,e=>{"use strict";var t=e.i(4496450);let l={enabled:!0,disabledReason:void 0},i=e=>({enabled:!1,disabledReason:e});e.s(["useOnDemandConcurrentBuilds",0,function(e,a){if(!e||!e.billing)return i("other");if("enterprise"===e.billing.plan)return(0,t.isLegacyPlanIteration)(e.billing.planIteration)?i("enterprise-non-unbundled"):a?l:i("no-permission");if("pro"===e.billing.plan)return"active"===e.billing.status?a?l:i("no-permission"):i("pro-non-active");return i("hobby-plan")}])},5023172,e=>{"use strict";var t=e.i(847684),l=e.i(7185353),i=e.i(6891161),a=e.i(455575),n=e.i(277234),s=e.i(4244280),r=e.i(57106);e.s(["StartBuildingNowModal",0,function(e){let[o,d]=(0,l.useState)(!1),c=(0,a.useToasts)(),u=(0,l.useCallback)(async()=>{if(!e.deploymentId||!e.teamId)return;d(!0);let t=new URLSearchParams;t.append("teamId",e.teamId);let l=`${(0,s.API_DEPLOYMENTS)("v13")}/${e.deploymentId}/skip-queue?${t.toString()}`;200===(await (0,n.fetchAPI)(l,{method:"POST",body:void 0,throwOnHTTPError:!1,returnStatus:!0})).status?(c.success("Deployment will start building now."),e.onSuccess?.()):c.error("Something went wrong"),d(!1),e.onClose()},[e,c]);return(0,t.jsxs)(i.Modal.Modal,{active:e.active,onClickOutside:e.onClose,width:"500px",children:[(0,t.jsxs)(i.Modal.Body,{children:[(0,t.jsx)(i.Modal.Header,{children:(0,t.jsx)(i.Modal.Title,{children:(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-2 flex-initial",children:"Start Building Now"})})}),(0,t.jsxs)("div",{className:"flex flex-col items-center justify-start gap-2 flex-initial",children:[(0,t.jsxs)("p",{className:"text-copy-14",children:["This will bypass the regular queue and start your build immediately. On-demand builds are billed in 1 minute increments."," ",(0,t.jsx)(r.Link,{href:"/docs/deployments/managing-builds#on-demand-concurrent-builds",target:"_blank",variant:"highlight",children:"Learn more."})]}),e.teamId&&e.projectName?(0,t.jsxs)("p",{className:"text-copy-14",children:["If you frequently need faster builds for this project, consider enabling"," ",(0,t.jsx)(r.Link,{as:`/${e.teamId}/${encodeURIComponent(e.projectName)}/settings/build-and-deployment`,href:"/[teamSlug]/[project]/settings/build-and-deployment",target:"_blank",variant:"highlight",children:"On-Demand Concurrent Builds"})," ","at the project level."]}):null,(0,t.jsx)("p",{className:"text-copy-14",children:'By clicking "Confirm" you agree to be charged for on-demand concurrency.'})]})]}),(0,t.jsxs)(i.Modal.Actions,{children:[(0,t.jsx)(i.Modal.Action,{loading:!1,onClick:e.onClose,type:"secondary",children:"Close"}),(0,t.jsx)(i.Modal.Action,{disabled:o,loading:o,onClick:u,children:"Confirm"})]})]})}])},5598924,5442212,e=>{"use strict";var t=e.i(847684),l=e.i(9338892),i=e.i(7185353),a=e.i(5255926),n=e.i(6881349),s=e.i(6352514),r=e.i(4759942),o=e.i(1991452),d=e.i(8238875),c=e.i(9031150),u=e.i(935882);let m=()=>{let e=(0,d.useSearchParams)();return{isReady:(0,o.useRouter)().isReady,filterBranch:e?.get("filterBranch")||void 0}};e.s(["useProjectFilteredBranch",0,function(){let{project:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=m(),[l,a]=(0,i.useState)(t.filterBranch||null);(0,i.useEffect)(()=>{a(t.filterBranch||null)},[t.isReady,t.filterBranch]);let n=(0,o.useRouter)(),s=(0,i.useCallback)(e=>{(0,c.awaitPaint)().then(()=>{a(e),function(e,t){let{teamSlug:l,project:i,slug:a,...n}=e.query;t?n.filterBranch=t:delete n.filterBranch,e.replace({pathname:window.location.pathname,query:n},void 0,{shallow:!0,scroll:!1})}(n,e)})},[n]),r=l?{ref:l}:void 0,d=(0,i.useCallback)(()=>{l&&(a(null),s(null))},[l,s]),h=!e||!t.isReady,p=null!==l,[x,y]=(0,i.useState)(p);return(0,u.default)(()=>{y(p)},[y,h,p]),{showBranchFilterBar:x,filteredBranch:l,setFilteredBranch:s,clearBranch:d,gitSource:r}},"useRouterFilteredBranch",0,m],5442212);var h=e.i(1947138),p=e.i(7401972);let x=(0,i.memo)(e=>{let{loading:a,skeleton:o,onSelect:d,project:c,value:x,includeProductionBranch:f,placeholder:j,skeletonStyle:g,comboboxSize:b,clearable:v}=e,[k,S]=(0,i.useState)(!1),[C,N]=(0,i.useState)(!1),[A,R,{currentValue:w,setValueImmediate:I}]=(0,h.useDebounceState)(x||"",300);(0,i.useEffect)(()=>{x&&I(x)},[I,x]);let[,{branches:D,isValidating:M,fetchedQuery:P}]=(0,p.useProjectDeployedBranches)({project:c,includeProductionBranch:f,query:A},{revalidateOnFocus:!1,revalidateIfStale:!1,revalidateOnReconnect:!1}),T=(P||"")!==A,E=!!C&&!!k&&!!w&&T,{filterBranch:L}=m();(0,i.useEffect)(()=>{L&&I(L)},[I,L]),(0,i.useEffect)(()=>{I(x||"")},[I,x]),(0,i.useEffect)(()=>{k||D&&!M&&S(!0)},[k,D,M]);let[O,B]=(0,i.useState)([]);(0,i.useEffect)(()=>{M||void 0===D||(0!==$.current.query.indexOf(w)&&($.current={values:[],query:w}),B(D||[]))},[JSON.stringify(D),P]);let $=(0,i.useRef)({values:[],query:""}),_=M||w.length>=A.length&&w.length>=1?$.current.values:[],F=[...new Set([..._,...E?O:D||[]])],H=(0,i.useRef)(null);return((0,u.default)(()=>{w&&H.current?.setValue(w)},[w]),(0,u.default)(()=>{x||H.current?.clear()},[x]),o&&!k)?(0,t.jsx)(y,{skeletonStyle:g}):(0,t.jsxs)(n.Combobox,{clearable:v,filter:function(e,t){let i=""===t?e:(0,l.matchSorter)(e,t,{keys:["value","label"]}),a=[];for(let e of _)i.find(t=>t.value===e)&&a.push(e);let n=[...new Set([...a,...i.map(e=>e.value)])],s=n.map(e=>{let t=i.find(t=>t.value===e);if(!t)throw Error("impossible state");return t});return $.current={values:n,query:w},s},loading:E||a,onChange:e=>{e===L?setTimeout(()=>{d?.(null),H.current?.clear(),I("")}):(r.analytics.track(s.AnalyticsEvent.DEPLOYMENT_OVERVIEW_FILTERS_BRANCH,{value:e}),I(e||""),d?.(e))},onChangeOpen:e=>{N(e)},placeholder:j||"All Branches…",ref:H,size:b,children:[(0,t.jsx)(n.Combobox.Input,{loading:E||a,onChange:e=>{""===e.target.value?I(""):R(e.target.value)}}),(0,t.jsx)(n.Combobox.List,{children:F.map((e,l)=>(0,t.jsx)(n.Combobox.Option,{value:e,children:e},w?e:`${e}${l}`))})]})});function y(e){let{skeletonStyle:l}=e;return(0,t.jsx)(a.Skeleton,{style:l||{height:40},width:"100%"})}e.s(["BranchSearchCombobox",0,function(e){let{skeletonStyle:l}=e;return(0,t.jsx)(i.Suspense,{fallback:(0,t.jsx)(y,{skeletonStyle:l}),children:(0,t.jsx)(x,{...e})})}],5598924)},2645806,e=>{"use strict";var t=e.i(847684),l=e.i(7185353),i=e.i(2111701),a=e.i(6891161),n=e.i(455575),s=e.i(277234),r=e.i(4244280),o=e.i(4470704);let d=l.default.memo(e=>{let{active:d,onClose:c,deployment:u,teamId:m}=e,[h,p]=(0,l.useState)(!1),x=(0,n.useToasts)(),y=(0,l.useCallback)(async()=>{if(!u)return;p(!0);let e=m?"?teamId="+m:"",t=await (0,s.fetchAPI)(`${(0,r.API_DEPLOYMENTS)("v12")}/${u.id}/cancel`+e,{throwOnHTTPError:!1,method:"PATCH"});t.error&&x.error(`Could not cancel the deployment, it's ${u.readyState}`),"CANCELED"===t.readyState&&(x.success("The deployment has been successfully canceled."),(0,i.mutate)((0,o.getUrl)(u.id),{...u,readyState:t.readyState,status:t.readyState,canceledAt:t.canceledAt,host:u.url,isPrivate:!u.public})),p(!1),c()},[u,m,x,c]);return(0,t.jsxs)(a.Modal.Modal,{active:d,onClickOutside:c,width:"500px",children:[(0,t.jsxs)(a.Modal.Body,{children:[(0,t.jsx)(a.Modal.Header,{children:(0,t.jsx)(a.Modal.Title,{children:"Cancel Deployment"})}),(0,t.jsx)("p",{className:"text-copy-16",children:"Canceling this deployment will immediately stop the build, with no way to resume."}),(0,t.jsx)("p",{className:"text-copy-16",style:{margin:0},children:"Are you sure you want to continue?"})]}),(0,t.jsxs)(a.Modal.Actions,{children:[(0,t.jsx)(a.Modal.Action,{loading:!1,onClick:c,type:"secondary",children:"Close"}),(0,t.jsx)(a.Modal.Action,{disabled:h,loading:h,onClick:y,children:"Cancel deployment"})]})]})});e.s(["default",0,d])},5229375,e=>{"use strict";var t=e.i(7185353),l=e.i(7909933),i=e.i(3924999),a=e.i(818351),n=e.i(8042625),s=e.i(277234),r=e.i(4244280),o=e.i(5338940);function d(e,t){let l=(0,n.encode)(e,!1),i=t?`&${t}`:"";return l?`?${l}${i}`:`?${i}`}e.s(["useAliases",0,function(e,t){return(0,l.default)(()=>{if(!e)return null;let{team:t,id:l,teamId:i}=e;return`${(0,r.API_DEPLOYMENTS)("v2")}/${l}/aliases${(0,n.encode)({teamId:i??(t?t.id:null)})}`},e=>(0,s.fetchAPI)(e,{throwOnHTTPError:!0}),t)},"useAliasesInfinite",0,function(e,l){let{limit:a=20,domains:n,rollbackDeploymentId:c}=e,{isReady:u,team:m}=(0,o.useTeam)(),h=(0,i.default)((e,t)=>{if(!u)return null;let l=`${r.API_ALIASES}`,i=n?.map(e=>`domain=${encodeURIComponent(e)}`).join("&")||null;if(!e)return`${l}${d({limit:a+1,teamId:m?.id,rollbackDeploymentId:c},i)}`;let s=t?.aliases&&t.aliases.length>a?t.aliases[a-1].createdAt:null;return s?`${l}${d({limit:a+1,teamId:m?.id,until:s},i)}`:null},e=>(0,s.fetchAPI)(e,{throwOnHTTPError:!0}),l),p=(0,t.useMemo)(()=>h.data?[].concat(...h.data.filter(Boolean).map(e=>e.aliases.slice(0,a))):[],[h.data,a]),x=!!h.data&&!h.error,y=!!(h.data&&0===p.length),f=!!(h.data&&h.size>h.data.length),j=!!(h.data&&h.data[h.data.length-1]?.aliases.length<=a);return[h,{aliases:p,initialDataLoaded:x,isEmpty:y,loadMore:()=>h.setSize(e=>e+1),isLoadingMore:f,isReachingEnd:j}]},"useAliasesV2",0,function(e,t){let{deploymentId:l,teamId:i}=e;return(0,a.useIsomorphicSWR)(l?function(e){let{deploymentId:t,teamId:l}=e;return`${(0,r.API_DEPLOYMENTS)("v2")}/${t}/aliases${(0,n.encode)({teamId:l})}`}({deploymentId:l,teamId:i}):null,t)}],5229375)},7018452,e=>{"use strict";var t=e.i(7185353);e.s(["default",0,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",[l,i]=(0,t.useState)(!1),a=window.location.hash,n=e.startsWith("#")?e:`#${e}`;return(0,t.useEffect)(()=>{let e=()=>{window.location.hash!==n||l||i(!0)};return window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[l,n]),a!==n||l||(i(!0),window.history.replaceState(null,""," ")),a!==n&&l&&(window.location.hash=n),[l,i]}])},9719784,e=>{"use strict";var t=e.i(847684),l=e.i(7185353),i=e.i(57106),a=e.i(822157),n=e.i(7018452),s=e.i(2405448),r=e.i(542164),o=e.i(1681029),d=e.i(4478191);let c=(0,l.memo)(function(e){let{url:c,truncate:u,defaultRoute:m,...h}=e,[p,x]=(0,n.default)("#wildcard"),[y,f]=(0,l.useState)(null),[j,g]=(0,l.useState)(!1),b=(0,l.useCallback)(()=>{f((0,s.default)(c)),x(!0)},[f,x,c]);return c?(0,r.default)(c)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.Link,{className:"pt-px leading-[16px] hover:underline",onClick:b,...h,onMouseEnter:()=>g(!0),style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:c}):c}),j||p?(0,t.jsx)(a.default,{active:p,onCancel:()=>{x(!1)},url:y}):null]}):(0,t.jsx)(i.Link,{className:"pt-px leading-[16px] hover:underline",external:!0,href:(0,d.withDefaultRoute)((0,o.domainToUrl)(c),m),...h,style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:c}):c}):null});e.s(["default",0,c])},9365163,4904548,e=>{"use strict";var t=e.i(847684),l=e.i(7185353),i=e.i(5338940),a=e.i(1717203),n=e.i(7557283),s=e.i(4670733),r=e.i(588428),o=e.i(4396019),d=e.i(762945),c=e.i(7749291),u=e.i(8735244),m=e.i(2504781),h=e.i(6891161),p=e.i(455575),x=e.i(8522580),y=e.i(8761240),f=e.i(5756088),j=e.i(9386557),g=e.i(4004502),b=e.i(8042625),v=e.i(277234),k=e.i(4244280),S=e.i(5140444),C=e.i(5757634),N=e.i(5802506),A=e.i(6641571);e.i(9623499);var R=e.i(5576066),w=e.i(3924999),I=e.i(5229375);e.i(2598434);var D=e.i(9668517);let M="[teamSlug]";var P=e.i(6060673),T=e.i(930810),E=e.i(7952834),L=e.i(1173672),O=e.i(8227242),B=e.i(9745887),$=e.i(3306538),_=e.i(5468328),F=e.i(9719784);function H(e){let{hidden:l,showIcon:i=!0,linkProps:a,defaultRoute:n}=e;return(0,t.jsx)(t.Fragment,{children:l.map(e=>(0,t.jsx)("div",{children:(0,t.jsx)(F.default,{defaultRoute:n,icon:i,title:e,truncate:!0,url:e,...a})},e))})}function q(e){let{hidden:l,linkProps:i}=e;return(0,t.jsx)(_.Tooltip,{text:(0,t.jsx)(H,{hidden:l,linkProps:i}),children:(0,t.jsx)($.Badge,{size:"sm",variant:"gray-subtle",children:`+${l.length}`})})}let W=function(e){let{className:l,defaultRoute:i,domains:a,firstOnly:n,showIcon:s=!0,style:r,linkProps:o}=e;if(!a)return(0,t.jsx)("span",{className:`text-copy-14 text-gray-900 ${l}`,style:r,children:"-"});let{visible:d,hidden:c}=a.reduce((e,t)=>(0===e.visible.length||!n&&1===e.visible.length&&e.visible[0].length<=20?e.visible.push(t):e.hidden.push(t),e),{visible:[],hidden:[]});return(0,t.jsx)("span",{className:`text-[14px] leading-[20px] font-medium ${l}`,children:(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-2 flex-initial max-w-full",style:{...r},children:[d.map((e,l)=>{let a=l===d.length-1;return(0,t.jsx)(F.default,{defaultRoute:i,icon:s,style:{marginRight:a?void 0:"var(--geist-gap-half)",minWidth:0},truncate:!0,url:e,...o},e)}),c.length?(0,t.jsx)(q,{hidden:c,linkProps:o}):null]})})};e.s(["default",0,W],4904548);var U=e.i(8651268),z=e.i(2547843);function Y(){return(0,t.jsx)(h.Modal.Header,{children:(0,t.jsx)(h.Modal.Title,{center:!0,children:"Instant Rollback"})})}function V(e){let{setStage:l}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(Y,{}),(0,t.jsx)("p",{className:"text-copy-14",style:{marginBottom:"24px"},children:"Error: You must select a deployment to roll back."})]}),(0,t.jsx)(h.Modal.Actions,{children:(0,t.jsx)(h.Modal.Action,{fullWidth:!0,onClick:()=>{l("initial")},type:"secondary",children:"Back"})})]})}function K(){return(0,t.jsx)("div",{children:(0,t.jsx)(x.Note,{className:"bg-yellow-50 border-yellow-300 border text-amber-700",fill:!0,label:!1,type:"warning",variant:"contrast",children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",style:{padding:4},children:[(0,t.jsx)(d.Warning,{style:{flexShrink:0}}),(0,t.jsxs)("div",{className:"flex flex-col items-start justify-start flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"Make sure the domains listed above are correct."}),(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"This deployment has custom aliases not included in the project's domain settings."})]})]})})})}function J(e){var a;let n,{hasFloatingAliases:o,onCancel:d,previousDeployment:c,productionAliases:u,productionDeployment:p,project:y,rollbackCandidates:j,setStage:b,selectedDeployment:v,setSelectedDeployment:k,deploymentSwr:S,rollbackReason:C,setRollbackReason:N}=e,A=(a="/[teamSlug]",n=(0,D.useTeamSlug)(),(0,l.useMemo)(()=>a.includes(M)?a.replace(`/${M}`,n?`/${n}`:""):a,[n,a])),[w,I]=(0,l.useState)(!1),{team:P}=(0,i.useTeam)(),E=!P||P.billing?.plan==="hobby",{value:L}=(0,s.useInstantRollbackHobbyRestrictionFlag)(),{value:O}=(0,r.useInstantRollbackHobbyRestrictionTeamFlag)();return j.length&&c&&v?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(Y,{}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("p",{className:"text-copy-16",children:["Rolling back"," ",(0,t.jsx)(W,{domains:u,firstOnly:!0,style:{display:"inline-flex",fontWeight:"500"}})]}),o?(0,t.jsx)(K,{}):null,(0,t.jsx)("div",{children:(0,t.jsx)(B.DeploymentCardSmall,{deployment:p,isProductionDeployment:!0,selectedDeployment:v,setSelectedDeployment:k})})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-16",children:"To the following deployment:"}),w?(0,t.jsx)("div",{children:(0,t.jsx)(T.ChooseDeploymentList,{deployments:j,previousDeployment:c,productionDeployment:p,rolledBackDeploymentId:y?.lastAliasRequest?.type==="rollback"?y.lastAliasRequest.fromDeploymentId:void 0,selectedDeployment:v,setSelectedDeployment:k,swr:S})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsx)(B.DeploymentCardSmall,{deployment:v,isForm:w,isPreviousDeployment:v.uid===c.uid,selectedDeployment:v,setSelectedDeployment:k})}),(L||O)&&E?(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial mt-6",children:(0,t.jsx)(x.Note,{className:"bg-blue-50 border border-blue-500 text-blue-600",fill:!0,label:!1,size:"small",variant:"contrast",children:(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial p-2",children:[(0,t.jsx)(f.LockClosed,{style:{transform:"translateX(1px)"}}),(0,t.jsxs)("div",{className:"flex flex-col items-start justify-start flex-initial",children:[(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-inherit",children:"Looking for an earlier deployment?"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(R.Link,{className:"text-current no-underline",external:!0,href:"/"===A?"/dashboard?createTeam=instant-rollback":`${A}?upgradeTeam=instant-rollback`,target:"_blank",children:(0,t.jsx)("span",{className:"text-copy-14 text-inherit",children:"Upgrade to Pro"})}),(0,t.jsxs)("span",{className:"text-copy-14 text-inherit",style:{whiteSpace:"nowrap"},children:[" ","to roll back to an earlier deployment"]})]})]})]})})}):(0,t.jsx)(m.Button,{onClick:()=>{I(!0)},type:"secondary",width:"100%",size:"small",children:"Choose another deployment"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("label",{htmlFor:"rollback-reason",className:"flex flex-col items-stretch justify-start gap-1 flex-initial",children:(0,t.jsx)("span",{className:"text-copy-16",children:"Share a reason for this rollback:"})}),(0,t.jsx)(T.RollbackDescriptionTextarea,{value:C,onChange:N,id:"rollback-reason"})]})]})]}),(0,t.jsxs)(h.Modal.Actions,{children:[(0,t.jsx)(h.Modal.Action,{onClick:d,type:"secondary",children:"Cancel"}),(0,t.jsx)(h.Modal.Action,{"data-testid":(0,g.tid)("deployment","rollback-modal","continue-button"),disabled:C.length>=T.REASON_MAX_CHARACTER_LENGTH,onClick:()=>{b("selected")},children:"Continue"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(Y,{}),(0,t.jsx)("p",{className:"text-copy-14",children:"This project does not have any valid deployments to roll back to."})]}),(0,t.jsx)(h.Modal.Actions,{children:(0,t.jsx)(h.Modal.Action,{onClick:d,type:"secondary",children:"Cancel"})})]})}function X(e){let{selectedDeployment:l,setStage:i,requestRollback:a,project:n,rollbackReason:s,rollbackCandidates:r}=e,{user:o}=(0,S.useUser)();if(!l)return(0,t.jsx)(V,{setStage:i});let d=s.length>=T.REASON_MAX_CHARACTER_LENGTH,u=(0,T.getMostRecentlyPromotedDeployment)(r);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(Y,{}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-16",children:"Rolling back to:"}),(0,t.jsx)(B.DeploymentCardSmall,{deployment:l,isPreviousDeployment:l.uid===u?.uid,selectedDeployment:l,setSelectedDeployment:()=>null})]}),s.trim()&&(0,t.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:(0,t.jsx)(T.RollbackDescriptionCard,{rollbackDescription:{description:s.trim(),userId:o?.uid??"",username:o?.username??"",deploymentId:l.uid,projectId:n?.id??"",createdAt:new Date().getTime()},project:n,preview:!0})}),(0,t.jsxs)(A.UL,{className:"mb-0",children:[(0,t.jsx)(A.LI,{children:"Instant Rollback assigns domains to a previous deployment. All Environment Variables from the original build will remain. Cron jobs will be reverted to the state of the previous deployment."}),(0,t.jsxs)(A.LI,{children:[(0,t.jsxs)(R.Link,{className:"inline-flex items-center text-[var(--geist-success)] no-underline",href:`https://${l.url}`,target:"_blank",children:["View the selected deployment ",(0,t.jsx)(c.ExternalSmall,{className:"ml-1"})]})," ","before rolling back—external APIs, databases, and CMS platforms may not behave as expected."]}),(0,t.jsx)(A.LI,{children:"You can update the rollback reason from the project overview."})]}),(n?.autoAssignCustomDomains??!0)||n?.lastAliasRequest?.type==="rollback"?(0,t.jsx)(x.Note,{fill:!0,type:"secondary",children:(0,t.jsx)("div",{className:"flex flex-row items-center justify-start gap-4 flex-initial",children:(0,t.jsx)("div",{className:"flex flex-col items-start justify-start flex-initial",children:(0,t.jsx)("p",{className:"text-copy-14 text-inherit",children:"After rolling back, production deployments will not be automatically promoted until the rollback is removed."})})})}):null]})]}),(0,t.jsxs)(h.Modal.Actions,{children:[(0,t.jsx)(h.Modal.Action,{onClick:()=>{i("initial")},type:"secondary",children:"Back"}),(0,t.jsx)(h.Modal.Action,{"data-testid":(0,g.tid)("deployment","rollback-modal","rollback-button"),disabled:d,onClick:()=>{a(l.uid),i("processing")},children:"Confirm Rollback"})]})]})}function G(e){let{jobStatus:i,rollbackDeploymentId:a,rollbackCandidates:n,selectedDeployment:s,setStage:r,onCancel:o,statusSwr:d,requestRollback:c,rollbackReason:p}=e,{user:x}=(0,S.useUser)();if((0,l.useEffect)(()=>{a===s?.uid&&("failed"===i?r("error"):"succeeded"===i&&r("done"))},[a,i,s,r]),!s)return(0,t.jsx)(V,{setStage:r});let f=(0,T.getMostRecentlyPromotedDeployment)(n);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.Modal.Body,{children:[(0,t.jsx)(Y,{}),(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,t.jsx)("p",{className:"text-copy-14",children:"Assigning production domains:"}),(0,t.jsx)(B.DeploymentCardSmall,{deployment:s,isPreviousDeployment:s.uid===f?.uid,selectedDeployment:s,setSelectedDeployment:()=>null})]}),""!==p?(0,t.jsxs)("div",{className:"rounded bg-background-200 px-4 py-3 shadow-border",children:[(0,t.jsxs)("p",{className:"text-copy-14 text-gray-900",children:["“",(0,t.jsx)(O.LinkParser,{text:p.trim()}),"”"]}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[(0,t.jsx)("p",{className:"text-copy-14",children:"Rolled back by"}),x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(U.PrincipalAvatar,{size:20,principalId:x.uid,principal:{type:"user",uid:x.uid,username:x.username}}),(0,t.jsx)("p",{className:"text-copy-14",children:x.username})]}):null]})]}):null,(0,t.jsxs)(A.UL,{className:"mx-4 my-0 list-none pt-2",children:[d.aliases.map(e=>{let l="loading";return"completed"===e.status?l="success":"failed"===e.status&&(l="error"),(0,t.jsx)(A.LI,{children:(0,t.jsxs)("div",{className:"h-6 flex items-center gap-2",children:["loading"===l&&(0,t.jsx)(u.Spinner,{className:"shrink-0",size:16}),"error"===l&&(0,t.jsx)(j.WarningFill,{className:"shrink-0",color:"amber-800",size:16}),"success"===l&&(0,t.jsx)(y.CheckCircleFill,{className:"shrink-0",color:"blue-700",size:16}),(0,t.jsx)("span",{className:"text-copy-14 truncate",children:e.alias})]})},e.alias)}),!d.isReachingEnd&&d.initialDataLoaded?(0,t.jsx)(A.LI,{children:(0,t.jsx)(m.Button,{loading:d.isLoadingMore,onClick:()=>{d.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})}):null]})]})]}),(0,t.jsx)(h.Modal.Actions,{children:(0,t.jsx)(h.Modal.Action,{"data-testid":(0,g.tid)("deployment","rollback-modal","finish-button"),fullWidth:!0,loading:"failed"!==i&&"succeeded"!==i,onClick:()=>{"failed"===i?c(s.uid):"succeeded"===i&&(r("initial"),o())},children:"failed"===i?"Retry":"Done"})})]})}function Q(e){let{active:a,initialSelectedDeployment:n,onCancel:s,productionBranch:r,productionDeployment:o,projectId:d,rollbackCandidates:c,swr:u,rollbackDescription:m}=e,{mutate:x}=(0,C.useSWRConfig)(),[y,f]=(0,l.useState)("initial"),[j,S]=(0,l.useState)(""),{isReady:A,team:R}=(0,i.useTeam)(),D=(0,p.useToasts)(),M=(0,l.useMemo)(()=>{let e=c.filter(e=>e.uid!==o.id);return(0,T.getMostRecentlyPromotedDeployment)(e)},[c,o]),[O,B]=(0,l.useState)(null),$=O??n??M??null,_=(0,l.useCallback)(f,[f]),F=(0,l.useCallback)(B,[B]),[,{aliases:H}]=(0,I.useAliasesInfinite)({rollbackDeploymentId:o.id}),{data:q}=(0,P.useProject)(d),{lastAliasRequest:W,hasFloatingAliases:U}=q||{lastAliasRequest:void 0,hasFloatingAliases:!1},{toDeploymentId:Y,jobStatus:V}=W||{toDeploymentId:null,jobStatus:null},[,K]=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,{isReady:n,team:s}=(0,i.useTeam)(),r=(0,w.default)((t,l)=>{if(!n)return null;let i={teamId:s?.id,limit:a};return t?l?.next?`${(0,k.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,b.encode)({...i,until:l.next})}`:null:`${(0,k.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,b.encode)(i)}`},e=>(0,v.fetchAPI)(e,{throwOnHTTPError:!0}),{refreshInterval:t}),o=(0,l.useMemo)(()=>r.data?[].concat(...r.data.filter(Boolean).map(e=>e.aliases.slice(0,a))):[],[r.data,a]),d=!!r.data,c=d&&0===o.length,u=d&&r.data&&r.size>r.data.length,m=d&&r.data&&r.data[r.data.length-1]?.aliases.length<a;return[r,{aliases:o,initialDataLoaded:d,isEmpty:c,loadMore:()=>r.setSize(e=>e+1),isLoadingMore:u,isReachingEnd:m,mutate:r.mutate}]}(d,2e3),Q=(0,l.useMemo)(()=>o,[a]),Z=()=>{f("initial"),B(n||M||null),s()},ee=(0,l.useCallback)(async e=>{if(!A)return;let t=`${(0,k.API_DEPLOYMENT_ROLLBACK)(d,e)}${(0,b.encode)({teamId:R?.id,description:j.trim()})}`;try{await (0,v.fetchAPI)(t,{throwOnHTTPError:!0,method:"POST",body:{}}),R&&(void 0!==q&&(0,E.revalidateProject)(x,q),await x((0,L.getProjectProductionDeploymentKey)({projectIdOrName:d,teamId:R.slug})),x((0,z.getRollingReleaseEndpoint)(R.slug,d)))}catch(e){D.error({text:"Something went wrong - please try requesting an Instant Rollback again",key:"rollback-deployment"}),(0,N.captureError)(e)}},[A,d,D,j,x,R,q]),et={rollbackDeploymentId:Y,hasFloatingAliases:!!U,jobStatus:V,onCancel:Z,previousDeployment:M,productionBranch:r,productionDeployment:Q,productionAliases:H.map(e=>{let{alias:t}=e;return t}),project:q,rollbackCandidates:c,setStage:_,selectedDeployment:$,setSelectedDeployment:F,deploymentSwr:u,statusSwr:K,requestRollback:ee,rollbackWarningText:"New deployments will not be automatically assigned production domains until this rollback is removed.",rollbackReason:j,setRollbackReason:S,rollbackDescription:m};return(0,t.jsxs)(h.Modal.Modal,{active:a,"data-testid":(0,g.tid)("deployment","rollback-modal"),onClickOutside:Z,sticky:!0,width:"500px",children:["initial"===y&&(0,t.jsx)(J,{...et}),"selected"===y&&(0,t.jsx)(X,{...et}),["processing","error","done"].includes(y)&&(0,t.jsx)(G,{...et})]})}var Z=e.i(5771992),ee=e.i(5645345),et=e.i(3981247);e.i(3182268);var el=e.i(7849855);e.s(["useInstantRollbackModal",0,function(e){let{onClose:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[s,r]=(0,l.useState)(!1),[d,c]=(0,l.useState)(),{teamSlug:u,projectSlug:m}=(0,el.useProjectAndTeamSlug)(),{data:h}=(0,P.useProject)(d?.name),p=m??d?.name,x=e??h,{data:y}=(0,et.useRollingRelease)({teamIdOrSlug:u,projectSlug:p}),f=y?.rollingRelease?y?.rollingRelease?.canaryDeployment?.id:void 0,{deployment:j,rollbackDescription:g,mutate:b}=(0,o.useProjectProductionDeployment)(x?.name),{can:v}=(0,a.default)({projectIdOrName:x?.name}),k=v(n.Action.Create,n.Resource.DeploymentRollback),S=x?.link?.productionBranch?x.link.productionBranch:void 0,[C,N]=(0,Z.useDeploymentsInfinite)({projectId:x?x.id:"",requireProject:!0,limit:10,rollbackCandidate:!0},{}),{deployments:A,initialDataLoaded:R}=N,w=A.filter(e=>!!e.isRollbackCandidate&&e.uid!==f),I=!!(R&&x&&!w.length),D=(0,l.useCallback)(e=>{c((0,ee.asListDeployment)(e)),r(!0)},[]),M=(0,l.useCallback)(()=>{r(!1),b().finally(()=>null),i?.()},[b,i]);return{rollbackModal:(0,l.useMemo)(()=>k&&s&&j&&x?(0,t.jsx)(Q,{active:s,initialSelectedDeployment:d,onCancel:M,productionBranch:S,productionDeployment:j,projectId:x.id,rollbackCandidates:w,rollbackDescription:g,swr:N}):null,[k,s,d,S,j,w,x,N,M,g]),closeRollbackModal:M,openRollbackModal:D,canRollbackDeployment:k,noRollbackCandidates:I}},"useRollbackTooltip",0,function(e){let{team:t}=(0,i.useTeam)(),a=!t||t.billing?.plan==="hobby",{value:n}=(0,s.useInstantRollbackHobbyRestrictionFlag)(),{value:d}=(0,r.useInstantRollbackHobbyRestrictionTeamFlag)(),c=n||d,u=e?.name,{deployment:m,isLoading:h}=(0,o.useProjectProductionDeployment)(u);return(0,l.useMemo)(()=>{let t=(0,ee.asListDeployment)(e),l=a&&!t?.isRollbackCandidate;return t?h?"Loading…":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be rolled back.":"readySubstate"in t&&"PROMOTED"!==t.readySubstate?"Only Deployments previously aliased to a Production domain can be rolled back.":t.uid===m?.id?"This Deployment is already in Production.":c?t.isRollbackCandidate||"production"===t.target?l?"Hobby customers can only roll back to the previous deployment.":"":"Only Deployments previously aliased to a Production domain can be rolled back.":t.isRollbackCandidate?"":"Only Deployments previously aliased to a Production domain can be rolled back.":""},[e,a,h,m?.id,c])}],9365163)}]);

//# debugId=713db41c-36f5-230e-4d6d-0075a48ae233
//# sourceMappingURL=49d5f940f3c84017.js.map