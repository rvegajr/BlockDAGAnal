;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="92099e22-a74e-358e-7756-576af3eba315")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6198010,e=>{"use strict";let t=(0,e.i(9334638).withNewIcon)('<path fill-rule="evenodd" clip-rule="evenodd" d="M 8.75,1 H7.25 V7.25 H1.5 V8.75 H7.25 V15 H8.75 V8.75 H14.5 V7.25 H8.75 V1.75 Z" fill="currentColor"/>');e.s(["Plus",0,t])},2006677,e=>{"use strict";let t=(0,e.i(9334638).withNewIcon)('<path fill-rule="evenodd" clip-rule="evenodd" d="M8 14.5C11.5899 14.5 14.5 11.5899 14.5 8C14.5 4.41015 11.5899 1.5 8 1.5C4.41015 1.5 1.5 4.41015 1.5 8C1.5 11.5899 4.41015 14.5 8 14.5ZM8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16ZM9 11C9 11.5523 8.55229 12 8 12C7.44772 12 7 11.5523 7 11C7 10.4477 7.44772 10 8 10C8.55229 10 9 10.4477 9 11ZM7.09584 5.82182C7.25716 5.48223 7.6022 5.25 7.99999 5.25C8.55227 5.25 8.99999 5.69772 8.99999 6.25C8.99999 6.75329 8.62748 7.17086 8.14337 7.23989C7.70367 7.3026 7.24999 7.67511 7.24999 8.25V8.5V9.25H8.74999V8.63535C9.76443 8.31661 10.5 7.36971 10.5 6.25C10.5 4.86929 9.3807 3.75 7.99999 3.75C7.00158 3.75 6.14136 4.3353 5.74095 5.17818L5.41913 5.85563L6.77402 6.49926L7.09584 5.82182Z" fill="currentColor"/>');e.s(["Question",0,t])},7867910,e=>{"use strict";var t=e.i(7185353);e.s(["useHotkey",0,function(e,l){(0,t.useEffect)(()=>{let t=t=>{let r=document.activeElement,a=r&&["input","select","textarea"].includes(r.tagName.toLowerCase());t.key.toLowerCase()!==l||a||t.ctrlKey||t.metaKey||(t.preventDefault(),e())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[e,l])}])},4047087,e=>{"use strict";let t=(0,e.i(9334638).withNewIcon)('<path fill-rule="evenodd" clip-rule="evenodd" d="M1 2H1.75H14.25H15V3.5H14.25H1.75H1V2ZM1 12.5H1.75H14.25H15V14H14.25H1.75H1V12.5ZM1.75 7.25H1V8.75H1.75H14.25H15V7.25H14.25H1.75Z" fill="currentColor"/>');e.s(["MenuAlt",0,t])},4998750,e=>{"use strict";var t=e.i(2749380);let l="$time";e.s(["DEFAULT_TIME_VALUE",0,"12h","TIME_VARIABLE",0,l,"extractError",0,function(e){return null==e?"Please retry later":`${e.message??e}`},"parseNotebook",0,function(e){let{variables:l,widgets:r,...a}=e;return{...a,variables:function(e){if(e)return{...e,time:e.time?(0,t.parseTime)(e.time):void 0}}(l),widgets:r?.map(e=>{let{query:{time:l,...r},...a}=e;return{type:"query-visualization",...a,query:{...r,time:(0,t.parseTime)(l)}}})}},"replaceVariables",0,function(e,t){return t?{...e,time:e.time===l&&t.time?t.time:e.time}:e},"serializeVariables",0,function(e){if(!e)return;let{time:t,...l}=e;return{...l,time:t?"string"==typeof t?t:{from:t.from.toISOString(),to:t.to.toISOString()}:void 0}}])},8673480,e=>{"use strict";e.s(["buildSWRKey",0,function(e,t){let{id:l,teamSlug:r}=t;return`${e.replace("{id}",l??"")}?${new URLSearchParams({slug:r}).toString()}`},"updateCachedList",0,function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return l=>{let r=l??{hasAccess:!0,notebooks:[]},a=r.notebooks.findIndex(t=>{let{id:l}=t;return l===e.id});return -1!==a?t?r.notebooks[a]=e:r.notebooks.splice(a,1):t&&r.notebooks.push(e),r}},"updateCachedNotebook",0,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;return r=>{if(!r)return{...e,widgets:t?[t]:void 0};let a={...r,...e};if(l&&(a.widgets=a.widgets?.filter(e=>{let{id:t}=e;return t!==l})),t){a.widgets||(a.widgets=[]);let e=a.widgets.findIndex(e=>{let{id:l}=e;return l===t.id});a.widgets=[...a.widgets.slice(0,e),t,...a.widgets.slice(e+1)]}return a}}])},9372366,e=>{"use strict";var t=e.i(4337458),l=e.i(854682),r=e.i(9667097),a=e.i(1283928),i=e.i(1233856),n=e.i(7185353),s=e.i(8690335),o=e.i(4919835),u=e.i(9486194),d=e.i(9429462),c=e.i(7722264),p=e.i(2107254),m=e.i(9668517),g=e.i(747275);let f=e=>{let{observabilityConfiguration:t}=(0,l.useHasObservabilityPlus)(),r=(0,m.useTeamSlug)(),{data:a,updateSearch:i,search:s}=(0,p.default)({limit:10,latestDeployments:null},{},r??void 0);return{decorate:(0,n.useCallback)(async e=>[...e,...a?.projects.map(e=>{let{id:t,name:l}=e;return{id:t,value:t,label:l}})??[]].map(e=>t?.observabilityPlus.excludedProjects?.some(t=>t.id===e.id)?{...e,disabled:!0,tooltip:"Excluded from Observability Plus"}:e),[t,a]),triggerMutation:async e=>{s!==e.text&&i(e.text)},dimensionId:"projectId"}},v=e=>{let{trigger:t}=(0,d.useDeploymentBadgeResolverMutation)(e);return{decorate:(0,n.useCallback)(async e=>{try{let l=await t();return(0,o.applyBadgesToDeploymentIds)(e,l)}catch{return e}},[t]),triggerMutation:()=>t().catch(()=>{}),dimensionId:"deploymentId"}},h=e=>{let{event:r,measure:a}=(0,s.splitEventAndMeasure)(e),i=(0,t.useSonarQueryScope)(),{hasObservabilityPlusAccess:n}=(0,l.useHasObservabilityPlus)();return{decorate:async(e,t)=>{let{dimension:l,text:s}=t;return i?[...e,...await x({event:r,measure:a,column:l.id,reason:n?"observability_query_builder_plus":"observability_query_builder_free",text:s,...i})]:[]},dimensionId:null}};async function x(e){let{event:t,measure:l,column:n,ownerId:o,reason:d,text:c}=e,p={minutes:5},m=(0,i.startOfDuration)(new Date(Date.now()-36e5),p),g=(0,i.endOfDuration)(new Date,p),f=s.labelColumnByColumn.get(n),v=u.staticDimensionValues.find(e=>e.dimensions.includes(n))?.values,h="number"===a.AllDimensions[n].type;if(v)return v.map(e=>({id:e.id.toString(),value:e.id,..."label"in e?{label:e.label}:{}})).sort((e,t)=>String(e.id).localeCompare(String(t.id)));let x=c?`contains(${f||n},'${c}')`:void 0;return(await (0,r.getSonarData)({event:t,scope:{type:"owner",ownerId:o},reason:d,startTime:m,endTime:g,rollups:{value:{measure:l,aggregation:"sum"}},filter:x,granularity:p,groupBy:f?[n,f]:[n],limit:10,tailRollup:"truncate",summaryOnly:!0})).summary.map(e=>{let t=h?Number.parseFloat(e[n]):e[n];return{id:t.toString(),label:f?e[f]:void 0,value:t}})}e.s(["getDimensionValues",0,x,"useValuesResolver",0,e=>{let t,l,r,{decorate:a,triggerMutation:i}=(t=[h,f,v].map(t=>t(e)),(l=(0,n.useRef)(t)).current=t,r=e=>l.current.filter(t=>null===t.dimensionId||t.dimensionId===e.dimension.id),{decorate:async(e,t)=>{let l=e;for(let e of r(t))l=await e.decorate(l,t);return l},triggerMutation:e=>Promise.all(r(e).map(t=>t.triggerMutation?.(e)))});return async e=>{let{dimension:t,text:l}=e;try{i({dimension:t,text:l});let e=await a([],{dimension:t,text:l});return(0,g.default)(e,"id")}catch(e){return console.error(`Error fetching dimension values. ${(0,c.isError)(e)?e.message:""}`,e),[]}}}])},5627633,e=>{"use strict";var t=e.i(8238153),l=e.i(8492421);let r=["years","months","weeks","days","hours","minutes","seconds"];e.s(["formatDuration",0,function(e,a){let i=(0,l.getDefaultOptions)(),n=a?.locale??i.locale??t.defaultLocale,s=a?.format??r,o=a?.zero??!1,u=a?.delimiter??" ";return n.formatDistance?s.reduce((t,l)=>{let r=`x${l.replace(/(^.)/,e=>e.toUpperCase())}`,a=e[l];return void 0!==a&&(o||e[l])?t.concat(n.formatDistance(r,a)):t},[]).join(u):""}])},3675495,e=>{"use strict";let t=(0,e.i(9334638).withNewIcon)('<path fill-rule="evenodd" clip-rule="evenodd" d="M11.4749 1.33217L11.1964 2.02853L6.19636 14.5285L5.91781 15.2249L4.5251 14.6678L4.80364 13.9714L9.80364 1.47144L10.0822 0.775085L11.4749 1.33217ZM4 5.49999C4.82843 5.49999 5.5 4.82841 5.5 3.99999C5.5 3.17156 4.82843 2.49999 4 2.49999C3.17157 2.49999 2.5 3.17156 2.5 3.99999C2.5 4.82841 3.17157 5.49999 4 5.49999ZM7 3.99999C7 5.65684 5.65685 6.99999 4 6.99999C2.34315 6.99999 1 5.65684 1 3.99999C1 2.34313 2.34315 0.999986 4 0.999986C5.65685 0.999986 7 2.34313 7 3.99999ZM13.5 12C13.5 12.8284 12.8284 13.5 12 13.5C11.1716 13.5 10.5 12.8284 10.5 12C10.5 11.1716 11.1716 10.5 12 10.5C12.8284 10.5 13.5 11.1716 13.5 12ZM12 15C13.6569 15 15 13.6568 15 12C15 10.3431 13.6569 8.99999 12 8.99999C10.3431 8.99999 9 10.3431 9 12C9 13.6568 10.3431 15 12 15Z" fill="currentColor"/>');e.s(["Percentage",0,t])},9192216,e=>{"use strict";var t=e.i(847684),l=e.i(4004502),r=e.i(9376050),a=e.i(9689002),i=e.i(5255926),n=e.i(8735244),s=e.i(5883567),o=e.i(6143247),u=e.i(7185353);function d(e){let{heading:l,items:a,setSearch:i,renderItem:n,getId:s,getValue:u,onChange:d,addBorder:c}=e;return a.length?(0,t.jsx)(r.Command.Group,{className:(0,o.cn)("h-full p-1.5  [&>[cmdk-group-heading]]:px-2 [&>[cmdk-group-heading]]:pb-1 [&>[cmdk-group-heading]]:pt-0.5 [&>[cmdk-group-heading]]:text-xs [&>[cmdk-group-heading]]:text-gray-800",c&&"border-b"),heading:l,children:a.map(e=>(0,t.jsx)(r.Command.Item,{className:"w-full cursor-pointer rounded-md text-sm *:aria-selected:rounded  *:aria-selected:bg-gray-100 focus-visible:bg-gray-100 active:bg-gray-100",onSelect:()=>{d(e),i("")},value:u(e),children:n(e)},s(e)))}):null}function c(e){let{search:l,onAddNew:a,addLabel:i,allowEmptyAdd:n,label:o}=e,u=l.length>0?`${i} "${l}"`:n?`${i} new ${o}`:"",d=l.length>0?l:"new-item";return(0,t.jsx)(r.Command.Group,{className:"sticky bottom-0 z-10 rounded-b-lg border-t outline-none -mt-px",children:(0,t.jsx)(r.Command.Item,{"aria-label":u,className:"flex w-full cursor-pointer bg-white items-center p-1 text-gray-900 *:aria-selected:rounded *:aria-selected:bg-gray-100 focus-visible:bg-gray-100 active:bg-gray-100",onSelect:()=>a(l||""),value:d,children:(0,t.jsxs)("div",{className:"flex w-full items-center gap-2 p-1.5",children:[(0,t.jsx)(s.PlusCircle,{size:14}),(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:u})]})})})}e.s(["CommandMenu",0,function(e){let{label:s,options:p,isLoading:m,isSelected:g,onChange:f,onSearch:v,parseNewValue:h,getId:x,getValue:b,value:y,open:C,reverse:w,allowEmptyAdd:j=!1,addLabel:N="Add",...V}=e,[S,k]=(0,u.useState)(""),[O,D]=(0,u.useState)(!1),[I,M]=(0,u.useState)(!1),A=(0,u.useRef)(null),F=(0,u.useRef)(null),H=(0,u.useRef)(0);(0,u.useEffect)(()=>{y&&C&&setTimeout(()=>{let e=F.current?.querySelector(`[data-value="${b(y)}"]`);e?.scrollIntoView({block:"start"})},50)},[C]);let L=(0,u.useMemo)(()=>p?.length?`Find ${s}...`:`Enter ${s}`,[p,s]),{selected:P,groups:B}=(0,u.useMemo)(()=>{let e={selected:[],groups:{}};for(let t of p??[])if(g?.(t))e.selected.push(t);else{let l=t.group??"";l in e.groups||(e.groups[l]=[]),e.groups[l].push(t)}return e},[p,g]),$=(0,u.useMemo)(()=>h&&(S.length>0?(p??[]).every(e=>x(e)!==S):j),[S,p,x,h,j]),E=(0,u.useCallback)(e=>{if(h){let t=h(e);null===t?D(!0):(f(t),k(""),A.current?.focus())}},[f,h]),T=(0,u.useCallback)(e=>{k(e),D(!1),clearTimeout(H.current),v&&(H.current=setTimeout(()=>{M(!0),v(e).finally(()=>M(!1))},250))},[v]),R=(0,u.useCallback)(e=>{if("Tab"===e.key)e.key=e.shiftKey?"ArrowUp":"ArrowDown";else if(" "===e.key&&0===S.trim().length){e.preventDefault();let t=F.current?.querySelector('[aria-selected="true"] input[type="checkbox"]');t?.click()}},[S]);return(0,t.jsxs)(r.Command,{className:(0,o.cn)("w-100 rounded-lg border-gray-alpha-400 bg-background-100 shadow-menu flex",w?"flex-col-reverse":"flex-col"),loop:!0,onKeyDown:R,children:[(0,t.jsxs)("div",{className:(0,o.cn)("flex w-full items-center justify-between px-4 py-3",p?.length!==0&&"border-b"),children:[(0,t.jsx)(r.Command.Input,{className:(0,o.cn)("w-full border-none bg-transparent text-sm outline-none",O&&"text-[--geist-error]"),onValueChange:T,placeholder:L,ref:A,value:S}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-[14px] flex justify-center",children:I&&(0,t.jsx)(n.Spinner,{size:14})}),(0,t.jsx)(a.Kbd,{small:!0,children:"Esc"})]})]}),(0,t.jsxs)(r.Command.List,{className:"flex max-h-[288px] w-full flex-col overflow-y-auto",ref:F,children:[p&&!m?(0,t.jsxs)(t.Fragment,{children:[P.length?(0,t.jsx)(d,{addBorder:!0,getId:x,getValue:b,items:P,onChange:f,setSearch:k,...V}):null,Object.entries(B).map(e=>{let[l,r]=e;return(0,t.jsx)(d,{getId:x,getValue:b,heading:l,items:r,onChange:f,setSearch:k,...V},l)})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2 p-2","data-testid":(0,l.tid)("command-menu","loading"),children:[(0,t.jsx)(i.Skeleton,{className:"h-4",width:"100%"}),(0,t.jsx)(i.Skeleton,{className:"h-4",width:"100%"}),(0,t.jsx)(i.Skeleton,{className:"h-4",width:"100%"})]}),!m&&!I&&p&&(0,t.jsxs)(r.Command.Empty,{className:"px-4 py-3 text-center text-sm text-gray-900",children:["No matching ",s.toLowerCase()]}),$?(0,t.jsx)(c,{onAddNew:E,search:S,addLabel:N,allowEmptyAdd:j,label:s}):null]})]})}])},5376857,8569407,e=>{"use strict";let t=(0,e.i(7185353).createContext)(null);t.displayName="FilterBarContext",e.s(["FilterBarContext",0,t],5376857);var l=e.i(847684),r=e.i(2504781),a=e.i(1971436),i=e.i(6143247);e.s(["AddFilter",0,function(e){let{iconOnly:t,...n}=e;return(0,l.jsx)(r.Button,{"aria-label":"Add filter",prefix:t?void 0:(0,l.jsx)(a.FilterSmall,{}),shape:t?"square":void 0,size:"small",...n,className:(0,i.cn)("!text-gray-900 hover:!text-gray-1000 data-[state='open']:!bg-gray-100",!t&&"!pl-2",n.className),type:"tertiary",typeName:"button",children:t?(0,l.jsx)(a.FilterSmall,{}):"Add filter"})}],8569407)},1482596,8815885,2789287,e=>{"use strict";var t=e.i(847684),l=e.i(7185353),r=e.i(5376857),a=e.i(8569407),i=e.i(2504781),n=e.i(9096446),s=e.i(6143247),o=e.i(4004502),u=e.i(1821888),d=e.i(9722978),c=e.i(3869281),p=e.i(5468328),m=e.i(3306538),g=e.i(9192216),f=e.i(5778089);let v=e=>{let{label:t,id:l}=e;return`${l}${t?`
${t}`:""}`};function h(e){let{values:r,options:a,label:n,rounded:s=!1,size:o="small",onOpenChange:p,onChange:h,onSearch:b,open:y,className:C,parseNewValue:w,children:j,disabled:N,availableOperators:V}=e,S=(0,l.useCallback)(e=>r.some(t=>{let{id:l}=t;return l===e.id}),[r]),k=(0,l.useCallback)(e=>{let l="string"==typeof e.label&&e.label.length>0,r=l?e.label:e.id;return(0,t.jsx)(x,{text:e.tooltip,children:(0,t.jsxs)("div",{className:(0,d.clsx)("flex w-full items-center gap-2 px-2 py-1.5",e.disabled&&"cursor-not-allowed opacity-75"),onClick:t=>{let l=document.getSelection();if(l?.isCollapsed===!1){t.preventDefault(),t.stopPropagation();return}t.target.closest("label")&&(t.preventDefault(),t.stopPropagation(),h(e,!0))},children:[!V||V.some(e=>"multiple"===e.type||"array"===e.type)?(0,t.jsx)(c.Checkbox,{checked:S(e),disabled:e.disabled,onChange:()=>void 0,tabIndex:-1}):null,(0,t.jsx)("div",{className:"flex min-w-0 flex-1 max-w-[min(32rem,75vw)] flex-col items-start",children:l&&e.label!==e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"w-full truncate font-medium leading-tight",title:e.label,children:e.label}),(0,t.jsx)("span",{className:"w-full truncate text-sm text-gray-800 leading-tight",title:e.id,children:e.id})]}):""===r?(0,t.jsx)("span",{className:"text-sm text-gray-800",children:f.emptyStringReplacement}):(0,t.jsx)("span",{className:"w-full truncate",title:r,children:r})}),e.badge?(0,t.jsx)("div",{className:"ml-2 shrink-0",children:(0,t.jsx)(x,{text:e.badge.tooltip,children:(0,t.jsx)(m.Badge,{size:"sm",...e.badge})})}):null]})})},[h,S,V]);return(0,t.jsxs)(u.Root,{modal:!0,onOpenChange:p,open:y,children:[(0,t.jsx)(u.Anchor,{className:"flex",children:(0,t.jsx)(u.Trigger,{asChild:!0,children:j||(0,t.jsx)(i.Button,{className:(0,d.clsx)("!ring-1 ring-gray-400 focus:z-10 focus:ring-gray-500",!s&&"rounded-[0!important]","left"===s&&"rounded-r-[0!important]","right"===s&&"rounded-l-[0!important]",N&&"bg-[var(--themed-bg)!important]",C),disabled:N,size:o,type:"secondary",typeName:"button",children:(0,f.getValueLabel)(r,n)})})}),(0,t.jsx)(u.Portal,{children:(0,t.jsx)(u.Content,{align:"start",className:"tailwind-preflight",onCloseAutoFocus:()=>p(!1),sideOffset:8,children:(0,t.jsx)(g.CommandMenu,{getId:f.getValueId,getValue:v,isSelected:S,label:n,onChange:h,onSearch:b,options:a,parseNewValue:w,renderItem:k})})})]})}function x(e){let{text:l,children:r}=e;return l?(0,t.jsx)(p.Tooltip,{className:"w-full",text:l,children:r}):r}var b=e.i(6198010);let y=e=>{let{id:t}=e;return t},C=e=>{let{label:t,group:l}=e;return`${t}${l?` ${l}`:""}`},w=e=>(0,t.jsxs)("div",{className:"flex w-full items-center gap-2 rounded px-2 py-1.5",children:["icon"in e&&e.icon?(0,t.jsx)(e.icon,{className:"size-4"}):null,e.label]});function j(e){let{label:l,value:r,options:a,onOpenChange:n,open:s,onChange:o,isLoading:c,rounded:p=!1,size:m="small",className:f,children:v,disabled:h,prefix:x,suffix:j,id:N}=e;return(0,t.jsxs)(u.Root,{modal:!0,onOpenChange:n,open:s,children:[(0,t.jsx)(u.Anchor,{className:"flex",children:(0,t.jsx)(u.Trigger,{asChild:!0,children:v||(0,t.jsx)(i.Button,{id:N,"aria-label":`Select ${l}`,className:(0,d.clsx)("!px-1",!p&&"rounded-[0!important]","left"===p&&"rounded-r-[0!important]","right"===p&&"rounded-l-[0!important]",h&&"bg-[var(--themed-bg)!important]",f),disabled:h,prefix:r&&"icon"in r&&r.icon?(0,t.jsx)(r.icon,{className:"size-4"}):x,size:m,suffix:j,type:"secondary",typeName:"button",children:r?r.label:(0,t.jsx)(b.Plus,{"aria-label":`Select ${l}`})})})}),(0,t.jsx)(u.Portal,{children:(0,t.jsx)(u.Content,{align:"start",className:"tailwind-preflight",sideOffset:8,children:(0,t.jsx)(g.CommandMenu,{getId:y,getValue:C,isLoading:c,label:l,onChange:o,open:s,options:a,renderItem:w,value:r})})})]})}e.s(["SingleFilterPopoverBox",0,j],8815885);var N=e.i(8914449);function V(e){let t=(0,l.useContext)(r.FilterBarContext);if(!t)throw Error("Missing FilterBarContext.Provider in the React tree");return(0,N.useStore)(t,e)}function S(e){let{value:{value:r}={id:"",value:""},onChange:a,onToggle:i,disabled:n,ref:s}=e,[o,u]=(0,l.useState)(r);return(0,t.jsx)("div",{className:"focus:border-rounded -my-px flex items-center border bg-background-100 px-2",children:(0,t.jsx)("input",{"aria-label":"input value",className:(0,d.clsx)("block w-full bg-background-100 focus:outline-none focus:ring-transparent sm:text-sm",n&&"bg-[--themed-bg] text-gray-700"),disabled:n,onBlur:()=>{o!==r&&a((0,f.toValueObj)(o)),i(!1)},onChange:e=>u(e.target.value),onFocus:()=>i(!0),ref:s,type:"text",value:o.toString()})})}function k(e){let{index:r}=e,a=V(e=>e.filters),u=V(e=>e.removeFilter),d=V(e=>e.chooseValue),c=V(e=>e.chooseOperator),p=V(e=>e.searchValues),m=V(e=>e.toggleFilter),g=V(e=>e.edited),v=V(e=>e.config.dimensions),x=V(e=>e.disabled),b=(0,l.useRef)(null),{open:y,dimension:C,values:w,operator:N,availableValues:k,availableOperators:O,parseValue:D}=(0,l.useMemo)(()=>({open:null,availableValues:void 0,availableOperators:void 0,parseValue:void 0,values:a[r]?.values??[],operator:a[r]?.operator,...g?.index===r?g:{},dimension:v.find(e=>{let{id:t}=e;return t===a[r]?.dimension})??v[0]}),[g,a,r,v]),I=(0,l.useCallback)(e=>{e&&"value"===y||m(e?"value":null,r)},[r,m,y]),M=(0,l.useCallback)(e=>void m(e?"operator":null,r),[r,m]);return(0,l.useEffect)(()=>{"match"===N.type&&"value"===y&&setTimeout(()=>b.current?.focus(),100)},[y,N.type]),(0,t.jsxs)("div",{className:"flex h-8 items-stretch","data-testid":(0,o.tid)("filter-bar","cascading-filter"),children:[(0,t.jsx)("div",{className:"rounded-l-md bg-background-100 px-2 py-1.5 text-sm font-normal shadow-border",children:(0,f.renderItem)(C,!0)}),(0,t.jsx)(j,{className:"!font-normal !ring-1 ring-gray-400 focus:ring-gray-500",disabled:x,label:"operator",onChange:c,onOpenChange:M,open:"operator"===y,options:O,value:N}),"match"===N.type&&(0,t.jsx)(S,{disabled:x,onChange:d,onToggle:I,ref:b,value:w[0]}),"match"!==N.type&&"valueless"!==N.type&&(0,t.jsx)(h,{disabled:x,label:C.label,onChange:d,onOpenChange:I,onSearch:p,open:"value"===y,options:k,parseNewValue:D,values:w,availableOperators:O}),(0,t.jsx)(i.Button,{"aria-label":"Remove filter",className:(0,s.cn)("!px-0.5 !ring-1 ring-gray-400 hover:!text-gray-1000 focus:ring-gray-500",x?"bg-[var(--themed-bg)!important]":"!text-gray-900"),disabled:x,onClick:()=>u(r),size:"small",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},svgOnly:!0,type:"secondary",typeName:"button",children:(0,t.jsx)(n.CrossSmall,{size:"small"})})]})}function O(){let{dimension:e,operator:l,availableValues:r,availableOperators:i,values:n,parseValue:s}=V(e=>e.edited??{dimension:null,operator:null,availableValues:[],availableOperators:[],values:[],parseValue:void 0}),o=V(e=>e.config.dimensions),u=V(e=>e.edited?.index===null?e.edited.open:null),d=V(e=>e.startNewFilter),c=V(e=>e.chooseDimension),p=V(e=>e.chooseOperator),m=V(e=>e.chooseValue),g=V(e=>e.searchValues),f=V(e=>e.disabled);return e?l?(0,t.jsx)(h,{label:e.label,onChange:m,onOpenChange:d,onSearch:g,open:"value"===u,options:r,parseNewValue:s,values:n,availableOperators:i,children:(0,t.jsx)(a.AddFilter,{disabled:f})}):(0,t.jsx)(j,{label:"operator",onChange:p,onOpenChange:d,open:"value"===u,options:i,children:(0,t.jsx)(a.AddFilter,{disabled:f})}):(0,t.jsx)(j,{label:"dimension",onChange:e=>void c(e),onOpenChange:d,open:"operator"===u,options:o,children:(0,t.jsx)(a.AddFilter,{disabled:f})})}function D(e){let{renderFilter:r,addFilter:a}=e,i=V(e=>e.filters);return(0,t.jsxs)("div",{className:"items-top tailwind-preflight flex flex-wrap gap-2",children:[i.map((e,a)=>(0,t.jsx)(l.Fragment,{children:(r||(e=>e))((0,t.jsx)(k,{index:a}),e,a)},a)),a||(0,t.jsx)(O,{})]})}e.s(["useStore",0,V],2789287);var I=e.i(1154851);function M(e,t,l){let{edited:r}=l();t({edited:r?.index===e?null:r})}function A(e,t,l,r){let{filters:a,edited:i,onChange:n}=r(),s=t?.operator?.type==="valueless",o=void 0===t||s||t.values?.length?[...a.slice(0,e),t?{...a[e],...t}:void 0,...a.slice(e+1)].filter(e=>void 0!==e):a;l({filters:o,edited:t&&i?{...i,operator:t.operator??i.operator,values:t.values??i.values}:null}),n(o)}function F(e,t){let{dimensions:l}=t;return l.find(t=>{let{id:l}=t;return e?.dimension===l})}function H(e,t,l,r){let{valuesByDimension:a,edited:i}=r(),n=[...a[e.id]??[]],s=new Set(n.map(e=>{let{id:t}=e;return t})),o=!(e.id in a);for(let e of t)s.has(e.id)||(s.add(e.id),n.push(e),o=!0);o&&(i?.dimension?.id===e.id&&l({edited:{...i,availableValues:n}}),l({valuesByDimension:{...a,[e.id]:n}}))}function L(e){return"stringArray"===e.type?e=>{let{type:t}=e;return"array"===t||"valueless"===t}:"boolean"===e.type?e=>{let{type:t}=e;return"single"===t||"valueless"===t}:"number"===e.type?e=>{let{type:t}=e;return"multiple"===t||"single"===t||"numerical"===t||"valueless"===t}:e=>{let{type:t}=e;return"multiple"===t||"single"===t||"match"===t||"valueless"===t}}async function P(e,t){let{filters:l,config:r}=t(),a=new Set;for(let e of l){let l=F(e,r);!l||l.id in t().valuesByDimension||a.add(l)}for(let i of(await Promise.allSettled([...a].map(async l=>{H(l,await B({dimension:l},r.resolveValues),e,t)})),l)){let l=F(i,r);"match"!==i.operator.type&&l&&H(l,i.values,e,t)}e({filters:l.map(e=>({dimension:F(e,r)?.id,operator:function(e,t){let{operators:l}=t;return l.find(t=>{let{id:l}=t;return e?.operator.id===l})}(e,r),values:e.values.map(l=>t().valuesByDimension[e.dimension]?.find(e=>e.id===l.id)??l)})).filter(e=>void 0!==e.dimension&&void 0!==e.operator)})}async function B(e,t){let l=t?.(e);return l instanceof Object&&"then"in l?await l??[]:l??[]}function $(e,t){return JSON.stringify(e)===JSON.stringify(t)}e.s(["FilterBar",0,function(e){let{renderFilter:a,addFilter:i,...n}=e,s=(0,l.useRef)((0,I.createStore)()((e,t)=>({config:{dimensions:[],operators:[]},filters:[],onChange:()=>void 0,disabled:!1,operatorUponCreation:!1,autoSelectSingleDimension:!1,edited:null,valuesByDimension:{},setProps:async l=>{let{onChange:r,disabled:a,config:i,filters:n,operatorUponCreation:s,autoSelectSingleDimension:o}=l,u=t();a!==u.disabled&&e({disabled:a}),r!==u.onChange&&e({onChange:r}),s!==u.operatorUponCreation&&e({operatorUponCreation:s}),o!==u.autoSelectSingleDimension&&e({autoSelectSingleDimension:o});let d=!1;if(!$(u.config,i)){e({config:i,filters:n,edited:null});let t=n.filter(e=>{let{dimension:t}=e;return i.dimensions.some(e=>{let{id:l}=e;return l===t})});$(n,t)||(e({filters:t}),r(t)),d=!0}(i.resolveValues!==u.config.resolveValues||i.createValue!==u.config.createValue||i.resolveOperators!==u.config.resolveOperators)&&(e({config:i}),d=!0),$(u.filters,n)||(e({filters:n}),d=!0),d&&await P(e,t)},toggleFilter:async(l,r)=>{let{config:a,disabled:i,edited:n,filters:s,valuesByDimension:o}=t(),u=s[r],d=F(u,a);!i&&u&&d&&(l||n?.index===null||n?.values.length!==0||A(n.index,void 0,e,t),e({edited:l?{index:r,operator:u.operator,values:u.values,open:l,dimension:d,availableOperators:a.operators.filter(L(d)),availableValues:o[d.id],parseValue:(0,f.makeParseValue)(d)}:null}),H(d,await B({dimension:d},a.resolveValues),e,t))},startNewFilter:l=>{let{config:r,disabled:a,edited:i,filters:n,operatorUponCreation:s,autoSelectSingleDimension:o,valuesByDimension:u}=t();if(!a){if(l&&o&&1===r.dimensions.length){let l=r.dimensions[0],a="stringArray"===l.type?r.defaultArrayOperator:r.defaultSingleOperator;e({edited:{index:null,open:"value",dimension:l,operator:s?void 0:a,values:[],availableOperators:r.operators.filter(L(l)),availableValues:u[l.id],parseValue:(0,f.makeParseValue)(l)}}),B({dimension:l},r.resolveValues).then(r=>H(l,r,e,t));return}if(e({edited:l?{index:null,open:"operator",operator:s?void 0:r.defaultSingleOperator,values:[],availableOperators:r.operators}:null}),i?.dimension&&(i.operator?.type==="multiple"||i.operator?.type==="array")){let{values:l,operator:r,dimension:{id:a}}=i;l.length&&A(n.length,{values:l,operator:r,dimension:a},e,t)}}},chooseDimension:async l=>{let{config:r,edited:a,valuesByDimension:i,operatorUponCreation:n}=t();if(!a)return;let s="stringArray"===l.type?r.defaultArrayOperator:r.defaultSingleOperator;e({edited:{...a,open:"value",dimension:l,operator:n?void 0:s,parseValue:(0,f.makeParseValue)(l),availableValues:i[l.id],availableOperators:r.operators.filter(L(l))}}),H(l,await B({dimension:l},r.resolveValues),e,t)},chooseOperator:async l=>{let{edited:r,filters:a}=t();if(!r)return;if(null===r.index)return void("valueless"===l.type&&r.dimension?(e({edited:null}),A(a.length,{dimension:r.dimension.id,operator:l,values:[]},e,t)):e({edited:{...r,open:"value",operator:l}}));if(r.operator?.type==="valueless"&&"valueless"!==l.type){let t={...r,operator:l,open:null};return e({edited:t}),await new Promise(e=>{setTimeout(e,50)}),e({edited:{...t,open:"value"}})}let i=r.values;"multiple"!==l.type&&r.values.length>1&&(i=r.values.slice(0,1)),"valueless"===l.type&&(i=[]),A(r.index,{...a[r.index],operator:l,values:i},e,t),M(r.index,e,t)},chooseValue:(l,r)=>{let{config:a,filters:i,edited:n}=t();if(!n||!n.dimension||!n.operator)return;let{dimension:s,operator:o,values:u}=n;if(function(e,t){let{value:l}=e;return"number"===t.type&&("number"!=typeof l||Number.isNaN(l))||"boolean"===t.type&&!0!==l&&!1!==l}(l,s))return;let d={values:u,operator:o},c=!1;"match"===o.type?d.values=[l]:(u.every(e=>{let{id:t}=e;return t!==l.id})?(H(s,[l],e,t),"multiple"===o.type||"array"===o.type?d.values=[...u,l]:r?(d.values=[...u,l],d.operator=a.defaultMultiOperator):d.values=[l]):(d.values=u.filter(e=>{let{id:t}=e;return t!==l.id}),r&&"multiple"===o.type&&d.values.length<2&&(d.operator=a.defaultSingleOperator)),c=!r),null===n.index?r?e({edited:{...n,...d}}):(d.values.length&&A(i.length,{dimension:n.dimension.id,...d},e,t),e({edited:null})):(0===d.values.length&&c?A(n.index,void 0,e,t):A(n.index,d,e,t),c&&M(n.index,e,t))},searchValues:async l=>{let{config:r,edited:a}=t();if(!a?.dimension)return;let{dimension:i}=a,n=await B({dimension:i,text:l},r.resolveValues);H(i,n,e,t)},removeFilter:l=>{let{disabled:r,filters:a}=t();!r&&a[l]&&A(l,void 0,e,t)},resetOperator:()=>{let{disabled:l,edited:r}=t();!l&&r&&r.dimension&&e({edited:{...r,operator:void 0,values:[],open:"operator"}})},resetDimension:()=>{let{disabled:l,edited:r,config:a}=t();!l&&r&&e({edited:{index:null,values:[],open:"operator",availableOperators:a.operators}})}}))),o=(0,l.useMemo)(()=>n,[n]);return(0,l.useEffect)(()=>{s.current.getState().setProps(o)},[o]),(0,t.jsx)(r.FilterBarContext.Provider,{value:s.current,children:(0,t.jsx)(D,{renderFilter:a,addFilter:i})})}],1482596)}]);

//# debugId=92099e22-a74e-358e-7756-576af3eba315
//# sourceMappingURL=56a301277fb52d78.js.map